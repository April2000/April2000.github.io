(function(a){a(jQuery)})(function(a){a.extend(a.FE.DEFAULTS,{dragInline:!0}),a.FE.PLUGINS.draggable=function(b){function c(q){return q.originalEvent&&q.originalEvent.target&&q.originalEvent.target.nodeType==Node.TEXT_NODE||(q.target&&'A'==q.target.tagName&&1==q.target.childNodes.length&&'IMG'==q.target.childNodes[0].tagName&&(q.target=q.target.childNodes[0]),a(q.target).hasClass('fr-draggable')?void(!b.undo.canDo()&&b.undo.saveStep(),b.opts.dragInline?b.$el.attr('contenteditable',!0):b.$el.attr('contenteditable',!1),b.opts.toolbarInline&&b.toolbar.hide(),a(q.target).addClass('fr-dragging'),!b.browser.msie&&!b.browser.edge&&b.selection.clear(),q.originalEvent.dataTransfer.setData('text','Froala')):(q.preventDefault(),!1))}function d(q){return!(q&&('HTML'==q.tagName||'BODY'==q.tagName||b.node.isElement(q)))}function f(q,r,s){b.opts.iframe&&(q+=b.$iframe.offset().top,r+=b.$iframe.offset().left),p.offset().top!=q&&p.css('top',q),p.offset().left!=r&&p.css('left',r),p.width()!=s&&p.css('width',s)}function g(q){var r=b.doc.elementFromPoint(q.originalEvent.pageX-b.win.pageXOffset,q.originalEvent.pageY-b.win.pageYOffset);if(!d(r)){for(var s=0,t=r;!d(t)&&t==r&&0<q.originalEvent.pageY-b.win.pageYOffset-s;)s++,t=b.doc.elementFromPoint(q.originalEvent.pageX-b.win.pageXOffset,q.originalEvent.pageY-b.win.pageYOffset-s);(!d(t)||p&&0===b.$el.find(t).length&&t!=p.get(0))&&(t=null);for(var u=0,v=r;!d(v)&&v==r&&q.originalEvent.pageY-b.win.pageYOffset+u<a(b.doc).height();)u++,v=b.doc.elementFromPoint(q.originalEvent.pageX-b.win.pageXOffset,q.originalEvent.pageY-b.win.pageYOffset+u);(!d(v)||p&&0===b.$el.find(v).length&&v!=p.get(0))&&(v=null),r=null==v&&t?t:v&&null==t?v:v&&t?s<u?t:v:null}if(a(r).hasClass('fr-drag-helper'))return!1;if(r&&!b.node.isBlock(r)&&(r=b.node.blockParent(r)),r&&0<=['TD','TH','TR','THEAD','TBODY'].indexOf(r.tagName)&&(r=a(r).parents('table').get(0)),r&&0<=['LI'].indexOf(r.tagName)&&(r=a(r).parents('UL, OL').get(0)),r&&!a(r).hasClass('fr-drag-helper')){p||(!a.FE.$draggable_helper&&(a.FE.$draggable_helper=a('<div class="fr-drag-helper"></div>')),p=a.FE.$draggable_helper,b.events.on('shared.destroy',function(){p.html('').removeData().remove(),p=null},!0));var w,x=q.originalEvent.pageY;w=!!(x<a(r).offset().top+a(r).outerHeight()/2);var y=a(r),z=0;w||0!==y.next().length?(!w&&(y=y.next()),('before'!=p.data('fr-position')||!y.is(p.data('fr-tag')))&&(0<y.prev().length&&(z=parseFloat(y.prev().css('margin-bottom'))||0),z=Math.max(z,parseFloat(y.css('margin-top'))||0),f(y.offset().top-z/2-b.$box.offset().top,y.offset().left-b.win.pageXOffset-b.$box.offset().left,y.width()),p.data('fr-position','before'))):('after'!=p.data('fr-position')||!y.is(p.data('fr-tag')))&&(z=parseFloat(y.css('margin-bottom'))||0,f(y.offset().top+a(r).height()+z/2-b.$box.offset().top,y.offset().left-b.win.pageXOffset-b.$box.offset().left,y.width()),p.data('fr-position','after')),p.data('fr-tag',y),p.addClass('fr-visible'),p.appendTo(b.$box)}else p&&0<b.$box.find(p).length&&p.removeClass('fr-visible')}function h(q){q.originalEvent.dataTransfer.dropEffect='move',b.opts.dragInline?!l()&&(b.browser.msie||b.browser.edge)&&q.preventDefault():(q.preventDefault(),g(q))}function j(q){q.originalEvent.dataTransfer.dropEffect='move',b.opts.dragInline||q.preventDefault()}function k(q){b.$el.attr('contenteditable',!0);var r=b.$el.find('.fr-dragging');p&&p.hasClass('fr-visible')&&b.$box.find(p).length?m(q):r.length&&(q.preventDefault(),q.stopPropagation()),p&&b.$box.find(p).length&&p.removeClass('fr-visible'),r.removeClass('fr-dragging')}function l(){for(var q=null,r=0;r<a.FE.INSTANCES.length;r++)if(q=a.FE.INSTANCES[r].$el.find('.fr-dragging'),q.length)return q.get(0)}function m(q){for(var r,s,t=0;t<a.FE.INSTANCES.length;t++)if(r=a.FE.INSTANCES[t].$el.find('.fr-dragging'),r.length){s=a.FE.INSTANCES[t];break}if(s===b&&r.length){if(q.preventDefault(),q.stopPropagation(),p&&p.hasClass('fr-visible')&&b.$box.find(p).length)p.data('fr-tag')[p.data('fr-position')]('<span class="fr-marker"></span>'),p.removeClass('fr-visible');else{var u=b.markers.insertAtPoint(q.originalEvent);if(!1===u)return!1}r.removeClass('fr-dragging');var v=r;if(r.parent().is('A')&&(v=r.parent()),!b.core.isEmpty()){var w=b.$el.find('.fr-marker');w.replaceWith(a.FE.MARKERS),b.selection.restore()}else b.events.focus();if(s==b||b.undo.canDo()||b.undo.saveStep(),!b.core.isEmpty()){var x=b.markers.insert();a(x).replaceWith(v),r.after(a.FE.MARKERS),b.selection.restore()}else b.$el.html(v);return b.popups.hideAll(),b.selection.save(),b.$el.find(b.html.emptyBlockTagsQuery()).not('TD, TH, LI, .fr-inner').remove(),b.html.wrap(),b.html.fillEmptyBlocks(),b.selection.restore(),b.undo.saveStep(),b.opts.iframe&&b.size.syncIframe(),s!=b&&(s.popups.hideAll(),s.$el.find(s.html.emptyBlockTagsQuery()).not('TD, TH, LI, .fr-inner').remove(),s.html.wrap(),s.html.fillEmptyBlocks(),s.undo.saveStep(),s.events.trigger('element.dropped'),s.opts.iframe&&s.size.syncIframe()),b.events.trigger('element.dropped',[v]),!1}}function n(q){if(q&&'DIV'==q.tagName&&b.node.hasClass(q,'fr-drag-helper'))q.parentNode.removeChild(q);else if(q&&q.nodeType==Node.ELEMENT_NODE)for(var r=q.querySelectorAll('div.fr-drag-helper'),s=0;s<r.length;s++)r[s].parentNode.removeChild(r[s])}var p;return{_init:function(){b.opts.enter==a.FE.ENTER_BR&&(b.opts.dragInline=!0),b.events.on('dragstart',c,!0),b.events.on('dragover',h,!0),b.events.on('dragenter',j,!0),b.events.on('document.dragend',k,!0),b.events.on('document.drop',k,!0),b.events.on('drop',m,!0),b.events.on('html.processGet',n)}}}});