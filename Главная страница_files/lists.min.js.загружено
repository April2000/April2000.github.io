(function(a){a(jQuery)})(function(a){a.FE.PLUGINS.lists=function(b){function c(r){return'<span class="fr-open-'+r.toLowerCase()+'"></span>'}function d(r){return'<span class="fr-close-'+r.toLowerCase()+'"></span>'}function f(r,s){for(var v,t=[],u=0;u<r.length;u++)v=r[u].parentNode,'LI'==r[u].tagName&&v.tagName!=s&&0>t.indexOf(v)&&t.push(v);for(u=t.length-1;0<=u;u--){var w=a(t[u]);w.replaceWith('<'+s.toLowerCase()+'>'+w.html()+'</'+s.toLowerCase()+'>')}}function g(r,s){f(r,s);for(var t=b.html.defaultTag(),u=0;u<r.length;u++)'LI'!=r[u].tagName&&(t&&r[u].tagName.toLowerCase()==t?a(r[u]).replaceWith('<'+s+'><li'+b.node.attributes(r[u])+'>'+a(r[u]).html()+'</li></'+s+'>'):a(r[u]).wrap('<'+s+'><li></li></'+s+'>'));b.clean.lists()}function h(r){var s,t;for(s=r.length-1;0<=s;s--)for(t=s-1;0<=t;t--)if(a(r[t]).find(r[s]).length||r[t]==r[s]){r.splice(s,1);break}var u=[];for(s=0;s<r.length;s++){var v=a(r[s]),w=r[s].parentNode;v.before(d(w.tagName)),'LI'==w.parentNode.tagName?(v.before(d('LI')),v.after(c('LI'))):(!b.node.isEmpty(v.get(0),!0)&&0===v.find(b.html.blockTagsQuery()).length&&v.append('<br>'),v.append(c('LI')),v.prepend(d('LI'))),v.after(c(w.tagName)),'LI'==w.parentNode.tagName&&(w=w.parentNode.parentNode),0>u.indexOf(w)&&u.push(w)}for(s=0;s<u.length;s++){var x=a(u[s]),y=x.html();y=y.replace(/<span class="fr-close-([a-z]*)"><\/span>/g,'</$1>'),y=y.replace(/<span class="fr-open-([a-z]*)"><\/span>/g,'<$1>'),x.replaceWith(b.node.openTagString(x.get(0))+y+b.node.closeTagString(x.get(0)))}b.$el.find('li:empty').remove(),b.$el.find('ul:empty, ol:empty').remove(),b.clean.lists(),b.html.wrap()}function k(r,s){for(var t=!0,u=0;u<r.length;u++){if('LI'!=r[u].tagName)return!1;r[u].parentNode.tagName!=s&&(t=!1)}return t}function n(r){b.selection.save();for(var t,s=0;s<r.length;s++)if(t=r[s].previousSibling,t){var u=a(r[s]).find('> ul, > ol').last().get(0);if(u){for(var x,v=a('<li>').prependTo(a(u)),w=b.node.contents(r[s])[0];w&&!b.node.isList(w);)x=w.nextSibling,v.append(w),w=x;a(t).append(a(u)),a(r[s]).remove()}else{var y=a(t).find('> ul, > ol').last().get(0);if(y)a(y).append(a(r[s]));else{var z=a('<'+r[s].parentNode.tagName+'>');a(t).append(z),z.append(a(r[s]))}}}b.clean.lists(),b.selection.restore()}function o(r){b.selection.save(),h(r),b.selection.restore()}function p(r){if('indent'==r||'outdent'==r){for(var s=!1,t=b.selection.blocks(),u=[],v=0;v<t.length;v++)'LI'==t[v].tagName?(s=!0,u.push(t[v])):'LI'==t[v].parentNode.tagName&&(s=!0,u.push(t[v].parentNode));s&&('indent'==r?n(u):o(u))}}return{_init:function(){b.events.on('commands.after',p),b.events.on('keydown',function(r){if(r.which==a.FE.KEYCODE.TAB){for(var s=b.selection.blocks(),t=[],u=0;u<s.length;u++)'LI'==s[u].tagName?t.push(s[u]):'LI'==s[u].parentNode.tagName&&t.push(s[u].parentNode);if(1<t.length||t.length&&(b.selection.info(t[0]).atStart||b.node.isEmpty(t[0])))return r.preventDefault(),r.stopPropagation(),r.shiftKey?o(t):n(t),!1}},!0)},format:function(r){b.selection.save(),b.html.wrap(!0,!0,!0,!0),b.selection.restore();for(var s=b.selection.blocks(),t=0;t<s.length;t++)'LI'!=s[t].tagName&&'LI'==s[t].parentNode.tagName&&(s[t]=s[t].parentNode);b.selection.save(),k(s,r)?h(s):g(s,r),b.html.unwrap(),b.selection.restore()},refresh:function(r,s){var t=a(b.selection.element());if(t.get(0)!=b.el){var u=t.get(0);'LI'!=u.tagName&&(u=t.parents('li').get(0)),u&&u.parentNode.tagName==s&&b.el.contains(u.parentNode)&&r.addClass('fr-active')}}}},a.FE.RegisterCommand('formatUL',{title:'Unordered List',refresh:function(b){this.lists.refresh(b,'UL')},callback:function(){this.lists.format('UL')},plugin:'lists'}),a.FE.RegisterCommand('formatOL',{title:'Ordered List',refresh:function(b){this.lists.refresh(b,'OL')},callback:function(){this.lists.format('OL')},plugin:'lists'}),a.FE.DefineIcon('formatUL',{NAME:'list-ul'}),a.FE.DefineIcon('formatOL',{NAME:'list-ol'})});