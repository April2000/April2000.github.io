function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(t){"use strict";if(void 0===t||null===t)throw new TypeError("Cannot convert first argument to object");for(var r=Object(t),e=1;e<arguments.length;e++){var n=arguments[e];if(void 0!==n&&null!==n)for(var o=Object.keys(Object(n)),i=0,a=o.length;i<a;i++){var f=o[i],u=Object.getOwnPropertyDescriptor(n,f);void 0!==u&&u.enumerable&&(r[f]=n[f])}}return r}}),Object.values||Object.defineProperty(Object,"values",{enumerable:!1,configurable:!0,writable:!0,value:function(t){return"string"==typeof t?t.split(""):Array.isArray(t)?t:"object"!==_typeof(t)?[]:Object.keys(t).map(function(r){return t[r]})}}),Array.prototype.findIndex||(Array.prototype.findIndex=function(t){if(null==this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var r,e=Object(this),n=e.length>>>0,o=arguments[1],i=0;i<n;i++)if(r=e[i],t.call(o,r,i,e))return i;return-1}),Array.from||(Array.prototype.from=function(){var t=Object.prototype.toString,r=function(r){return"function"==typeof r||"[object Function]"===t.call(r)},e=Math.pow(2,53)-1,n=function(t){var r=function(t){var r=Number(t);return isNaN(r)?0:0!==r&&isFinite(r)?(r>0?1:-1)*Math.floor(Math.abs(r)):r}(t);return Math.min(Math.max(r,0),e)};return function(t){var e=Object(t);if(null==t)throw new TypeError("Array.from requires an array-like object - not null or undefined");var o=arguments[1];if(void 0!==o){if(o=arguments.length>1?arguments[1]:void 0,!r(o))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(T=arguments[2])}for(var i,a=n(e.length),f=r(this)?Object(new this(a)):new Array(a),u=0;u<a;)i=e[u],f[u]=o?"undefined"==typeof T?o(i,u):o.call(T,i,u):i,u+=1;return f.length=a,f}}()),Array.prototype.fill||(Array.prototype.fill=function(t){if(null==this)throw new TypeError("this is null or not defined");for(var r=Object(this),e=r.length>>>0,n=arguments[1]>>0,o=n<0?Math.max(e+n,0):Math.min(n,e),i=arguments[2],a=void 0===i?e:i>>0,f=a<0?Math.max(e+a,0):Math.min(a,e);o<f;)r[o]=t,o++;return r}),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,r,e){for(var n=atob(this.toDataURL(r,e).split(",")[1]),o=n.length,i=new Uint8Array(o),a=0;a<o;a++)i[a]=n.charCodeAt(a);t(new Blob([i],{type:r||"image/png"}))}}),Array.prototype.includes||(Array.prototype.includes=function(t){"use strict";var r=Object(this),e=parseInt(r.length,10)||0;if(0===e)return!1;var n,o=parseInt(arguments[1],10)||0;for(o>=0?n=o:(n=e+o)<0&&(n=0);n<e;){var i=r[n];if(t===i||t!=t&&i!=i)return!0;n++}return!1});
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}window.is_dev=!1,window.is_admin=!1,window.is_editor=!1,window.flexbe=window.spaced={isInit:!1,land:{},site:{},admin:{},view:{},init:function(){if(this.isInit)return!1;this.isInit=!0,window.is_editor&&("function"==typeof this.createViews&&this.createViews(),"function"==typeof this.createStores&&this.createStores(),"function"==typeof this.createServices&&this.createServices(),"function"==typeof this.land.init&&this.land.init(),"function"==typeof this.site.init&&this.site.init()),window.is_admin&&"function"==typeof this.admin.init&&this.admin.init()}};var customHistory=[];history.state&&history.replaceState({},""),$(window).off("popstate.core").on("popstate.core",function(t){var i=customHistory.pop(),o=customHistory[customHistory.length-1]||{data:{},title:"",location:null};i&&history.replaceState(o.data,o.title,o.location),"object"===_typeof(i)&&i.data.modal&&flexbe.modal.list[i.data.modal]&&flexbe.modal.list[i.data.modal].close(!1)});
flexbe.panel={adaptive_view:0,init:function(){var e=this;this.$menu=$("#flexbe-panel"),this.lead_notify.init(),this.$menu.find(".hide-button span").off("click").on("click",function(){var t=!e.$menu.hasClass("cute");e.$menu.removeClass("noanimate"),setTimeout(function(){e.$menu.toggleClass("cute",t),localStorage.setItem("panelCute",t?1:"")},30)}),this.$menu.find("a.page-settings.controlled").off("click").on("click",function(e){e.preventDefault(),flexbe.page.settings(flexbe.land.p_id)}),this.$menu.find("a.font-setup").off("click").on("click",function(e){e.preventDefault(),flexbe.land.fonts.setup(),flexbe.stat.event("Editor - Fonts")}),this.$menu.find("a.modals").off("click").on("click",function(e){e.preventDefault(),flexbe.land.modal.control.showList()}),this.popupActions(),this.historyModal(),this.adaptiveInit(),this.convert_theme(),flexbe.support.init(),this.$menu.find(".group-add").on("click",function(e){e.preventDefault(),flexbe.page.create("new")}),this.$menu.find("a.preview").off("click").on("click",function(e){e.preventDefault(),console.log(e.currentTarget.href),flexbe.stat.link(e.currentTarget.href,"Editor - Preview")})},popupActions:function(){this.$menu.off("click.actions").on("click.actions",'a[href*="#"]',function(e){e.preventDefault();var t=$(e.currentTarget),n=t.attr("href"),i=$(n);if(i[0]){if(i.toggleClass("show"),!i.hasClass("show"))return t.removeClass("active"),$document.off("click."+n),!1;t.addClass("active"),setTimeout(function(){$document.off("click."+n).on("click."+n,function(e){$(e.target).closest(i)[0]&&!$(e.target).is("a")||$(e.target).is(t)||($document.off("click."+n),i.removeClass("show"),t.removeClass("active"))})},150)}})},adaptiveInit:function(){var e,t=this.$menu.find("a.adaptive"),n=t.attr("data-is-set")||0;if(void 0===n)return!1;"1"!=n?("0"==n&&(e='\n                <div class="tip-content">\n                    <img class="emoji notebook" src="/_s/images/land/emoji/notebook.png"/>\n\n                    <h2>Адаптивный режим выключен</h2>\n\n                    Включение адаптивного режима обеспечит подходящее отображение лендинга на мобильных телефонах и планшетах.\n\n                    <div class="buttons-holder">\n                        <a href="/admin/settings/adaptive/" class="gubert-button filled green"><span>Включить</span></a>\n                        <div class="ignore">Позже</div>\n                    </div>\n                    <a class="close"></a>\n                </div>'),flexbe.tip.show(t,{position:"bottom",animation:"fade",trigger:"click",interactive:"click",hideOnClick:!0,contentAsHTML:!0,maxWidth:360,minWidth:360,theme:"flexbe-info-tip white",arrowColor:"#FFF",content:e,functionReady:function(e,i){i.find(".ignore, .close").off().on("click",function(e){e.preventDefault(),t.tooltipster("hide")}),e.addClass("active tips-show"),$("body > .menu-pages-overlay").remove(),$("body").append('<div class="menu_pages_overlay"></div>'),"0"==n&&flexbe.stat.event("Editor - Responsive view not available")},functionAfter:function(e){e.removeClass("active tips-show"),$(".menu-pages-overlay").remove()}})):this.adaptiveButton()},convert_theme:function(){var e=this.$menu.find("a.page-settings"),t=flexbe.land.theme_id;if(is_editor&&2!=flexbe.land.theme_id)if(e.tooltipster({position:"bottom",animation:"fade",trigger:"custom",interactive:"click",hideOnClick:!0,contentAsHTML:!0,maxWidth:360,minWidth:360,theme:"flexbe-info-tip blue",arrowColor:"#507cff",content:"",functionReady:function(t,n){t.addClass("tips-show"),$("body > .menu-pages-overlay").remove(),$("body").append('<div class="menu_pages_overlay"></div>');n.find(".ignore, .close").off("click").on("click",function(){t.removeClass("tips-show"),$(".menu-pages-overlay").remove(),e.tooltipster("hide"),localStorage.setItem("showConvert-"+flexbe.land.p_id,1),localStorage.removeItem("themeUpdated-"+flexbe.land.p_id)}),n.find(".update").off("click").on("click",function(e){$(e.currentTarget).addClass("loading"),flexbe.page.update_theme(flexbe.land.p_id,3,function(e){location.reload()})})}}),1===t);else if(3===t&&localStorage.getItem("themeUpdated-"+flexbe.land.p_id)){e.tooltipster("content",'\n            <div class="tip-content">\n                <h2>Дизайн обновлен</h2>\n\n                Практически идеально.<br>\n                Новые возможности шаблона помогут сделать страницу охренительно прекрасной.\n                <br><br>\n                Вы можете отменить обновление<br>в настройках страницы.\n\n                <div class="buttons-holder">\n                    <div class="gubert-button filled yellow close"><span>Готово</span></div>\n                </div>\n\n                <a class="close"></a>\n            </div>'),setTimeout(function(){e.tooltipster("show")},600)}},adaptiveButton:function(){var e=this,t=this.$menu.find("a.adaptive");t.off().on("click",function(n){n.preventDefault(),e.adaptive_view?(e.adaptive_view=0,t.removeClass("active"),$("#flexbe-view").removeAttr("class")):(e.adaptive_view=1,t.addClass("active"),$("#flexbe-view").removeAttr("class").addClass("mobile")),flexbe.stat.event("Editor - Responsive view")})},historyModal:function(){var e=this.$menu.find("#page-history ul");this.$menu.find("a.history").off("click.load_history").on("click.load_history",function(t){flexbe.page.versions(flexbe.land.p_id,function(t){var n="",i="";if(0===t.length)n='<li class="loading no-saves">Нет сохранений</li>';else for(var a=t.length-1;a>=0;a--)i="",1==t[a].selected&&(i='<svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/_s/images/land/editor/panel.svg#history"></use></svg>'),n+='<li><a data-v_id="'+t[a].v_id+'" data-v_date="'+t[a].v_date+'" href="#restore_'+t[a].v_id+'">\n                                '+i+"\n                                <span>"+t[a].time_str+"</span>\n                            </a></li>";e.html(n),e.off("click").on("click","a",function(e){e.preventDefault();var t=$(e.currentTarget).data("v_id"),n=$(e.currentTarget).data("v_date"),i=$('<div class="confirm-restore-messge"><p class="title">Восстановить версию страницы <br><span>от '+n+'</span>?</p><a href="#restore" class="btn_green rewrite">Восстановить</a><a href="#cancel" class="btn_light">Отмена</a></div>');i.find('a[href="#restore"]').on("click",function(e){e.preventDefault();var n=$(e.currentTarget);n.addClass("loading").text("Восстановление..."),flexbe.page.restore(t,flexbe.land.p_id,function(e){e?location.reload():(n.removeClass("loading").text("Восстановить"),alertify.error("Не удалось восстановить эту версию"))})}),i.find('a[href="#cancel"]').on("click",function(){return flexbe.land.confirm_modal.close(),!1}),flexbe.land.confirm_modal=flexbe.modal.create({title:"Восстановление предыдущей версии страницы",width:500,name:"confirm_version_restore",$data:i})})}),flexbe.stat.event("Editor - Save history view")})},lead_notify:{$el:!1,init:function(){this.$el=$("#flexbe-panel .unread-cnt")},updateCnt:function(e){var t=parseInt(this.$el.text(),10);!0===e?e=t+1:!1===e&&(e=t-1),this.$el.text(e||""),e>t&&(flexbe.support.playNotify(),$("html").trigger("update_leads"))}}};
flexbe.support={unread:0,offlineInterval:null,init:function(){var t=this;this.tag||(this.socket.init(new WebSocket(this.socket.url,"echo-protocol"),this),$(".support-btn").on("click.support",function(){t.readAll(),t.tag?t.tag.update({show:!0}):($("body").append('<div data-is="support-chat"></div>'),t.tag=riot.mount("support-chat",{support:t})[0],setTimeout(function(){t.tag.update({show:!0})},25)),flexbe.stat.event("Support chat")}),$(document).on("keydown.tip_modal",function(e){t.tag&&($(".overlay-support-preview").length?$(".overlay-support-preview").trigger("click"):t.tag.showSmiles?t.tag.update({showSmiles:!1}):27===e.keyCode&&t.tag.update({show:!1}))}))},socket:{instance:null,url:"wss://ws.flexbe.com:3130",init:function(t,e){var a=this;this.instance=t,t.onopen=function(){t.send(JSON.stringify({event:"connect",socketsig:flexbe.socketsig})),e.tag&&(clearInterval(e.offlineInterval),e.offlineInterval=null,e.tag.connect=!0)},t.onclose=function(t){t.wasClean||(setTimeout(function(){e.socket.init(new WebSocket(e.socket.url,"echo-protocol"),e)},5e3),e.tag&&!e.offlineInterval&&(e.offlineInterval=e.tag.offlineLoad())),e.tag&&(e.tag.connect=!1)},t.onmessage=function(t){var n=JSON.parse(t.data),s=e.tag;switch(n.event){case"leads_unread_cnt":1*n.site.group_id==1*flexbe.land.group_id&&flexbe.panel.lead_notify.updateCnt(n.msg_data.leads_unread_cnt);break;case"support_message":case"app_message":var o;if(2===n.msg_type&&e.playNotify(),s&&s.show?e.readAll():(a.unread+=1,$("#flexbe-panel .support-btn em").html(a.unread||"")),s)n.msg_text&&(n.msg={text:n.msg_text}),n.time_day=n.time_day||s.lastMessage.time_day||"Сегодня",(o=s.cash[n.time_day])||(o=s.cash[n.time_day]=[],s.dates.push(o)),s.lastMessage=n,o.push(s.lastMessage),s.lastMessage.msg.hasOwnProperty("text")&&(s.lastMessage.isNew=!0),s.update(),s.scrollDown()}},t.onerror=function(){e.tag&&(e.tag.connect=!1)}}},readAll:function(){var t=this.socket.instance;this.unread=0,$.get("/admin/support/read/",{},function(){}),t.readyState===t.OPEN&&this.socket.instance.send(JSON.stringify({event:"support_read_msg",socketsig:flexbe.socketsig})),$("#flexbe-panel .support-btn em").html(this.unread||"")},playNotify:function(){var t;if(!(t=document.createElement("audio")).canPlayType||!t.canPlayType("audio/mpeg;").replace(/no/,""))return!1;void 0===this.notify&&(this.notify=new Audio,this.notify.src="/_s/files/notify.mp3"),this.notify.pause(),this.notify.play()}};
flexbe.modal={list:{},create:function(t){var e=$.extend({handle:".flexbe_modal_title",cancelClass:"flexbe_modal_close",cancelText:"",type:"window",animate:!0,duplicate:!0,riotDelay:0,riotTag:void 0,riotOpts:{},$data:void 0,name:"",title:!1,limit:{top:10,left:100,right:100,bottom:70},width:0,height:0,iframe:!1,overlay:"overlay"!==t.type&&flexbe.admin.settings,editor_stop:!1,click_out:!0,tabs:void 0,on_tab_change:function(){return!0},on_init:function(){},open:function(){},cancel:function(){},close:function(){}},t),i=this.list[e.name];return!e.duplicate&&i&&$(".flexbe_modal, .flexbe-overlay-modal").filter("[data-name="+e.name+"]").length?i.show():(i=new this.Window(e),this.list[e.name]=i),i},load:function(t,e){var i=this,a=$.ajax({url:"/admin/modal/?",type:"POST",dataType:"json",data:{load_name:t}});a.done(function(t){e.template=t.template,e.vars=$.extend({},t.vars,e.vars),i.create(e)}),a.fail(function(){alertify.error("Ошибка, не удалось загрузить шаблон")})}},flexbe.modal.Window=function(t){var e=this,i=[];if(t.title){var a=[];if(t.tabs){var o=[];Object.values(t.tabs).forEach(function(t){o.push('<a class="tab'+(t.active?" active":"")+'">'+t.title+"</a>")}),a=['<div class="tabs">'].concat(o,["</div>"])}i=['<div class="flexbe_modal_title clear '+(t.overlay?"nodraggable":"")+'">\n                <div class="title-wrap">\n                    <div class="title">\n                        <i></i>\n                        <span class="title-inner">\n                            '+t.title+'\n                        </span>\n                    </div>\n                    <a class="'+t.cancelClass+'">'+t.cancelText+"</a>\n                </div>"].concat(a,["</div>"])}var n,l=['<div class="overlay-area'+(t.overlay?" shadow":"")+' on" style="opacity: 0" tabindex="0">\n            <div class="'+("overlay"===t.type?"flexbe-overlay-modal":"flexbe_modal")+(t.tabs?" flexbe_modal_tabs":"")+'" data-name="'+t.name+'">'].concat(i,['<div class="flexbe_modal_data scrollable-content" data-name="'+t.name+'"></div>\n                 <div style="clear:both"></div>\n             </div>\n         </div>']).join(""),s=$(l),d=s.find(".flexbe_modal"),c=s.find(".flexbe_modal_data");if(this.$modal=s,this.options=t,this.eventId=".flexbe_modal_"+flexbe.lib.rand(0,9999),this.$modal.data("modal",this),d.css({width:t.width||"",height:t.height||"",position:"absolute"}),t.riotTag){var r=$("<"+t.riotTag+"></"+t.riotTag+">"),h=function(){e.riotInstances=riot.mount(r[0],t.riotTag,Object.assign({modal:e},t.riotOpts))};c.append(r),t.riotDelay?setTimeout(h,t.riotDelay):h()}else if(t.$data&&t.$data.length)c.append(t.$data);else if(t.template)require(["/_s/lib/twig/twig.js"],function(){"undefined"!=typeof Twig&&(c.append(Twig.twig({data:t.template}).render(t.vars||{})),t.on_init(e),e.open(!0))});else if(t.imageSrc){c.removeClass("scrollable-content");var f=new Image;f.onload=function(){if(!t.width){var i=document.documentElement.clientWidth-160,a=f.naturalWidth,o=f.naturalHeight,n=Math.min(a,i),l=n*o/a;d.css({width:n,height:l,maxWidth:i})}c.append("<div class='flexbe_modal_img'>\n                             <span class=\""+t.cancelClass+"\"></span>\n                             <img src='"+t.imageSrc+"'>\n                          </div>"),t.on_init(e),e.open(!0)},f.src=t.imageSrc}if(t.tabs){$(".tabs-content-wrap",c).length||c.wrapInner('<div class="tabs-content-wrap"></div>');var m=$(".tabs-content-wrap",c),p=m.find("[data-tab]:first-child");p.addClass("active"),p.on("transitionend",function(t){t.target===this&&m.removeClass("animate")}),$(".tabs .tab",s).on("click",function(e){var i=$(e.currentTarget),a=$(".tab.active",i.parent()),o=i.index();o!==a.index()&&!1!==t.on_tab_change($("[data-tab]",m).eq(o).attr("data-tab"))&&(m.addClass("animate"),p.css("margin-left",-100*o+"%"),a.add($("[data-tab].active",m)).removeClass("active"),i.add($("[data-tab]",m).eq(o)).addClass("active"))})}(s.on("keydown",function(t){if(27===t.which)return e.cancel(),setTimeout(function(){$("body").find(".overlay-area").last().focus()},10),t.preventDefault(),t.stopImmediatePropagation(),!1}),s.on("click.cancel",".flexbe_modal_close, header .close, footer .close",function(){e.cancel()}),t.click_out)&&(s.on("mousedown",function(t){n=null,t.target==s.get(0)&&(n=t.target)}),s.on("mouseup",function(t){t.target===n&&(n=null,e.cancel())}));t.handle&&!t.overlay&&($.fn.modalDraggable=function(e){return this.each(function(){var i=$(this),a=$(".flexbe_modal",i);$(e.handle,a).on("mousedown.drag",function(e){var o=e.pageX,n=e.pageY,l=i.get(0),s=a.get(0),d=s.offsetTop,c=s.offsetLeft,r={minLeft:-(s.offsetWidth-t.limit.left),maxLeft:l.offsetWidth-t.limit.right,minTop:t.limit.top,maxTop:l.offsetHeight-t.limit.bottom};$document.on("mousemove.drag",function(t){var e={top:d+(t.pageY-(this.body.scrollTop||0)-n),left:c+(t.pageX-o)};e.top=e.top>r.maxTop&&r.maxTop||e.top<r.minTop&&r.minTop||e.top,e.left=e.left>r.maxLeft&&r.maxLeft||e.left<r.minLeft&&r.minLeft||e.left,a.css(e)}),$document.one("mouseup.drag",function(){$document.off("mousemove.drag")}),e.preventDefault()})})},s.modalDraggable({handle:t.handle})),t.imageSrc||t.template||(t.on_init(this),this.open(!0))},flexbe.modal.Window.prototype={open:function(t){var e=this;this.options.from&&this.options.from.hide();var i="overlay"==this.options.type;if(i&&t){var a={modal:this.options.name};history.pushState(a,window.document.title,""),customHistory.push({data:a,title:window.document.title,location:""})}flexbe.tip.init(this.$modal),this.options.editor_stop&&flexbe.land.editor&&flexbe.land.editor.stop(),$("body").append(this.$modal),this.options.animate&&t&&"undefined"!=typeof anime?anime({targets:this.$modal.get(0),scale:{value:i?[.985,1]:[1,1],duration:350,easing:"easeInOutQuad"},opacity:{value:i?[.9,1]:[0,1],duration:250,easing:"linear"},complete:function(){e.options.open(e),e.$modal.focus()}}):(this.options.open(this),this.$modal.css({transform:"",opacity:1}).focus()),i||(this.update_position(),$(window).on("resize"+this.eventId,this.update_position.bind(this)))},close:function(t){var e=this;void 0===t&&(t=!0),"overlay"==this.options.type&&t&&$(window).trigger("popstate"),$(window).off("resize"+this.eventId+" scroll"+this.eventId),setTimeout(function(){e.options.editor_stop&&flexbe.land.editor&&flexbe.land.editor.start()},200),this.options.close(),"overlay"==this.options.type?this.$modal.detach():this.$modal.remove(),Array.isArray(this.riotInstances)&&this.riotInstances.map(function(t){return t.unmount()}),delete flexbe.modal.list[this.options.name],this.options.from&&this.options.from.show()},cancel:function(){this.options.cancel(),this.close()},update_position:function(){var t=this.options,e=this.$modal,i=e.find(".flexbe_modal"),a=$(t.item||t.item_bind)[0],o=i[0],n=e[0],l=a&&a.getBoundingClientRect(),s=o&&o.getBoundingClientRect(),d=n&&n.getBoundingClientRect(),c=spaced&&flexbe.land&&flexbe.view.$frame?flexbe.view.$frame.offset().top:0,r=document.documentElement.clientHeight/2-s.height/2,h=document.documentElement.clientWidth/2-s.width/2;a&&t.item?(h=(h=l.left+l.width+30)&&h+s.width<n.offsetWidth&&h||(h=l.left-s.width-30)&&h>0&&h||(h=l.left+l.width+30)&&n.offsetWidth-s.width-30||"auto",r=(r=l.top+c-(s.height/2-l.height/2))&&r+s.height<d.height&&r>0&&r||r+s.height>d.height&&r>0&&d.height-s.height-10||r<0&&10||"auto"):a&&t.item_bind&&(r=l.top+c+l.height/2-s.height/2,h=l.left+l.width/2-s.width/2,r<30?r=30:r+s.height>d.bottom-30&&(r=d.bottom-s.height-30),h<30?h=30:h+s.width>d.right-30&&(h=d.right-s.width-30)),i.css({top:r,left:h})},hide:function(){this.$modal.hide()},show:function(){this.$modal.show(),this.$modal.focus()},disabled:function(t){$(".flexbe_modal",this.$modal)[t?"attr":"removeAttr"]("disabled","disabled")}};
flexbe.regex={link:{is:function(t){if(!t||t.length<1)return!1;if("http://"==(t=String(t)).substr(0,7)||"https://"==t.substr(0,8)){var e="http://"==t.substr(0,7)?7:8,r=t.substr(e,100),n=r.indexOf("/"),s=-1==n?r:r.substr(0,n);if(!flexbe.regex.domain.is(s))return!1}return!0},get_full:function(t){if(!t||t.length<1)return"";if("/"==t.substr(0,1)||"http://"==t.substr(0,7)||"https://"==t.substr(0,8))return t;var e=t.indexOf("/"),r=-1==e?t:t.substr(0,e);return flexbe.regex.domain.is(r)?document.location.protocol+"//"+t:t},get_link:function(t){t=this.get_full(t);var e=window.location.protocol+"//"+window.location.hostname;return t=t.replace(new RegExp(e,"ig"),"")}},domain:{is:function(t){return!!t.match(/^([a-zA-Z0-9]+[a-zA-Z0-9\-\.]*[a-zA-Z0-9]+)\.([a-zA-Z]{2,7})$/)||(!!t.match(/^xn--([a-zA-Z0-9\-\.]*)\.xn--([a-zA-Z0-9]*)$/)||!!t.match(/^([а-яА-Я0-9]+[а-яА-Я0-9\-\.]*[а-яА-Я0-9]+)\.([а-яА-Я]{2,7})$/))}},clean_page_uri:function(t,e,r){return"_"==(t=(t=$.trim(t)).replace(new RegExp(" {1,}","g"),"_")).substr(0,1)&&(t=t.substr(1,t.length-1)),"_"==t.substr(t.length-1,1)&&(t=t.substr(0,t.length-1)),t=t.replace(new RegExp("[^a-zA-Zа-яА-Я0-9/._-]","g"),""),r&&(t=this.translit(t)),t=t.substr(0,250),e?("/"!=t.substr(0,1)&&(t="/"+t),"/"!=t.substr(t.length-1,1)&&(t+="/"),t=t.replace(new RegExp("/{2,}","g"),"/")):t=t.replace(new RegExp("^/|/$","g"),""),t=t.toLowerCase(),t=$.trim(t)},translit:function(t){for(var e=[["а","a"],["б","b"],["в","v"],["г","g"],["д","d"],["е","e"],["ё","yo"],["ж","zh"],["з","z"],["и","i"],["й","y"],["к","k"],["л","l"],["м","m"],["н","n"],["о","o"],["п","p"],["р","r"],["с","s"],["т","t"],["у","u"],["ф","f"],["х","h"],["ц","c"],["ч","ch"],["ш","sh"],["щ","shch"],["ъ",""],["ы","y"],["ь",""],["э","e"],["ю","yu"],["я","ya"],["А","a"],["Б","b"],["В","v"],["Г","g"],["Д","d"],["Е","e"],["Ё","yo"],["Ж","zh"],["З","z"],["И","i"],["Й","y"],["К","k"],["Л","l"],["М","m"],["Н","n"],["О","o"],["П","p"],["Р","r"],["С","s"],["Т","t"],["У","u"],["Ф","f"],["Х","h"],["Ц","c"],["Ч","ch"],["Ш","sh"],["Щ","shch"],["Ъ",""],["Ы","y"],["Ь",""],["Э","e"],["Ю","yu"],["Я","ya"],["a","a"],["b","b"],["c","c"],["d","d"],["e","e"],["f","f"],["g","g"],["h","h"],["i","i"],["j","j"],["k","k"],["l","l"],["m","m"],["n","n"],["o","o"],["p","p"],["q","q"],["r","r"],["s","s"],["t","t"],["u","u"],["v","v"],["w","w"],["x","x"],["y","y"],["z","z"],["A","a"],["B","b"],["C","c"],["D","d"],["E","e"],["F","f"],["G","g"],["H","h"],["I","i"],["J","j"],["K","k"],["L","l"],["M","m"],["N","n"],["O","o"],["P","p"],["Q","q"],["R","r"],["S","s"],["T","t"],["U","u"],["V","v"],["W","w"],["X","x"],["Y","y"],["Z","z"],[" ","_"],["0","0"],["1","1"],["2","2"],["3","3"],["4","4"],["5","5"],["6","6"],["7","7"],["8","8"],["9","9"],["-","-"],["_","_"],["/","/"],[".","."]],r="",n=0;n<t.length;n++){for(var s=t.charAt(n),i="",u=0;u<e.length;u++)s==e[u][0]&&(i=e[u][1]);r+=i}return r.replace(/[_]{2,}/gim,"_").replace(/\n/gim,"")}};
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}flexbe.stat={amplitude_lib:"https://cdn.amplitude.com/libs/amplitude-3.8.0-min.gz.js",amplitude_api_key:"f341476816e68c0290851ed0f17a769c",is_init:!1,user:{id:0,data:{}},init:function(t){t.getInstance().init(this.amplitude_api_key),this.user&&this.user.id>0&&(t.getInstance().setUserId(this.user.id),this.user.data&&t.getInstance().setUserProperties(this.user.data)),this.is_init=!0,window.is_dev&&console.log("amplitude init deviceId: "+t.getInstance().options.deviceId)},event:function(t,e,i){var n=this;window.is_dev&&console.log(t,e),requirejs([this.amplitude_lib],function(o){n.is_init||n.init(o),window.is_dev||("object"===_typeof(e)?o.getInstance().logEvent(t,e):o.getInstance().logEvent(t)),"function"==typeof i&&i()})},link:function(t,e,i){window.is_dev&&console.log("redirect after stat to "+t),this.event(e,i,function(){document.location=t})}};
flexbe.files={},flexbe.files.upload={},flexbe.files.upload.init=function(e){switch(e.type||(e.type="file"),e.multi||(e.multi=!1),e.type){case"image_svg":e.$input.attr("accept","image/jpeg,image/png,image/gif,image/svg+xml"),e.type="image";break;case"image":e.$input.attr("accept","image/jpeg,image/png,image/gif, image/svg+xml");break;case"audio":e.$input.attr("accept","audio/mpeg")}var t=0,a=0,o=e.$input.spacedUpload({url:e.url||"/admin/files/upload?type="+e.type,multiple:e.multi,data:e.data,onSelect:function(i){a=t,t+=1;var n=o.spacedUpload("addItem",{file:i,onProgress:function(t){"function"==typeof e.on_progress&&e.on_progress(n,t)},onComplete:function(t,a,o){t||console.warn("Ошибка при загрузке. Код ошибки: "+o);try{a=JSON.parse(a)}catch(e){a={text:"JSON parse error",err:e}}"function"==typeof e.on_complete&&(e.support?e.on_complete(a.is_success,a.data,n,a.message):e.on_complete(t,a,i,n))}});"function"==typeof e.on_select&&e.on_select(n)},onSelectAll:function(o){"function"==typeof e.on_start&&a!==t&&(e.on_start(t),a+=1)}});return o};
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}flexbe.lib={message:function(e){var t=e.channel,o=e.title,n=e.text,r=e.msg;1===arguments.length&&"object"!==_typeof(arguments[0])&&(r=arguments[0]),$.get("/mod/log",{channel:t,title:o,text:n,msg:r})},rand:function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},getRandomId:function(e){void 0===e&&(e=5);for(var t="",o="",n=0;n<e;n++)t+=0===n?"1":"0",o+="9";return this.rand(+t,+o)},htmlspecialchars:function(e,t){return void 0===t&&(t=!1),t?$("<div/>").html(e).text():$("<div/>").text(e).html()},utime:function(e){return void 0===e&&(e=1),parseInt((new Date).getTime()/e,10)},getCookie:function(e){var t=("; "+document.cookie).split("; "+e+"=");return 2==t.length&&t.pop().split(";").shift()},setCookie:function(e,t,o){void 0===o&&(o=94608e3);var n=(new Date).getTime()+1e3*o;document.cookie=e+"="+escape(t)+"; path=/; domain=."+document.location.hostname+";  expires="+new Date(n)},replaceObject:function(e,t){if("object"==_typeof(e)&&"object"!=_typeof(t)||"object"==_typeof(t)&&"object"!=_typeof(e)||Array.isArray(e)!=Array.isArray(t))return e;if("object"==_typeof(e)){for(var o in e)t.hasOwnProperty(o)&&(e[o]=this.replaceObject(e[o],t[o]));Array.isArray(e)&&t.length>e.length&&(e=e.concat(t.slice(e.length,t.length)))}else e=t;return e},compareArray:function(e,t){return!(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)&&e.every(function(e){return-1!==t.indexOf(e)})},arrayUnique:function(e){for(var t={},o=[],n=e.length,r=0,c=0;c<n;c++){var i=e[c];1!==t[i]&&(t[i]=1,o[r++]=i)}return o},walkObject:function(e,t){return void 0===t&&(t=function(){}),function e(o,n){return void 0===n&&(n=[]),Object.keys(o).forEach(function(r){Array.isArray(o[r])?o[r].forEach(function(o,c){t({value:o,key:r+":"+c,location:[].concat(n,[r],[c]),isLeaf:!1}),e(o,[].concat(n,[r],[c]))}):"object"===_typeof(o[r])?(t({value:o[r],key:r,location:[].concat(n,[r]),isLeaf:!1}),e(o[r],[].concat(n,[r]))):t({value:o[r],key:r,location:[].concat(n,[r]),isLeaf:!0})}),o}(e)},contrastColor:function(e,t,o,n){if(void 0===t&&(t="#000000"),void 0===o&&(o="#FFFFFF"),void 0===n&&(n=.65),!e)return t;n=Number(n);var r=e.replace(/^#/,"");3===r.length&&(r=r[0]+r[0]+r[1]+r[1]+r[2]+r[2]);var c={r:parseInt(r.slice(0,2),16)/255,g:parseInt(r.slice(2,4),16)/255,b:parseInt(r.slice(4,6),16)/255};return Object.keys(c).forEach(function(e){var t=c[e];c[e]=t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}),.2126*c.r+.7152*c.g+.0722*c.b<n?o:t},setToClipboard:function(e){void 0===e&&(e="");var t=document.createElement("input");return t.type="text",t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),!0}};
flexbe.bill={plan_id:0,domain_limit:0,page_limit:0,show_old_price:!1,plan_change:function(l){var a=!1;flexbe.modal.load("bill_plan_change",{width:this.show_old_price?1140:700,name:"bill_plan_change",title:polyglot.t("admin::user::bill::change_plan::title"),vars:{show_old_price:this.show_old_price,current_plan_id:this.plan_id,lang:{per_month:polyglot.t("admin::user::bill::change_plan::per_month"),domains_1:polyglot.t("admin::user::bill::change_plan::domains",1),domains_2:polyglot.t("admin::user::bill::change_plan::domains",2),domains_5:polyglot.t("admin::user::bill::change_plan::domains",5),domains_unlimited:polyglot.t("admin::user::bill::change_plan::domains_unlimited"),pages:polyglot.t("admin::user::bill::change_plan::pages"),pages_unlimited:polyglot.t("admin::user::bill::change_plan::pages_unlimited"),sms:polyglot.t("admin::user::bill::change_plan::sms"),abtest:polyglot.t("admin::user::bill::change_plan::abtest"),dynamic_replacement:polyglot.t("admin::user::bill::change_plan::dynamic_replacement"),geo_replacement:polyglot.t("admin::user::bill::change_plan::geo_replacement"),additional_users_1:polyglot.t("admin::user::bill::change_plan::additional_users",1),additional_users_5:polyglot.t("admin::user::bill::change_plan::additional_users",5),select:polyglot.t("admin::user::bill::change_plan::select"),recalc_notice:polyglot.t("admin::user::bill::change_plan::recalc_notice")}},on_init:$.proxy(function(n){n.$modal.find('.price_item[data-id="'+this.plan_id+'"] a').removeClass("select").addClass("current").text(polyglot.t("admin::user::bill::change_plan::current_plan")),n.$modal.on("click","a.select",$.proxy(function(e){if(a)return!1;var i=$(e.currentTarget),t=i.closest(".price_item").attr("data-id");a=!0,i.addClass("active"),this.plan_change_select(t,$.proxy(function(l){l?n.close():(i.removeClass("active"),a=!1)},this),l)},this))},this),cancel:$.proxy(function(){"function"==typeof l&&l(!1)},this)})},plan_change_select:function(l,a,n){var e=$.ajax({url:"/admin/user/pay/plan_change/",type:"POST",dataType:"json",data:{act:"calc",plan_id:l}});e.done($.proxy(function(l){l.error?(alertify.error(l.error),a(!1)):l.warning?(alertify.log(l.warning),a(!1)):l.change_data&&l.change_data.new.exp<1?this.plan_change_confirmed(l.change_data.new.plan_id,$.proxy(function(l){a(!!l)},this),n):(a(!0),this.plan_change_confirm(l.change_data,n))},this)),e.fail(function(){alertify.error("Ошибка, не удалось сменить тариф"),a(!1)})},plan_change_confirm:function(l,a){var n=!1;flexbe.modal.load("bill_plan_confirm",{width:500,name:"bill_plan_confirm",title:polyglot.t("admin::user::bill::change_plan_recalc::title"),vars:{data:l,lang:{current_date:polyglot.t("admin::user::bill::change_plan_recalc::current_date"),new_date:polyglot.t("admin::user::bill::change_plan_recalc::new_date"),current_plan:polyglot.t("admin::user::bill::change_plan_recalc::current_plan"),new_plan:polyglot.t("admin::user::bill::change_plan_recalc::new_plan"),change_plan:polyglot.t("admin::user::bill::change_plan_recalc::change_plan")}},on_init:$.proxy(function(e){e.$modal.find("a.plan_change").on("click",$.proxy(function(i){if(n)return!1;var t=$(i.currentTarget),o=l.new.plan_id;n=!0,t.addClass("progress"),this.plan_change_confirmed(o,$.proxy(function(l){l?e.close():(t.removeClass("progress"),n=!1)},this),a)},this))},this),cancel:$.proxy(function(){"function"==typeof a&&a(!1)},this)})},plan_change_confirmed:function(l,a,n){var e=$.ajax({url:"/admin/user/pay/plan_change/",type:"POST",dataType:"json",data:{act:"change",plan_id:l}});e.done($.proxy(function(l){l.error?(alertify.error(l.error),a(!1)):l.warning?(alertify.log(l.warning),a(!1)):(flexbe.bill.plan_id=1*l.plan_data.id,flexbe.bill.ssl=1*l.plan_data.ssl,flexbe.bill.users_limit=1*l.plan_data.users_limit,flexbe.bill.abtest=1*l.plan_data.abtest,flexbe.bill.multilanding=1*l.plan_data.multilanding,flexbe.bill.page_limit=l.plan_data.page_limit,flexbe.bill.domain_limit=l.plan_data.domain_limit,a(!0),"function"==typeof n?n(!0):location.reload())},this)),e.fail(function(){alertify.error("Ошибка, не удалось сменить тариф"),a(!1)})},show_feature_modal:!1,show_feature:function(l,a){void 0!==l&&!1!==l||(l="Перейдите на соответствующий тарифный план"),flexbe.modal.load("bill_feature",{width:545,name:"bill_feature",title:polyglot.t("admin::user::bill::upgrade::feature_title"),vars:{text:l,lang:{button:polyglot.t("admin::user::bill::upgrade::button")}},on_init:$.proxy(function(l){flexbe.bill.show_feature_modal=l,l.$modal.find("a.plan_change").on("click",$.proxy(function(n){l.close(),this.plan_change(a)},this))},this),cancel:$.proxy(function(){"function"==typeof a&&a(!1)},this)})},show_limit:function(l,a){flexbe.modal.load("bill_limit",{width:545,name:"bill_limit",title:polyglot.t("admin::user::bill::upgrade::limit_title"),vars:{text:l,lang:{domains:polyglot.t("admin::user::bill::pay::domains"),pages:polyglot.t("admin::user::bill::pay::pages"),sms:polyglot.t("admin::user::bill::pay::sms"),of:polyglot.t("admin::user::bill::pay::of"),button:polyglot.t("admin::user::bill::upgrade::button")}},on_init:$.proxy(function(l){l.$modal.find("a.plan_change").on("click",$.proxy(function(n){l.close(),this.plan_change(a)},this))},this),cancel:$.proxy(function(){"function"==typeof a&&a(!1)},this)})}};
flexbe.tip={defaults:{content:"",contentAsHTML:!0,animation:"fade",delay:200,trigger:"hover",autoClose:!0,hideOnClick:!1,interactive:!0,position:"right",maxWidth:400},init:function(t){t||(t="body");var o=$(t);o.find(".tip, .flexbe-tooltip").each($.proxy(function(t,o){var i=$(o),a={content:i.html(),maxWidth:i.attr("data-width")||400},d=$.extend({},this.defaults,a);i.tooltipster(d)},this)),o.find(".tip_modal_show").off("click.tip").on("click.tip",$.proxy(function(t){var o=$(t.currentTarget);this.modal_show(o)},this))},modal_show:function(t,o){var i,a=t.attr("data-name")||"default";if(o)i=o;else{if(!t.next().is(".tip_modal_data"))return!1;i=t.next().clone()}this.$modal_window&&this.$modal_window.remove(),this.$modal_window=$('<div class="tip_modal"></div>').attr("data-name",a),this.$modal_window.html('<a class="close"></a>').append(i),i.attr("data-width")&&this.$modal_window.css("width",i.attr("data-width")),this.$modal_overlay=$('<div class="tip_modal_overlay"></div>'),$("body").append(this.$modal_window).append(this.$modal_overlay).addClass("tip_blur"),this.$modal_window.on("click","a.close",$.proxy(function(){this.modal_close()},this)),this.$modal_overlay.on("click",$.proxy(function(){this.modal_close()},this)),$(document).off("keydown.tip_modal").on("keydown.tip_modal",$.proxy(function(t){27===t.which&&this.modal_close()},this)),this.modal_update_position(),setTimeout($.proxy(function(){this.modal_update_position()},this),2e3),this.init()},modal_close:function(){this.$modal_window.remove(),$("body > .tip_modal_overlay").remove(),$("body").removeClass("tip_blur")},modal_update_position:function(){this.$modal_window.css("position","fixed").css("top","50%").css("left","50%").css("margin-left","-"+this.$modal_window.outerWidth()/2+"px").css("margin-top","-"+this.$modal_window.outerHeight()/2+"px")},show:function(t,o){var i=$.extend({},o);t.tooltipster(i)}};
flexbe.page={list:[],stat:{},updateList:function(e){var t=this;void 0===e&&(e=function(){}),$.ajax({url:"/admin/pages/get_list",dataType:"json",method:"POST"}).done(function(a){if(a.is_success&&a.data){var i=a.data.list;if(Array.isArray(i)){var n=!1;try{n=JSON.stringify(t.list)===JSON.stringify(i)}catch(e){}n||(t.list=i,$(window).trigger("update_page_list")),e(null,i)}}else console.warn("Ошибка, не удалось получить статистику страниц"),e(a)}).fail(function(t){console.warn("updateList: ",t.message),e(t)})},updateStat:function(e){var t=this;void 0===e&&(e=function(){}),$.ajax({url:"/admin/pages/get_stat",dataType:"json",method:"POST"}).done(function(a){if(a.is_success&&a.data){var i=a.data.pages;i&&(t.stat=i,e(null,i))}else console.warn("Ошибка, не удалось получить статистику страниц"),e(a)}).fail(function(t){console.warn("Ошибка, не удалось получить статистику страниц"),e(t)})},create:function(e,t,a){var i=this;if(void 0===a&&(a=function(){}),this.get_pages_count()>=flexbe.bill.page_limit){var n=polyglot.t("admin::user::bill::upgrade::pages",{pages:lexbe.bill.page_limit});return flexbe.bill.show_limit(n,function(a){a&&i.create(e,t)}),a()}if("new"==e&&flexbe.page.group_list.length>=flexbe.bill.domain_limit){var r=polyglot.t("admin::user::bill::upgrade::domains",parseInt(flexbe.bill.domain_limit));return flexbe.bill.show_limit(r,function(a){a&&i.create(e,t)}),a()}if(e&&!t){$("body").addClass("overflow");var o=$("<flexbe-page-add></flexbe-page-add>");flexbe.modal.create({name:"flexbe-page-add",type:"overlay",title:!1,$data:o,close:function(){$("body").removeClass("overflow")}}),setTimeout(function(){riot.mount(o[0],"flexbe-page-add",{scope:i,groupId:e})},150)}else if(e&&t){var s=this.findPageById(t);this.getUri(e,s.uri,function(a){var n={group_id:e,src_p_id:t,uri:a,title:s.title,type:s.type};i.create_request(n,function(e){i.updateList(),e.domain&&e.uri&&(document.location=document.location.protocol+"//"+e.domain+e.uri)})})}},create_request:function(e,t){void 0===t&&(t=function(){});var a=$.ajax({url:"/admin/pages/add",type:"POST",dataType:"json",data:e});a.done(function(e){e.error&&alertify.error(e.error),t(e)}),a.fail(function(e){alertify.error("Ошибка, не удалось создать страницу"),t(e)})},remove:function(e,t){var a=this;void 0===t&&(t=function(){}),$.ajax({url:"/admin/pages/remove",type:"POST",dataType:"json",data:{p_id:e}}).done(function(i){1==i.status?(alertify.success("Страница удалена"),a.list=a.list.filter(function(t){return t.id!=e}),t(i)):alertify.error(i.error)}).fail(function(){alertify.error("Ошибка, не удалось удалить страницу")})},versions:function(e,t){$.getJSON("/admin/pages/versions",{act:"history",p_id:e},function(e){1===e.status?t(e.versions):alertify.error(e.error)})},restore:function(e,t,a){void 0===a&&(a=function(){}),$.getJSON("/admin/pages/versions",{act:"restore",v_id:e,p_id:t},function(e){a(1===e.status),1!=e.status&&alertify.error(e.error)})},getVersion:function(e,t){void 0===t&&(t=function(){}),$.getJSON("/admin/pages/versions",{act:"get",v_id:e},function(e){t(e)})},update_theme:function(e,t,a){void 0===a&&(a=function(){}),$.ajax({url:"/admin/pages/convert_theme",type:"GET",dataType:"json",data:{p_id:e,theme_id:t}}).done(function(t){1==t.status?localStorage.setItem("themeUpdated-"+e,1):alertify.error(t.error),a(t)})},settings:function(e){var t=this;$.ajax({url:"/admin/pages/settings_load",type:"POST",dataType:"json",data:{p_id:e}}).done(function(e){e.p_id?("Landing"===e.p_data.meta_desc&&(e.p_data.meta_desc=""),"Landing"===e.p_data.meta_keywords&&(e.p_data.meta_keywords=""),flexbe.modal.create({name:"flexbe-page-settings",type:"overlay",title:!1,riotTag:"page-settings",riotDelay:100,riotOpts:{scope:t,data:e}})):alertify.error(e.error)}).fail(function(){alertify.error("Ошибка, не удалось загрузить настройки")})},settings_save:function(e){if(e.hasClass("active"))alertify.log("Страница уже сохраняется");else{e.addClass("active");var t=$.ajax({url:"/admin/pages/settings_save",type:"POST",dataType:"json",data:{p_id:this.settings_p_id,name:this.settings_modal.$modal.find('input[name="page_name"]').val(),uri:this.settings_modal.$modal.find('input[name="page_uri"]').data("_uri"),title:this.settings_modal.$modal.find('input[name="page_title"]').val(),meta_desc:this.settings_modal.$modal.find('textarea[name="meta_desc"]').val(),meta_keywords:this.settings_modal.$modal.find('textarea[name="meta_keywords"]').val(),meta_img:this.settings_modal.$modal.find('input[name="meta_img"]').val()}});t.done($.proxy(function(t){if(1==t.status){var a=$('.menu_pages .page_item[data-id="'+t.data.p_id+'"]'),i=a.closest(".group_item").attr("data-domain")+t.data.p_uri;if(a.find(".page_link").attr("href",document.location.protocol+"//"+i),a.find(".name").text(t.data.p_name),a.find(".uri").text(i),is_editor&&$("head title").text(this.settings_modal.$modal.find('input[name="page_title"]').val()),is_admin&&$(".pages_domain").length>0){var n=$('.pages_list .item[data-id="'+t.data.p_id+'"]');n.find(".page_name .name").attr("href",document.location.protocol+"//"+i).text(t.data.p_name),n.find(".page_name .uri").text(i),n.find(".btn_editor").attr("href",document.location.protocol+"//"+i)}this.settings_modal.close()}else"uri"==t.error_type?alertify.error(t.error):(t.error_type,alertify.error(t.error));e.removeClass("active")},this)),t.fail(function(){alertify.error("Ошибка, не удалось сохранить настройки"),e.removeClass("active")})}},checkUri:function(e,t,a){void 0===t&&(t=flexbe.land.group_id),void 0===a&&(a=function(){}),e=flexbe.regex.clean_page_uri(e,!0),t==flexbe.land.group_id&&this.list.length?a({status:this.list.some(function(t){return t.uri==e})}):$.ajax({url:"/admin/pages/check_page_exist",type:"POST",dataType:"json",data:{group_id:t,uri:e}}).done(function(e){a({status:e.status})}).fail(function(){alertify.error("Ошибка, не удалось проверить правильность URL"),a({status:0})})},getUri:function(e,t,a){var i=this;void 0===a&&(a=function(){}),t=flexbe.regex.clean_page_uri(t,!1),this.checkUri(t,e,function(n){n.status?(t+=1,i.getUri(e,t,a)):a("/"+t+"/")})},formatUrl:function(e,t,a,i){void 0===e&&(e=""),void 0===t&&(t=""),void 0===a&&(a=!1),void 0===i&&(i=!1),t=flexbe.regex.clean_page_uri(t,!1),e="string"==typeof e?e.replace(/^http(?:s)?:\/\//g,"").replace(/\/.$/,""):"";var n=t.match(/\/?subdomain\/(.*)/);return n?(t=n[1].replace(/\//g,"")+".",i?'<span class="uri">'+t+'</span><span class="domain">'+e+"</span>":t+e):(t=t&&"/"+t+"/"||"/",a?i?'<span class="uri">'+t+"</span>":t:i?'<span class="domain">'+e+'</span><span class="uri">'+t+"</span>":e+t)},findPageById:function(e){var t=!1;return this.list.forEach(function(a){a.id==e&&(t=Object.assign({},a))}),t},findPageByUri:function(e){e=flexbe.regex.clean_page_uri(e,!0);var t=!1;return this.list.forEach(function(a){a.uri==e&&(t=Object.assign({},a))}),t},find_domain_by_id:function(e,t){void 0===t&&(t=!1);var a=flexbe.page.group_list.filter(function(t){return Math.floor(t.group_id)==Math.floor(e)})[0];return a},get_pages_count:function(){return this.list.length}};
void 0===window.$document&&(window.$document=$(document)),flexbe.createViews=function(){if(this.view.$frame=$("#flexbe-view > iframe"),this.view.frame=this.view.$frame.get(0),!this.view.frame)return!1;this.view.window=this.view.$frame.get(0).contentWindow,this.view.$window=this.view.window.$(this.view.window),this.view.document=this.view.window.document,this.view.$document=$(this.view.document),this.view.$head=this.view.$document.find("head"),this.view.$body=this.view.$document.find("body"),this.view.$header=this.view.$body.find("header"),this.view.$footer=this.view.$body.find("footer"),this.view.$blockList=this.view.$body.find("> .container-list"),this.view.$modalList=this.view.$body.find("> .modal-list"),this.view.$widgetList=this.view.$body.find("> .widget-list"),window.flexbe_cli=this.view.window.flexbe_cli,void 0!==window.$document&&(window.$document=window.$document.add(this.view.$document));var i=flexbe.view.$frame.attr("src");document.location.hash&&flexbe.view.$frame.attr("src",i+document.location.hash),$(window).on("hashchange",function(){flexbe.view.$frame.attr("src",i+document.location.hash)})}.bind(flexbe);
flexbe.hello={show:function(){if(this.$overlay=$(".hello_overlay"),this.$window=$(".hello_window"),this.$overlay.add(this.$window.find(".hello_window_close")).add(this.$window.find(".btn_wrap a")).on("click",$.proxy(function(){this.close()},this)),this.$window.find(".hello_p").length>0){var i=this.$window.find(".hello_p .change_password_form"),o=this.$window.find(".hello_p .value"),s=this.$window.find(".hello_p input");this.$window.find(".hello_p a.show_change_password_form").on("click",$.proxy(function(s){o.hide(),i.show()},this)),this.$window.find(".hello_p a.change").on("click",$.proxy(function(e){var t=s.val();if(t!=s.attr("data-value")){var a=$.ajax({url:"/admin/user/profile/",type:"POST",data:{changePassword:1,oldPassword:s.attr("data-value"),newPassword:t}});a.done($.proxy(function(e){"success"==e.status||"string"==typeof e?(s.attr("data-value",t),o.find("span").text(t),i.hide(),o.show(),alertify.success("Пароль изменен")):alertify.error(e.message)},this)),a.fail(function(){alertify.error("Ошибка сети, не удалось изменить пароль")})}else i.hide(),o.show(),alertify.success("Данный пароль уже установлен")},this))}window.history&&history.pushState&&history.pushState({},"","/")},close:function(){this.$overlay.remove(),this.$window.remove()}};
function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}flexbe.createStores=function(){var t,e,i,n,r,a,s,o,l=window.mobx,u=l.observable,d=l.extendObservable,c=l.extendShallowObservable;l.action,l.autorun,l.createTransformer;t=[],e=function e(i){var n=void 0===i?{}:i,r=n.count,a=void 0===r?6:r,s=n.prefix,o=void 0===s?"":s,l=n.sufix,u=void 0===l?"":l,d=n.from;if("object"===_typeof(d)&&!o&&"modal"===d.is){var c=flexbe.helpers.parseId(d.fullId||d.templateId||d.template_id||d.mId||d.m_id,d.modId||d.mod_id).fullId,f=configStore.getEntityGroup("modal",c),h=configStore.themeJson.modal[f];o=h&&h.type||"",a=5}var m=o+flexbe.lib.getRandomId(a)+u,g=!configStore.getObject(m)&&!t.includes(m);return t.push(m),g?m:e({count:a,prefix:o,sufix:u})},i=function(t,e){var i=t?String(t).split(":"):[],n=i[0]&&String(i[0])||0,r=i[1]||e||0;return{templateId:n,modId:r,fullId:n&&r?n+":"+r:n}},n=function(t,e,i){var n=[];return function t(r){r&&"object"==_typeof(r)&&Object.keys(r).forEach(function(a){var s=r[a],o=e===a,l=void 0===i||"function"==typeof i&&i(s,e)||i==s;o&&l?n.push(r):void 0===e&&l&&n.push(r),"object"===_typeof(s)&&t(s)})}(t),{key:e,value:i,list:n}},r=function(t){var e=n(t,"elements").list,i=n(t,"zone").list;e=e.filter(function(t){return Array.isArray(t.elements)&&t.elements.length&&"object"!==_typeof(t.elements[0])}),i=i.filter(function(t){return t.zone&&"object"!==_typeof(t.zone)});var r=e.reduce(function(t,e){return[].concat(t,e.elements)},[]),a=i.reduce(function(t,e){return[].concat(t,[e.zone])},[]);return{foundedElements:e,foundedZones:i,zones:a,elements:r,list:[].concat(a,r)}},a=function t(e){var i=void 0===e?{}:e,n=i.data,a=i.searcher,s=i.recursive;void 0===a&&(a=function(t){var e=pageStore.getEntity(t);return e&&e.getSave()||{}});var o=r(n).list;return s&&(o=o.reduce(function(e,i){var n=a(i),r=t(n);return e=[].concat(e,[i],r)},[])),o=o.map(function(t){return String(t)}),flexbe.lib.arrayUnique(o)},s=function(t,e){void 0===t&&(t={}),void 0===e&&(e=function(){});var i=r(t),n=i.foundedElements,a=i.foundedZones,s=n.map(function(t){var i=t.elements.map(function(i){var n="function"==typeof e?e({id:i,type:"element",data:t}):e;return Promise.resolve(n)});return Promise.all(i).then(function(e){return t.elements=e.filter(function(t){return!!t}),t})}),o=a.map(function(t){var i=t.zone,n="function"==typeof e?e({id:i,type:"zone",data:t}):e;return Promise.resolve(n).then(function(e){return e&&(t.zone=e),t})});return Promise.all([].concat(s,o)).then(function(){return{foundedElements:n,foundedZones:a,data:t}})},o={},flexbe.helpers={getArea:function(t,e){var i=e&&"element"!==e?'[data-is="'+e+'"][data-id="'+t+'"]':'[data-id="'+t+'"]',n=flexbe.view.document.documentElement.querySelector(i);return $(n)},createEntityInstance:function(t,e){if(!t||!t.id||!t.is)return!1;if(e||!o[t.id]){var i=function(t){switch(t){case"block":return b;case"modal":return _;case"widget":return S;case"element":return y;default:return v}}(t.is);o[t.id]=new i(t)}return o[t.id]},removeEntityInstance:function(t){return"object"===_typeof(t)&&t.id&&(t=t.id),!(!t||!o[t]||(delete o[t],0))},normalizeEntity:function(t){if("object"!==_typeof(t)||!t.is)return!1;var n=t.is,r=i(t.fullId||t.templateId||t.template_id||t.b_id||t.m_id||t.w_id,t.modId||t.mod_id),a=r.templateId,s=r.modId,o=$.extend(!0,{hidden:t.data&&t.data.hide||!1,mod_id:0,data:{}},mobx.toJS(t));return o.template_id=a,o.mod_id=s,o.id=String(o.id||e({from:o})),["abtest","fullId","templateId","modId","bId","mId","wId","b_id","m_id","w_id","elements","modals"].forEach(function(t){o[t]&&delete o[t]}),delete o.data.hide,delete o.data.owner_id,o[n[0]+"_id"]||(o[n[0]+"_id"]=o.template_id),!!o.template_id&&(o.new&&function(t){if("undefined"==typeof configStore)return t;var e=(configStore.getConfig(t.is,t.template_id+":"+t.mod_id)||{}).default_data;e&&(t.data=Object.assign({},e,t.data),t.merged=!0)}(o),"block"===n?(o.multitext=u(Object.assign({},o.multitext)),o.multisection=u.shallowObject(Object.assign({created:!1,enabled:!1,main_var:"utm_term",vars:{}},o.multisection)),o.geolanding=u.shallowObject(Object.assign({created:!1,enabled:!1,vars:{}},o.geolanding))):"element"===n&&d(o,{params:o.params||{}}),o.update_time||(o.update_time=flexbe.lib.utime()),d(o,{new:o.new||!1,hidden:o.hidden,update_time:o.update_time}),o)},replaceElementsIds:s,getElementsList:a,createEntityHelper:function(t){var n;void 0===t&&(t={});var r=t.from||t.id&&pageStore.getEntity(t.id);if(t.from){var o=pageStore.getEntity(t.from);t=o&&o.getSave()||!1}var l,u=t.is,d=i(t.fullId||t.templateId||t.template_id,t.modId||t.mod_id),c=d.templateId,f=d.modId,h=d.fullId,m={},g={target:null,elements:[],modals:[]};return u&&c?(n={},n[u]=[h],l=n,pageService.loadEntityDataRecursive(l)).then(function(){var i=Object.assign({is:u,template_id:c,mod_id:f},t);if(!r&&i.id||(i.id=e({from:i})),r){var n=a({data:i,recursive:!0});i.modals=[],i.elements=n.map(function(t){var e=pageStore.getEntity(t,"element"),i=e&&e.getSave();return i})}else{var s=configStore.getConfig(u,h);i.data=i.data||$.extend(!0,{},s.default_data),i.elements=i.elements||$.extend(!0,[],s.elements),i.modals=i.modals||[],i.modals=Object.keys(i.modals).map(function(t){return Object.assign({id:t},i.modals[t])}),i.modals=i.modals.map(function(t){return Object.assign({is:"modal",template_id:t.template_id||t.m_id,mod_id:t.mod_id||0},t)}),i.elements=i.elements.map(function(t){return Object.assign({is:"element",template_id:t.template_id||t.m_id,mod_id:t.mod_id||0},t)})}return{raw:i}}).then(function(t){var i=t.raw;return s(i,function(t){var n=t.id,r=t.type,a=i.elements.find(function(t){return t.id==n});if(!a){if("zone"!==r)return null;i.elements.push({id:n,template_id:"zone01",mod_id:0,is:"element",data:{}})}return m[n]=e({from:a}),m[n]}).then(function(){return{raw:i}})}).then(function(t){var e=t.raw;return g.target=e,g.modals=e.modals,Object.keys(m).forEach(function(t){var i=e.elements.find(function(e){return e.id==t});if(i){var n=m[t];i.id=n,g.elements.push(i)}}),delete g.target.elements,delete g.target.modals,delete g.target.templateId,delete g.target.modId,g}):Promise.reject(new Error("Not enough data to create Entity, check your data"))},findInObject:n,getRandId:e,parseId:i};var f=function(){function t(t){this.variantsCache={};var e=Object.assign({id:1,set:{}},t);d(this,{_raw:e,get id(){return this._raw.id},get set(){return mobx.toJS(this._raw.set)}})}var e=t.prototype;return e.setVariant=function(t){var e=this._raw.id;if(e==t)return!1;this.variantsCache[e]=this.getSave();var i=this.variantsCache[t]||configStore.fonts.find(function(e){return e.id==t});i&&(this._raw.id=i.id,this._raw.set=$.extend(!0,{},i.set))},e.setFont=function(t,e){if(!t)return!1;this._raw.set[t]=Object.assign(this._raw.set[t],e)},e.resetFont=function(t){var e=this.id,i=configStore.fonts.find(function(t){return t.id==e}).set[t];i&&this.setFont(t,i)},e.getSave=function(){return $.extend(!0,{},mobx.toJS(this._raw))},t}(),h=function(){function t(t){void 0===t&&(t=[]),t=t.map(function(t){return delete t.valid,t.current="a",t}),d(this,{_list:t,get list(){return this._list.map(function(t){var e=!(!pageStore.getEntity(t.a)||!pageStore.getEntity(t.b)),i=t.is_active&&flexbe.bill.abtest&&e;return Object.assign({},t,{valid:e,is_active:i})})}})}var e=t.prototype;return e.findTest=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1);var i=this._list.find(function(i){return t&&i.id===t||e&&(i.a==e||i.b==e)}),n=i&&this._list.indexOf(i);return!!i&&{index:n,test:i}},e.getTest=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1);var i=this.findTest(t,e);return i&&this.list[i.index]||!1},e.create=function(t,e,i){if(void 0===i&&(i=!0),!(t&&e&&pageStore.getEntity(t)&&pageStore.getEntity(e)))return!1;var n={a:t,b:e,id:null,current:"b",is_active:flexbe.bill.abtest&&i};return{index:this._list.push(n)-1,test:n}},e.toggleActive=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1);var i=this.findTest(t,e);return i&&(i.test.is_active=!i.test.is_active),!!i&&i.test.is_active},e.toggleCurrent=function(t,e,i){void 0===t&&(t=!1),void 0===e&&(e=!1),void 0===i&&(i=!1);var n=this.findTest(t,e);return!!n&&(n.test.current=["a","b"].includes(i)&&i||("b"===n.test.current?"a":"b"),n.test.current)},e.delete=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1);var i=this.findTest(t,e);i&&void 0!==i.index&&this._list.splice(i.index,1)},t}(),m=function(){function t(t,e){var i=this;void 0===e&&(e="multisection"),this._type=e,this._entity=t,this._raw=t._raw[e]||{},d(this,{selectedVar:"default",get created(){return this._raw.created||!1},get enabled(){return this._raw.enabled||!1},get main_var(){return this._raw.main_var},get vars(){return this._raw.vars}}),["setField","setData","selectVar"].forEach(function(t){"function"==typeof i[t]&&(i[t]=mobx.action(i[t].bind(i)))})}var e=t.prototype;return e.getDefaults=function(){return{created:!1,enabled:!1,main_var:"utm_term",vars:{}}},e.getData=function(){return Object.assign(this.getDefaults(),mobx.toJS(this._raw))},e.getField=function(t){var e=this.getData();return void 0!==e[t]&&e[t]},e.setData=function(t){return!!t&&(this._entity.setField(this._type,Object.assign(this.getDefaults(),t)),!0)},e.setField=function(t,e){this._raw[t]=e,this._entity.change()},e.selectVar=function(t){return void 0===t&&(t="default"),!(!t||"default"!==t&&!this.vars[t])&&(this.selectedVar=t,this._entity.change(),!0)},e.addVar=function(t,e){if(void 0===e&&(e={}),!t||"default"===t||this.vars[t])return!1;var i=this._entity.getSave(),n=$.extend(!0,{},{data:i.data,elements:i.elements},e),r=this.getField("vars");return("object"!==_typeof(r)||Array.isArray(r))&&(r={}),r[t]=n,this.setField("vars",r),!0},e.deleteVar=function(t){if(!t||"default"===t)return!1;var e=this.getField("vars");return delete e[t],this.setField("vars",e),!0},t}(),g=function(t){function e(e){return t.call(this,e,"multisection")||this}return _inheritsLoose(e,t),e.prototype.renameVar=function(t,e){if(!t||!e||"default"===t||"default"===e||t==e||!this.vars[t]||this.vars[e])return!1;var i=this.getField("vars");return i[e]=i[t],delete i[t],this.setField("vars",i),!0},e}(m),p=function(t){function e(e){return t.call(this,e,"geolanding")||this}return _inheritsLoose(e,t),e}(m),v=function(){function t(t){var e=this;this._raw=t,["change","setData","setField"].forEach(function(t){"function"==typeof e[t]&&(e[t]=mobx.action(e[t].bind(e)))}),this.dispatchEvents(),this.extend(),this.run()}var e=t.prototype;return e.extend=function(){var t=this._raw,e=t.is,i=t.id,n=this._raw.new,r=flexbe.helpers.parseId(this._raw.template_id,this._raw.mod_id),a=r.fullId,s=r.templateId,o=r.modId;d(this,{is:e,id:i,fullId:a,templateId:s,modId:o,isNew:n,lastTemplateRender:0,lastTemplateBuild:0,lastStyleRender:0,lastStyleBuild:0,templateRendered:"",styleRendered:"",get _object(){return configStore.getObject(i)},get config(){return configStore.getConfig(this.is,this.fullId,!0)},get onpage(){this.utime;var t=this.$area;return!(!t||!t.length)},get rendered(){this.lastTemplateRender;var t=this.$data;return!!(t&&t[0]&&t[0].childElementCount)},get parentList(){return pageStore[this.is+"s"]},get rawList(){return pageStore["_"+this.is+"s"]},get index(){var t=this;return this.rawList.findIndex(function(e){return e.id===t.id})},get prev(){return this.parentList[this.index-1]||null},get next(){return this.parentList[this.index+1]||null},get hidden(){this.utime;return this._raw.hidden||!1},get type(){var t=this,i=(this.utime,this.config);if(i)return(i.type||[]).filter(function(e){return void 0===t.data[e]||!!t.data[e]});var n=this.$area.attr("data-"+e[0]+"-type");return"string"==typeof n?JSON.parse(n):[]},get siteBlockType(){this.utime;return this._raw.siteBlockType||!1},get utime(){return this._raw.update_time}})},e.run=function(){var t=this;Promise.resolve().then(function(){return t.trigger("initStart")}).then(function(){return t.loadConfig()}).then(function(){return t.mergeDefaults()}).then(function(){return t.fixData()}).then(function(){return t.registerProto()}).then(function(){return!(!t.isNew||"element"===t.is)&&t.render({render:"full"})}).then(function(){return t.isNew=!1,t._raw.new=!1,t.trigger("initDone"),!0}).catch(function(e){t.trigger("initFail",e)})},e.dispatchEvents=function(){var t=this;riot.observable(this),this.on("initDone",function(){t._object&&t._object._on_init(),flexbe.land.editor.bindEditorDelayed(t)}),this.on("initFail",function(e){console.warn("Entity "+t.id+" - initFail, Message: \n--------\n",e)}),this.on("renderTemplate",function(e){t._object&&t._object._on_render(e),flexbe.land.editor.bindEditorDelayed(t,!0)}),this.on("change",function(e){void 0===e&&(e={}),e.entity=t,t._object&&t._object._on_change(e),flexbe_cli.events.emit("editor_change",e),flexbe.land.change()}),this.on("remove",function(){var e;t._object&&(e=t._object)._on_remove.apply(e,arguments)})},e.loadConfig=function(){var t,e=this;return!!this.config||pageService.loadEntityData((t={},t[this.is]=[this.fullId],t),10).then(function(t){var i=!!t,n=e.config;return e.trigger("loadConfig",{status:i,config:n}),n||Promise.reject(new Error("{ status: 0 }"))}).catch(function(t){var i=e.config;return e.trigger("loadConfig",{err:t,config:i}),Promise.reject(t)})},e.mergeDefaults=function(){if(!this.isNew||this._raw.merged)return!0;var t=this.config;if(!t||!t.default_data)return!1;var e=$.extend(!0,{},t.default_data);return this.setField("data",e,"default"),this.trigger("mergeDefaults"),!0},e.fixData=function(){if(this.siteBlockType&&"object"===_typeof(this._raw.data.menu)){var t=groupStore.getSiteGlobal(this.siteBlockType,"menu");Array.isArray(t)&&t.length&&(this._raw.data.menu.list=$.extend(!0,[],t))}return this.trigger("fixData"),!0},e.registerProto=function(){var t=this._object;return t||(t=flexbe.land[this.is].register(this),configStore.setObject(t)),this.trigger("registerProto"),t},e.change=function(t){this._raw.update_time=flexbe.lib.utime(),this.trigger("change",t)},e.render=function(t){var e=this;void 0===t&&(t={});var i=t,n=i.render,r=i.reason,a=i.name,s=i.val;return!1!==n&&(Array.isArray(n)||(void 0===n?n=["template"]:"full"===n||!0===n?n=["template","style"]:["html","css","style","template"].includes(n)&&(n=[n])),this.updateRenderData({render:n,recursive:!0}).then(function(){return(n.includes("template")||n.includes("html"))&&e.renderTemplate({render:n,reason:r,name:a,val:s}),(n.includes("style")||n.includes("css"))&&e.renderStyle({render:n,reason:r,name:a,val:s}),!0}))},e.updateRenderData=function(t){var e=this,i=void 0===t?{}:t,n=i.render,r=void 0===n?["template","style"]:n,a=i.recursive,s=void 0===a||a,o="",l="",u=[];if((r.includes("template")||r.includes("html"))&&(o=this.buildTemplate()),(r.includes("style")||r.includes("css"))&&(l=this.buildStyle()),s&&this.elements){var d=this.elements.map(function(t){return pageStore.getEntity(t,"element").updateRenderData({render:r,recursive:s})});u=Promise.all(d)}return Promise.all([o,l,u]).then(function(t){var i=t[0],n=t[1],r=t[2];return i&&(e.lastTemplateData=i,e.lastTemplateBuild=Date.now()),n&&(e.lastStyleData=n,e.lastStyleBuild=Date.now()),{html:i,css:n,elements:r}})},e.buildTemplate=function(){var t=this.is,e=this.fullId,i=this.data;return flexbe.land.template.render(t,e,i)},e.buildStyle=function(){var t=this,e=this.is,i=this.templateId,n=configStore.getStyle(e,i)||{};return Promise.all([("string"==typeof n.css&&n.css||"")+("string"==typeof n.css_mobile&&n.css_mobile||""),function(){if(!n.css_logic)return"";var r,a,s,o=t.id,l=t.data,u=(r=t.multisection,a=t.geolanding,("object"==_typeof((s=r&&r.enabled?r:a&&a.enabled?a:{}).selectedVar)?s.selectedVar.id:s.selectedVar)||"default"),d="[data-"+e[0]+'-id="'+i+'"][data-id="'+o+'"]';return"default"!==u&&(d+='[data-multivar="'+u+'"]'),flexbe.land.less.render(d+" { "+n.css_logic+" }",l)}()]).then(function(t){return{style:t[0],logic:t[1]}})},e.renderTemplate=function(t,e){var i=this.$area,n=this.lastTemplateData;if(!i.length||!n)return!1;if(this.lastTemplateRender>this.lastTemplateBuild)return!1;if(e||i.find(".editor_text").froalaEditor("destroy"),i.removeClass("loading").removeClass("in-block-edit"),"block"===this.is){var r=this.$data;r.length?r.replaceWith(n):i.append(n)}else i.html(n);return this.lastTemplateRender=Date.now(),this.trigger("renderTemplate",t),this.elements.forEach(function(e){pageStore.getEntity(e,"element").renderTemplate(t,!0)}),!0},e.renderStyle=function(t){if(!this.lastStyleData)return!1;if(this.lastStyleRender>this.lastStyleBuild)return!1;var e=this.id,i=this.is,n=this.templateId,r=this.lastStyleData,a=r.style,s=r.logic,o=""+i[0]+n+"_css",l=""+i[0]+n+"_"+e;return a&&flexbe.land.layout.applyStyle({id:o,css:a,replace:!1}),s&&flexbe.land.layout.applyStyle({id:l,css:s,replace:!0}),this.trigger("renderStyle",t),!0},e.setData=function(t,e,i){var n=this.data;i&&"object"===_typeof(e)&&"object"===_typeof(n[t])&&(e=Object.assign({},n[t],e)),n[t]=e,this.change(),this.trigger("setData",{data:n,key:t,value:e})},e.setField=function(t,e,i){var n=this._raw;void 0!==e?(e=mobx.toJS(e),i&&"object"===_typeof(e)&&"object"===_typeof(n[t])&&(e="default"===i?Object.assign(e,n[t]):Object.assign(n[t],e)),mobx.isObservable(n[t])?["multisection","geolanding"].includes(t)?c(n[t],e):d(n[t],e):n[t]=e,this.trigger("setField",{key:t,value:e}),"default"!==i&&this.change()):delete n[t]},e.hasType=function(t){var e=this.type;return e?e.includes(t):null},e.getSave=function(){var t=this,e=$.extend(!0,{},mobx.toJS(this._raw)),i={all:["is","id","mod_id","template_id","data","update_time"],block:["b_id","multitext","multisection","geolanding","removed","hidden","siteBlockType"],modal:["m_id","siteBlockType"],widget:["w_id"],element:["e_id","params"]},n=["multitext","multisection","geolanding"];return Object.keys(e).forEach(function(r){var a=i.all.includes(r)||i[t.is].includes(r),s=n.includes(r);a&&(!s||e[r]&&e[r].enabled)||delete e[r]}),this.siteBlockType&&delete e.data.hide,this.owner&&(e.owner=this.owner.id),e},e.remove=function(){var t=this.elements,e=this.rawList,i=this.index;if(!e||-1===i)return!1;mobx.runInAction(function(){e.splice(i,1),t.forEach(function(t){return pageStore.removeEntity(t,"element")})}),this.trigger("remove"),flexbe.helpers.removeEntityInstance(this.id)},_createClass(t,[{key:"$area",get:function(){return flexbe.helpers.getArea(this.id,this.is)}},{key:"$data",get:function(){return this.$area}},{key:"$root",get:function(){return this.$area}},{key:"data",get:function(){return this._raw.data}},{key:"elements",get:function(){return flexbe.helpers.getElementsList({data:this.data,recursive:!1})}}]),t}(),y=function(t){function e(e){var i;return i=t.call(this,e)||this,d(i,{get params(){return this._raw.params||{}},get isZone(){return this.config?!!this.config.zone:null}}),i}return _inheritsLoose(e,t),_createClass(e,[{key:"$data",get:function(){return this.isZone?this.$area:this.$area.find(".element-container").eq(0)}},{key:"$root",get:function(){return this.$area.closest("[data-is=block], [data-is=modal], [data-is=widget]")}}]),e}(v),b=function(t){function e(e){var i,n=i=t.call(this,e)||this;return d(i,{get owner(){if("block"!==this.is||this.siteBlockType)return null;var t=this.next;return!this.siteBlockType&&this.hasType("overflow")&&t&&t.hasType("allow_head")?t:null},get header(){if("block"!==this.is||2!==pageStore.themeId)return null;if(!(!this.siteBlockType&&this.hasType("allow_head")))return null;var t=this.abtest,e=this.prev;if(e&&e.hasType("overflow"))return e;e&&!e.hasType("overflow")&&pageStore.pType&&t&&("b"===t.variant&&(1===t.a.index||t.a.header&&1===t.a.header.index)&&(e=pageStore.blocks[0]));return e&&e.hasType("overflow")?e:null},get abtest(){if("block"!==this.is)return{};this.utime;var t=pageStore.abtests.getTest(!1,this.id);return t&&t.valid?{id:t.id,variant:t.a===this.id?"a":"b",current:t.current,active:t.is_active,a:pageStore.getEntity(t.a,"block"),b:pageStore.getEntity(t.b,"block")}:null},multisection:new g(n),geolanding:new p(n),get multitext(){this.utime;return this._raw.multitext}}),i}return _inheritsLoose(e,t),_createClass(e,[{key:"$data",get:function(){return this.$area.find("> .container-fluid")}},{key:"data",get:function(){var t,e=this.multisection.enabled&&this.multisection.selectedVar,i=this.geolanding.enabled&&this.geolanding.selectedVar;if(e){var n=this._raw.multisection.vars&&this._raw.multisection.vars[e];t=n&&n.data}else if(i){var r=this._raw.geolanding.vars&&this._raw.geolanding.vars[i];t=r&&r.data}return t||(t=this._raw.data),t}}]),e}(v),_=function(t){function e(e){return t.call(this,e)||this}return _inheritsLoose(e,t),_createClass(e,[{key:"$data",get:function(){return this.$area.find("> .modal-data").eq(0)}}]),e}(v),S=function(t){function e(e){return t.call(this,e)||this}return _inheritsLoose(e,t),e}(v);!function(){var t,e=function(){function t(t){this.root=t}var e=t.prototype;return e.setData=function(t,e,i){this[t]=i?u(e):e},e.getData=function(t){return t&&this[t]},t}(),i=function(t){function e(e){var i;return i=t.call(this,e)||this,riot.observable(i),i.page=new a(i,i.root),i}return _inheritsLoose(e,t),e}(e),n=function(){function t(t){void 0===t&&(t={}),d(this,{classes:t.classes||[],get classlist(){return this.classes.join(" ")}})}var e=t.prototype;return e.addClass=function(t){var e=this;String(t).split(" ").forEach(function(t){e.hasClass(t)||e.classes.push(t)})},e.removeClass=function(t){var e=this;String(t).split(" ").forEach(function(t){e.hasClass(t)&&e.classes.splice(e.classes.indexOf(t),1)})},e.hasClass=function(t){return this.classes.includes(t)},e.toggleClass=function(t,e){void 0===e&&(e=this.hasClass(t)),this[e?"removeClass":"addClass"](t)},e.setState=function(t,e,i){var n;(void 0===i&&(i=!0),i)?d(this,((n={})[t]=e,n)):this[t]=e},e.getState=function(t){return t&&this[t]},t}(),r=function(){function t(){var t=this;d(this,{_state:[],get list(){return mobx.toJS(this._state)},set list(t){Array.isArray(t)&&(this._state=t)}}),["pushState","removeState"].forEach(function(e){"function"==typeof t[e]&&(t[e]=mobx.action(t[e].bind(t)))})}var e=t.prototype;return e.hasState=function(t){return t=String(t).trim(),this.list.includes(t)},e.pushState=function(t){var e=this;return Array.isArray(t)||(t=[t]),t.forEach(function(t){(t=String(t).trim())&&!e.hasState(t)&&e._state.push(t)}),this.list},e.removeState=function(t){var e=this;return Array.isArray(t)||(t=[t]),t.forEach(function(t){(t=String(t).trim())&&e.hasState(t)&&e._state.splice(e._state.indexOf(t),1)}),this.list},e.clearState=function(){this.list=[]},t}(),a=function(t,e){this.parent=t,this.root=e,this.state=new r,this.body=new n({classes:[e._data.settings.adaptive?"adaptive":"","ready"]}),this.blockAdd=u({lock:!1,state:!1,index:1,get isFirst(){return this.index<=Number(pageStore.pType)},get isLast(){return this.index>=pageStore._blocks.length-Number(pageStore.pType)},get isOnly(){return 0===pageStore._land.length}})},s=function(t){function e(e){var i;return(i=t.call(this,e)||this).themeJson=flexbe.land.theme_json,i.fonts=i.themeJson.fonts,i.twigGlobals=i.root._data.page.twigGlobals,i.objects=u.shallowMap(),i.config=u.map(),i.template=u.map(),i.styles=u.map(),i.groups={},i}_inheritsLoose(e,t);var i=e.prototype;return i.getObject=function(t){return this.objects.get(t)||!1},i.setObject=function(t){return!!t&&(this.objects.set(t.id,t),!0)},i.removeObject=function(t){return!!t&&(this.objects.delete(t),!0)},i.getTemplate=function(t,e){if(!t||!e&&"macro"!==t)return!1;if("macro"===t)return this.template.get("macro")||!1;var i=String(e),n=i.split(":")[0];return this.template.get(t+i)||this.template.get(t+n)||!1},i.setTemplate=function(t,e,i){if(!t||!e&&"macro"!==t||void 0===i)return!1;if("macro"===t)return this.template.set(t,i),!0;var n=String(e),r=n.split(":")[0];return this.template.set(t+n,i),n===r||this.getTemplate(t,r)||this.template.set(t+r,i),!0},i.getStyle=function(t,e){if(!t||!e&&"mixin"!==t)return!1;if("mixin"===t)return this.styles.get("mixin")||!1;var i=String(e),n=i.split(":")[0],r=this.styles.get(t+i)||this.styles.get(t+n);return r&&mobx.toJS(r)||!1},i.setStyle=function(t,e,i){if(!t||!e&&"mixin"!==t||!i)return!1;if("mixin"===t)return this.styles.set("mixin",i),!0;var n=String(e),r=n.split(":")[0];return this.styles.set(t+n,i),n===r||this.getTemplate(t,r)||this.styles.set(t+r,i),!0},i.getConfig=function(t,e,i){if(void 0===i&&(i=!1),!t||!e)return!1;var n=(e=String(e)).split(":"),r=n[0],a=n[1],s=+a?r+":"+a:r,o=this.config.get(t+s)||!i&&this.config.get(t+r);return o&&mobx.toJS(o)||!1},i.setConfig=function(t,e,i){if(!t||!e||!i)return!1;i.type||(i.type=[]);var n=String(e);return this.config.set(t+n,i),i},i.getEntityGroup=function(t,e){var i=this,n=this.themeJson[t];return!!n&&(this.groups[t]||(this.groups[t]={},Object.keys(n).map(function(e){var r=n[e].list.map(String);i.groups[t][e]=r})),Object.keys(this.groups[t]).find(function(n){return i.groups[t][n].includes(String(e))}))},i.getEntityList=function(t,e){var i=this.getEntityGroup(t,e);return this.groups[t]&&this.groups[t][i]||!1},e}(e),o=function(t){function e(e){var i,n=(i=t.call(this,e)||this).root._data.page,r=flexbe.helpers.normalizeEntity;return i.pId=n.pId,i.pType=n.pType,i.themeId=n.themeId,i.fonts=new f(n.fonts),i.abtests=new h(n.abtests),["block","modal","widget","element"].forEach(function(t){var e=t+"s",a=u.shallowArray(n[e].map(function(e){return r(e,t)}));mobx.intercept(a,function(e){return e.added&&(e.added=e.added.map(function(e){return e.new=!0,e.is=t,r(e)}).filter(function(t){return!!t})),e}),i["_"+e]=a}),i.extend(),i.runMobx(),i}_inheritsLoose(e,t);var i=e.prototype;return i.extend=function(){var t=this;d(this,{saved:!0,get _header(){return this._blocks.filter(function(t){return"header"===t.siteBlockType})},get _footer(){return this._blocks.filter(function(t){return"footer"===t.siteBlockType})},get _land(){return this._blocks.filter(function(t){return!t.siteBlockType})},get _list(){var t=this._blocks.toJS(),e=this._modals.toJS(),i=this._widgets.toJS(),n=this._elements.toJS();return[].concat(t,e,i,n)},get blocks(){var t=this;return this._blocks?this._blocks.map(function(e){return t.getEntity(e.id,"block")}):[]},get modals(){var t=this;return this._modals?this._modals.map(function(e){return t.getEntity(e.id,"modal")}):[]},get widgets(){var t=this;return this._widgets?this._widgets.map(function(e){return t.getEntity(e.id,"widget")}):[]},get elements(){var t=this;return this._elements?this._elements.map(function(e){return t.getEntity(e.id,"element")}):[]},get list(){var t=this.blocks,e=this.modals,i=this.widgets,n=this.elements;return[].concat(t,e,i,n)},get $blocks(){return $($.map(this.blocks,function(t){return t.$area&&t.$area.get()}))},get $modals(){return $($.map(this.modals,function(t){return t.$area&&t.$area.get()}))},get $widgets(){return $($.map(this.widgets,function(t){return t.$area&&t.$area.get()}))},get $elements(){return $($.map(this.elements,function(t){return t.$area&&t.$area.get()}))},get $list(){return $($.map(this.list,function(t){return t.$area&&t.$area.get()}))}}),[].forEach(function(e){"function"==typeof t[e]&&(t[e]=mobx.action(t[e].bind(t)))})},i.runMobx=function(){var t=this;mobx.autorun(function(){t.$blocks,t.$modals,t.$widgets,t.$elements,t.$list,t.blocks,t.modals,t.widgets,t.elements,t.list})},i.addEntity=function(t){var e,i,n=this,r=t.raw,a=void 0===r?{}:r,s=t.index,o=void 0===s?0:s,l=t.force,u=void 0!==l&&l,d=t.replace,c=void 0!==d&&d,f=this["_"+a.is+"s"];if(!f)return console.warn("addEntity: wrong source list",a),!1;if("block"===a.is){var h=this.blocks[o]||{},m=h.abtest;if(!u&&!c){m&&"b"===m.variant&&(o+=1);var g=Number(this.pType);o=Math.max(g,Math.min(f.length-g,o))}c&&m&&(e=pageStore.abtests.findTest(m.id,h.id),i=e&&e.test.b==h.id?"b":"a")}return flexbe.helpers.createEntityHelper(a).then(function(t){return mobx.runInAction(function(){var n=t.modals,r=t.elements,s=t.target;r&&r.length&&r.forEach(function(t){pageStore._elements.push(t)}),n.length&&n.forEach(function(t){pageStore._modals.push(t)}),f.splice(o,Boolean(c),s),a=f[o],e&&(e.test[i]=a.id)}),n.getEntity(a.id,a.is)})},i.getEntity=function(t,e){var i=this._findEntity(t,e).raw;return i&&flexbe.helpers.createEntityInstance(i)||!1},i.getEntityIndex=function(t,e){var i=this.getEntity(t,e);return i?i.index:-1},i.removeEntity=function(t,e){var i=this.getEntity(t,e);return!!i&&(i.remove(),!0)},i.copyEntity=function(t,e,i){var n=pageStore.getEntity(t,e);if(!n)return Promise.reject(new Error("copyEntity: copy failed, source not found "+e+":"+t));void 0===i&&(i=n.index+1);var r=n.getSave();return this.addEntity({raw:r,index:i})},i.replaceEntity=function(t,e){var i=this.getEntity(t);if(!i)return!1;var n=i.is,r=i.index;i.abtest;return e=Object.assign({is:n},e),this.addEntity({raw:e,index:r,force:!0,replace:!0}).then(function(t){return t})},i.moveEntity=function(t,e){var i=this;if(!t||!e)return!1;Array.isArray(t)||(t=[t]),Array.isArray(e)||(e=[e]);var n=t.map(function(t){return i.getEntityIndex(t,"block")}).filter(function(t){return t>=0}).sort(),r=e.map(function(t){return i.getEntityIndex(t,"block")}).filter(function(t){return t>=0}).sort(),a=Math.min.apply(Math,n),s=Math.max.apply(Math,n)-a+1,o=Math.min.apply(Math,r),l=Math.max.apply(Math,r),u=a>l?o:l-s+1;if(u<Number(this.pType)||u>this._blocks.length-Number(this.pType))return!1;var d=this._blocks;mobx.runInAction(function(){d.splice.apply(d,[u,0].concat(d.splice(a,s)))})},i.getIds=function(){var t={};return pageStore.list.forEach(function(e){Array.isArray(t[e.is])||(t[e.is]=[]),t[e.is]=flexbe.lib.arrayUnique([].concat(t[e.is],[e.fullId]))}),t},i.getSave=function(){var t=this,e=function(t){return(t||[]).filter(function(t){return!t._raw.removed&&t.$area.length})},i=Promise.all(e(this.blocks).map(function(t){return t.getSave()})),n=Promise.all(e(this.modals).map(function(t){return t.getSave()})),r=Promise.all(e(this.widgets).map(function(t){return t.getSave()})),a=Promise.all(e(this.elements).map(function(t){return t.getSave()}));return Promise.all([i,n,r,a]).then(function(e){var i=e[0],n=e[1],r=e[2],a=e[3],s=t.fonts.getSave(),o=t.abtests.list.filter(function(t){return t.valid});return{pId:t.pId,pType:t.pType,themeId:t.themeId,blocks:i,modals:n,widgets:r,elements:a,fonts:s,abtests:o}})},i._findEntity=function(t,e){var i=["block","modal","widget","element"].includes(e)&&this["_"+e+"s"]||this._list,n=i.find(function(e){return e.id===String(t)});return!e&&n&&["block","modal","widget","element"].includes(n.is)&&(i=this["_"+n.is+"s"]),{raw:n,list:i}},e}(e),l=function(t){function e(e){var i,n=(i=t.call(this,e)||this).root._data.group;return i.sId=n.sId,i.groupId=n.groupId,i.siteGlobals=Object.assign({menu:{header:[],footer:[],modals:[]}},n.globals),i}_inheritsLoose(e,t);var i=e.prototype;return i.getSiteGlobal=function(t,e){return this.siteGlobals[e]&&this.siteGlobals[e][t]},i.setSiteGlobal=function(t,e,i){if(!t||!e)return!1;"object"!==_typeof(this.siteGlobals[e])&&(this.siteGlobals[e]={}),this.siteGlobals[e][t]=i},i.getSave=function(){var t=this;return new Promise(function(e){var i=pageStore._header[0],n=pageStore._footer[0];i&&i.data.menu&&Array.isArray(i.data.menu.list)&&t.setSiteGlobal("header","menu",$.extend(!0,[],i.data.menu.list)),n&&n.data.menu&&Array.isArray(n.data.menu.list)&&t.setSiteGlobal("footer","menu",$.extend(!0,[],n.data.menu.list)),e({siteGlobals:$.extend(!0,{},t.siteGlobals)})})},e}(e),c=flexbe.view.document.getElementById("flexbe-editor-store");try{t=JSON.parse(c.getAttribute("data-store")),c.remove()}catch(t){return console.error("Editor store parse error",t),!1}var m=new function(t){if("object"!==_typeof(t))return!1;this._data=t,this.configStore=new s(this),this.groupStore=new l(this),this.pageStore=new o(this),this.uiStore=new i(this)}(t);window.uiStore=m.uiStore,window.configStore=m.configStore,window.pageStore=m.pageStore,window.groupStore=m.groupStore}()};
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}flexbe.createServices=function(){var t=function(){function t(){this.loadDataThrottle=0,this.loadEntityDataQueue={},this.loadEntityDataPromises=[]}var e=t.prototype;return e.loadEntityData=function(t,e){var o=this;void 0===t&&(t={}),void 0===e&&(e=50);var n=function(t,e){t&&(alertify.error(t.message),console.error(t)),o.loadEntityDataPromises.forEach(function(o){var n=o.resolve,a=o.reject;t&&"function"==typeof a?a(t):t||"function"!=typeof n||n(e)}),o.loadEntityDataPromises=[],o.loadEntityDataQueue={}};return new Promise(function(a,r){o.loadEntityDataPromises.push({resolve:a,reject:r}),Object.keys(t).forEach(function(e){var n=t[e],a=o.loadEntityDataQueue[e]||[],r=flexbe.lib.arrayUnique([].concat(a,n));o.loadEntityDataQueue[e]=r.filter(function(t){return!configStore.getConfig(e,t,!0)}),o.loadEntityDataQueue[e].length||delete o.loadEntityDataQueue[e]}),clearTimeout(o.loadDataThrottle),o.loadDataThrottle=setTimeout(function(){var t={theme_id:pageStore.themeId,load_ids:o.loadEntityDataQueue,load_macro:configStore.getTemplate("macro")?0:1,load_less:configStore.getStyle("mixin")?0:1};if(!Object.keys(t.load_ids).length&&!t.load_macro&&!t.load_less)return n(null,!0);$.ajax({url:"/admin/data/load",type:"POST",dataType:"json",data:t}).then(function(t){var e=void 0===t?{}:t,o=e.data,a=e.is_success,r=e.message;return a&&o?(Object.keys(o).forEach(function(t){"object"===_typeof(o[t])&&Object.keys(o[t]).length&&Object.keys(o[t]).forEach(function(e){var n=o[t][e];if(!n)return!1;configStore.setConfig(t,e,Object.assign({},n.config,{js_editor:n.js_editor})),configStore.setTemplate(t,e,n.html),configStore.setStyle(t,e,{css:n.css,css_mobile:n.css_mobile,css_logic:n.css_logic})})}),o.macro&&configStore.setTemplate("macro",null,o.macro),o.less&&configStore.setStyle("mixin",null,o.less),n(null,!0),!0):n(new Error(r))}).fail(function(){return n(new Error("Ошибка сети: не удалось загрузить данные")),!1})}.bind(o),e)})},e.loadEntityDataRecursive=function(t){var e=this,o={};return function t(n){return e.loadEntityData(n,0).then(function(){var e=[];return Object.keys(n).forEach(function(t){n[t].forEach(function(n){var a=configStore.getConfig(t,n);if(!a||o[t]&&o[t].includes(n)||(o[t]=[].concat(o[t]||[],[n])),a&&a.elements&&a.elements.length){var r=a.elements.map(function(t){return t.templateId||t.template_id});e=[].concat(e,r)}})}),!e.length||t({element:e})})}(t).then(function(){return!!Object.keys(o).length&&o})},t}();window.pageService=new t};
flexbe.land={editor:{},editorInit:!1,init:function(){var e=this;this.browserAlert(),this.$btnSave=$("#flexbe-panel .save").eq(0),this.$btnSave.off("click").on("click",function(){e.save(),flexbe.stat.event("Editor - Save",{method:"click"})}),this.hotkeys(),this.template.init(),this.layout.init(),this.fonts.init(),this.editor.init(),window.onbeforeunload=function(){if(pageStore&&!pageStore.saved)return"Вы не сохранили изменения.\nКнопка сохранения находится в правом верхнем углу."},this.editorInit=!0},change:function(e){pageStore.saved=!1,e&&flexbe_cli.events.emit("editor_change",e)},hotkeys:function(){var e=this;this.$btnSave.closest(".editor-btn").attr("data-title",flexbe_cli.run.is_OSX?"CMD + S (⌘ + S)":"CTRL + S"),$document.off("keydown.spaced_edit_hotkeys").on("keydown.spaced_edit_hotkeys",function(t){if((t.ctrlKey||t.metaKey)&&83===t.which)return e.save(),t.preventDefault(),flexbe.stat.event("Editor - Save",{method:"hotkey"}),!1})},getSave:function(){var e=this;this.check.init();var t=pageStore.getSave(),i=groupStore.getSave();return Promise.all([t,i]).then(function(t){var i=t[0],a=t[1],s={p_id:i.pId,update_time:parseInt(e.updateTime,10),block_data:JSON.stringify(i.blocks),modal_data:JSON.stringify(i.modals),widget_data:JSON.stringify(i.widgets),element_data:JSON.stringify(i.elements),abtests_data:JSON.stringify(i.abtests),font_data:JSON.stringify(i.fonts)};return 1===i.pType&&(s.site_globals=JSON.stringify(a.siteGlobals)),s})},saveTimeout:0,save:function(e){var t=this;if(this.editorInit){this.$btnSave.addClass("active");var i=!1;this.getSave().then(function(s){var o=$.ajax({url:"/admin/save",type:"POST",dataType:"json",data:s});o.done(function(s){t.$btnSave.removeClass("active"),i=!0,1==s.status?function(t){var i=this;clearTimeout(this.saveTimeout),this.updateTime=t.update_time,pageStore.saved=!0,this.$btnSave.addClass("success"),setTimeout(function(){i.$btnSave.removeClass("success")},1e3),t.abtests&&console.log("Сервер обновил список тестов",t.abtests);"function"==typeof e&&e(!0)}.call(t,s):a(s.error)}),o.fail(function(){a()})}),clearTimeout(this.saveTimeout),this.saveTimeout=setTimeout(function(){i||a()},12e4)}function a(t){void 0===t&&(t="Ошибка, не удалось сохранить страницу"),clearTimeout(this.saveTimeout),flexbe.land.$btnSave.removeClass("active"),alertify.error(t),"function"==typeof e&&e(!1)}},browserAlert:function(){function e(){return/(iPhone|iPad|iPod|BlackBerry|Android)/.test(navigator.userAgent)}var t,i,a,s,o,n=(i=navigator.userAgent,a=i.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[],/trident/i.test(a[1])?{name:"IE ",version:(t=/\brv[ :]+(\d+)/g.exec(i)||[])[1]||""}:"Chrome"===a[1]&&null!==(t=i.match(/\bOPR\/(\d+)/))?{name:"Opera",version:t[1]}:(a=a[2]?[a[1],a[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(t=i.match(/version\/(\d+)/i))&&a.splice(1,1,t[1]),{name:a[0],version:a[1]}));(e()||("IE"===n.name||"MSIE"===n.name)&&1*n.version<10||"Opera"===n.name&&1*n.version<20)&&!flexbe.lib.getCookie("browseralert")&&(e()?(screen.width<1e3&&($("body iframe").hide(),$("head").append('<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1,  maximum-scale=1">')),s=$('<div class="browser-messge mobile-browser-messge"><p class="title">Редактирование с мобильных устройств не&nbsp;поддерживается!</p><p class="desc">Воспользуйтесь компьютером или ноутбуком.</p><div class="close-wrap"><a class="btn_light" href="#close">Все равно продолжить</a><br><br><br><a href="/admin/lead/">Просмотр заявок</a></div></div>')):s=$('<div class="browser-messge"><p class="title">Браузер не поддерживается <br>редактором!</p><p class="desc">Ваш браузер в данный момент не поддерживается нашим сервисом.<br>Пожалуйста, воспользуйтесь одним из следующих браузеров:</p><a href="https://www.google.ru/chrome/browser/desktop/" class="chrome" target="_blank" >Google Chrome</a><a href="https://www.mozilla.org/ru/firefox/new/" class="firefox" target="_blank" >Mozilla Firefox</a><div class="close-wrap"><a class="btn_light" href="#close">Все равно продолжить</a></div></div>'),s.find('.close-wrap a[href="#close"]').on("click",function(){if(flexbe.lib.setCookie("browseralert",1),e()&&screen.width<1e3){$('head meta[name="viewport"]').remove();var t="device-width";$(window).width()<1e3&&(t=1e3),$("head").append('<meta name="viewport" content="width='+t+'">'),$("body iframe").show()}return o.close(),!1}),o=flexbe.modal.create({width:625,click_out:"body",name:"browser_modal",$data:s}))}};
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(){var e=function(){function e(){}var t=e.prototype;return t.init=function(){this.pageLayout(),this.listLayout(),this.abtestLayout()},t.pageLayout=function(){mobx.autorun(function(){flexbe.view.$body[0].classList=uiStore.page.body.classlist}),mobx.autorun(function(){var e=uiStore.page.state.list;flexbe.view.$body[0].setAttribute("state",e.join(" "))})},t.listLayout=function(){var e=this;mobx.observe(pageStore._blocks,function(e){flexbe.land.change({reason:"update_list",name:e.addedCount?"block_add":e.removedCount?"block_remove":"block_sort"})}),mobx.observe(pageStore._modals,function(e){flexbe.land.change({reason:"update_list",name:e.addedCount?"modal_add":e.removedCount?"modal_remove":"modal_sort"})}),mobx.observe(pageStore._widgets,function(e){flexbe.land.change({reason:"update_list",name:e.addedCount?"widget_add":e.removedCount?"widget_remove":"widget_sort"})});var t=[];mobx.autorun(function(){var o=pageStore.list,n=o.map(function(e,t){return{index:t,is:e.is,id:String(e.id)}});t.filter(function(e){return!n.find(function(t){return t.id==e.id})}).forEach(function(t){return e.removeEntity(t)}),n.filter(function(e){return!t.find(function(t){return t.id===e.id})}).forEach(function(t){var n=o[t.index];n&&n.id&&n.is&&n.isNew&&e.createEntity(n)}),t=n}),mobx.autorun(this.setBlocksOrder.bind(this))},t.setBlocksOrder=function(){if(this.preventBlockOrder)return!1;var e,t=flexbe.view.$blockList;pageStore.blocks.forEach(function(a){if(!a.siteBlockType){var r=a.$area,l=(a.next,a.owner),c=function e(o){var n=o.parent();if(!o.length)return o;return i(n,t)?o:e(n)}(r);if(c.length){var f=!e,s=!!l,d=c.is(".flexbe-block-move-container"),u=c.is(".flexbe-block-replace-container");if(d||u);else if(s){var b=l.$area;i(b,c)||(r.addClass("b_head"),b.prepend(r))}else if(f)(function(e,t){void 0===t&&(t=o);return!n(e,t).length})(c)||t.prepend(r);else{i(e,c)||i(e,n(c))||(e.after(r),r.removeClass("b_head"))}s||(e=r)}}});var o=".b_block";function n(e,t){return void 0===t&&(t=o),e.prevAll(t).eq(0)}function i(e,t){return!(!e||!t)&&e.is(t)}},t.abtestLayout=function(){function e(e){if("object"!==_typeof(e)||!e.a||!e.b)return!1;e.valid&&(flexbe_cli.events.emit("editor_abtest"),flexbe_cli.events.emit("layout_change",{test:e,is:"block",action:"abtest"}))}mobx.autorun(function(){pageStore.abtests.list.forEach(function(t){e(t)})}),mobx.observe(pageStore.abtests._list,function(t){t.added.length&&t.added.forEach(e),t.removed.length&&t.removed.forEach(e)})},t.createEntity=function(e){var t=e.is;if("element"===t)return!1;"block"===t?function(){var t=e.siteBlockType?flexbe.view["$"+e.siteBlockType]:flexbe.view.$blockList,o=e.$area&&e.$area.length?e.$area:flexbe.land.template.getEmptyTemplate({data:e});if(!t[0].contains(o[0]))if(e.siteBlockType)t.prepend(o);else{var n=e.prev,i=!n||n.siteBlockType;if(i)flexbe.view.$blockList.prepend(o);else{var a=n.$area,r=a.parent(),l=r[0]===t[0]?a:r;l.after(o)}}}():function(){var o=flexbe.view["$"+t+"List"],n=flexbe.land.template.getEmptyTemplate({data:e});o[0].contains(n[0])||o.append(n)}(),e.one("renderTemplate",function(){flexbe_cli.events.emit("layout_change",{is:t,entity:e,action:"create"})})},t.removeEntity=function(e){void 0===e&&(e={});var t=e,o=t.is,n=t.id;if(!o||!n)return!1;var i=e.$area;i&&i.length||(i=flexbe.view.$document.find("[data-is="+o+"][data-id="+n+"]"));var a="block"===o&&i.find(".b_block");a&&(a.removeClass("b_head"),i.before(a)),i.remove(),flexbe_cli.events.emit("layout_change",{is:o,entity:e,action:"remove"})},t.sortEntity=function(e,t){flexbe_cli.events.emit("layout_change",{is:"block",action:"move",fromIds:e,toIds:t})},t.scrollToBlock=function(e){var t=e.$area,o=e.delay,n=void 0===o?30:o,i=e.duration,a=void 0===i?250:i,r=flexbe.view.$document.find("body, html");setTimeout(function(){var e=t.offset().top-(flexbe_cli.resize.height-t[0].offsetHeight)/2;r.animate({scrollTop:e},a)},n)},t.applyStyle=function(e){var t=e.id,o=e.css,n=void 0===o?"":o,i=e.replace,a=void 0===i||i;if(t){var r=flexbe.view,l=r.$body,c=r.$document.find("#"+t);!c.length||n?c.length?a&&n&&c.html(n):l.append('<style id="'+t+'">'+n+"</style>"):c.remove()}},e}();flexbe.land.layout=new e}();
flexbe.land.template={cache:{},init:function(){},render:function(a,d,e){void 0===e&&(e={});var i=this.parseId(d).templateId,t=a+"_"+i,o=Object.assign({},e,configStore.twigGlobals),n=configStore.getConfig(a,d);if(!n)return Promise.reject(new Error("Template Render: Empty entity ("+a+" - "+d+") config"));if(!this.cache[t]){var l=configStore.getTemplate("macro"),c=configStore.getTemplate(a,i),r=/block|modal/.test(a)?'{% if _anchor %}<a class="_anchor" name="{{ _anchor | lower }}"></a>{% endif %}':"",s="modal"===a?'<a class="close"></a>':"";Twig.twig({id:t,data:l+r+s+c}),this.cache[t]=!0}return Twig.twig({ref:t}).renderAsync(o).then(function(d){return"block"===a?d='<div class="container-fluid">'+d+"</div>":"modal"===a?d='<div class="modal-data">'+d+"</div>":"element"!==a||n.zone||(d='<div class="element-container">'+d+"</div>"),d})},getEmptyTemplate:function(a){var d=a.data,e=a.asString,i=void 0!==e&&e,t=a.loading,o=void 0===t?"":t;if(!d.id||!d.is)return console.warn("getEmptyTemplate: not enough data"),!1;var n,l=d.id,c=d.is,r=this.parseId(d.fullId||d.templateId||d.template_id||d[c[0]+"_id"],d.modId||d.mod_id),s=r.templateId,m=r.modId;return"block"===c?(""!==o&&!0!==o||(o='<div class="flexbe-block-loading"><svg class="loader circular-loader" viewBox="25 25 50 50"><circle class="loader-path" cx="50" cy="50" r="20"></circle></svg></div>'),n='<div class="b_block b_'+l+(o?" loading":"")+'" data-is="block" data-id="'+l+'" data-b-id="'+s+'" data-mod-id="'+m+'">'+(o||"")+"</div>"):"modal"===c?n='<div class="m_modal m_'+l+(o?" loading":"")+'" data-is="modal" data-id="'+l+'" data-m-id="'+s+'" data-mod-id="'+m+'">'+(o||"")+"</div>":"widget"===c?n='<div class="w_widget w_'+l+(o?" loading":"")+'" data-is="widget" data-id="'+l+'" data-w-id="'+s+'" data-mod-id="'+m+'">'+(o||"")+"</div>":"element"===c&&d.isZone?n='<div class="content-zone zone-'+l+(o?" loading":"")+'" data-is="zone" data-id="'+l+'" data-e-id="'+s+'">'+(o||"")+"</div>":"element"===c&&(n='<div class="element-item'+(o?" loading":"")+'" data-is="element" data-id="'+l+'" data-e-id="'+s+'" data-mod-id="'+m+'">'+(o||"")+"</div>"),i?n:$(n)},getRandId:function(a,d,e){void 0===a&&(a=6),void 0===d&&(d=""),void 0===e&&(e="");var i=d+flexbe.lib.getRandomId(a)+e;return configStore.getObject(i)?this.getRandId(a,d,e):i},parseId:function(a,d){var e=String(a).split(":"),i=String(e[0]),t=e[1]||d||0;return{templateId:i,modId:t,fullId:t?i+":"+t:i}}};
flexbe.site={init:function(){if(1!==pageStore.pType)return!1;flexbe.view.$document.find("[data-site-block-type=header], header, footer").each(function(t,e){var i=e.getAttribute("data-site-block-type")||e.tagName.toLowerCase();e.setAttribute("data-title",polyglot.t("editor::control::site::"+i+"_title"))})}};
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}flexbe.land.editor={modules:{},$list:[],list:{},loaded:{twig:{},css:{}},init:function(){if(flexbe.user_role&&"manager"===flexbe.user_role)return!1;flexbe.land.block.control.init(),flexbe.land.modal.control.init(),flexbe.land.check.init()},bindEditorDelayed:function(e,t){var r=this;if(void 0===t&&(t=!1),!e)return!1;t||"element"===e.is&&e.isZone?setTimeout(function(){return r.bindEditor(e.id)},0):e.$area.off("mousemove.bind_editor").on("mousemove.bind_editor",function(){e.$area.off("mousemove.bind_editor"),r.bindEditor(e.id,"editor")})},bindEditor:function(e,t){void 0===t&&(t="editor");var r=this;e="object"===_typeof(e)?$(e).attr("data-id"):e;var i=pageStore.getEntity(e);if(!i)return!1;var o=i.data,n=i.config,d=i._object,a=!1;if("editor"===t&&"block"===i.is&&flexbe.land.block.control.controlCreate(i),n&&"object"===_typeof(o)){if("settings"===t)return function(e){return new flexbe.land.editor.modules.settings(e,{onChange:s})}(e);if("editor"===t&&n.vars)return function e(t,o,n){if("object"!==_typeof(o))return;var l=function(l){if(!o.hasOwnProperty(l))return"continue";var f=o[l];if(!f)return"continue";for(var c=n,m=l.split(":")[0],b=0,p=(m=m.split(".")).length;b<p;b++)c=c&&c[m[b-1]]||n,l=m[b];void 0===c[l]&&(c[l]="text"===f.editor?"":{}),f.item||(f.item='[data-bind="'+l+'"]');var v=$.throttle(s.bind(r,c,l),100);if(f.recursive_max&&!f.currentRecursion&&(f.currentRecursion=0),!f.editor&&f.dropdown&&(f.editor="dropdown"),f.editor&&r.bindEditorSingle(d,t,f,c[l],v,a),f.elements&&r.bindEditorElements(i,f,c[l],v),f.template){if(!Array.isArray(c[l]))return{v:!1};var y,x;f.context?(y=t.find(f.context).eq(0),x=y.children(f.item+"[data-item-id]")):(x=t.find(f.item+"[data-item-id]"),y=f.parent||f.editors_bind?x.closest(f.parent||f.editors_bind):x.eq(0).parent()),x.each(function(t,r){var i=$(r),o=parseInt(i.attr("data-item-id"),10)-1,n=c[l][o];f.recursive_max?(a=!0,f.currentRecursion<f.recursive_max?(f.template[l]=$.extend(!0,{},f),f.template[l].currentRecursion+=1):delete f.template[l]):a=!1,e(i,f.template,n)}),f.editors&&r.bindEditorItems(y,x,i,f,c[l],v)}u=l};for(var u in o){var f=l(u);switch(f){case"continue":continue;default:if("object"===_typeof(f))return f.v}}return!0}(i.$data,n.vars,o)}function s(e,t,r,o,n,d){e[t]=r,i.change({render:n,reason:o,name:t,val:r,$item:d}),i.render({render:n,reason:o,name:t,val:r})}},bindEditorGrid:function(e,t,r,i,o){},bindEditorElements:function(e,t,r,i){if(!e)return!1;var o=e.$data,n="self"===t.item?o:o.find(t.item);return!!n.length&&new flexbe.land.editor.elements({$wrap:n,entity:e,data:r,params:t,onChange:i})},bindEditorItems:function(e,t,r,i,o,n){return new flexbe.land.editor.items({$parent:e,$items:t,entity:r,data:o,params:i,onChange:n})},bindEditorSingle:function(e,t,r,i,o,n){var d="self"===r.item?t:t.find(r.item);if(!d.length)return!1;if(n&&(d=d.eq(0)),r.editor&&"function"!=typeof flexbe.land.editor.modules[r.editor])return console.warn("Неизвестный редактор "+r.editor,d),!1;setTimeout(function(){return flexbe.land.check.checkComponent(e,d,r,i)},30);var a="editor";~["text","list"].indexOf(r.editor)?a="text":~["dropdown","color","select","indent"].indexOf(r.editor)&&(a="custom");var s=d.attr("data-editor");if(s){if(-1!==s.split(",").indexOf(r.editor))return;d.attr("data-editor",s+","+r.editor)}else d.attr("data-editor",r.editor);var l={data:i,block:e,$block:e.$area,options:$.extend(!0,{},r.options),on_change:function(e,t,i){t||(t="editor_"+r.editor),o(e,t,i,d)}};if("text"===a)d.one("mousemove.editor_run",function(){return new flexbe.land.editor.modules[r.editor](d,l)});else{if("custom"===a){var u,f=r.editor;return d.each(function(e,t){var r=$(t),i=r.children(".flexbe-custom-editor-wrap");i[0]?i.attr("data-editor-list",i.attr("data-editor-list")+","+f):(i=$('<div class="flexbe-custom-editor-wrap" data-editor-list="'+f+'"></div>'),r.prepend(i));var o=$('<div class="flexbe-custom-editor flexbe-custom-editor-'+f+'"></div>');i.append(o),u=u?u.add(o):o}),"object"===_typeof(r.style)&&u.css(r.style),l.$item=d,r.dropdown&&(l.dropdown=r.dropdown),new flexbe.land.editor.modules[f](u,l)}if("editor"===a){var c=r.holder||this._getHolder(r.item,".editor-overlay");t.find(c).length||d.prepend('<div class="editor-overlay"><svg><use xlink:href="/_s/images/land/editor/inner.svg#editor_settings"></use></svg></div>'),t.on("mouseover.editor-hover",c,function(){d.addClass("editor-hover")}).on("mouseout.editor-hover",c,function(){d.removeClass("editor-hover")});var m=".editor."+r.item.replace(/[.#_ ]/g,"");t.off("click"+m).on("click"+m,c,function(e){return l.item=$(e.currentTarget).parent(),e.preventDefault(),e.stopPropagation(),new flexbe.land.editor.modules[r.editor](d,l)})}}return!0},stopStates:["disable-block-add","disable-block-control","disable-block-border","disable-editor-overlay","disable-editor-error","disable-editor-text","disable-editor-indent","disable-editor-custom","disable-editor-items","disable-editor-elements","disable-links"],stop:function(e){Array.isArray(e)||(e=this.stopStates),uiStore.page.state.pushState(e)},start:function(e){Array.isArray(e)||(e=this.stopStates),uiStore.page.state.removeState(e)},_getHolder:function(e,t){void 0===t&&(t=".editor-overlay");var r=function(e){return void 0===e&&(e="self"),"self"===e?[""]:e.split(",")};return e=r(e),t=r(t),e.map(function(e){for(var r=[],i=0,o=t.length;i<o;i++)r.push(e+" "+t[i]);return r.join(",")}).join(",")}};
function _typeof(o){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o})(o)}flexbe.land.check={init:function(){flexbe.land.abtest.check.init(),flexbe.land.modal.check.init(),flexbe.land.widget.check.init()},link:function(o){var t=!1;if(flexbe.regex.link.is(o)){if(/^(?:#|\.\/#)/.test(o)){var i=o.replace(/^(?:#{1,2}|\.\/#{1,2})/,""),e="#"+i+", ._anchor[name="+i+"], .m_modal[data-id="+i+"]";if(pageStore.modals.map(function(o){return o.id}).filter(function(o){return o}).includes(i))return t;if(pageStore.list.map(function(o){return o.data._anchor}).filter(function(o){return o}).includes(i))return t;i&&flexbe.view.$document.find(e).length||(t="anchor_is_wrong")}}else t="link_is_wrong";return t},checkComponent:function(o,t,i,e){void 0===i&&(i={}),void 0===e&&(e={}),t&&t.length&&i.editor&&this.components[i.editor]&&this.components[i.editor](o,t,e,i.options)},components:{_errors:{modal_is_wrong:"Не выбрано модальное окно",link_is_wrong:"Неправильно указана ссылка",anchor_is_wrong:"Неправильно указан якорь",menu_text_wrong:"Не заполнено название пункта меню"},_setError:function(o,t,i,e){if(1!==flexbe_cli.theme_id){var n=(t=t.eq(0)).find(".editor-error");if(n.length||(n=$('<div class="editor-error"></div>'),t.prepend(n)),i){var r=this._errors[i];r&&n.html('<div class="editor-error-bubble"><span>'+r+"</span></div>")}if(e){var l=t.find(e);if(l.length){var a=t[0].getBoundingClientRect(),d=l[0].getBoundingClientRect();n.css({top:d.top-a.top+"px",right:a.right-d.right+"px"})}}}},form:function(o,t,i,e){if(i.action&&!/^(?:modal_|form|done)/.test(i.action)||(i.action="modal"),i.modal_id||(i.modal_id=""),i.action_redirect||(i.action_redirect=""),i.pay||(i.pay={price:""}),i.name||(i.name="Заявка"),"object"!=_typeof(i.goals)&&(i.goals={goal:"",goal_html:""}),String(i.modal_id).replace(/\D/g,"").length<5&&!/^cart/.test(i.modal_id)){var n=String(o.id).split("_")[0];i.modal_id=n+"_"+i.modal_id}if("modal"!==i.action||i.modal_id&&flexbe_cli.modal.find(i.modal_id)){if("redirect"===i.action){var r=flexbe.land.check.link(i.action_redirect);r&&this._setError(o,t,r,".component-button")}}else this._setError(o,t,"modal_is_wrong",".component-button")},form_btn:function(o,t,i,e){if("modal_product"===i.action&&(i.modal_id=i.product_id,delete i.product_id),i.action&&!/^(?:modal_|form|done)/.test(i.action)||(i.action="modal"),i.modal_id||(i.modal_id=""),i.action_link||(i.action_link=""),"object"!=_typeof(i.goals)&&(i.goals={goal:"",goal_html:""}),String(i.modal_id).replace(/\D/g,"").length<5&&!/^cart/.test(i.modal_id)){var n=String(o.id).split("_")[0];i.modal_id=n+"_"+i.modal_id}if("modal"!==i.action||i.modal_id&&flexbe_cli.modal.find(i.modal_id)){if("link"===i.action){var r=flexbe.land.check.link(i.action_link);r&&this._setError(o,t,r)}}else this._setError(o,t,"modal_is_wrong")},quiz:function(o,t,i,e){if(i.action&&!/^(?:modal_|form|done)/.test(i.action)||(i.action="modal"),String(i.modal_id).replace(/\D/g,"").length<5&&!/^cart/.test(i.modal_id)){var n=String(o.id).split("_")[0];i.modal_id=n+"_"+i.modal_id}"modal"!==i.action||i.modal_id&&flexbe_cli.modal.find(i.modal_id)||this._setError(o,t,"modal_is_wrong")},menu:function(o,t,i,e){var n=!1;i.list.some(function(o){return!!(n=o.text?flexbe.land.check.link(o.url):"menu_text_wrong")}),n&&this._setError(o,t,n)}}};
flexbe.land.image={},flexbe.land.image.aviary={is_init:!1,is_open:!1,run:function(i){this.is_init?this.launch(i):this.init(i)},init:function(i){var n=this;n.is_init||requirejs(["/_s/lib/aviary/feather.js"],function(){n.aviary=new Aviary.Feather({apiKey:"WGdidL2eMEisrVFVBlTBAA",apiVersion:3,language:"ru",maxSize:1920,tools:["crop","orientation","frames","draw","text","effects","colorsplash","focus","brightness","saturation","sharpness"],onError:function(i){console.error(i)},onLoad:function(){n.is_init=!0,n.launch(i)}})})},launch:function(i){var n=this;n.aviary.launch({image:i.image,url:i.url,onSave:function(a,e){n.save(e,i)},onClose:function(a){"function"==typeof i.close&&i.close(a),n.close(),n.is_open=!1}}),n.is_open=!0},close:function(){this.is_init&&this.is_open&&this.aviary.close()},save:function(i,n){var a=this;$.ajax({url:"/admin/files/upload_url?type=image",type:"POST",dataType:"json",data:{file_url:i,file_name:n.img_name}}).done(function(i){i.img_id&&(n.save({id:i.img_id,name:i.img_name}),a.close())}).fail(function(i,n){alert("Ошибка сохранения (проблемы с сетью): "+n+". Попробуйте еще раз.")})}};
flexbe.land.fonts={list:null,init:function(){var e=this,t=pageStore.fonts;Object.keys(t.set).length||t.setVariant(1),mobx.autorun(function(){e.applyFonts(t.set)})},setup:function(){flexbe.modal.create({name:"font_setup",width:380,title:polyglot.t("editor::fonts::title"),overlay:!1,item:flexbe.panel.$menu.find("a.font-setup"),riotTag:"font-setup",riotOpts:{scope:this}})},loadList:function(e){var t=this;if(void 0===e&&(e=function(){}),this.list)e(this.list);else{var s=[{family:"Arial, Helvetica",source:"system"},{family:"Courier New, Courier",source:"system"},{family:"Georgia",source:"system"},{family:"Tahoma, Geneva",source:"system"},{family:"Times New Roman, Times",source:"system"},{family:"Verdana, Geneva",source:"system"}];$.ajax({url:"/admin/api/fonts",type:"GET",dataType:"json",data:{fields:"items(family,subsets)",subsets:["cyrillic"]}}).done(function(i){if(!i.items)return!1;t.list=[].concat(s,i.items),e(t.list)})}},loadFontsOnPage:function(e){void 0===e&&(e=function(){}),0===$("head .google-fonts").length?this.loadList(function(t){var s={},i=0;for(var o in t.forEach(function(e){var t=Math.floor(i/10);s[t]||(s[t]=[]),"system"!=e.source&&(s[t].push(e.family.replace(/[ \n\t]/g,"+").replace(/['"]/g,"")),i+=1)}),$("head .google-fonts").remove(),s){var a="https://fonts.googleapis.com/css?family="+s[o].join("|");$("head title").after('<link class="google-fonts" href="'+a+'" rel="stylesheet">')}e()}):e()},applyFonts:function(e){if(void 0===e&&(e=pageStore.fonts.set),!e)return!1;var t=[],s=[],i=[],o="",a="";Object.keys(e).forEach(function(o){var a=e[o];if(a.family){var n=a.family.split(",")[0];n=n.replace(/[ \n\t]/g,"+").replace(/['"]/g,""),"content"===o?s.push("body { font-family: "+a.family+", sans-serif !important }"):s.push("body .text-style-"+o+" { font-family: "+a.family+", sans-serif }"),["Formular","Verdana","Times+New+Roman","Arial","Georgia","Tahoma","Courier+New"].includes(n)||i.includes(n)||(i.push(n),t.push(n+":300,300i,400,400i,700,700i"))}}),t.length&&(o="//fonts.googleapis.com/css?family="+t.join("|")+"&subset=cyrillic"),a+=s.join("\n");var n=flexbe.view.$document.find(".font-setup"),l=$('<style class="font-setup">'+a+"</style>"),f=flexbe.view.$document.find(".font-setup-import"),r=$('<link class="font-setup-import" rel="stylesheet" href="'+o+'">');n.length?(f.last().after(r),n.last().after(l),setTimeout(function(){n.remove(),f.remove()},300)):flexbe.view.$head.append(r,l)}};
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}flexbe.land.less={render:function(t,o){void 0===t&&(t=""),void 0===o&&(o={});var e=configStore.getStyle("mixin"),r="";return e&&(r+=e),r+=t,less.render(r,{compress:!0,modifyVars:this.buildVars(o)}).then(function(t){return t.css},function(t){return console&&console.error&&console.error(t),""})},buildVars:function(t,o,e){if(void 0===o&&(o=""),void 0===e&&(e=-1),"object"==_typeof(t)){var r={};o&&(o+="-"),e+=1;var n=new RegExp("[а-я<>\n\t]","gi");for(var i in t)if(t.hasOwnProperty(i)){var s=t[i],f=o+i;if(Math.floor(i)>=0&&(f=o),void 0!==s&&"object"!=_typeof(s)&&("number"==typeof s||s.length)&&!n.test(s)){var a=/^[\d ]*$/.test(s),y=/^\s*(#([\da-f]{3}){1,2}|\w+\((?:\d+%?(?:\s*,\s*)*){3}(?:\d*\.?\d+)?\));?\s*$/i.test(s),c=/^\s*(?:linear-gradient|repeat-linear-gradient)\(.*\)/i.test(s),u=/^\s*(#([\da-f]{3}){1,2}|\w+\((?:\d+%?(?:\s*,\s*)*){3}(?:\d*\.?\d+)?\))\s*url\((.*)\)$/i.test(s),l=/url\([a-z0-9_\/\\\'\"?.,%;:&\(\)]*\)/i.test(s);a||y||c||u||l?r[f]=s:("string"==typeof s&&(s=s.split("'").join('"')),r[f]="'"+s+"'")}e<5&&s&&"object"==_typeof(s)&&(s.forEach&&"object"!=_typeof(s[0])?r[f]="'"+s.join(",")+"'":r=d(r,this.buildVars(s,f,e)))}return r}function d(t,o){if("object"!=_typeof(o))return t;var e=Object.assign({},t);for(var r in o)if(o.hasOwnProperty(r)){var n=o[r];void 0!==e[r]&&"object"!=_typeof(e[r])&&"object"!=_typeof(n)?e[r]+=", "+n:e[r]=n}return e}}};
flexbe.land.abtest={check:{init:function(){this.checkOrder()},checkOrder:function(){mobx.autorun(function(){pageStore.abtests.list.filter(function(t){return t.valid}).forEach(function(t){var e=pageStore.getEntity(t.a,"block"),a=pageStore.getEntity(t.b,"block"),o=e.prev,i=a.prev,r=e.header,n=a.header;if(e===i){var l=r&&o===r?r.prev:o;l&&l.hasType("overflow")&&!l.siteBlockType&&a.hasType("allow_head")&&pageStore.moveEntity([l.id],[e.id])}else if(i!==n){var s=r&&!r.siteBlockType?r.id:e.id;pageStore.moveEntity([i.id],[s])}})})}},getStat:function(t,e,a){void 0===t&&(t=!1),void 0===e&&(e=!1),void 0===a&&(a=function(){});var o=pageStore.abtests.getTest(t,e);o&&$.ajax({url:"/admin/abtest/?action=get_stat",type:"POST",dataType:"json",data:{test:o,p_id:pageStore.pId}}).done(function(t){a(t.data)})},toggleTest:function(t,e){var a=this;void 0===t&&(t=!1),void 0===e&&(e=!1);var o=pageStore.abtests.getTest(t,e);o?this.stopTest(o.id,e):flexbe.bill.abtest?this.runTest(e):flexbe.bill.show_feature(polyglot.t("admin::user::bill::upgrade::abtest"),function(t){if(!t)return!1;a.runTest(e)})},runTest:function(t){var e=pageStore.getEntity(t);if(!e||pageStore.abtests.getTest(!1,t))return!1;flexbe.modal.create({id:"ab_block_variant",name:"ab_block_variant",width:380,overlay:!0,dublicate:!1,title:polyglot.t("editor::ab_begin::title"),riotTag:"ab-block-variant",riotOpts:{onselect:function(t,a){var o;"new"===t&&a&&a.templateId?o=flexbe.land.block.create({raw:a,index:e.index+1,loader:!1,scroll:!1}):"copy"===t&&(o=flexbe.land.block.copy({entity:e,scroll:!1})),o&&Promise.resolve(o).then(function(t){pageStore.abtests.create(e.id,t.id,!0)})}}})},stopTest:function(t,e,a){var o=pageStore.abtests.getTest(t,e);if(!o)return!1;var i=function(t){var e=o["a"===t?"b":"a"];mobx.runInAction(function(){var a=pageStore.getEntity(e,"block");a.header&&!a.header.siteBlockType&&pageStore.removeEntity(a.header.id,"block"),pageStore.removeEntity(a.id,"block"),pageStore.abtests.delete(o.id,o[t])}),flexbe_cli.events.emit("editor_abtest",{reason:"stop"})};a?i(a):flexbe.modal.create({id:"block_ab_tests",name:"ab_block_select_result",width:380,overlay:!0,dublicate:!1,title:polyglot.t("editor::ab_stop::title"),riotTag:"ab-stop",riotOpts:{test:o,onselect:function(t){i(t)}}})},showStatistic:function(t,e){function a(){flexbe.modal.create({id:"ab_block_statistics",name:"ab_block_statistics",width:500,title:polyglot.t("editor::ab_stat::title"),overlay:!1,item:!1,riotTag:"ab-statistics",riotOpts:{id:t,section:e}})}flexbe.bill.abtest?a():flexbe.bill.show_feature(polyglot.t("admin::user::bill::upgrade::abtest"),function(t){if(!t)return!1;a()})},profitToStr:function(t){var e="—";return void 0!==t&&(e=t?t>0?"+ "+t+"%":"- "+Math.abs(t)+"%":"0%"),e}};
flexbe.land.editor.prototype={on_init:function(){},on_change:function(){},on_render:function(){},on_edit:function(){},on_remove:function(){},_on_init:function(e){this._setDisposers(),this.on_init(e)},_on_change:function(e){var i=this,t=(e.render,e.reason),n=e.name,s=e.val,o=e.$item,r=this.id;this.on_change(t,n,s,o,this.id),setTimeout(function(){flexbe_cli.events.emit(i.is+"_change",{id:r,reason:t,name:n,val:s})},0)},_on_remove:function(e){var i=this;this._clearDisposers(),this.on_remove(e),configStore.removeObject(this.id),setTimeout(function(){flexbe_cli.events.emit(i.is+"_remove",i.entity)},0)},_on_render:function(e){var i=this,t=e.render,n=e.reason,s=e.name,o=e.val,r=this.id;this.on_render(t,n,s,o),setTimeout(function(){flexbe_cli.events.emit(i.is+"_render",{render:t,reason:n,name:s,val:o,id:r})},0)},_setDisposers:function(){var e=this;this._clearDisposers(),this._disposers=Object.keys(this.disposers).map(function(i){var t=e.disposers[i].bind(e);return mobx.autorun(t)})},_clearDisposers:function(){var e=this;if(!this._disposers)return!1;Object.keys(this._disposers).forEach(function(i){var t=e._disposers[i];"function"==typeof t&&(t(),delete e._disposers[i])})},clientMsg:function(e,i){var t=this;setTimeout(function(){flexbe_cli.events.emit("client_msg",{is:t.is,id:t.id,msg:e,data:i})},0)},disposers:{setAreaParams:function(){var e=this.entity;if(e){e.utime,e.lastTemplateRender;var i=e.$area,t=e.is[0];if(i&&i.length){if(i.attr("data-is",e.isZone?"zone":e.is),i.attr("data-"+t+"-type",JSON.stringify(e.type)),i.attr("data-"+t+"-id",e.templateId),i.attr("data-mod-id",e.modId),i.toggleClass("hidden",!!e.hidden),"block"===e.is){var n=e.owner;i.attr("data-owner",n&&n.id||null)}if(["block","modal"].includes(e.is)){var s=e.siteBlockType;i.attr("data-site-block-type",s||null)}}}}}};
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}flexbe.land.block={data:{},register:function(e){var t=e.config||{};if("function"!=typeof this.data[e.fullId]){var n=function(e){this.is=e.is,this.id=e.id,this.templateId=e.templateId,this.modId=e.modId,this.fullId=e.fullId,Object.defineProperty(this,"entity",{get:function(){return pageStore.getEntity(e.id,"block")}}),Object.defineProperty(this,"config",{get:function(){return e.config}}),Object.defineProperty(this,"data",{get:function(){return e.data}}),Object.defineProperty(this,"elements",{get:function(){return e.elements}})},a=t.js_editor&&new Function(t.js_editor)()||{};n.prototype=$.extend(!0,{},flexbe.land.editor.prototype,this.prototype,a),this.data[e.fullId]=n}return new this.data[e.fullId](e)},create:function(e){var t=e.raw,n=void 0===t?{}:t,a=e.index,o=e.force,r=e.loader,i=void 0===r||r,l=e.scroll,c=void 0===l||l;if(void 0===a&&(a=uiStore.page.blockAdd.index),uiStore.page.blockAdd.lock=!1,n=$.extend(!0,{is:"block",id:flexbe.helpers.getRandId()},n),i&&uiStore.page.blockAdd.isOnly&&(i=!1),i){var d=flexbe.view.$blockList,s=flexbe.land.template.getEmptyTemplate({data:n,loading:!0}),u=pageStore.blocks[a];if(u&&!u.siteBlockType){var f=u.$area,p=f.parent();(p[0]===d[0]?f:p).before(s)}else if(u){d["footer"===u.siteBlockType?"append":"prepend"](s)}else d.append(s)}return pageStore.addEntity({raw:n,index:a,force:o}).then(function(e){return c&&e.one("renderTemplate",function(){flexbe.land.layout.scrollToBlock({$area:e.$area})}),e}).catch(function(e){return alertify.error(e.message),console.error(e),e})},replace:function(e){var t=e.id,n=e.entity,a=e.raw,o=e.loader,r=void 0===o||o,i=e.scroll,l=void 0!==i&&i;return n?t=n.id:n=pageStore.getEntity(t),a=$.extend(!0,{is:"block",siteBlockType:n.siteBlockType||!1,hidden:n.hidden||!1},a),n.data._anchor&&(a.data._anchor=n.data._anchor),r&&(r=setTimeout(function(){n.$area.addClass("loading")},50)),pageStore.replaceEntity(t,a).then(function(e){return l&&e.one("renderTemplate",function(){clearTimeout(r),flexbe.land.layout.scrollToBlock({$area:e.$area})}),e}).catch(function(e){return alertify.error(e.message),console.error(e),e})},copy:function(e){var t=e.id,n=e.entity,a=e.index,o=e.scroll,r=void 0===o||o;return n&&(t=n.id),pageStore.copyEntity(t,"block",a).then(function(e){return e.data._anchor&&(e.data._anchor=e.data._anchor+"_copy"),r&&e.one("renderTemplate",function(){flexbe.land.layout.scrollToBlock({$area:e.$area,delay:30,duration:250})}),e}).catch(function(e){return alertify.error(e.message),console.error(e),e})},remove:function(e,t){void 0===t&&(t=function(){});var n=["object"!==_typeof(e)?e:$(e).attr("data-id")],a=[],o=pageStore.getEntity(n,"block"),r=o&&o.$area;if(!o)return!1;o.abtest?a.push(o.abtest.a,o.abtest.b):a.push(o),a.forEach(function(e){e.header&&!e.header.siteBlockType&&a.push(e.header)});var i=$('<div class="flexbe-block-removing"><span>Секция удалена</span><a class="cancel">Восстановить</a><a class="close"><svg viewBox="0 0 14 14"><path d="M6.707 8.12L12 13.415 13.414 12 8.12 6.707l5.294-5.293L12 0 6.707 5.293 1.414 0 0 1.414l5.293 5.293L0 12l1.414 1.414L6.707 8.12z"/></svg></a></div>');r.addClass("removing").append(i);var l=function(e){uiStore.page.blockAdd.state=!1,pageStore.removeEntity(e.id,"block"),t()},c=function(e){a.forEach(function(t){t&&t.setField("removed",e)})},d=function(){anime({targets:i[0],height:{value:0,easing:"easeOutSine",duration:300},opacity:{value:[1,0],duration:100,easing:"linear"},complete:function(){uiStore.page.state.removeState(["hover-block-control"]),a.forEach(l)}})},s=setTimeout(function(){d()},5e3);c(!0),i.on("click.close",".close",function(){clearTimeout(s),d()}),i.on("click.cancel",".cancel",function(){clearTimeout(s),c(),i.remove(),r.removeClass("removing")})},move:function(e,t){if(e){var n="up"===t,a="down"===t,o=function(e){var t=function(e){var t=[];if(!e||e.siteBlockType)return t;var n=(e=e.owner||e).abtest;return n?t.push(n.a,n.b):t.push(e),t.filter(function(e){return e})}(e),n=$($.map(t,function(e){return e.$area&&e.$area.get()}));return{list:t,ids:t.reduceRight(function(e,t){var n=t.header;return[n&&!n.siteBlockType&&n.id,t.id].concat(e)},[]).filter(function(e){return e}),$area:n}},r=o(pageStore.getEntity(e,"block")),i=pageStore.getEntity(r.ids[a?r.ids.length-1:0],"block"),l=o(a?i.next:i.prev);if(r.list.length&&l.list.length){var c=r.$area.wrapAll('<div class="move-block"></div>').parent(),d=l.$area.wrapAll('<div class="mark-block"></div>').parent(),s=c.add(d).wrapAll('<div class="flexbe-block-move-container"></div>').parent();flexbe.land.editor.stop();var u=s[0].getBoundingClientRect(),f=u.top,p=u.height,h=c[0].getBoundingClientRect(),g=h.top,b=h.height,v=d[0].getBoundingClientRect(),m=v.top,y=v.height,x=flexbe_cli.resize.documentHeight-flexbe_cli.resize.height,k=flexbe_cli.scroll.latest+y*(n?-1:1),S=n?Math.min(0+k,0):Math.max(k-x,0),w=f>=0&&f+p<=flexbe_cli.resize.height,I=Math.min(500,Math.max(1200,y/1.3));s.css({position:"relative",height:p+"px"}),c.css({position:w?"absolute":"fixed",width:"100%",height:b+"px",top:0,transform:"translateY("+(w?g-f:g)+"px)",zIndex:25}),d.css({position:"absolute",width:"100%",height:y+"px",top:0,transform:"translateY("+(m-f)+"px)",zIndex:0}),anime({targets:c[0],opacity:[{value:.85,duration:I/2},{value:1,duration:I/2}],translateY:w?n?0:y:g+S,duration:I,easing:"easeInOutQuad",begin:function(){w||flexbe.view.$document.find("html, body").animate({scrollTop:k},I)}}),anime({targets:d[0],translateY:a?0:b,duration:I,easing:"easeInOutQuad",complete:function(){n?c.insertBefore(d):c.insertAfter(d),c.contents().unwrap(),d.contents().unwrap(),s.contents().unwrap(),pageStore.moveEntity(r.ids,l.ids),flexbe.land.layout.sortEntity(r.ids,l.ids),flexbe.land.editor.start()}})}}},selectorCache:{},selector:function(e,t){var n=pageStore.getEntity(e,"block");if(!n)return!1;var a,o=n.fullId,r=configStore.getEntityList("block",o),i=r.indexOf(o),l=n.$area,c=l.outerHeight();if(!r||r.length<=1)return!1;a="prev"===t?i<=0?r[r.length-1]:r[i-1]:i===r.length-1?r[0]:r[i+1],flexbe.land.editor.stop(),flexbe.land.layout.preventBlockOrder=!0,this.selectorCache[o]=n.getSave();var d=!1;if(this.selectorCache[a])d=this.selectorCache[a];else{var s=flexbe.helpers.parseId(a);d={is:"block",id:flexbe.helpers.getRandId(),fullId:a,templateId:s.templateId,modId:s.modId}}var u=$('<div class="flexbe-block-replace-container disable-pointer-events '+t+'"></div>'),f=flexbe.land.template.getEmptyTemplate({data:d,loading:!1});return l.addClass("flexbe-block-replace-old"),f.addClass("flexbe-block-replace-new"),u.css("height",c+"px"),u.insertBefore(l),"next"===t?u.append(l,f):u.append(f,l),pageStore.addEntity({raw:d,index:n.index}).then(function(e){return e.one("renderTemplate",function(){var e=f.outerHeight();anime({duration:450,easing:"easeInOutCubic",targets:u[0],height:{duration:200,value:[c,e]},translateX:"next"===t?[0,"-50%"]:["-50%",0],complete:function(){pageStore.removeEntity(n.id,"block"),f.unwrap(),u.remove(),f.addClass("in-hover"),f.removeClass("flexbe-block-replace-new"),flexbe.land.editor.start(),flexbe.land.layout.preventBlockOrder=!1}})}),e}).catch(function(e){console.warn("Error change block",e),f.remove(),l.unwrap(),u.remove()})},hide:function(e,t){var n=pageStore.getEntity(e,"block");if(!n)return!1;function a(e,t){e.setField("hidden",t),e.header&&e.header.setField("hidden",t)}void 0===t&&(t=!n.hidden),n.abtest?(a(n.abtest.a,t),a(n.abtest.b,t)):a(n,t)}};
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}flexbe.land.block.prototype={disposers:{multidata:function(){if(this.entity){var t=this.entity,e=(t.utime,t.multisection.selectedVar),a=t.geolanding.selectedVar;t.multisection.enabled&&"default"!==e||(e=null),t.geolanding.enabled&&"default"!==a?"object"===_typeof(a)&&(a=a.id||null):a=null,t.$area.attr("data-multivar",e||a||null)}},abtests:function(){if(this.entity){var t=this.entity,e=t.abtest||{},a=t.$area||{};t.utime;a.attr("data-abtest-active",e.variant&&e.variant===e.current||null),a.attr("data-abtest-id",e.id||null),a.attr("data-abtest-variant",e.variant||null)}}},resetModals:function(){var t=flexbe.helpers.findInObject(this.entity.data,"modal_id");t.list.length&&t.list.forEach(function(t){t&&t.modal_id&&(t.modal_id="")})}};
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}flexbe.land.block.control={init:function(){var e;this.addBlockButton(),flexbe.view.$document.off("mouseenter.prefetch_block_data").on("mouseenter.prefetch_block_data",".block-control-wrap",function(e){var t=$(e.currentTarget).closest(".b_block").attr("data-id"),o=pageStore.getEntity(t,"block"),l=configStore.getEntityList("block",o.fullId);l&&pageService.loadEntityData({block:l},0)});var t=pageStore.$blocks;flexbe.view.$document.off("mouseenter.block_hover mousemove.block_hover").on("mouseenter.block_hover",".b_block",function(){t=pageStore.$blocks}).on("mousemove.block_hover",".b_block",function(o){var l=o.currentTarget;e===l||t.filter(".in-block-edit").length||(e=l,t.removeClass("in-hover"),$(l).addClass("in-hover"))})},controlCreate:function(e){if(e&&e.$area&&"block"===e.is){var t=e.$area.find(" > .block-control-wrap");t.length||(t=$('<div class="block-control-wrap"></div>'),e.$area.append(t),riot.mount(t[0],"block-controls",{id:e.id}))}},addBlockButton:function(){var e=this,t=flexbe.view.$blockList,o=mobx.action(function(t){if(uiStore.page.blockAdd.lock)return!1;var o,l=t.currentTarget,a=l.getAttribute("data-id"),n=pageStore.getEntity(a,"block"),i=l.getBoundingClientRect(),r=i.top,d=i.height,c=(t.pageY-flexbe_cli.scroll.latest-r)/d*100>50?1:0,b=n.index,u=function(){return!!n.abtest&&(n=n.abtest[c?"b":"a"],b=n.index,!0)};u();var s=n.header;return!c&&s&&(s.siteBlockType?(c=1,u()):b=s.index),!(!(o=n.$area)||!o.length)&&(o.parent().is(".container-list")||(o=o.parent()),b+=c,(!uiStore.page.blockAdd.state||uiStore.page.blockAdd.index!==b)&&(uiStore.page.blockAdd.state=!1,uiStore.page.blockAdd.index=b,void function(t,o){t&&$(t)[o?"after":"before"](e.$add),setTimeout(function(){uiStore.page.blockAdd.state=!0},30)}(o,c)))});e.$add&&e.$add.remove(),e.$add=$('<span class="flexbe-block-add"><div class="flexbe-block-add-plus"><i></i></div></span>'),t.off("mousemove.block_add").on("mousemove.block_add","> .b_block",$.throttle(function(e){return o(e)},300,e)),e.$add.on("click",function(){uiStore.page.blockAdd.state=!1,uiStore.page.blockAdd.lock=!0,e.addBlockModal()}),t.append(e.$add),mobx.autorun(function(){var o=uiStore.page.blockAdd.isOnly,l=!o&&uiStore.page.blockAdd.isFirst,a=!o&&uiStore.page.blockAdd.isLast,n=uiStore.page.blockAdd.state||o;t.toggleClass("empty",o),e.$add.toggleClass("show",n),e.$add.toggleClass("first",l),e.$add.toggleClass("last",a&&flexbe_cli.resize.height<=flexbe_cli.resize.documentHeight),e.$add.toggleClass("only",o)})},addBlockModal:function(e){flexbe.stat.event("Editor - Section Add"),e=Object.assign({type:"block"},e),flexbe.modal.create({name:"flexbe-block-add",type:"overlay",title:"Добавление секции",riotDelay:150,riotTag:"block-add-window",riotOpts:{control:this,options:e},close:function(){uiStore.page.blockAdd.state=!0,uiStore.page.blockAdd.lock=!1}})},toggleMultitext:function(e,t){void 0===t&&(t=function(){});var o="object"!==_typeof(e)?e:$(e).attr("data-id"),l=pageStore.getEntity(o,"block");if(!l)return!1;var a=l.multitext||{},n=function(){a.vars||(a.vars=[{var_name:"utm_term",var_default:""}]),a.enabled=!a.enabled,l.setField("multitext",a),t(a.enabled)};flexbe.bill.multilanding||a.enabled?n():flexbe.bill.show_feature(polyglot.t("admin::user::bill::upgrade::dynamic_replacement"),function(e){if(!e)return!1;n()})},toggleMultisection:function(e,t){void 0===t&&(t=function(){});var o="object"!==_typeof(e)?e:$(e).attr("data-id"),l=pageStore.getEntity(o,"block");if(!l)return!1;var a=l.multisection.getData(),n=function(){a.created||(a.created=!0),a.enabled=!a.enabled,l.multisection.setData(a),t(a.enabled)};flexbe.bill.multilanding||a.enabled?n():flexbe.bill.show_feature(polyglot.t("admin::user::bill::upgrade::dynamic_replacement"),function(e){if(!e)return!1;n()})},toggleGeolanding:function(e,t){void 0===t&&(t=function(){});var o="object"!==_typeof(e)?e:$(e).attr("data-id"),l=pageStore.getEntity(o,"block");if(!l)return!1;var a=l.geolanding.getData(),n=function(){a.created||(a.created=!0),a.enabled=!a.enabled,l.geolanding.setData(a),t(a.enabled)};flexbe.bill.geolanding||a.enabled?n():flexbe.bill.show_feature(polyglot.t("admin::user::bill::upgrade::geo_replacement"),function(e){if(!e)return!1;n()})}};
flexbe.land.block.favorites={stored:[],loadData:function(e){var t=this;void 0===e&&(e=function(){}),setTimeout(function(){$.ajax({url:"/admin/favorites/load",type:"POST",dataType:"json",data:{theme_id:Math.floor(flexbe.land.theme_id)}}).done(function(a){t.stored=a||[],e(t.stored)})},1)},check:function(e,t){return t||(t=flexbe.land.p_id),flexbe.land.block.favorites.stored[e]||flexbe.land.block.favorites.stored[e+"_"+t]},add:function(e,t){var a=this;void 0===t&&(t=function(){});var d=pageStore.getEntity(e,"block");if(!d)return!1;var o=d.getSave(),r=pageStore.pId;o.theme_id=pageStore.themeId,o.data=d.data,delete o.multisection,delete o.geolanding,delete o.id,delete o.hidden;var i=flexbe.land.modal.check.findModalsIn(d.$area);o.modals=i.map(function(e){var t=e.attr("data-id"),a=pageStore.getEntity(t,"modal");return a&&a.getSave()}).filter(function(e){return!!e}),$.ajax({url:"/admin/favorites/add",type:"POST",dataType:"json",data:{id:e,p_id:r,block_data:JSON.stringify(o)}}).done(function(d){1===d.status?(alertify.success("Сохранено в избранном"),Array.isArray(a.stored)&&(a.stored={}),a.stored[e+"_"+r]=o):2===d.status?alertify.success("Данные о блоке в избранном обновлены"):alertify.error("Ошибка при добавлении, попробуйте еще раз"),t(d)}).fail(function(){alertify.error("Ошибка при добавлении, попробуйте еще раз")})},remove:function(e,t){var a=this;(void 0===t&&(t=function(){}),e)&&$.ajax({url:"/admin/favorites/remove",type:"POST",dataType:"json",data:{id:e}}).done(function(d){1===d.status?delete a.stored[e]:alertify.error("Ошибка при удалении, попробуйте еще раз"),t(d&&d.list)})}};
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}flexbe.land.modal={data:{},register:function(t){var e=t.config||{};if("function"!=typeof this.data[t.fullId]){var o=function(t){this.is=t.is,this.id=t.id,this.templateId=t.templateId,this.modId=t.modId,this.fullId=t.fullId,Object.defineProperty(this,"entity",{get:function(){return pageStore.getEntity(t.id,"modal")}}),Object.defineProperty(this,"config",{get:function(){return t.config}}),Object.defineProperty(this,"data",{get:function(){return t.data}}),Object.defineProperty(this,"elements",{get:function(){return t.elements}})},n=e.js_editor&&new Function(e.js_editor)()||{};o.prototype=$.extend(!0,{},flexbe.land.editor.prototype,this.prototype,n),this.data[t.fullId]=o}return new this.data[t.fullId](t)},create:function(t){return void 0===t&&(t={}),"object"==_typeof((t=$.extend(!0,{is:"modal"},t)).data)&&delete t.data._anchor,t.id&&pageStore.getEntity(t.id)?(console.warn("modal create: cant create modal with exist on page ID",t),!1):pageStore.addEntity({raw:t})},copy:function(t){return pageStore.copyEntity(t,"modal").then(function(t){return t.data._anchor&&(t.data._anchor=t.data._anchor+"_copy"),t})},remove:function(t){pageStore.removeEntity(t,"modal")}};
flexbe.land.modal.prototype={};
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}flexbe.land.modal.control={editing:{},shots:{},inUpdate:!1,init:function(){},controlCreate:function(e,o){void 0===o&&(o={});var t=configStore.getObject(e);if(t){var i=t.entity,n=t.config||{},l=i.$area,s=flexbe.view.$modalList,d=s.find("> modal-controls");d[0]||(d=$('<modal-controls class="modal-editor block-control-wrap"></modal-controls>'),s.prepend(d)),riot.mount(d[0],"modal-controls",{control:this,_object:t,$modal:l,options:o,allow:{cancel:!!o.showCancel,settings:!!n.vars_settings}})}},open:function(e,o,t){var i=this;void 0===t&&(t={}),flexbe.view.$document.find('.m_modal[data-id="'+e+'"]').eq(0).length&&($("#flexbe-view").removeClass("mobile"),flexbe.land.editor.start(),this.controlCreate(e,t),t.fromClosed||(this.editing[e]={editor:o,options:t,id:flexbe.view.$document.find(".m_modal.show").attr("data-id")||null},"object"===_typeof(o)&&setTimeout(function(){return o.hide()},100)),flexbe_cli.modal.open(e,{},{multivar:t.multivar}),flexbe.view.$window.off("keyup.modal-close-esc-editor").on("keyup.modal-close-esc-editor",function(o){if(27!==o.keyCode||!Object.keys(i.editing).length)return!0;i.close(e)}))},close:function(e){if(flexbe.view.$window.off("keyup.modal-close-esc-editor"),this.editing[e]){var o=this.editing[e];o.id&&o.id!=e&&this.open(o.id,o.editor,Object.assign({fromClosed:!0},o.options)),o.editor&&o.editor.show()}delete this.editing[e],flexbe_cli.modal.close(e)},loadScreenshots:function(e){var o=this;void 0===e&&(e=function(){});var t=pageStore.modals.map(function(e){return e.siteBlockType?"modal_g"+flexbe_cli.group_id+"_"+e.id:"modal_p"+flexbe_cli.p_id+"_"+e.id});t&&0!==t.length&&$.ajax({url:"/admin/screenshot/site_elements/get_all_screenshots",type:"POST",dataType:"json",data:{indexes:t}}).done(function(t){if(t.is_success&&t.data){var i=t.data.screenshots_data;"object"===_typeof(i)&&(o.shots=i),e(null,i)}else console.warn("Не удалось загрузить скриншоты",t.message),e(t.message,o.shots)}).fail(function(e){console.warn("Не удалось загрузить скриншоты",e.message)})},showList:function(e){void 0===e&&(e={}),flexbe.land.editorInit&&flexbe.modal.create({name:"flexbe-modal-add",type:"overlay",from:e.editor,title:"Всплывающие окна",riotTag:"modal-add-window",riotOpts:{control:this,options:e},riotDelay:100})}};
flexbe.land.modal.check={init:function(){this.findDoublicates(),this.payIsNeeded()},findDoublicates:function(){var e=[];flexbe.view.$document.find(".m_modal").not("[data-multivar]").each(function(a,d){var t=$(d).attr("data-id");e.includes(t)?$(d).remove():e.push(t)})},payIsNeeded:function(){var e=pageStore.$modals.filter('.m_modal[data-id="pay"]'),a=pageStore.$list.find(".component-form"),d=!!e.length,t=!!$('[name="action"][value="pay"]',a).length;!d&&t&&flexbe.land.modal.create({id:"pay",templateId:100})},isRequiredBy:function(e){var a='[href="##'+e+'"], [href="#'+e+'"], [data-modal-id="'+e+'"]';if(String(e).indexOf("_")>=0){var d=e.split("_");a+=', [data-id^="'+d[0]+'"] [data-modal-id="'+d[1]+'"]'}return $().add(flexbe.view.$header).add(flexbe.view.$blockList).add(flexbe.view.$footer).add(flexbe.view.$widgetList).add(flexbe.view.$modalList).find(a).filter(function(e,a){return!$(a).closest(".mobile-menu, .mobile-menu-content").length})},findModalsIn:function(e,a){var d=this;void 0===a&&(a=!0);var t=[];return e.find("[data-modal-id]").each(function(e,i){var n=$(i).attr("data-modal-id"),l=pageStore.$modals.filter('.m_modal[data-id="'+n+'"]');if(l.length&&(t.push(l),a)){var o=d.findModalsIn(l);t=t.concat(o)}}),t}};
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}flexbe.land.widget={data:{},register:function(t){var e=t.config||{};if("function"!=typeof this.data[t.fullId]){var i=function(t){this.is=t.is,this.id=t.id,this.templateId=t.templateId,this.modId=t.modId,this.fullId=t.fullId,Object.defineProperty(this,"entity",{get:function(){return pageStore.getEntity(t.id,"widget")}}),Object.defineProperty(this,"config",{get:function(){return t.config}}),Object.defineProperty(this,"data",{get:function(){return t.data}}),Object.defineProperty(this,"elements",{get:function(){return t.elements}})},o=e.js_editor&&new Function(e.js_editor)()||{};i.prototype=$.extend(!0,{},flexbe.land.editor.prototype,this.prototype,o),this.data[t.fullId]=i}return new this.data[t.fullId](t)},create:function(t){void 0===t&&(t={});uiStore.page;var e=flexbe.helpers.parseId(t.fullId||t.templateId||t.template_id,t.modId||t.mod_id),i=e.templateId,o=e.modId;"object"==_typeof(t.data)&&delete t.data._anchor;var d={id:t.id,is:"widget",template_id:i,mod_id:o,data:$.extend(!0,{},t.data)};return(!t.id||(d.id=t.id,!pageStore._widgets.find(function(e){return e.id===t.id})))&&pageStore.addEntity({raw:d})},remove:function(t){pageStore.removeEntity(t,"widget")}};
flexbe.land.widget.prototype={};
flexbe.land.widget.check={cache:{},init:function(){var e,t=this;this.all(),flexbe_cli.events.off("editor_change.wcheck layout_change.wcheck").on("editor_change.wcheck layout_change.wcheck",function(a,c){"layout_change"===a.type&&"block"===c.is?t.all():(c&&c.reason&&c.reason.match(/^items_(add|remove)$/)||"editor_form_btn"===c.reason&&c.val.action||"editor_settings"===c.reason&&"ungroup_buttons"===c.name)&&(clearTimeout(e),e=setTimeout(function(){t.cart()},200))})},all:function(){this.cart(),this.anchors()},cart:function(){var e=this,t=pageStore.getEntity("cart","widget"),a=pageStore.$list.find('[data-action="cart"]').length;t&&!a?(t.$area.find(".cart-button").removeClass("show"),setTimeout(function(){e.cache.cart=t.getSave(),flexbe.land.widget.remove("cart")},200)):!t&&a?(flexbe.land.widget.create(Object.assign({id:"cart",templateId:1},this.cache.cart)),flexbe.view.$widgetList.find(".w_cart .cart-button").toggleClass("show",a)):t&&t.$area.find(".cart-button").toggleClass("show",a)},anchors:function(){[1,99].includes(flexbe_cli.theme_id)?flexbe.land.widget.remove("anchors"):flexbe.land.widget.create({id:"anchors",templateId:2})}};
flexbe.land.element={data:{},register:function(e){var t=e.config||{};if("function"!=typeof this.data[e.fullId]){var i=function(e){this.is=e.is,this.id=e.id,this.templateId=e.templateId,this.modId=e.modId,this.fullId=e.fullId,Object.defineProperty(this,"entity",{get:function(){return pageStore.getEntity(e.id,"element")}}),Object.defineProperty(this,"config",{get:function(){return e.config}}),Object.defineProperty(this,"data",{get:function(){return e.data}}),Object.defineProperty(this,"elements",{get:function(){return e.elements}})},n=t.js_editor&&new Function(t.js_editor)()||{};i.prototype=$.extend(!0,{},flexbe.land.editor.prototype,this.prototype,n),this.data[e.fullId]=i}return new this.data[e.fullId](e)},create:function(e,t,i){void 0===e&&(e={}),void 0===t&&(t=[]),void 0===i&&(i=-1);var n=Object.assign({is:"element",id:flexbe.helpers.getRandId()},e);return!pageStore._list.some(function(t){return t.id===e.id})&&pageStore.addEntity({raw:n}).then(function(e){return Array.isArray(t)&&!t.includes(e.id)&&(i=Math.min(Math.max(i,0),t.length),t.splice(i,0,e.id)),e})},remove:function(e,t){void 0===t&&(t=[]);var i=pageStore.getEntity(e,"element");if(!i)return!1;var n=t.indexOf(i.id);return t.splice(n,1),i.remove(),!0}};
flexbe.land.element.control={addModal:function(e){void 0===e&&(e={}),flexbe.stat.event("Editor - Element Add"),flexbe.modal.create({name:"flexbe-elements-add",width:600,overlay:!1,dublicate:!1,animate:!1,editor_stop:!0,item:e.bindTo,title:"Добавить элемент",riotTag:"element-add-window",riotOpts:Object.assign({scope:this,onSelect:function(){}},e),open:function(){"function"==typeof e.onOpen&&e.onOpen()},close:function(){"function"==typeof e.onClose&&e.onClose()}})}};
flexbe.land.element.prototype={disposers:{setElementParams:function(){var e=this.entity;if(e){var t=e.$area,a=e.$data,l=e.isZone;e.lastTemplateRender,e.utime;t&&t.length&&(a.attr("data-pad",l?null:e.params.pad),a.attr("data-cols",l?null:e.params.cols),t.toggleClass("content-zone",l),t.toggleClass("element-item",!l))}}}};
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}flexbe.land.editor.modules.settings=function(t,e){var i=configStore.getObject(t)||{},a=i.entity,o=a.config;if(!o||!o.vars_settings)return!1;this._object=i,this.entity=a,this.config=o,this.$area=a.$area,this.id=a.id,this.data=a.data,this.onChange=e.onChange,this.init(),i.on_edit()},flexbe.land.editor.modules.settings.prototype={init:function(){var t,e,i=this,a=0,o=Object.keys(this.config.vars_settings).map(function(e,o,n){var s=i.config.vars_settings[e];if(!s.type)return!1;var r,l=$('<div class="field" data-type="'+s.type+'"></div>'),d=s.title&&"bool"!=s.type&&'<div class="title">'+s.title+"</div>",c=s.caption&&'<span class="caption">'+s.caption+"</span>",g=(s.desc||s.tip)&&'<q class="tip">'+(s.desc||s.tip)+"</q>";if(s.classes&&l.addClass(s.classes),t!==s.type&&a&&l.addClass("group-start"),"function"==typeof i[s.type]){for(var p=i.data,u=e.split("."),v=0,m=u.length;v<m;v++)p=p[u[v-1]]||i.data,e=u[v];r=i[s.type](e,p,s),t=s.type,a=1}return l.append(c,d,r,g),l}),n=$('<div class="field-list"></div>');if(n.append.apply(n,o),"block"===this.entity.is){var s=this.anchors();n.append(s)}e="block"===this.entity.is?this.$area.find(".block-control-wrap .control-group.right"):"modal"===this.entity.is?flexbe.view.$modalList.find(".block-control-wrap .modal-controls.right"):"widget"===this.entity.is?this.$area.find('[data-command="settings"]'):this.$area,this.modal=flexbe.modal.create({name:"block_settings",title:polyglot.t("editor::bg_settings::title"),overlay:!1,width:400,item:e.length?e:this.$area,$data:n})},bool:function(t,e,i){var a=this,o=i.render||!0,n=$('<label data-is="flexbe-input" class="flexbe-input toggle"><input type="checkbox" /><span class="flexbe-checkbox"></span><span>'+i.title+"</span></label>");return e[t]&&"0"!==e[t]&&n.find("input").prop("checked",!0),n.find("input").on("change",function(i){var n=i.currentTarget.checked?1:0;a.onChange(e,t,n,"editor_settings",o)}),n},radio:function(t,e,i){var a=this,o=i.render||!0,n=$('<div class="values"></div>');for(var s in i.values){var r=i.values[s];n.append('<label class="tab-el"><input type="radio" name="'+t+'" value="'+r.value+'"><span class="tab-title">'+r.name+"</span></label>")}return n.find('input[value="'+e[t]+'"]').prop("checked","checked").closest("label").addClass("active"),n.find("input:radio").on("change",function(i){$(i.currentTarget).closest("label").siblings().removeClass("active"),$(i.currentTarget).closest("label").addClass("active");var n=$(i.currentTarget).val();a.onChange(e,t,n,"editor_settings",o)}),n},color:function(t,e,i){var a=this,o=i.render||["css"],n=i.colors,s=$('<div class="color_list"></div>');for(var r in n){var l=n[r],d=$("<a></a>");d.attr("data-color",l).css("background",l),e[t]==l&&d.addClass("active"),s.append(d)}return s.on("click","a",function(i){var n=$(i.currentTarget).attr("data-color");a.onChange(e,t,n,"editor_settings",o)}),s},anchors:function(){var t=document.createElement("div");return riot.mount(t,"section-anchor",{data:this.data}),t}},flexbe.land.editor.modules.settings.prototype.background=function(t,e,i){var a=this,o={type:["color","image","video"],title:i.title,colors:[],position:!0,custom_color:!1,opacity:!0,color_opacity:!1,color_gradient:!1,parallax:!0,gradient:!0,render:["css"]},n=Object.assign({},o,i.options),s=Object.assign({parallax:0,color:"#fff",gradient:0,image:"",opacity:50,type:"color",position:{x:"50%",y:"50%"}},e[t]),r=$("<div></div>");return riot.mount(r[0],"editor-background",{bg:s,options:n,change:function(i,o){a.onChange(e,t,i,"editor_settings",o||n.render)},editor:this}),r},flexbe.land.editor.modules.settings.prototype.backgroundOld=function(t,e,i){var a=this,o=i.render||["css"],n=i.bg_type;(-1===$.inArray(n,["image","video"])||i.only_image)&&(n="image");var s=$("<div></div>").attr("data-bg-type",n);if(!i.only_image){var r=$('<div class="type_select" class="clear"><a data-type="image">'+polyglot.t("editor::settings::image")+'</a><a data-type="video">'+polyglot.t("editor::settings::video")+"</a></div>");r.on("click","a[data-type]",function(i){n=$(i.currentTarget).attr("data-type"),s.attr("data-bg-type",n),"image"==n?(e.bg_type="image",a._object.clientMsg("video_bg_destroy"),a.onChange(e,t,e[t],"editor_settings",!0)):"video"==n&&s.find(".bg_video input").triggerHandler("paste")}),s.append(r)}var l=$('<div class="bg_image" class="clear"></div>'),d=$('<div class="data_img"><img src="'+e.bg_img+'"></div>'),c=$('<a class="btn user-load"><input type="file"><span>'+polyglot.t("editor::settings::upload")+"</span></a>"),g=$('<a class="btn unsplash">Галерея</a>'),p=$('<div class="actions"></div>');p.append(c,g),l.append(d,p),g.on("click",function(){new flexbe.land.editor.modules.gallery(a.$area,{is_background:!0,on_change:function(i){e.bg_img="/img/"+i.img_id+"_1920/"+i.img_name,d.find("img").attr("src","/img/"+i.img_id+"_1920/"+i.img_name),a.onChange(e,t,e[t],"editor_settings",o)}})}),flexbe.files.upload.init({$input:c.find("input"),type:"image",on_complete:function(i,n){e.bg_img="/img/"+n.img_id+"_1920/"+n.img_name,d.find("img").attr("src","/img/"+n.img_id+"_1920/"+n.img_name),a.onChange(e,t,e[t],"editor_settings",o)}});var u=i.bg_el_selector||".container-fluid";if(d.dragBg({block:this.$area,bg_el_selector:u,pos:{x:e.bg_position.x,y:e.bg_position.y}},function(t){e.bg_position=t}),s.append(l),!i.only_image){var v=$('<div class="bg_video" class="clear"><div class="title">'+polyglot.t("editor::settings::link_video")+'<i></i> YouTube</div><div class="video_link"><input class="old-style" type="text" placeholder="'+polyglot.t("editor::settings::link_video_placeholder")+'"></div><div class="desc">'+polyglot.t("editor::settings::link_video_desc")+"</div></div>"),m=v.find("input");"object"===_typeof(e.bg_video)&&"string"==typeof e.bg_video.id&&e.bg_video.id.length>0&&m.val("youtube.com/watch?v="+e.bg_video.id),m.on("keyup paste",function(){setTimeout(function(){var i=$.trim(m.val()),n="";if(0===(i=(i=(i=(i=i.replace("http://","")).replace("https://","")).replace("://","")).replace("www.","")).search(/(\s*)?youtube.com\//i)||0===i.search(/(\s*)?youtu.be\//i))if(/youtube\.com\/(.*?)v=([^&\s+]+)/i.test(i)?n=i.match(/youtube.com\/(.*?)v=([^&\s+]+)/i)[2].replace(/(\s*)/,""):/youtube\.com\/user\/(.*?)\#/i.test(i)?n=i.match(/\/([^\/.*]+)$/i)[1].replace(/(\s*)/,""):/youtu\.be\/([^&\s+]+)/i.test(i)&&(n=i.match(/youtu\.be\/([^&\s+]+)/i)[1].replace(/(\s*)/,"")),n.length>0){if(e.bg_type="video",e.bg_video={type:"youtube",id:n},e.bg_position={x:"50%",y:"50%"},!d.find("img").hasClass("check_load")){var s=["maxresdefault.jpg","hqdefault.jpg","mqdefault.jpg","default.jpg"],r=0;e.bg_img="https://img.youtube.com/vi/"+n+"/"+s[r],d.find("img").addClass("check_load").off("load.check_img error.check_img").on("load.check_img error.check_img",$.proxy(function(i){if(120==i.currentTarget.naturalWidth&&90==i.currentTarget.naturalHeight){if(++r==s.length||"string"!=typeof s[r])return d.find("img").removeClass("check_load"),!1;e.bg_img="https://img.youtube.com/vi/"+n+"/"+s[r],d.find("img").attr("src",e.bg_img+"?"+(new Date).getTime()),this.onChange(e,t,e[t],"editor_settings",o)}else d.find("img").removeClass("check_load").off("load.check_img error.check_img")},a)),d.find("img").attr("src",e.bg_img+"?"+(new Date).getTime()),a.onChange(e,t,e[t],"editor_settings",o)}a._object.clientMsg("video_bg_update",e.bg_video),a.onChange(e,t,e[t],"editor_settings",!0)}else e.bg_type="image",e.bg_video={},a._object.clientMsg("video_bg_destroy");else e.bg_type="image",e.bg_video={},a._object.clientMsg("video_bg_destroy")},1)}),s.append(v)}return s};
!function(){var t=function(t,e){var n=e.x||e.left||0,s=e.y||e.top||0,o=Object.assign([0,0,0,0],e.pad),i=[].concat(t).map(function(t){var e=t.getAttribute("data-id")||null,i=$(t).offset(),a=t.offsetWidth,l=t.offsetHeight,r={width:a,height:l,top:i.top,left:i.left,right:i.left+a-1,bottom:i.top+l-1},d={top:r.top-o[0],right:r.right+o[1],bottom:r.bottom+o[2],left:r.left-o[3]};return r.outer={left:r.left-n,top:r.top-s,right:n-r.right,bottom:s-r.bottom},d.x=(n-d.left)/(d.right-d.left)*100,d.y=(s-d.top)/(d.bottom-d.top)*100,d.inside=d.x>=0&&d.x<=100&&d.y>=0&&d.y<=100,d.xPos=Number(d.x>=50),d.yPos=Number(d.y>=50),r.x=(n-r.left)/(r.right-r.left)*100,r.y=(s-r.top)/(r.bottom-r.top)*100,r.insideX=r.x>=0&&r.x<=100,r.insideY=r.y>=0&&r.y<=100,r.inside=r.insideX&&r.insideY,{id:e,target:t,rect:r,bound:d}}).filter(function(t){return t.bound.inside});return i.sort(function(t,e){var n=t.rect.outer,s=e.rect.outer,o=n.left>=0&&n.left<s.right||n.right>=0&&n.right<s.left,i=s.left>=0&&s.left<n.right||s.right>=0&&s.right<n.left,a=n.top>=0&&n.top<s.bottom||n.bottom>=0&&n.bottom<s.top,l=s.top>=0&&s.top<n.bottom||s.bottom>=0&&s.bottom<n.top;return o||i?-Number(o)||Number(i):a||l?-Number(a)||Number(l):void 0}),i.sort(function(t,e){var n=t.rect.inside,s=e.rect.inside,o=t.rect.insideX,i=e.rect.insideX,a=t.rect.insideY,l=e.rect.insideY;return n||s?-Number(n)||Number(s):o||i?-Number(o)||Number(i):a||l?-Number(a)||Number(l):void 0}),i},e={sprite:"/_s/images/land/editor/inner.svg?1",paddingWr:[24,24,24,24],paddingEl:[15,6,15,40],smallW:200,smallH:50},n={modules:["add","move","settings","remove"]},s="flexbe-elements-control-bar",o="flexbe-elements-control-single",i="flexbe-elements-control-single-bg",a="flexbe-elements-control-single--active",l="flexbe-elements-control-bar-single",r="flexbe-elements-control-group",d="flexbe-elements-control-group--active",c="flexbe-elements-control-bar-group",h="flexbe-elements-wrap-hover",u="element-item",m={first:"is-first-child",last:"is-last-child",only:"is-only-child",hover:"element-editor-hover",smallW:"element-editor-small-w",smallH:"element-editor-small-h"},f="flexbe-elements-activated",p="flexbe-elements-deactivated",v="flexbe-elements-bound",g="flexbe-elements-group-hover",b="flexbe-elements-bar-single-hover",E="flexbe-elements-bar-group-hover",x=function(){function x(t){var e=t.$wrap,s=t.entity,o=t.data,i=t.params,a=t.onChange;e[0].elementsInstance=this,riot.observable(this),this.$wrap=e,this.entity=s,this.data=o,this.params=Object.assign(n,i),this.onChange=a,this.eventId=flexbe.lib.getRandomId(),this.modules={},this.controls={},this.elementLocked=!1,this.preventEvents=!1,this.init()}var y=x.prototype;return y.init=function(){this.setElementsClasses(),this.normalizeData(),this.createControls(),this.initModules(),this.bindControls(),this.dispatchEvents()},y.normalizeData=function(){this.data.elements=this.data.elements.map(function(t){return String(t)})},y.initModules=function(){var t=this,e=this.params.modules;[].concat(["zone"],e).forEach(function(e){var n=flexbe.land.editor.elements.modules[e];"function"==typeof n&&(t.modules[e]=new n(t))})},y.sendEvent=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),s=1;s<e;s++)n[s-1]=arguments[s];this.trigger.apply(this,[t].concat(n)),Object.values(this.modules).forEach(function(e){"function"==typeof e.trigger&&e.trigger.apply(e,[t].concat(n))})},y.createControls=function(){var t=this.$wrap,e=$('<span class="'+r+'" data-source="'+this.entity.id+'"></span>'),n=$('<div class="'+s+" "+c+'"></div>'),a=$('<span class="'+o+'" data-source="'+this.entity.id+'"></span>'),d=$('<div class="'+s+" "+l+'"></div>'),h=$('<div class="'+i+'"></div>'),u=$("<span></span>");this.controls.$saver=u,this.controls.$group=e,this.controls.$single=a,this.controls.$singleBar=d,this.controls.$groupBar=n,t.attr("data-editor","elements"),t.append(e),e.append(n),a.append(h,d),u.append(a)},y.bindControls=function(){var n=this,s=this.entity.$root,o=this.$wrap[0];s.on("mousemove."+this.eventId,$.debounce(function(i){if(!n.preventEvents)if(o&&s[0].contains(o)){var a=Array.from(o.children).filter(function(t){return t.classList.contains(u)}),l=t(o,{x:i.pageX,y:i.pageY,pad:e.paddingWr})[0],r=t(a,{x:i.pageX,y:i.pageY,pad:e.paddingEl})[0],d=!(!n.lastElement||r&&r.target===n.lastElement.target),c=!(!r||n.lastElement&&r.target===n.lastElement.target),h=!(!r||!n.lastElement||r.target!==n.lastElement.target);if(n.setWrap(l),d&&n.setElement({element:!1,changeElement:c}),c&&n.setElement({element:r,changeElement:d}),c&&!n.elementLocked||h){var m=r.bound.xPos,f=r.bound.yPos;n.setBound({boundX:m,boundY:f})}}else s.off("mousemove."+n.eventId)},10)),this.controls.$singleBar.on("mouseenter mouseleave",function(t){var e="mouseenter"===t.type;n.sendEvent(b,{state:e})}),this.controls.$groupBar.on("mouseenter mouseleave",function(t){var e="mouseenter"===t.type;n.sendEvent(E,{state:e})})},y.dispatchEvents=function(){var t=this;this.on(f,this.onElementActivate),this.on(p,this.onElementDeactivate),this.on(v,this.onElementBoundChange),this.on(b,function(e){var n=e.state;t[n?"lockElement":"unlockElement"]()}),this.on(E,function(e){var n=e.state;t[n?"lockWrap":"unlockWrap"]()}),this.on(g,function(e){var n=e.state;t[n?"onGroupActivate":"onGroupDeactivate"]()})},y.onGroupActivate=function(){this.$wrap.addClass(h),this.controls.$group.addClass(d)},y.onGroupDeactivate=function(){this.$wrap.removeClass(h),this.controls.$group.removeClass(d)},y.onElementActivate=function(t){var n=t.state,s=t.changeElement;if(!n)return!1;var o=this.controls.$single,i=n.element,l=$(i.target);if(l.append(o),!s)l[0].offsetWidth;o.addClass(a),l.addClass(m.hover),i.rect.width<e.smallW&&l.addClass(m.smallW),i.rect.height<e.smallH&&l.addClass(m.smallH)},y.onElementDeactivate=function(t){var e=t.state,n=t.changeElement;if(!e)return!1;var s=e.element;$(s.target).removeClass(m.hover+" "+m.smallW+" "+m.smallH),n||this.saveControls()},y.onElementBoundChange=function(t){var e=t.boundY;this.controls.$single.attr("data-bound",e?"bottom":"top")},y.onWrapBoundChange=function(t){var e=t.boundY;this.controls.$group.attr("data-bound",e?"bottom":"top")},y.setElementsClasses=function(){var t=this.$wrap.find("."+u).not(".flexbe-elements-sortable-ghost"),e=t.length;t.each(function(t,n){$(n).toggleClass(m.first,0===t).toggleClass(m.last,t===e-1).toggleClass(m.only,0===t&&1===e)})},y.saveControls=function(){var t=this.controls,e=t.$saver,n=t.$single;n.removeClass(a),e.append(n),this.unlockEvents(),this.unlockElement()},y.lockElement=function(){this.elementLocked=!0},y.unlockElement=function(){this.elementLocked=!1},y.lockWrap=function(){this.wrapLocked=!0},y.unlockWrap=function(){this.wrapLocked=!1},y.lockEvents=function(){this.preventEvents=!0},y.unlockEvents=function(){this.preventEvents=!1},y.setBound=function(t){var e=t.boundY;this.boundY!==e&&(this.boundX=0,this.boundY=e,this.sendEvent(v,{boundX:this.boundX,boundY:this.boundY}))},y.setElement=function(t){var e=t.element,n=t.changeElement;if(this.elementLocked)return!1;if(e){this.lastElement=e,e.id&&(this.lastEntity=pageStore.getEntity(e.id,"element"));var s=this.getState();this.sendEvent(f,{state:s,changeElement:n})}else{var o=this.getState();this.lastElement=!1,this.lastEntity=!1,this.sendEvent(p,{state:o,changeElement:n})}},y.setWrap=function(t){if(this.wrapLocked)return!1;var e=!!t;if(e===!!this.lastWrap)return!1;this.sendEvent(g,{state:e}),this.lastWrap=t},y.getState=function(){var t=this.lastWrap,e=this.lastElement,n=this.lastEntity,s=n&&n.id||!1,o=this.data.elements;return{id:s,list:o,index:o.indexOf(s),entity:n,element:e,wrap:t,boundX:this.boundX,boundY:this.boundY,locked:this.elementLocked}},x}();flexbe.land.editor.elements=x,flexbe.land.editor.elements.modules={}}();
!function(){var e="/_s/images/land/editor/inner.svg?1",t="flexbe-elements-add-wrap",n="flexbe-elements-add-button",o="flexbe-elements-add-placeholder",d="flexbe-elements-add-before",i="flexbe-elements-add-after",s="flexbe-elements-bound",a="flexbe-elements-button-add-hover",l="flexbe-elements-add-modal",r=function(){function r(e){riot.observable(this),this.parent=e,this.$wrap=e.$wrap,this.entity=e.entity,this.params=e.params,this.onChange=e.onChange,this.$single=e.controls.$single,this.addShow=!0,this.addHover=!1,this.addPlaceholder=!1,this.init()}var h=r.prototype;return h.init=function(){this.createControls(),this.bindControls(),this.dispatchEvents()},h.createControls=function(){this.$add=$(['<div class="'+t+'">','<div class="'+n+'">','<svg><use xlink:href="'+e+'#element-add"></use></svg>',"</div>",'<div class="'+o+'"></div>',"</div>"].join("")),this.$button=this.$add.find("."+n),this.$single.find("."+t).remove(),this.$single.append(this.$add)},h.bindControls=function(){var e=this,t=this.$add;t.on("mouseenter mouseleave",function(t){var n="mouseenter"===t.type;e.parent.sendEvent(a,{state:n})}),t.on("click",function(){e.parent.sendEvent(l)})},h.dispatchEvents=function(){var e=this,t=["disable-editor-overlay","disable-editor-indent","disable-editor-custom","disable-editor-items","disable-editor-elements-group"];this.on(a,function(n){var o=n.state;uiStore.page.state[o?"pushState":"removeState"](t),e.toggleAddHover(o),e.togglePlaceholder(o)}),this.on(s,function(){e.togglePlaceholder(e.addPlaceholder)}),this.on(l,function(){e.showAddModal()})},h.toggleAddHover=function(e){e?this.parent.lockElement():this.parent.unlockElement(),this.addHover=e},h.togglePlaceholder=function(e){var t=this.parent.getState(),n=t.element,o=t.boundY;if(!n)return!1;if(!this.addHover&&!this.addPlaceholder&&!e)return!1;var s=$(n.target);s.toggleClass(d,e&&!o),s.toggleClass(i,e&&!!o),this.addPlaceholder=e},h.showAddModal=function(){var e=this.parent,t=e.getState(),n=t.list,o=t.index,d=t.boundY,i=this.$button;flexbe.land.element.control.addModal({bindTo:i,onSelect:function(t){flexbe.land.element.create(t,n,o+Number(d)).then(function(){e.onChange(e.data,"elements_remove",["template"])})},onOpen:function(){e.lockEvents()},onClose:function(){e.unlockEvents()}})},r}();flexbe.land.editor.elements.modules.add=r}();
!function(){var e="/_s/images/land/editor/inner.svg?1",t="flexbe-elements-control-button",n="flexbe-elements-control-button-move",s="flexbe-elements-move-from",l="flexbe-elements-move-to",o=function(){function o(e){riot.observable(this),this.parent=e,this.$wrap=e.$wrap,this.entity=e.entity,this.params=e.params,this.onChange=e.onChange,this.$single=e.controls.$single,this.$singleBar=e.controls.$singleBar,this.init()}var a=o.prototype;return a.init=function(){this.createControls(),this.bindControls(),this.dispatchEvents(),this.createSortable()},a.createControls=function(){this.$move=$('<div class="'+t+" "+n+'"><svg width="12" height="12"><use xmlns:xlink="https://www.w3.org/1999/xlink" xlink:href="'+e+'#button-move"></use></svg></div>'),this.$singleBar.find("."+n).remove(),this.$singleBar.append(this.$move)},a.bindControls=function(){},a.dispatchEvents=function(){this.parent;var e=flexbe.land.editor.stopStates;e=e.filter(function(e){return!["disable-editor-elements","disable-editor-elements-group","disable-editor-elements-group-borders"].includes(e)}),e=[].concat(e,["disable-editor-elements-single","disable-editor-elements-add","disable-editor-elements-group-bar","disable-editor-elements-group-corners","in-elements-move"]),this.on(s,function(){flexbe.land.editor.stop(e)}),this.on(l,function(t){var n=void 0===t?{}:t,s=n.isSameList,l=n.fromList,o=n.toList,a=n.fromIndex,i=n.toIndex,r=n.fromInstance,d=n.toInstance,m=n.element;flexbe.land.editor.start(e),l.splice(a,1),o.splice(i,0,m),r.data.elements=l,s||(d.data.elements=o)})},a.createSortable=function(){var e,t,n,o,a=this.parent;this.sortable=new Sortable(this.$wrap[0],{delay:0,scroll:!0,animation:300,ghostAnimation:180,placeholderAnimation:300,forceFallback:!0,dragoverBubble:!0,group:"elements",draggable:".element-item",dataIdAttr:"data-id",fallbackTolerance:1,chosenClass:"flexbe-elements-sortable-chosen",dragClass:"flexbe-elements-sortable-drag",placeholderClass:"flexbe-elements-sortable-placeholder",ghostClass:"flexbe-elements-sortable-ghost",filter:".indent-point",preventOnFilter:!1,instancesBubble:!0,fallbackOffset:{x:0,y:15},fallbackMax:250,fallbackOpacity:1,onMoveEnd:function(t){var n=t.to.elementsInstance;n.setElementsClasses(),e&&e!==n&&e.setElementsClasses(),e=n},onStart:function(l){e=a,t=l.oldIndex,n=a.data.elements,o=n[t],a.sendEvent(s,{fromInstance:e,fromIndex:t,fromList:n,element:o}),e.setElementsClasses()},onEnd:function(s){var i=s.from===s.to,r=i?a:s.to.elementsInstance;if(r){var d=s.newIndex,m=r.data.elements;r.sendEvent(l,{fromInstance:a,toInstance:r,element:o,fromList:n,toList:m,isSameList:i,toIndex:d,fromIndex:t}),e=null,t=null,n=null,o=null}}})},o}();flexbe.land.editor.elements.modules.move=o}();
!function(){var e="/_s/images/land/editor/inner.svg?1",t="flexbe-elements-control-button",n="flexbe-elements-control-button-remove",s="flexbe-elements-button-remove-hover",i="flexbe-elements-button-remove-click",o=function(){function o(e){riot.observable(this),this.parent=e,this.$wrap=e.$wrap,this.entity=e.entity,this.params=e.params,this.onChange=e.onChange,this.$single=e.controls.$single,this.$singleBar=e.controls.$singleBar,this.init()}var r=o.prototype;return r.init=function(){this.createControls(),this.bindControls(),this.dispatchEvents()},r.createControls=function(){this.$remove=$('<div class="'+t+" "+n+'"><svg width="10" height="12"><use xmlns:xlink="https://www.w3.org/1999/xlink" xlink:href="'+e+'#button-remove"></use></svg></div>'),this.$singleBar.find("."+n).remove(),this.$singleBar.append(this.$remove)},r.bindControls=function(){var e=this,t=this.$remove;t.on("mouseenter mouseleave",function(t){var n="mouseenter"===t.type;e.parent.sendEvent(s,{state:n})}),t.on("click",function(){e.parent.sendEvent(i)})},r.dispatchEvents=function(){var e=this;this.on(i,function(){e.removeElement.apply(e,arguments)})},r.removeElement=function(){var e=this.parent,t=e.getState(),n=t.id,s=t.list;e.saveControls(),flexbe.land.element.remove(n,s),e.onChange(e.data,"elements_remove",["template"])},o}();flexbe.land.editor.elements.modules.remove=o}();
!function(){var t="/_s/images/land/editor/inner.svg?1",e="flexbe-elements-control-button",n="flexbe-elements-control-button-settings",s="flexbe-elements-control-hidden",i="flexbe-elements-activated",o="flexbe-elements-button-settings-hover",l="flexbe-elements-settings",r=function(){function r(t){riot.observable(this),this.parent=t,this.$wrap=t.$wrap,this.entity=t.entity,this.params=t.params,this.onChange=t.onChange,this.$single=t.controls.$single,this.$singleBar=t.controls.$singleBar,this.init()}var a=r.prototype;return a.init=function(){this.createControls(),this.bindControls(),this.dispatchEvents()},a.createControls=function(){this.$settings=$('<div class="'+e+" "+n+'"><svg width="12" height="12"><use xmlns:xlink="https://www.w3.org/1999/xlink" xlink:href="'+t+'#button-settings"></use></svg></div>'),this.$singleBar.find("."+n).remove(),this.$singleBar.append(this.$settings)},a.bindControls=function(){var t=this.$settings,e=this.parent;t.on("mouseenter mouseleave",function(t){var n="mouseenter"===t.type;e.sendEvent(o,{state:n})}),t.on("click",function(){e.sendEvent(l)})},a.dispatchEvents=function(){var t=this;this.on(l,function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];console.log("Element settings",e)}),this.on(i,function(e){var n=e.entity,s=n&&n.config&&n.config.vars_settings,i=!(!s||!Object.keys(s).length);t.toggleIcon(i)})},a.toggleIcon=function(t){this.$settings.toggleClass(s,!t)},r}();flexbe.land.editor.elements.modules.settings=r}();
!function(){var t="/_s/images/land/editor/inner.svg?1",s="flexbe-elements-control-corners",n="flexbe-elements-control-corner",e="flexbe-elements-control-area",i="flexbe-elements-control-button",o="flexbe-elements-control-button-settings",r="flexbe-elementList-settings",l=function(){function l(t){riot.observable(this),this.parent=t,this.$wrap=t.$wrap,this.entity=t.entity,this.params=t.params,this.onChange=t.onChange,this.$group=t.controls.$group,this.$groupBar=t.controls.$groupBar,this.init()}var a=l.prototype;return a.init=function(){this.createControls(),this.bindControls(),this.dispatchEvents()},a.createControls=function(){this.$corners=$(['<div class="'+s+'">','<span class="'+n+" "+n+'-tl"></span>','<span class="'+n+" "+n+'-tr"></span>','<span class="'+n+" "+n+'-br"></span>','<span class="'+n+" "+n+'-bl"></span>',"</div>"].join("")),this.$border=$(['<div class="'+e+'">',"</div>"].join("")),this.$group.find("."+s+", ."+e).remove(),this.$group.append(this.$corners,this.$border),this.$settings=$('<div class="'+i+" "+o+'"><svg width="12" height="12"><use xmlns:xlink="https://www.w3.org/1999/xlink" xlink:href="'+t+'#button-settings"></use></svg></div>'),this.$groupBar.find("."+o).remove(),this.$groupBar.append(this.$settings)},a.bindControls=function(){var t=this;this.$settings.on("click",function(){t.parent.sendEvent(r)})},a.dispatchEvents=function(){this.on(r,function(t){console.log("elementsList settings",t)})},l}();flexbe.land.editor.elements.modules.zone=l}();
!function(){var e="flexbe-items-wrap",t="flexbe-items-control-single",i="flexbe-items-control-group",s="flexbe-control-bar-small",n="flexbe-items-control-bar",o="flexbe-items-control-button",r=function(){function r(e){var t=this,i=e.$parent,s=e.$items,n=e.entity,o=e.data,r=e.params,a=e.onChange;this.$items=s,this.$parent=i||s.eq(0).parent(),this.$area=n.$area,this.$root=n.$root,this.entity=n,this.data=o||[],this.params=Object.assign({min:1},r),this.editors=this.params.editors,this.sprite="/_s/images/land/editor/inner.svg?1",this.onChange=function(e,i,s){void 0===i&&(i="items_change"),void 0===s&&(s="template"),a(e,i,s,t.$items)},this.modules={single:{},group:{}},this.current={id:1,index:0},Object.keys(this.editors).length&&this.init()}var a=r.prototype;return a.init=function(){this.createControls(),this.bindControls(),this.initModules()},a.createControls=function(){var o=this.params.editors_class||{};this.$single=$('<div class="'+t+" "+(o.single||o.item||"")+'"><div class="'+s+" "+n+'"></div></div>'),this.$group=$('<div class="'+i+" "+(o.group||o.static||"")+'"><div class="'+s+" "+n+'"></div></div>'),this.$single.hide(),this.$parent.addClass(e),this.$parent.append(this.$single),this.$parent.append(this.$group)},a.bindControls=function(){var e,t=this;this.$items.off("mousemove.items-editor mouseleave.items-editor").on("mousemove.items-editor mouseleave.items-editor",function(i){var s=i.currentTarget,n=$(s),o=i.type;if("mousemove"!==o||e!==s){e=s;var r=s.getAttribute("data-item-id"),a=r-1;t.current={id:r,index:a,$item:n},n.prepend(t.$single),t.$single.show(),Object.values(t.modules).forEach(function(e){"group"!==e.bindTo&&("mousemove"===o&&(e.current=t.current),"function"==typeof e.on_hover&&e.on_hover(n,o))})}})},a.initModules=function(){var e=this;Object.values(this.editors).forEach(function(t){var i=t.name.split(".")[0],s=t.name.split(".")[1]||t.id||"default",r=flexbe.land.editor.items.modules[i];if("function"!=typeof r)return!1;var a,l="static"===t.position||0===e.data.length&&!e.params.currentRecursion?"group":"single",d="flexbe-control-button-small "+o+" "+o+"-"+i+" "+(t.classList||""),u=$('<div class="'+d+'"></div>');flexbe.land.editor.items.modules[i]&&(a=new r({id:s,name:i,$editor:u,bindTo:l,parent:e,options:t}));if(a.disabled)return!1;"group"===l?(e.$group.find("."+n).append(u),e.modules[t.name]=a):(u.attr("title",a.description),e.$single.find("."+n).append(u),e.modules[t.name]=a)})},r}();flexbe.land.editor.items=r,flexbe.land.editor.items.modules={}}(),flexbe.land.editor.modules.blank=function(){},flexbe.land.editor.items.modules.blank=function(){};
!function(){var t=function(){function t(t){var i=t.$editor,e=t.options,o=t.bindTo,n=t.parent;this.description=polyglot.t("editor::outer_choise::desc"),this.bindTo=o,this.$editor=i,this.parent=n,this.options=Object.assign({var:"type",mode:"select",only_one:!1,states:[0,1],render:["template"]},e),this.params=n.params,this.data=n.data,this.onChange=n.onChange,this.init()}var i=t.prototype;return i.init=function(){if("group"===this.bindTo)return!1;this.createControls(),this.bindControls()},i.createControls=function(){this.$editor.empty(),"active"===this.options.mode?this.$editor.prepend('<svg width="22" height="11"><use xlink:href="'+this.parent.sprite+'#button-apply"></use></svg>'):this.$editor.prepend('<svg width="22" height="14"><use xlink:href="'+this.parent.sprite+'#button-toggle"></use></svg>'),this.options.text&&this.$editor.append("<span>"+this.options.text+"</span>")},i.bindControls=function(){var t=this;this.$editor.off("click.editor-choise").on("click.editor-choise",function(){var i=t.parent.current,e=t.options.var,o=t.data[i.index][e],n=t.getNextType(o);"active"===t.options.mode&&t.options.only_one&&t.data.forEach(function(t){t[e]=0}),t.data[i.index][e]=n,t.onChange(t.data,"items_choise",t.options.render)})},i.getNextType=function(t){if("active"===this.options.mode)return t?0:1;var i=this.options.states.indexOf(t);return this.options.states[i+1]||this.options.states[0]},t}();flexbe.land.editor.items.modules.choise=t}();
!function(){var t={colors:["#FFFFFF","#000","#222","#4D69BE","#2BB0D4","#95DAF8","#794C90","#E05BA5","#DD4B39","#F06D28","#38A817","#1AC687","#8CC832","#AE7E4B","#FFF55A"],custom:!0,opacity:!1,offset:!1,transparent:!1,rule:!1,selector:!1,var:"color",render:["css"]},o=function(){function o(o){var i=o.$editor,s=o.options,n=o.bindTo,e=o.parent;this.description=polyglot.t("editor::outer_color::desc"),this.bindTo=n,this.$editor=i,this.parent=e,this.options=Object.assign({},t,s),this.options.transparent&&(this.options.opacity=!0,this.options.colors.unshift("rgba(255,255,255,0)")),this.params=e.params,this.data=e.data,this.$items=e.$items,this.onChange=e.onChange,this.init()}var i=o.prototype;return i.init=function(){if("group"===this.bindTo)return!1;this.createControls(),this.bindControls()},i.createControls=function(){this.$editor.empty(),this.$editor.prepend('<svg width="22" height="14"><use xlink:href="'+this.parent.sprite+'#button-color"></use></svg>'),this.options.text&&this.$editor.append("<span>"+this.options.text+"</span>")},i.bindControls=function(){var t=this;this.$editor.off("click.color").on("click.color",function(o){t.showPicker()})},i.showPicker=function(){var t=this,o=this.parent.current,i=this.options.var,s=this.data[o.index][i];flexbe.land.editor.stop(),$.fn.colorpicker({element:this.$editor[0],value:s,show:!0,colors:!!this.options.colors,colorList:this.options.colors,opacity:this.options.opacity,spectre:this.options.custom,input:this.options.custom,change:function(o){t.applyColor(o.value)},on_done:function(){flexbe.land.editor.start()}})},i.applyColor=function(t){var o=this.parent.current.$item;this.options.selector&&"self"!==this.options.selector&&(o=o.find(this.options.selector));var i=this.parent.current,s=this.options.var;this.data[i.index][s]=t,this.options.rule&&o&&o.css(this.options.rule,t),this.onChange(this.data,"items_color",this.options.render)},o}();flexbe.land.editor.items.modules.color=o}();
!function(){var t=function(){function t(t){var e=t.$editor,i=t.options,a=t.bindTo,n=t.parent;this.bindTo=a,this.$editor=e,this.parent=n,this.options=Object.assign({render:["template"],item:!1},i),this.params=n.params,this.data=n.data,this.$items=n.$items,this.onChange=n.onChange,this.description=i.item?polyglot.t("editor::items_create::add_subitem"):polyglot.t("editor::items_create::add_subelement"),this.init()}return t.prototype.init=function(){var t=this;this.$editor.empty(),"group"===this.bindTo?this.$editor.prepend('<svg width="22" height="12"><use xlink:href="'+this.parent.sprite+'#button-add"></use></svg>'):this.options.item||"subitem"===this.options.mode?this.$editor.prepend('<svg width="22" height="12"><use xlink:href="'+this.parent.sprite+'#button-append"></use></svg>'):this.$editor.prepend('<svg width="22" height="14"><use xlink:href="'+this.parent.sprite+'#button-clone"></use></svg>'),(this.options.text||"group"===this.bindTo)&&this.$editor.append("<span>"+(this.options.text||this.description)+"</span>");var e=this.params.max&&this.data.length>=this.params.max,i=this.options.item&&0===this.data.length,a=this.options.item&&this.params.currentRecursion>=this.params.recursive_max;(e||a||i)&&(this.$editor.addClass("disabled"),this.disabled=!0),this.$editor.off("click").on("click",function(){var i,a=[];if(e)alertify.log(polyglot.t("editor::items_create::limit",{max:t.params.max}));else{if(t.data||(t.data=[]),"group"===t.bindTo){var n={},s=t.params.cols||1;Math.ceil(t.data.length/s)!==t.data.length/s&&(s=Math.ceil(t.data.length/s)*s-t.data.length);for(var d=s;d>=1;d--)n=t.options.default_data?$.extend(!0,{},t.options.default_data):t.data[t.data.length-d]||t.data[0]||{},a.push($.extend(!0,{},n));t.data=t.data.concat(a),t.data.length-s,t.data.length-1}else{var o=t.parent.current;t.options.item?(t.data[o.index][t.options.item]||(t.data[o.index][t.options.item]=[]),i=$.extend(!0,{},t.options.default_data),t.data[o.index][t.options.item].push(i),o.index):(i=$.extend(!0,{},t.data[o.index]||t.options.default_data),t.data.splice(o.index+1,0,i),o.index+1)}if(t.options.has_elements){return flexbe.helpers.replaceElementsIds(i||a,function(t){var e=t.id;return pageStore.copyEntity(e,"element").then(function(t){return t.id})}).then(function(){return t.onChange(t.data,"items_add",t.options.render),!0})}t.onChange(t.data,"items_add",t.options.render)}})},t}();flexbe.land.editor.items.modules.create=t}();
!function(){var e=function(){function e(e){var t=e.$editor,a=e.options,i=e.bindTo,o=e.parent;this.description=polyglot.t("editor::items_move::desc"),this.bindTo=i,this.$editor=t,this.parent=o,this.options=Object.assign({render:["template"]},a),this.params=o.params,this.data=o.data,this.$items=o.$items,this.onChange=o.onChange,this.init()}var t=e.prototype;return t.init=function(){var e=this;this.$editor.empty(),this.$editor.prepend('<svg width="22" height="14"><use xlink:href="'+this.parent.sprite+'#button-move"></use></svg>'),(this.options.text||"group"===this.bindTo)&&this.$editor.append("<span>"+(this.options.text||this.description)+"</span>"),this.data.length<=1&&(this.$editor.addClass("disabled"),this.disabled=!0),this.$editor.one("mouseenter.bind",function(){e.bind()})},t.bind=function(){var e=this,t=this.parent.$root,a=this.$items.parent(),i=Math.floor(1e3*Math.random()*1e3);a.each(function(o,s){new Sortable(s,{group:i,delay:0,scroll:!0,animation:{duration:250,easing:"cubic-bezier(0.74, 0.57, 0.26, 0.46)"},ghostAnimationIn:{duration:400,easing:"cubic-bezier(0.1, 0.84, 0.28, 0.98)"},ghostAnimationOut:{duration:300,easing:"cubic-bezier(0.1, 0.25, 0.01, 1)"},fallbackOpacity:"1",fallbackScale:"0.8",fallbackTolerance:0,fallbackDisabled:!1,forceFallback:!0,draggable:"[data-item-id]",dataIdAttr:"data-item-id",handle:".flexbe-items-control-button-move",chosenClass:"flexbe-items-sortable-placeholder",placeholderClass:"flexbe-items-sortable-placeholder",dragClass:"flexbe-items-sortable-drag",ghostClass:"flexbe-items-sortable-ghost",instancesBubble:!0,onChoose:function(i){e.$contenteditable=t.find('[contenteditable="true"]').attr("contenteditable",!1),$(i.item).append('<span class="flexbe-items-sortable-placeholder-bg"></span>'),t.addClass("in-items-move"),a.addClass("flexbe-items-wrap--draggable draggable"),uiStore.page.state.pushState("in-items-move"),flexbe.land.editor.stop()},onUnchoose:function(i){e.$contenteditable.attr("contenteditable",!0),$(i.item).find(".flexbe-items-sortable-placeholder-bg").remove(),t.removeClass("in-items-move"),a.removeClass("flexbe-items-wrap--draggable draggable"),uiStore.page.state.removeState("in-items-move"),flexbe.land.editor.start()},onStart:function(){0},onEnd:function(){var t=[];a.children("[data-item-id]").not("[data-disable-sortable]").each(function(a,i){var o=Math.floor($(i).data("itemId"))-1;t.push(e.data[o])}),setTimeout(function(){e.onChange(t,"items_move",e.options.render)},30)}})})},e}();flexbe.land.editor.items.modules.move=e}();
!function(){var t=function(){function t(t){var e=t.$editor,i=t.options,s=t.bindTo,o=t.parent;this.description=polyglot.t("editor::items_remove::desc"),this.bindTo=s,this.$editor=e,this.parent=o,this.options=Object.assign({render:["template"]},i),this.params=o.params,this.data=o.data,this.$items=o.$items,this.onChange=o.onChange,this.init()}var e=t.prototype;return e.init=function(){this.createControls(),this.bindControls()},e.createControls=function(){this.$editor.empty(),this.$editor.prepend('<svg width="22" height="12"><use xlink:href="'+this.parent.sprite+'#button-remove"></use></svg>'),(this.options.text||"group"===this.bindTo)&&this.$editor.append("<span>"+(this.options.text||this.description)+"</span>"),!this.params.currentRecursion&&this.data.length<=this.params.min&&(this.$editor.addClass("disabled"),this.disabled=!0)},e.bindControls=function(){var t=this;this.$editor.off("click").on("click",function(){t.removeItem()}),this.$editor.on("mouseenter",function(){t.togglePlaceholder(!0)}),this.$editor.on("mouseleave",function(){t.togglePlaceholder(!1)})},e.getItem=function(){if("group"===this.bindTo){var t=this.$items.closest(".active");t.length||(t=this.$items.last());var e=+t.attr("data-item-id");return{id:e,index:e-1,$item:t}}return this.parent.current},e.togglePlaceholder=function(t){var e=this.getItem().$item;e.toggleClass("is-remove-candidate",t),t&&!this.disabled?e.append('<div class="flexbe-items-placeholder-remove"><svg><use xlink:href="'+this.parent.sprite+'#editor_remove"></use></svg></div>'):(this.$items.find(".flexbe-items-placeholder-remove").remove(),this.$items.removeClass("is-remove-candidate"))},e.removeItem=function(){var t=this.getItem().index;this.data.splice(t,1),this.onChange(this.data,"items_remove",this.options.render)},t}();flexbe.land.editor.items.modules.remove=t}();
!function(){var t=function(){function t(t){var i=t.$editor,s=t.options,e=t.bindTo,n=t.parent;this.description=polyglot.t("editor::items_settings::desc"),this.bindTo=e,this.$editor=i,this.parent=n,this.options=Object.assign({},s),this.params=n.params,this.data=n.data,this.$items=n.$items,this.onChange=n.onChange,this.init()}return t.prototype.init=function(){this.$editor.empty(),this.$editor.prepend('<svg width="22" height="14"><use xlink:href="'+this.parent.sprite+'#button-settings"></use></svg>'),this.options.text&&this.$editor.append("<span>"+(this.options.text||this.description)+"</span>")},t}();flexbe.land.editor.items.modules.settings=t}();
!function(){var t=function(){function t(t){var i=t.$editor,e=t.options,s=t.bindTo,n=t.parent;this.bindTo=s,this.$editor=i,this.parent=n,this.options=Object.assign({type:"image",multiply:!1,render:["template"]},e),this.params=n.params,this.data=n.data,this.$items=n.$items,this.onChange=n.onChange,this.description=e.item?polyglot.t("editor::items_create::add_subitem"):polyglot.t("editor::items_create::add_subelement"),this.init()}return t.prototype.init=function(){var t=this;this.params.max&&this.data.length>=this.params.max&&(this.$editor.addClass("disabled"),this.disabled=!0),this.$editor.html('<input type="file" name="file"><svg width="22" height="12"><use xlink:href="'+this.parent.sprite+'#button-add"></use></svg>'),(this.options.text||"group"===this.bindTo)&&this.$editor.append("<span>"+(this.options.text||this.description)+"</span>"),this.$editor.find("input").attr("multiple",this.options.multiply),flexbe.files.upload.init({$input:this.$editor.find("input"),type:this.options.type,multi:!!this.options.multiply,on_complete:function(i,e){if(i){var s=$.extend(!0,{},t.data[t.data.length-1]);s.img&&(s.img.id=e.img_id,s.img.name=e.img_name),t.data.push(s),t.onChange(t.data,"items_add",t.options.render)}else alertify.error("Не удалось загрузить файл")}})},t}();flexbe.land.editor.items.modules.upload=t}();
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}flexbe.land.editor.modules.dropdown=function(t,o){this.$editor=t,this.$block=o.$block,this.$item=o.$item,this.dropdown=o.dropdown,this.data=o.data,this.dropdown&&(this.on_change=o.on_change,this.init())},flexbe.land.editor.modules.dropdown.prototype={init:function(){var t=this;this.$editor.parent().addClass("flexbe-control-bar-small"),this.$editor.addClass("flexbe-control-button-small");var o=[];if(this.dropdown.forEach(function(t){var e=t.editor;t.options&&t.options.preset&&(e+=":"+t.options.preset),o.push(e)}),this.$editor.attr("data-module-list",o.join(",")),"object"!=_typeof(this.data)&&(~o.indexOf("choise:seo")&&this.$editor.attr("data-value",this.data),~o.indexOf("fontsize"))){var e="string"==typeof this.data&&this.data.match(/font-size: ?([\d.?\d?]*)em;?/);e=parseInt(e&&100*e[1],10)||100,this.$editor.attr("data-value",e+"%")}this.$editor.one("mouseenter",function(){var o=t.$editor.empty();t.dropdown.forEach(function(t,e){t.var=t.var||"self",o.append('<div data-is="dropdown-module-'+t.editor+'" class="dropdown-module" editor-index="'+e+'"></div>')}),riot.mount(o[0],"dropdown",{dropdown:t.dropdown,editor:t})})},change:function(t){void 0===t&&(t=["template","editor"]),this.on_change(this.data,"dropdown_editor",t)}};
flexbe.land.editor.modules.color=function(t,s){this.description=polyglot.t("editor::outer_color::desc"),this.$editor=t,this.$block=s.$block,this.$item=s.$item,this.$current=!1,this.data=s.data,this.params=s.params,this.on_change=s.on_change;this.s=$.extend({},{colors:["#FFFFFF","#000","#222","#4D69BE","#2BB0D4","#95DAF8","#794C90","#E05BA5","#DD4B39","#F06D28","#38A817","#1AC687","#8CC832","#AE7E4B","#FFF55A"],custom:!0,transparent:!1,rule:!1,render:["css"],offset:!1,opacity:!1,var:"color",selector:!1},s.options),"static"!==this.s.position&&(this.s.transparent&&(this.s.opacity=!0,this.s.colors.unshift("rgba(255,255,255,0)")),this.init())},flexbe.land.editor.modules.color.prototype={init:function(){var t=this;this.$editor.parent().addClass("flexbe-control-bar-small"),this.$editor.addClass("flexbe-control-button-small"),this.$editor.empty(),this.$editor.prepend('<svg width="22" height="14"><use xlink:href="/_s/images/land/editor/inner.svg?4#button-color"></use></svg>'),this.s.text&&this.$editor.append("<span>"+this.s.text+"</span>"),this.$editor.off("click.editor_color").on("click.editor_color",function(s){var i=t.data;t.$current=t.$item,t.picker(t.$editor[0],i)})},picker:function(t,s){var i=this;flexbe.land.editor.stop();var o={element:t,value:s,show:!0,colors:!!this.s.colors,colorList:this.s.colors,opacity:this.s.opacity,spectre:this.s.custom,input:this.s.custom,change:function(t){i.set(t.value)},on_done:function(){flexbe.land.editor.start()}};$.fn.colorpicker(o)},set:function(t){this.data=t,this.s.rule&&this.$current.css(this.s.rule,t),this.change()},change:function(){this.on_change(this.data,null,this.s.render)}};
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}flexbe.land.editor.modules.indent=function(t,i){this.description=polyglot.t("editor::outer_indent::desc"),this.$editor=t,this.$block=i.$block,this.$item=i.$item,this.$current=!1,this.data=i.data,this.params=i.params,this.on_change=i.on_change,this.isObject="object"==_typeof(this.data);var e={render:["css"],preset:"indent",display:"all",min:20,max:200,scroll:!0,step:5,factor:1,unit:"px",element:"self",property:!1,propertyTop:"paddingTop",propertyBottom:"paddingBottom",initial:{top:0,bottom:0}};i.options&&"image"===i.options.preset&&(e.min=i.options.min||40,e.max=i.options.max||150,e.step=i.options.step||1,e.display=i.options.display||"bottom",e.scroll=i.options.scroll||!0,e.property=i.options.property||"paddingBottom",e.unit=i.options.unit||"%",e.element=i.options.element||!1),this.s=Object.assign({},e,i.options),this.init()},flexbe.land.editor.modules.indent.prototype={$line_top:[],$line_bottom:[],init:function(){this.makeEditor(),this.moveIndent()},makeEditor:function(){this.$editor.empty().addClass("preset-"+this.s.preset),this.$top=$('<div class="indent-point" data-type="top"></div>'),this.$bottom=$('<div class="indent-point" data-type="bottom"></div>'),this.s.initial.top&&(this.$line_top=$('<div class="indent-line indent-line-top">'+polyglot.t("editor::outer_indent::recommend")+": "+this.s.initial.top+"px</div>")),this.s.initial.bottom&&(this.$line_bottom=$('<div class="indent-line indent-line-bottom">'+polyglot.t("editor::outer_indent::recommend")+": "+this.s.initial.bottom+"px</div>")),"all"!==this.s.display&&"top"!==this.s.display||this.$editor.append(this.$top,this.$line_top),"all"!==this.s.display&&"bottom"!==this.s.display||this.$editor.append(this.$bottom,this.$line_bottom)},moveIndent:function(){var t=this,i=!1;this.$editor.off("click.editor_indent").on("click.editor_indent",".indent-point",function(t){return t.preventDefault(),!1}),this.$editor.off("mousedown.editor_indent").on("mousedown.editor_indent",".indent-point",function(e){if(e.preventDefault(),0===e.button){i=!0;var o=$(e.currentTarget).attr("data-type"),n=$(e.currentTarget).closest(t.$item),s=!!t.s.element&&("self"==t.s.element&&t.$item||t.$item.find(t.s.element)),a=n.innerWidth(),d=flexbe_cli.scroll.latest,r=n.offset().top,l=e.screenY,p=t.getValues(),m=p.initialTop,c=p.initialBottom,h=m,u=c;return $(e.currentTarget).addClass("in-drag"),n.addClass("in-drag editor-hover"),t.$item.parents(".b_block, .m_modal, .w_widget").addClass("in-edit"),flexbe.view.$document.find("body").addClass("unselectable"),t.alignLines(),$document.off("mousemove.editor_indent").on("mousemove.editor_indent",function(e){i&&requestAnimationFrame(function(){var i=e.screenY;if("top"==o){var p=l-i;"%"==t.s.unit&&(p=p/a*100),h=m+p/t.s.factor,h=Math.floor(h/t.s.step)*t.s.step,h=Math.min(t.s.max,Math.max(t.s.min,h))}else{var f=i-l;"%"==t.s.unit&&(f=f/a*100),u=c+f/t.s.factor,u=Math.floor(u/t.s.step)*t.s.step,u=Math.min(t.s.max,Math.max(t.s.min,u))}if(m!=h||c!=u){if(t.isObject?(t.data.top=h,t.data.bottom=u):t.data="top"==o?h:u,t.s.element){var b=("top"==o?t.s.propertyTop:t.s.propertyBottom)||t.s.property,$=t.isObject?t.data[o]:t.data;s.css(b,$+t.s.unit)}else t.change();if(t.alignLines(),t.s.scroll)if("top"==o&&"indent"==t.s.preset){var y=-(i-l);y=Math.min(t.s.max-m,Math.max(y,t.s.min-m)),flexbe.view.$document.scrollTop(d+y)}else if("image"==t.s.preset){var v=n.offset().top;flexbe.view.$document.scrollTop(d-(r-v))}}})}),$document.off("mouseup.editor_indent").on("mouseup.editor_indent",function(){if(i=!1,$document.off("mousemove.editor_indent mouseup.editor_indent"),flexbe.view.$document.find("body").removeClass("unselectable"),t.$top.removeClass("in-drag"),t.$bottom.removeClass("in-drag"),t.$item.removeClass("in-drag editor-hover"),t.$item.parents(".b_block, .m_modal, .w_widget").removeClass("in-edit"),t.isObject&&(delete t.data.initial_top,delete t.data.initial_bottom),t.change(t.s.render||["css"]),t.s.element){var e=("top"==o?t.s.propertyTop:t.s.propertyBottom)||t.s.property;s.css(e,"")}}),!1}})},getValues:function(){return this.isObject?{initialTop:this.data.top,initialBottom:this.data.bottom}:{initialTop:this.data,initialBottom:this.data}},alignLines:function(){var t=this.getValues(),i=t.initialTop,e=t.initialBottom;this.$top.attr("data-value",i+"px"),this.$bottom.attr("data-value",e+"px"),this.isObject&&(this.s.initial.top&&this.$line_top.css("top",this.data.top-this.s.initial.top+"px"),this.s.initial.bottom&&this.$line_bottom.css("bottom",this.data.bottom-this.s.initial.bottom+"px"))},change:function(t){this.on_change(this.data,null,t||this.s.render)}};
flexbe.land.editor.modules.text=function(t,e){this.$item=t,this.opt=e,this.options=Object.assign({full:!1,buttons:["fontWeight","bold","italic","strikeThrough","underline","insertLink","clearFormatting"],oneline:!1,colorsBackground:!1,img_width:1200},e.options),this.init()},flexbe.land.editor.modules.text.prototype={init:function(){if(this.$item.find(".editor_text").length)return!1;this.createView(),this.setOptions(),this.bindFroala()},createView:function(){this.$item.wrapInner('<div class="editor_text"></div>'),this.$item.find(".flexbe-custom-editor-wrap").prependTo(this.$item);var t=this.$item.find(".editor_text"),e=this.$item.parents(".b_block, .m_modal, .w_widget, .element-item"),o=t.children();this.$parents=e,this.$text=t;var l=String(t.html()||"").trim();o.length&&!/^\s*<span.*(?=style)[^>]*>/g.test(l)||(l="<p>"+l+"</p>"),/^\s*<p>\s*<\/p>\s*$/g.test(l)&&(l="<p><br></p>"),l=l.replace(/^\s*<span[^>]*>|<\/span>\s*$|<p><strong><em><\/em><\/strong><\/p>$/g,""),t.html(l)},setOptions:function(){var t=this.options;if(t.full&&(t.buttons=["fontSize","fontWeight","bold","italic","strikeThrough","underline","insertLink","alignLeft","alignCenter","alignRight","justify","color","cash","insertImage","paragraphFormat","paragraphStyle","glavred","speller","clearFormatting"]),t.buttons.length){var e=t.buttons.indexOf("fontWeight");e>=0&&!t.buttons.includes("bold")&&t.buttons.splice(e+1,0,"bold"),t.buttons.includes("clearFormatting")||t.buttons.push("clearFormatting"),t.buttons.includes("speller")||t.buttons.push("speller"),t.buttons.includes("glavred")&&requirejs(["//api.glvrd.ru/v1/glvrd.js"])}this.froalaOptions={toolbarInline:!0,theme:"flexbe",charCounterCount:!1,pastePlain:!0,placeholderText:"",language:polyglot.currentLocale,heightMin:15,quickInsertButtons:[],htmlUntouched:!0,colorsBackground:!1,pasteDeniedTags:["a","span"],linkEditButtons:["linkOpen","linkEdit","linkRemove"],linkInsertButtons:["linkBack","remove"],scrollableContainer:this.$item.closest(".modal-list, .widget-list, .container-list, footer, header")[0],multiLine:!t.oneline,toolbarVisibleWithoutSelection:!!t.buttons.length,toolbarButtons:t.buttons,toolbarButtonsMD:t.buttons,toolbarButtonsSM:t.buttons,toolbarButtonsXS:t.buttons,imageUploadURL:"/admin/files/upload?type=image&is_text_redactor=1&img_width="+t.img_width,imageEditButtons:["imageReplace","imageAlign","imageRemove","imageLink","linkOpen","linkEdit","linkRemove","imageDisplay","imageSize"],imagePaste:!1,paragraphFormat:{N:"Normal",PRE:"Code"},paragraphMultipleStyles:!1,paragraphStyles:{"fr-note":polyglot.t("editor::text::paragraph_style_note"),"fr-fact":polyglot.t("editor::text::paragraph_style_fact")}},!0===t.colorsBackground&&delete this.froalaOptions.colorsBackground;var o=parseInt(this.$text.css("line-height"),10);o&&(this.froalaOptions.heightMin=o),$.FE.DEFAULTS.htmlAllowedTags.push("font"),$.FE.DEFAULTS.htmlAllowedTags.push("glavred"),$.FE.DEFAULTS.htmlAllowedTags.push("speller"),$.FE.DEFAULTS.htmlAllowedTags.push("tooltip"),$.FE.DEFAULTS.htmlAllowedAttrs.push("hint-name"),$.FE.DEFAULTS.htmlAllowedAttrs.push("index"),$.FE.DEFAULTS.htmlDoNotWrapTags.push("font"),$.FE.DEFAULTS.htmlAllowedEmptyTags.push("em"),$.FE.LANGUAGE.en={translation:{},direction:"ltr"},$.FE.LANGUAGE[polyglot.currentLocale].translation["editor::text::font_weight"]=polyglot.t("editor::text::font_weight"),$.FE.LANGUAGE[polyglot.currentLocale].translation["editor::text::cash_symbol"]=polyglot.t("editor::text::cash_symbol"),$.FE.LANGUAGE[polyglot.currentLocale].translation["editor::text::cash_rub"]=polyglot.t("editor::text::cash_rub"),$.FE.LANGUAGE[polyglot.currentLocale].translation["editor::text::cash_eur"]=polyglot.t("editor::text::cash_eur"),$.FE.LANGUAGE[polyglot.currentLocale].translation["editor::text::cash_usd"]=polyglot.t("editor::text::cash_usd"),$.FE.LANGUAGE[polyglot.currentLocale].translation["editor::text::glavred"]=polyglot.t("editor::text::glavred"),$.FE.LANGUAGE[polyglot.currentLocale].translation["editor::text::glavred_no_recommendations"]=polyglot.t("editor::text::glavred_no_recommendations"),$.FE.LANGUAGE[polyglot.currentLocale].translation["editor::text::glavred_error"]=polyglot.t("editor::text::glavred_error"),$.FE.LANGUAGE[polyglot.currentLocale].translation["editor::text::speller"]=polyglot.t("editor::text::speller"),$.FE.LANGUAGE[polyglot.currentLocale].translation["editor::text::speller_error"]=polyglot.t("editor::text::speller_error"),$.FE.LANGUAGE[polyglot.currentLocale].translation["editor::text::speller_no_errors"]=polyglot.t("editor::text::speller_no_errors"),$.FE.LANGUAGE[polyglot.currentLocale].translation["editor::text::speller_options"]=polyglot.t("editor::text::speller_options")},bindFroala:function(){var t=this,e=this.$text,o=this.$parents,l=this.froalaOptions,r=!1;e.froalaEditor(l),e.on("froalaEditor.initialized",function(t,e){l.toolbarButtons.length||e.$tb.css({opacity:"0"})}),e.on("froalaEditor.blur froalaEditor.focus",function(e){t.$item.toggleClass("in-edit","focus"===e.namespace),o.toggleClass("in-edit","focus"===e.namespace)}),e.on("froalaEditor.commands.after",function(t,e,o){r=!0,flexbe.stat.event("Editor - Text - Command "+o)}),e.on("froalaEditor.paste.after",function(){r=!0,flexbe.stat.event("Editor - Text - Paste")}),e.on("froalaEditor.paste.afterCleanup",function(t,e,o){if("string"!=typeof o)return"";if(/img/.test(o))return o;var l=$("<div/>").text(o).html().replace(/amp;/g,""),r=$("<div/>").html(l).text(),i=Boolean($("<div/>").append(r).text());return e.html.insert(e.selection.isFull()||!e.html.get()?"<p>"+(i?r:"<br>")+"</p>":r),""}),e.on("froalaEditor.contentChanged",function(e,o){/<glavred>/.test(o.html.get())&&($("tooltip",o.doc.body).remove(),$("glavred",o.$el).each(function(){var t=$(this).data("tooltip");t&&t.remove(),$(this).replaceWith(this.childNodes)})),"function"==typeof t.opt.on_change&&t.opt.on_change(o.html.get().replace(/<\/?speller .*?>/gm,""),!1,!1),!1===r?flexbe.stat.event("Editor - Text - Changed"):r=!1})}};
flexbe.land.editor.modules.list=function(t,e){this.$item=t,this.opt=e,this.init()},flexbe.land.editor.modules.list.prototype={init:function(){var t=this,e=this.$item;if(e.find("li").attr("contenteditable",!0).attr("spellcheck",!1),this.empty_observer(),this.opt.options&&this.opt.options.controls){var i=$('<div class="list-item-remove" title="Удалить строку">&times;</div>');e.append(i);var s=$('<div class="list-item-add" title="Добавить строку">Добавить строку</div>');e.append(s),e.on("focus","li",function(e){clearTimeout(t.focusTmt);var o=$(e.currentTarget).parent().find("li").length<=1;if(o)i.removeClass("show");else{var n=$(e.currentTarget).position().top;n+=$(e.currentTarget).outerHeight()/2-i.outerHeight()/2,i.addClass("show").css({top:n}),s.css("visibility","visible"),i.off("click").on("click",function(){if(!o){var i=$(e.currentTarget).prev();i.length||(i=$(e.currentTarget).next()),$(e.currentTarget).remove(),t.update_list(),i.focus()}})}}),e.on("blur","li",function(e){t.focusTmt=setTimeout(function(){i.removeClass("show").off("click"),s.css("visibility","")},120)}),s.off("click").on("click",function(){if(!(e.find("li").last().text().length<1)){var i=$("<li></li>").attr("contenteditable",!0).attr("spellcheck",!1);e.find("ul").append(i),i.focus(),t.update_list()}}),e.off("mouseenter.add-item").on("mouseenter.add-item",function(){s.addClass("show")}),e.off("mouseleave.add-item").on("mouseleave.add-item",function(){s.removeClass("show")})}e.off("keypress").on("keypress","li",$.proxy(function(t){if(13===t.which){var e=$(t.currentTarget),i=$("<li></li>").attr("contenteditable",!0).attr("spellcheck",!1);return e.after(i),i.focus(),t.preventDefault(),this.empty_observer(),!1}},this)),e.off("keyup").on("keyup","li",$.proxy(function(t){var e=$(t.currentTarget);8===t.which&&e.text().length<1?e.data("_press_repeat")?e.siblings().length>0&&(e.prev().focus(),e.remove(),this.update_list()):e.data("_press_repeat",1):13!==t.which&&(e.removeData("_press_repeat"),this.update_list())},this)),e.off("paste").on("paste","li",$.proxy(function(t){setTimeout($.proxy(function(){$(t.currentTarget);this.update_list()},this),1)},this))},empty_observer:function(){this.$item.find("> ul li").off("blur.editor").on("blur.editor",$.proxy(function(t){var e=$(t.currentTarget);e.text().length<1&&e.siblings().length>0&&(e.remove(),this.update_list()),e.html()!=e.text()&&e.html($("<div/>").append(e.text()).text())},this))},update_list:function(){var t=[];this.$item.find("> ul li").each($.proxy(function(e,i){var s=$(i).text();t.push({text:s})},this)),"function"==typeof this.opt.on_change&&this.opt.on_change(t,!1,!1)}};
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}flexbe.land.editor.modules.image=function(t,a){var e=this;e.$item=t,e.opt=a,e.opt.data&&"object"===_typeof(e.opt.data)||(e.opt.data={}),e.$data=$("<div></div>"),e.$data_img_wrap=$('<div class="editor_image_wrap clear"></div>'),e.$data_img=$('<div class="image_settings clear"></div>'),e.$data_video=$('<div class="video_settings clear"></div>'),e.$data_left=$('<div class="data_left"><div class="data_img"><div class="overlay"></div><img/></div></div>'),e.$data_right=$('<div class="data_right"></div>'),e.$file=$('<div class="file_select"><input type="file" name="file" accept="image/jpeg,image/png,image/gif"><a><svg width="18" height="16" viewBox="0 0 533.333 533.334"><path d="M66.667 133.333v333.333h466.667V133.333H66.667zM500 411.11L433.333 300l-75.556 62.962L300 266.667 100 433.333V166.667h400V411.11zM133.333 250c0 27.614 22.386 50 50 50 27.615 0 50-22.386 50-50s-22.385-50-50-50c-27.614 0-50 22.386-50 50zM466.667 66.667H0V400h33.333V100h433.333V66.667z"/></svg><span>Загрузить</span></a></div>'),e.$edit_btn=$('<div class="edit_btn"><a><svg width="15" height="14" viewBox="0 0 533.333 533.333"><path d="M200 333.333L266.667 300 500 66.667l-33.333-33.333-233.334 233.333L200 333.333zm-49.323 118.28c-16.475-34.754-34.2-52.48-68.956-68.955l51.613-142.08L200 200 400 0H300L100 200 0 533.333l333.333-100 200-200v-100l-200 200L292.753 400"/></svg><span>Фоторедактор</span></a></div>'),e.$data_left.append(e.$file).append(e.$edit_btn),e.$data_img.append(e.$data_left).append(e.$data_right),e.$data_img_wrap.append(e.$data_img),e.$data.append(e.$data_img_wrap),e.opt.options&&e.opt.options.size&&e.opt.options.size.v&&e.opt.options.size.h&&(e.$data_left.find(".overlay").prepend('<div class="recommend-size">Рекомендуемый размер: <div><span class="vert">'+e.opt.options.size.v+'</span> &times; <span class="hor">'+e.opt.options.size.h+"</span></div></div>"),e.$file.on("mouseenter",function(){e.$data_left.find(".overlay").addClass("hover")}),e.$file.on("mouseleave",function(){e.$data_left.find(".overlay").removeClass("hover")})),e.init()},flexbe.land.editor.modules.image.prototype={init:function(){var t=this;t.update_preview();var a={click_out:"body",overlay:!1,id:this.$item.attr("data-id")+"_editor_image",name:"editor_image",width:275,title:"Изображение",item:this.opt.item};if(t.opt.options&&t.opt.options.show_video&&(a.tabs={image:{active:!0,title:"Изображение"},video:{title:"Видео"}},a.on_tab_change=function(a){t.opt.data.type="video"==a?"video":"image",t.change()},a.width=320,t.$data.wrapInner('<div data-tab="image"></div>'),t.$data_video.append('<div class="sp_modal_opt sp_modal_opt_text" data-name="video_url"><label class="old-style"><div class="title">Ссылка на видео или код</div><input class="old-style" type="text" tabindex="99"><div class="desc">Например, youtube.com/watch?v=cIyHm6hSMrc</div></label></div>'),t.$data_video.find('.sp_modal_opt[data-name="video_url"] input').val(t.opt.data.v_link).on("keyup paste extchange",function(a){setTimeout(function(){var e=$(a.currentTarget).val(),i=t.parse_video_link(e);t.opt.data.v_link=i.link,t.opt.data.v_type=i.type,t.opt.data.v_id=i.id,t.change()},0)}),t.$data_video.append('<div class="video_settings_services"><a href="http://www.youtube.com/" data-type="youtube" target="_blank"></a><a href="http://vimeo.com/" data-type="vimeo" target="_blank"></a></div>'),t.$data.append($('<div data-tab="video"></div>').append(t.$data_video))),t.opt.options&&t.opt.options.show_popup){var e=$(['<div class="sp_modal_opt sp_modal_opt_text img-popup" data-name="img_popup">','<label class="old-style checkbox">','<input class="old-style" type="checkbox" value="1">',"Увеличивать при клике","</label>","</div>"].join(""));t.$data_left.append(e),e.find("input[type=checkbox]").spacedCheckbox(),t.opt.data.popup&&e.find(".spacedCheckbox").attr("data-checked",!0),e.find(".spacedCheckbox").on("click",function(a){var e=$(a.currentTarget).attr("data-checked");t.opt.data.popup="true"==e?1:0,t.change()})}if(t.opt.options&&(t.opt.options.show_name||t.opt.options.show_desc||t.opt.options.show_url)&&(a.width=550,t.$data_img.addClass("two-cols"),t.opt.options.show_name&&(t.$data_right.append('<div class="sp_modal_opt sp_modal_opt_text" data-name="img_title"><label class="old-style"><div class="title">Название</div><input class="old-style" type="text" tabindex="99"><div class="desc">Выводится при наведении на фотографию</div></label></div>'),t.$data_right.find('.sp_modal_opt[data-name="img_title"] input').val(t.opt.data.title).on("keyup paste extchange",function(a){setTimeout(function(){t.opt.data.title=$(a.currentTarget).val(),t.change()},0)})),t.opt.options.show_desc&&(t.$data_right.append('<div class="sp_modal_opt sp_modal_opt_text" data-name="img_desc"><label class="old-style"><div class="title">Описание</div><input class="old-style" type="text" tabindex="99"><div class="desc">Выводится при наведении на фотографию</div></label></div>'),t.$data_right.find('.sp_modal_opt[data-name="img_desc"] input').val(t.opt.data.desc).on("keyup paste extchange",function(a){setTimeout(function(){t.opt.data.desc=$(a.currentTarget).val(),t.change()},0)})),t.opt.options.show_url)){var i=$(['<div class="sp_modal_opt sp_modal_opt_text" data-name="img_url">','<label class="checkbox">','<input class="old-style" type="checkbox" value="1">',"Сделать ссылкой","</label>",'<label class="field old-style collapsed">','<input class="old-style" type="text" tabindex="99">','<div class="desc">Введите адрес ссылки</div>',"</label>","</div>"].join(""));t.$data_right.append(i),i.find("input[type=checkbox]").spacedCheckbox(),t.opt.data.url&&(i.find(".field").removeClass("collapsed"),i.find(".spacedCheckbox").attr("data-checked",!0)),i.find(".spacedCheckbox").on("click",function(a){var e=$(a.currentTarget).attr("data-checked"),i=$(a.currentTarget).parent().siblings(".field");"true"==e?(i.removeClass("collapsed"),t.opt.data.url=i.find("input[type=text]").val()):(i.addClass("collapsed"),delete t.opt.data.url),t.change()});var o=[];flexbe.page.updateList(function(){var t=flexbe.page.find_domain_by_id(flexbe.land.group_id);!t||!t.pages||t.pages.length<=1||(o=t.pages.map(function(t){return t.uri}))}),i.find('input[type="text"]').val(t.opt.data.url).on("keyup paste extchange",$.debounce(function(a){var e=$(a.currentTarget).val();e=$("<div/>").text(e).html(),!/^((http|https|ftp):\/\/|\/)/.test(e)&&/\S+[.](ru|org|com|net|ua|рф|mobi|biz|me|pro|kz|info|be|su)/.test(e)&&(e=document.location.protocol+"//"+e),t.opt.data.url=e,t.change()},150)).autocomplete({minChars:1,autoSelectFirst:!0,lookup:o,onSelect:function(a){t.opt.data.url=a.value,t.change()}})}a.$data=t.$data;flexbe.modal.create(a);t.upload_init(),t.photo_editor_init(),t.opt.options&&t.opt.options.no_drag||t.image_position()},upload_init:function(){var t=this;flexbe.files.upload.init({$input:t.$file.find("input"),type:"image",on_start:function(){t.$data_left.find(".overlay").addClass("loading")},on_complete:function(a,e){t.$data_left.find(".overlay").removeClass("loading"),e&&e.img_id?(t.opt.data.id=e.img_id,t.opt.data.name=e.img_name,t.change(),t.update_preview(),void 0!==t.$data_right&&t.$data_right.find('.sp_modal_opt[data-name="img_file"] input').val(e.img_name)):alertify.error("Не удалось загрузить изображение")}})},photo_editor_init:function(){var t=this;t.$edit_btn.on("click","a",function(){var a=document.location.host,e=document.location.protocol+"//"+a+"/img/"+t.opt.data.id+"_1920/"+t.opt.data.name;flexbe.land.image.aviary.run({image:t.$data_left.find("img").get(0),url:e,img_name:t.opt.data.name,save:function(a){t.opt.data.id=a.id,t.opt.data.name=a.name,t.change(),t.update_preview()}})})},image_position:function(){var t=this,a=t.$item;t.opt.options&&t.opt.options.element&&(a=a.find(t.opt.options.element)),"object"!=_typeof(t.opt.data.position)&&(t.opt.data.position={x:"50%",y:"50%"}),t.$data_left.find(".data_img").dragBg({pos:{x:t.opt.data.position.x,y:t.opt.data.position.y}},function(e){t.opt.data.position.x=e.x,t.opt.data.position.y=e.y,t.change("css"),a.css({"background-position":e.x+" "+e.y})})},changeTmt:0,change:function(t){var a=this;clearTimeout(a.changeTmt),a.changeTmt=setTimeout(function(){"function"==typeof a.opt.on_change&&a.opt.on_change(a.opt.data,null,t)},200)},update_preview:function(){this.opt.data&&this.$data_left.find("img").attr("src","/img/"+this.opt.data.id+(/\.svg$/.test(this.opt.data.name)?"":"_350")+"/"+this.opt.data.name)},parse_video_link:function(t){var a=t=$.trim(t),e="";if(0===(t=(t=(t=(t=t.replace("http://","")).replace("https://","")).replace("://","")).replace("www.","")).search(/(\s*)?youtube.com\//i)||0===t.search(/(\s*)?youtu.be\//i)){if(/youtube\.com\/(.*?)v=([^&\s+]+)/i.test(t)?e=t.match(/youtube.com\/(.*?)v=([^&\s+]+)/i)[2].replace(/(\s*)/,""):/youtube\.com\/user\/(.*?)\#/i.test(t)?e=t.match(/\/([^\/.*]+)$/i)[1].replace(/(\s*)/,""):/youtu\.be\/([^&\s+]+)/i.test(t)&&(e=t.match(/youtu\.be\/([^&\s+]+)/i)[1].replace(/(\s*)/,"")),e.length>0)return{link:t,id:e,type:"youtube"}}else if(0===t.search(/^vimeo\.com\//i)||0===t.search(/^player\.vimeo\.com\//i)){if(/^vimeo\.com\/channels\/([^\/]*)\/([0-9]*)/i.test(t)?e=t.match(/^vimeo\.com\/channels\/([^\/]*)\/([0-9]*)/i)[2].replace(/(\s*)/,""):/^vimeo\.com\/([0-9]*)/i.test(t)?e=t.match(/^vimeo\.com\/([0-9]*)/i)[1].replace(/(\s*)/,""):/player\.vimeo\.com\/video\/([0-9]*)/i.test(t)&&(e=t.match(/player\.vimeo\.com\/video\/([0-9]*)/i)[1].replace(/(\s*)/,"")),e.length>0)return{link:t,id:e,type:"vimeo"}}else if(0===a.search(/^\<iframe/i)||0===a.search(/^\<object/i))return{link:a,id:a,type:"html"};return{link:"",id:"",type:""}}};
flexbe.land.editor.modules.video=function(t,e){this.$item=t,this.opt=e,this.init()},flexbe.land.editor.modules.video.prototype={init:function(){var t=$('<div class="video_settings clear"></div>');if(t.append('<div class="sp_modal_opt sp_modal_opt_text" data-name="video_url"><label class="old-style"><div class="title">Ссылка на видео или код</div><input class="old-style" type="text" tabindex="99"><div class="desc">Например, youtube.com/watch?v=cIyHm6hSMrc</div></label></div>'),t.find('.sp_modal_opt[data-name="video_url"] input').val(this.opt.data.link||this.opt.data.v_link||"").on("keyup paste extchange",$.proxy(function(t){setTimeout($.proxy(function(){var e=$(t.currentTarget).val(),i=this.parse_video_link(e);this.opt.data.v_link=i.link,this.opt.data.v_type=i.type,this.opt.data.v_id=i.id,this.opt.data.link=i.link,this.opt.data.type=i.type,this.opt.data.id=i.id,this.change()},this),0)},this)),this.opt.options&&this.opt.options.size){var e=$('<div class="video_size"><div class="title">Размер видео</div><div class="video_size_list"><a data-size="small"></a><a data-size="medium" class="active"></a><a data-size="big"></a></div></div>');t.append(e),this.opt.data&&this.opt.data.size&&e.find('a[data-size="'+this.opt.data.size+'"]').addClass("active").siblings().removeClass("active"),e.on("click","a",$.proxy(function(t){this.opt.data.size=$(t.currentTarget).attr("data-size"),$(t.currentTarget).addClass("active").siblings().removeClass("active"),this.change()},this))}t.append('<div class="video_settings_services"><a href="http://www.youtube.com/" data-type="youtube" target="_blank"></a><a href="http://vimeo.com/" data-type="vimeo" target="_blank"></a></div>');flexbe.modal.create({click_out:"body",overlay:!1,id:this.$item.attr("data-id")+"_editor_video",name:"editor_video",width:500,title:"Видео",item:this.opt.item,$data:t})},change:function(){"function"==typeof this.opt.on_change&&this.opt.on_change(this.opt.data)},parse_video_link:function(t){var e=t=$.trim(t),i="";if(0===(t=(t=(t=(t=t.replace("http://","")).replace("https://","")).replace("://","")).replace("www.","")).search(/(\s*)?youtube.com\//i)||0===t.search(/(\s*)?youtu.be\//i)){if(/youtube\.com\/(.*?)v=([^&\s+]+)/i.test(t)?i=t.match(/youtube.com\/(.*?)v=([^&\s+]+)/i)[2].replace(/(\s*)/,""):/youtube\.com\/user\/(.*?)\#/i.test(t)?i=t.match(/\/([^\/.*]+)$/i)[1].replace(/(\s*)/,""):/youtu\.be\/([^&\s+]+)/i.test(t)&&(i=t.match(/youtu\.be\/([^&\s+]+)/i)[1].replace(/(\s*)/,"")),i.length>0)return{link:t,id:i,type:"youtube"}}else if(0===t.search(/^vimeo\.com\//i)||0===t.search(/^player\.vimeo\.com\//i)){if(/^vimeo\.com\/channels\/([^\/]*)\/([0-9]*)/i.test(t)?i=t.match(/^vimeo\.com\/channels\/([^\/]*)\/([0-9]*)/i)[2].replace(/(\s*)/,""):/^vimeo\.com\/([0-9]*)/i.test(t)?i=t.match(/^vimeo\.com\/([0-9]*)/i)[1].replace(/(\s*)/,""):/player\.vimeo\.com\/video\/([0-9]*)/i.test(t)&&(i=t.match(/player\.vimeo\.com\/video\/([0-9]*)/i)[1].replace(/(\s*)/,"")),i.length>0)return{link:t,id:i,type:"vimeo"}}else if(0===e.search(/^\<iframe/i)||0===e.search(/^\<object/i))return{link:e,id:e,type:"html"};return{link:"",id:"",type:""}}};
flexbe.land.editor.modules.gallery=function(e,t){this.$item=e,this.o=t,this.options=$.extend({render:"template"},this.o.options),this.init()},flexbe.land.editor.modules.gallery.prototype={init:function(){flexbe.modal.create({click_out:"body",overlay:!1,name:"editor_gallery",width:820,title:polyglot.t("editor::background::modal_title"),riotTag:"editor-gallery",riotOpts:{editor:this}})},unsplashService:function(e,t,o,i){void 0===i&&(i=function(){});var a=$.ajax({url:"/admin/data/background",type:"GET",dataType:"json",data:{per_page:t,search:o,page:e}});a.done(function(e){Array.isArray(e)?i(e):i(!1)}),a.fail(function(){i(!1)})},setImageByUrl:function(e,t){var o=this;void 0===t&&(t=function(){}),e=e.replace(/&q=85/,"&q=30")+"&w=1920";var i=$.ajax({url:"/admin/files/upload_url",type:"GET",dataType:"json",data:{type:"image",file_name:"upload.jpg",file_url:e}});i.done(function(e){e.img_id?(o.change({img_id:e.img_id,img_name:e.img_name}),t(e)):(t(!1),alertify.error(polyglot.t("editor::background::upload_error")))}),i.fail(function(){t(!1),alertify.error(polyglot.t("editor::background::upload_error"))})},change:function(e,t){"function"==typeof this.o.on_change&&this.o.on_change(e,"",t||this.options.render)}};
flexbe.land.editor.modules.bgposition=function(t,i){this.$item=t,this.o=i,this.options=$.extend({render:"template"},this.o.options),this.init()},flexbe.land.editor.modules.bgposition.prototype={init:function(){flexbe.modal.create({click_out:"body",overlay:!1,id:this.$item.attr("data-id")+"_editor_bgposition",name:"editor_bgposition",width:376,title:polyglot.t("editor::bg_setting::cover_settings"),riotTag:"editor-bgposition",riotOpts:{editor:this,bg:this.o.bg,change:this.o.on_change}})},change:function(t,i){"function"==typeof this.o.on_change&&this.o.on_change(t,"",i||this.options.render)}};
flexbe.land.editor.modules.logo=function(t,o){riot.observable(this),this.$item=t,this.opt=o,this._object=o.block,this.id=o.block.id,this.data=o.data,this.data.type||(this.data.type="img");var i={fonts:["Arial","Calibri","Georgia","Tahoma","Times New Roman","Trebuchet MS","Verdana"],render:["template"],tabs:"text"===this.data.type?["img","text"]:["img"],size:{img:[30,100],text:[21,40]},colors:["#FFFFFF","#000000"],color_custom:!0};this.options=Object.assign({},i,o.options),this.options.fonts=this.options.fonts.map(function(t){return{value:t,title:t,style:'font-family: "'+t+'"'}}),this.init()},flexbe.land.editor.modules.logo.prototype={init:function(){this.modal=flexbe.modal.create({riotTag:"editor-logo",riotOpts:{data:this.data,options:this.options,editor:this},name:"editor_logo",title:polyglot.t("editor::logo::modal_title"),item:this.opt.item,overlay:!1,width:420})},update:function(){this.trigger("update")},change:function(t){"function"==typeof this.opt.on_change&&this.opt.on_change(this.opt.data,null,t||this.options.render)},LM:function(t){function o(){return t.apply(this,arguments)}return o.toString=function(){return t.toString()},o}(function(){var t,o=this,i=this.data.icon_source,e={allow_apply:!0,onapply:function(i,e){try{o.data.icon_source=i,o.data.img.id=e.img_id,o.data.img.name=e.img_name,o.data.img.ext=e.img_ext}catch(t){}t&&t.close(),o.update(),o.change()}},a=function(){var a=$("<div></div>");LM.render(a.get(0),i,e),t=flexbe.modal.create({$data:a,name:"logo_creator",title:polyglot.t("editor::logo::modal_tool_title"),item:o.modal&&o.modal.$modal[0],overlay:!1,click_out:!1,width:860})};"undefined"==typeof LM?requirejs(["/_s/build/LM_editor.js"],function(){a()}):a()})};
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}flexbe.land.editor.modules.ico=function(t,i){this.$item=t,this.opt=i,this.old_style=1==flexbe_cli.theme_id,this.opt.options=$.extend({show_default:!0,deny_download:!1,custom_color:!this.old_style,render:["template"]},this.opt.options),this.init()},flexbe.land.editor.modules.ico.prototype={iconpath:"/_s/images/svg/",init:function(){var t=this.opt.options;if(this.ico_sets_list=t.show_default?[{name:"budicon",icon:"/_s/images/land/budicon_tab.svg"},{name:"line",icon:"/_s/images/land/line_tab.svg"},{name:"solid",icon:"/_s/images/land/solid_tab.svg"},{name:"numbers",icon:"/_s/images/svg/numbers/9.svg"}]:[],Array.isArray(t.show_default_list)){var i=this.ico_sets_list.filter(function(i){return!!~t.show_default_list.indexOf(i.name)});i.length&&(this.ico_sets_list=i)}"object"===_typeof(t.list)&&(this.ico_sets_list.some(function(i){return i.name&&i.name==t.list.name})||(this.ico_sets_list.push(t.list),this.cache[t.list.name]=t.list.set)),!0===t.colors&&(t.colors=["#FFF","#222","#3D52B0","#FC2F58","#38A817","#F06D28","#FFF55A","#2BB0D4","#794C90","#E05BA5"]),"string"==typeof this.opt.data&&(this.opt.data={url:this.opt.data,svg:0}),this.modal=flexbe.modal.create({handle:".title",click_out:"body",overlay:!1,id:this.$item.attr("data-id")+"_editor_ico",name:"editor_ico",width:500,title:polyglot.t("editor::ico::modal_title"),item:this.opt.item,$data:$('<div data-is="editor-ico"><div>')}),riot.mount("editor-ico",{options:t,ico_sets:this.ico_sets_list,editor:this,data:this.opt.data})},cache:{},change:function(){"function"==typeof this.opt.on_change&&this.opt.on_change(this.opt.data,null,this.opt.options.render)}};
flexbe.land.editor.modules.form=function(e,t){this.old_style=+flexbe.land.theme_id<=1,this.opt=t,this.$item=e,this.entity=t.block.entity,this.block=t.block,this.data=t.data,this.options=t.options,this.check(),this.init()},flexbe.land.editor.modules.form.prototype={init:function(){this.modal=flexbe.modal.create({name:"editor_form",width:500,title:polyglot.t("editor::form::modal_title"),item:this.opt.item,riotTag:"editor-form",riotOpts:{editor:this,data:this.data,options:this.options,onchange:this.change.bind(this)},overlay:!1})},check:function(){var e;switch(+flexbe.land.theme_id){case 1:e=!1;break;case 2:e=["style-2","style-3","style-1"];break;case 3:e=["style-1","style-3"]}var t={min:1,max:99,allowed:[],allow_desc:2!==flexbe_cli.theme_id,price_select:!1,render:["template"],color:!0,color_custom:!this.old_style,colors:this.old_style?["blue","green","orange","purple","purple_light","rose","red","yellow"]:["#FFF","#222","#3D52B0","#FC2F58","#38A817","#E8E8E8","#E10000","#F06D28","#F6B91F","#AE7E4B","#FFF55A","#1AC687","#38BABC","#95DAF8","#2BB0D4","#794C90","#E05BA5"],styles:e,actions:["modal","pay","redirect"],btn_styles:!this.old_style&&[["bordered"],["bordered","squared"],["bordered","rounded"],["filled"],["filled","squared"],["filled","rounded"]],types:[{type:"name",name:polyglot.t("editor::form::type_name"),desc:"",is_required:0},{type:"email",name:polyglot.t("editor::form::type_email"),desc:"",is_required:1},{type:"phone",name:polyglot.t("editor::form::type_phone"),desc:"",is_required:1},{type:"text",name:polyglot.t("editor::form::type_text"),desc:"",is_required:0},{type:"textarea",name:polyglot.t("editor::form::type_textarea"),desc:"",lines:3,is_required:0},{type:"checkbox",name:polyglot.t("editor::form::type_checkbox"),is_checked:0,desc:""},{type:"select",name:polyglot.t("editor::form::type_select"),desc:"",vars:[polyglot.t("editor::form::var1"),polyglot.t("editor::form::var2")]},{type:"radio",name:polyglot.t("editor::form::type_radio"),desc:"",vars:[polyglot.t("editor::form::var1"),polyglot.t("editor::form::var2")]},{type:"file",name:polyglot.t("editor::form::type_file"),desc:"",is_required:0}],type:this.block.entity.siteBlockType?"site":"land",exclude:"modal"===this.block.is&&[this.block.id],editor:this,excludeGroup:["form","product"]};this.options=Object.assign({},t,this.options),!this.data.style&&e&&(this.data.style=[e[0]]),this.data.product&&!Array.isArray(this.data.product)||(this.data.product={})},change:function(e){this.opt.on_change(this.data,"",e||this.options.render)}};
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}flexbe.land.editor.modules.socials=function(t,o){this.$item=t,this.opt=o,this.init()},flexbe.land.editor.modules.socials.prototype={init:function(){var t=this;this._socials={vk:{name:"vk",url:"vk.com",title:polyglot.t("editor::socials::vk")},fb:{name:"fb",url:"facebook.com",title:"Facebook"},twitter:{name:"twitter",url:"twitter.com",title:"Twitter"},ok:{name:"ok",url:"ok.ru",title:polyglot.t("editor::socials::ok")},gplus:{name:"gplus",url:"plus.google.com",title:"Google+"},skype:{name:"skype",url:polyglot.t("editor::socials::skype"),title:"Skype"},instagram:{name:"instagram",url:"instagram.com",title:"Instagram"},yt:{name:"yt",url:"youtu.be",title:"YouTube"},vimeo:{name:"vimeo",url:"vimeo.com",title:"Vimeo"},snapchat:{name:"snapchat",url:"snapchat.com",title:"Snapchat"},whatsapp:{name:"whatsapp",url:"whatsapp://send?phone=79009999999",title:"Whatsapp"},telegram:{name:"telegram",url:polyglot.t("editor::socials::tg"),title:"Telegram"},periscope:{name:"periscope",url:"periscope.com",title:"Periscope"},viber:{name:"viber",url:"viber://contact?number=79001122345",title:"Viber"},behance:{name:"behance",url:"www.behance.net",title:"Behance"},dribble:{name:"dribble",url:"dribbble.com",title:"Dribbble"},p:{name:"p",url:"ru.pinterest.com",title:"Pinterest"}},1==flexbe_cli.theme_id&&["snapchat","whatsapp","telegram","periscope","viber","skype"].forEach(function(o){return delete t._socials[o]});var o={max:Object.keys(this._socials).length,colors:!1,styles:{clean:{colors:!1},rounded:{colors:!1},rounded_color:{colors:!1},rounded_color_fill:{colors:!1},squared_color_fill:{colors:!1}},render:["template"]},e=this.opt.options=$.extend({},o,this.opt.options),l=this.opt.data;Object.keys(e.styles).forEach(function(o){var l=e.styles[o];t._getStyles()[o]?(l.colors&&("object"!=_typeof(l.colors)||l.colors.length)||(l.colors=!1),!0===l.colors&&(l.colors=t.opt.options.colors)):delete e.styles[o]}),l.style&&l.style.type&&e.styles[l.style.type]||(l.style={type:Object.keys(e.styles)[0]}),this.form_setting_modal=flexbe.modal.create({id:this.$item.attr("data-id")+"_editor_socials",name:"editor_socials",click_out:"body",width:500,title:polyglot.t("editor::socials::modal_title"),item:this.opt.item,overlay:!1,riotTag:"editor-socials",riotOpts:{data:l,options:e,editor:this}})},change:function(){"function"==typeof this.opt.on_change&&this.opt.on_change(this.opt.data,null,this.opt.options.render)},_getStyles:function(){return{clean:{colors:this._colors},clean_color:{colors:!1},rounded:{colors:this._colors},rounded_color:{colors:!1},rounded_color_fill:{colors:!1},squared:{colors:this._colors},squared_color:{colors:!1},squared_color_fill:{colors:!1}}},_colors:["#000","#222","#444","#666","#888","#aaa","#ccc","#eee","#fff"],_socials:{}};
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}flexbe.land.editor.modules.menu=function(e,t){this.old_style=+flexbe.land.theme_id<=1,this.$item=e,this.o=t,this.block=t.block,this.entity=t.block.entity,this.data=t.data,this.options=t.options,this.check(),this.init()},flexbe.land.editor.modules.menu.prototype={types:{link:{type:"link",text:"",target_blank:0,url:""}},modalMoveaway:function(){var e=this,t=this.modal.$modal.find(".flexbe_modal");t.addClass("animate move-away"),t.parent().removeClass("on"),$document.on("keydown.editor_menu_anchor",function(t){if(27===t.which)return e.modalGiveback(),t.preventDefault(),t.stopImmediatePropagation(),!1})},modalGiveback:function(){var e=flexbe.view.$document.find("body"),t=this.modal.$modal.find(".flexbe_modal");e.removeClass("select-block"),t.addClass("animate").removeClass("move-away").parent().addClass("on").one("transitionend",function(){t.removeClass("animate")}),$document.off("keydown.editor_menu_anchor")},selectAnchor:function(e){var t=this;void 0===e&&(e=function(){}),this.modalMoveaway();var o=flexbe.view.$document.find("body");o.addClass("select-block"),o.find(".container-list").one("click.select_block",".b_block",function(i){o.removeClass("select-block");var a=$(i.currentTarget).attr("data-id"),n=pageStore.getEntity(a,"block"),l=n&&n.data;void 0===l._anchor&&(l._anchor="b"+a,n.change()),e("#"+l._anchor),t.modalGiveback()})},selectPage:function(e){void 0===e&&(e=function(){});var t=$("<flexbe-pages></flexbe-pages>"),o=flexbe.modal.create({name:"flexbe-page-list",type:"overlay",title:!1,$data:t});riot.mount(t[0],"flexbe-pages",{userRole:flexbe.user_role,modal:o,type:"overlay",onselect:function(t,i){if("object"==_typeof(t)&&"object"==_typeof(i)){var a=i.group_id==flexbe.land.group_id,n=flexbe.page.formatUrl(i.domain,t.uri,a);n=a?n:"http://"+n,o.close(),e(n)}}})},check:function(){var e={render:["template"],min:1,max:999,show_pages:!0,show_anchors:!0,color:!1,color_custom:!1,colors:this.old_style?["default_color","blue","green","orange","purple","purple_light","rose","red","yellow"]:["#222","#FFF","#4D69BE","#3D52B0","#2BB0D4","#95DAF8","#794C90","#E05BA5","#FC2F58","#DD4B39","#F06D28","#38A817","#1AC687","#8CC832","#AE7E4B","#F6B91F","#FFF55A"]};this.options=Object.assign({},e,this.options),this.block.entity.siteBlockType&&(this.options.isSiteBlock=!0),this.data.min_items&&delete this.data.min_items,this.data.max_items&&delete this.data.max_items,Array.isArray(this.data.list)||(this.data.list=[])},init:function(){var e=$('<div data-is="editor-menu"><div>');riot.mount(e[0],"editor-menu",{options:this.options,editor:this,data:this.data}),this.modal=flexbe.modal.create({id:this.$item.attr("data-id")+"_editor_menu",name:"editor_menu",width:550,title:polyglot.t("editor::menu::modal_title"),item:this.o.item,overlay:!1,$data:e})},change:function(e){"function"==typeof this.o.on_change&&this.o.on_change(this.data,"",e||this.options.render)}};
flexbe.land.editor.modules.button=function(t,o){this.old_style=+flexbe.land.theme_id<=1,this.$item=t,this.o=o,this.block=o.block,this.entity=o.block.entity,this.data=o.data,this.options=o.options,this.check(),this.init()},flexbe.land.editor.modules.button.prototype={check:function(){var t=this,o=this.data,i=this,e={render:["template"],allow_modal:!0,allow_cart:!1,allow_close:!1,allow_link:!0,allow_file:!0,allow_quiz:!1,show_form_product_setup:!0,show_cart_product_setup:!0,actions:["quiz","modal","cart","link","file","close"],exclude:"modal"===this.block.is&&[this.block.id],editor:this,placeholders:{img:(!o.product||!o.product.img)&&function(){var t=i.$item.closest("[data-item-id], .modal-data").find("[data-img-id]").get(0);if(t)return"/img/"+t.getAttribute("data-img-id")+"_256/"+t.getAttribute("data-img-name")}()||"",title:(!o.product||!o.product.title)&&function(){var t=i.$item.closest("[data-item-id], .modal-data").find(".name, .title, .item-title, .text_title").get(0);if(t)return t.textContent}()||polyglot.t("editor::actions::product_title"),price:(!o.product||!o.product.price)&&function(){var t=i.$item.closest("[data-item-id], .modal-data").find(".price, .item-price, .main-price").eq(0);if(t.length)return $("del, s",t).remove(),t.text()}()||"0 ₽"},btn_styles:!this.old_style&&[["bordered"],["bordered","squared"],["bordered","rounded"],["filled"],["filled","squared"],["filled","rounded"]],color:!0,color_custom:!this.old_style,colors:this.old_style?["blue","green","orange","purple","purple_light","rose","red","yellow"]:["#222","#FFF","#4D69BE","#3D52B0","#2BB0D4","#95DAF8","#794C90","#E05BA5","#FC2F58","#DD4B39","#F06D28","#38A817","#1AC687","#8CC832","#AE7E4B","#F6B91F","#FFF55A"]};this.options=Object.assign({},e,this.options),!1===this.options.colors&&(this.options.color=!1),(this.$item.length>1||!this.options.allow_cart)&&(this.options.show_form_product_setup=!1,this.options.show_cart_product_setup=!1),this.options.actions=this.options.actions.filter(function(o){var i=t.options["allow_"+o];return void 0===i&&(i=!0),i}),this.data.product&&!Array.isArray(this.data.product)||(this.data.product={})},init:function(){this.modal=flexbe.modal.create({name:"editor_button",width:500,title:this.options.is_link?polyglot.t("editor::button::modal_title_link"):polyglot.t("editor::button::modal_title"),item:this.o.item,riotTag:"editor-button",riotOpts:{editor:this,data:this.data,options:this.options,onchange:this.change.bind(this)},overlay:!1})},change:function(t){"function"==typeof this.o.on_change&&this.o.on_change(this.data,"",t||this.options.render)}},flexbe.land.editor.modules.form_btn=flexbe.land.editor.modules.button;
flexbe.land.editor.modules.map=function(t,e){this.$item=t,this.opt=e;var a=+flexbe.land.theme_id<=1,o={color_custom:!a,colors:a?["blue","green","orange","purple","rose","red","yellow"]:["#222","#3D52B0","#FC2F58","#38A817","#F06D28","#FFF55A","#2BB0D4","#794C90","#E05BA5"],providers:a?["yandex"]:["yandex","google"],styles:["default","blue","silver","dark","night","retro"],render:["template"]};this.options=Object.assign({},o,e.options),this.opt.data.type||(this.opt.data.type="yandex"),this.lastDataJSON=JSON.stringify(this.opt.data),flexbe.modal.create({click_out:"body",overlay:!1,id:this.$item.attr("data-id")+"_editor_map",name:"editor_map",width:860,title:polyglot.t("editor::map::modal_title"),$data:$("<editor-map></editor-map>")}),riot.mount("editor-map",{data:this.opt.data,options:this.options,editor:this})},flexbe.land.editor.modules.map.prototype={changeTmt:0,change:function(t){var e=this;"function"==typeof this.opt.on_change&&(clearTimeout(this.changeTmt),this.changeTmt=setTimeout(function(){var a=JSON.stringify(e.opt.data);a!==e.lastDataJSON&&(e.lastDataJSON=a,e.opt.on_change(e.opt.data,null,t||e.options.render))},1500))}};
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}flexbe.land.editor.modules.timer=function(t,e){this.$item=t,this.opt=e,this.init()},flexbe.land.editor.modules.timer.prototype={init:function(){for(var t=this,e=!0,a=[],o=(new Date).getMonth(),i=0;i<13;i++){var r=new Date;r.setMonth(o+i,1);var l=r.getMonth()+1;l<10&&(l="0"+l.toString());var d=r.getFullYear();a.push({value:l+"."+d,name:this.get_month_text(l)+" "+d}),this.opt.data.my==l+"."+d&&(e=!1)}e&&(this.opt.data.my=a[11].value,this.change());var n=$('<div class="editor_timer_wrap clear" data-show="date"></div>'),s=$('<div class="timer_type clear"><a data-type="date" class="active"><span>'+polyglot.t("editor::timer::exact_date")+'</span></a><a data-type="monthly"><span>'+polyglot.t("editor::timer::monthly")+'</span></a><a data-type="weekly"><span>'+polyglot.t("editor::timer::weekly")+'</span></a><a data-type="daily"><span>'+polyglot.t("editor::timer::deily")+"</span></a></div>");n.append(s),n.attr("data-show",this.opt.data.type),s.find('a[data-type="'+this.opt.data.type+'"]').addClass("active").siblings().removeClass("active"),s.on("click","a",function(e){$(e.currentTarget).addClass("active").siblings().removeClass("active"),t.opt.data.type=$(e.currentTarget).attr("data-type"),n.attr("data-show",t.opt.data.type),t.change()});var p=$('<div class="timer_date"></div>'),c=$('<div class="timer_date_day clear"><div class="title title_date">'+polyglot.t("editor::timer::date")+'</div><div class="title title_monthly">'+polyglot.t("editor::timer::number")+'</div><div class="title title_weekly">'+polyglot.t("editor::timer::day")+"</div></div>"),m=this.add_select({name:"month",value:this.opt.data.my,list:a,on_change:function(e){t.opt.data.my=e,t.change()}}),y=this.add_select({name:"day",value:parseInt(this.opt.data.d,10),list:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],on_change:function(e){if(e<10&&(e="0"+e.toString()),"date"===t.opt.data.type){var a=m.find("select").val();a&&(t.opt.data.my=a)}t.opt.data.d=e,t.change()}}),h=this.add_select({name:"day_of_week",value:this.opt.data.dw,list:[{value:1,name:polyglot.t("editor::timer::monday")},{value:2,name:polyglot.t("editor::timer::tuesday")},{value:3,name:polyglot.t("editor::timer::wednesday")},{value:4,name:polyglot.t("editor::timer::thursday")},{value:5,name:polyglot.t("editor::timer::friday")},{value:6,name:polyglot.t("editor::timer::saturday")},{value:7,name:polyglot.t("editor::timer::sunday")}],on_change:$.proxy(function(t){this.opt.data.dw=t,this.change()},this)});c.append(y).append(m).append('<div class="monthly_text">'+polyglot.t("editor::timer::monthly_text")+"</div>").append(h);var u=$('<div class="timer_date_time clear"><div class="title">'+polyglot.t("editor::timer::end")+"</div></div>"),v=this.add_select({name:"hour",value:this.opt.data.h.toString(),list:["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],on_change:$.proxy(function(t){this.opt.data.h=t.toString(),this.change()},this)}),g=this.add_select({name:"minute",value:this.opt.data.m.toString(),list:["00","10","20","30","40","50"],on_change:$.proxy(function(t){this.opt.data.m=t.toString(),this.change()},this)});u.append(v).append('<div class="hour_delimiter">:</div>').append(g),p.append(c).append(u).append('<div style="clear:both"></div>'),n.append(p),n.append('<p class="notice">'+polyglot.t("editor::timer::notice")+"</p>"),flexbe.modal.create({click_out:"body",overlay:!1,id:this.$item.attr("data-id")+"_editor_image",name:"editor_timer",width:500,title:polyglot.t("editor::timer::modal_title"),item:this.opt.item,$data:n})},change:function(){"function"==typeof this.opt.on_change&&this.opt.on_change(this.opt.data)},add_select:function(t){var e=$('<div class="select '+t.name+'_select"></div>'),a=$("<select></select>");return e.append(a),$.each(t.list,function(t,e){var o=$("<option></option>");"object"===_typeof(e)?o.attr("value",e.value).text(e.name):o.attr("value",e).text(e),a.append(o)}),a.val(t.value),a.on("change",$.proxy(function(){t.on_change(a.val())},this)),a.spacedSelect({top:31,left:4}),e},get_month_text:function(t){switch(t.toString()){case"01":return polyglot.t("editor::timer::january");case"02":return polyglot.t("editor::timer::jebruary");case"03":return polyglot.t("editor::timer::march");case"04":return polyglot.t("editor::timer::april");case"05":return polyglot.t("editor::timer::may");case"06":return polyglot.t("editor::timer::june");case"07":return polyglot.t("editor::timer::july");case"08":return polyglot.t("editor::timer::august");case"09":return polyglot.t("editor::timer::september");case"10":return polyglot.t("editor::timer::october");case"11":return polyglot.t("editor::timer::november");case"12":return polyglot.t("editor::timer::december");default:return""}}};
flexbe.land.editor.modules.html=function(t,i){this.$item=t,this.opt=i,Array.isArray(this.opt.data.files)||(this.opt.data.files=[]),this.init()},flexbe.land.editor.modules.html.prototype={init:function(){this.modal=flexbe.modal.create({name:"editor_html",width:800,title:"HTML",riotTag:"editor-html",riotOpts:{editor:this}})},change:function(t){this.opt.on_change(this.opt.data,"",t||this.opt.options.render)}};
flexbe.land.editor.modules.anchors=function(t,i){this.$item=t,this.o=i,this.block=i.block,this.data=i.data,this.options=i.options,this.blockList=[],this.check(),this.init()},flexbe.land.editor.modules.anchors.prototype={check:function(){var t=this;this.options=Object.assign({},{render:"full",styles:[1,2,3]},this.options),Array.isArray(this.data.list)||(this.data.list=[]),this.data.list=pageStore.blocks.map(function(i){var o=i.config,e=configStore.getEntityGroup(i.is,i.fullId);if(o.type.includes("overflow")||i.siteBlockType)return!1;var s=i.id,n=i.data._anchor,a=i.abtest&&i.abtest.variant||!1,r=t.data.list.find(function(t){return t.id==s})||{};return t.blockList.push({id:s,anchor:n,group:e,abtest:a}),{id:s,enabled:r.enabled||0,title:r.title||""}}).filter(function(t){return!!t})},init:function(){this.modal=flexbe.modal.create({name:"editor_anchors",width:500,title:polyglot.t("editor::anchor::modal_title"),item:this.o.item,overlay:!1,riotTag:"editor-anchors",riotOpts:{options:this.options,editor:this,data:this.data,blockList:this.blockList}})},change:function(t){"function"==typeof this.o.on_change&&this.o.on_change(this.data,"",t||this.options.render)}};
flexbe.land.editor.modules.media=function(t,i){this.$item=t,this.options=i.options,this.block=i.block,this.entity=i.block.entity,this.data=i.data,this.opt=i,this.check(),this.init()},flexbe.land.editor.modules.media.prototype={check:function(){var t=this.data,i={render:["template"],tabs:["image","slider","video"],no_convert:!1,allow_slider_settings:!0,show_title:!1,show_desc:!1,show_alt:!this.options.show_desc,show_sizes:!1,show_actions:!0,show_colors:!0,custom_color:!0,show_pagination:!0,colors:["#FFFFFF","#000000"],paginations:["fraction","bullets"],actions:["link","popup"],sizes:["cover","contain"],show_video_size:!1,imageHeight:this.$item.innerHeight()/this.$item.innerWidth()*100};this.$item.closest("[data-item-id]").find(".component-button")[0]&&i.actions.push("button"),this.options=Object.assign({},i,this.options),this.options.imageHeight<60?this.options.imageHeight=60:this.options.imageHeight>130&&(this.options.imageHeight=130);var e={image:{id:1000014537,name:"default.jpg",position:{x:"50%",y:"50%"},action:this.block.data.hasOwnProperty("show_big")&&!this.block.data.show_big?"none":"popup"},slider:{autoplay:0,list:[],action:this.block.data.hasOwnProperty("show_big")&&!this.block.data.show_big?"none":"popup",loop:1,color:"#FFFFFF",size:"cover",pagination:"bullets"},video:{id:189995539,link:"vimeo.com/189995539",type:"vimeo"}};if(this.options.no_convert){var o=Array.isArray(t)?"slider":t.hasOwnProperty("v_id")?"video":"image";this.options.tabs=[o],"slider"!==o&&(this.data=$.extend(e[o],this.data))}else{var s=t.type,a=t.image,d=t.video,n=t.slider;!a&&t.hasOwnProperty("id")&&(delete(a=$.extend(!0,{},t)).v_id,delete a.v_link,delete a.v_size,delete a.v_type,delete a.type),!d&&t.hasOwnProperty("v_id")&&(d=$.extend(!0,{},{id:t.v_id,type:t.v_type||t.type,size:t.v_size||t.size,link:t.v_link})),!n&&Array.isArray(t)&&(n={autoplay:0,list:$.extend(!0,[],t)}),"img"===s&&(s="image"),"vimeo"!==s&&"youtube"!==s||(s="video"),s||(s=Array.isArray(t)?"slider":t.hasOwnProperty("v_id")?"video":"image"),this.data={type:s,image:$.extend(e.image,a),slider:$.extend(e.slider,n),video:$.extend(e.video,d)},-1===this.options.tabs.indexOf(s)&&(this.data.type=this.options.tabs[0])}},init:function(){$('<div data-is="editor-media"><div>');var t=this.options.tabs,i={image:polyglot.t("editor::media::img_title"),slider:polyglot.t("editor::media::slider_title"),video:polyglot.t("editor::media::video_title")},e=1===t.length?i[t[0]]:polyglot.t("editor::media::media_title");this.modal=flexbe.modal.create({id:this.$item.attr("data-id")+"_editor_media",name:"editor_media",width:600,title:polyglot.t("editor::media::modal_title",{title:e}),item:this.opt.item||this.$item,overlay:!1,riotTag:"editor-media",riotOpts:{editor:this,data:this.data,options:this.options,onchange:this.change.bind(this)}})},debounce_change:0,change:function(t){var i=this;clearTimeout(this.debounce_change),this.debounce_change=setTimeout(function(){"function"==typeof i.opt.on_change&&i.opt.on_change(i.data,null,t||i.options.render)},200)}};
flexbe.land.editor.modules.quiz=function(t,e){this.old_style=+flexbe.land.theme_id<=1,this.$item=t,this.opt=e,this.block=e.block,this.entity=e.block.entity,this.id=e.block.id,this.data=e.data,this.lastDataJSON=JSON.stringify(this.data);var i={allowed:[],render:["template"],color:!0,color_custom:!this.old_style,colors:["#FFF","#222","#3D52B0","#FC2F58","#38A817","#E8E8E8","#E10000","#F06D28","#F6B91F","#AE7E4B","#FFF55A","#1AC687","#38BABC","#95DAF8","#2BB0D4","#794C90","#E05BA5"],actions:["modal","pay","redirect"],price_select:!0,btn_styles:[["bordered"],["bordered","squared"],["bordered","rounded"],["filled"],["filled","squared"],["filled","rounded"]],text_loader_styles:["none","step","percent"],progress_loader_styles:["none","bar","circle"],tabs:["steps","style","goals"],type:this.block.entity.siteBlockType?"site":"land",exclude:"modal"===this.block.is&&[this.block.id],editor:this,disableButtonText:!0};this.templates=[{type:"name",name:polyglot.t("editor::form::type_name"),is_required:0},{type:"email",name:polyglot.t("editor::form::type_email"),is_required:1},{type:"phone",name:polyglot.t("editor::form::type_phone"),is_required:1},{type:"text",name:polyglot.t("editor::form::type_text"),is_required:0},{type:"textarea",name:polyglot.t("editor::form::type_textarea"),lines:3,is_required:0},{type:"select",name:polyglot.t("editor::form::type_select"),vars:[{title:polyglot.t("editor::form::var1")},{title:polyglot.t("editor::form::var2")}]},{type:"checkbox",name:polyglot.t("editor::form::type_checkbox"),is_checked:0,vars:[{title:polyglot.t("editor::form::var1")},{title:polyglot.t("editor::form::var2")}]},{type:"radio",name:polyglot.t("editor::form::type_radio"),vars:[{title:polyglot.t("editor::form::var1"),checked:1},{title:polyglot.t("editor::form::var2")}]},{type:"image",name:polyglot.t("editor::form::type_image"),is_required:1,is_multiple:1,show_text:1,image_form:"quad",vars:[{title:polyglot.t("editor::quiz::img_var1"),img_id:1000023306,img_name:"img.jpg"},{title:polyglot.t("editor::quiz::img_var2"),img_id:1000023308,img_name:"img.jpg"},{title:polyglot.t("editor::quiz::img_var3"),img_id:1000023309,img_name:"img.jpg"},{title:polyglot.t("editor::quiz::img_var4"),img_id:1000023393,img_name:"img.jpg"}]},{type:"file",name:polyglot.t("editor::form::type_file"),is_required:0}],this.options=Object.assign({},i,e.options),this.check(),this.init()},flexbe.land.editor.modules.quiz.prototype={init:function(){var t=$("<editor-quiz><editor-quiz>"),e=flexbe_cli.quiz.list[this.id]&&flexbe_cli.quiz.list[this.id].current-1||0;riot.mount(t[0],"editor-quiz",{data:this.data,options:this.options,editor:this,currentStep:e}),this.modal=flexbe.modal.create({$data:t,name:"editor_quiz",title:polyglot.t("editor::quiz::modal_title"),item:this.opt.item,overlay:!1,width:680})},check:function(){var t=this.data;t.action&&!/^(?:modal_|form|done)/.test(t.action)||(t.action="modal"),t.modal_id||(t.modal_id=""),t.action_redirect||(t.action_redirect=""),t.pay||(t.pay={price:""}),t.name||(t.name=polyglot.t("editor::quiz::default_name")),t.goals||(t.goals={goal:"",goal_html:""})},templates:[],changeTmt:0,change:function(t,e){var i=this;"function"==typeof this.opt.on_change&&(clearTimeout(this.changeTmt),this.changeTmt=setTimeout(function(){i.opt.on_change(i.data,null,t||i.options.render)},e||0))}};
riot.tag2("gubert-select",'<div class="gubert-select-selected" if="{!isYielded}" onclick="{toggleShow}"> <soan>{opts.riotValue}</soan> <div class="show-more"> <svg viewbox="0 0 9 6"><path d="M4.5 6L0 1.454 1.444 0 4.5 3.09 7.556 0 9 1.454z"></path></svg> </div> </div> <div class="gubert-select-selected" if="{isYielded}" onclick="{toggleShow}"> <yield from="selected"></yield> <div class="show-more"> <svg viewbox="0 0 9 6"><path d="M4.5 6L0 1.454 1.444 0 4.5 3.09 7.556 0 9 1.454z"></path></svg> </div> </div> <div class="gubert-select-list {top:toTop}"> <ul class="scrollable-content" if="{!isYielded}" onmousewheel="{blockScroll}" ref="list"> <li each="{item in opts.list}" class="{active: opts.riotValue == item.value}" onclick="{selectItem}"></li> </ul> <ul class="scrollable-content" if="{isYielded}" onmousewheel="{blockScroll}" ref="list"> <yield from="items"></yield> </ul> </div>',"",'class="{show: show}"',function(e){var t=this,o=function(e){$(t.root).has(e.target).length||t.update({show:!1})},l=function(){var e=$(".gubert-select-list",t.root),o=document.body.offsetHeight;t.update({toTop:$(t.root).offset().top+e.outerHeight()>o})};t.isYielded=Boolean(t.__.innerHTML.trim()),t.show=e.show||!1,this.toggleShow=function(){t.update({show:!t.show})}.bind(this),this.selectItem=function(o){t.update({show:!1}),(e.onchange||function(){})(o.item)}.bind(this),this.blockScroll=function(e){var o=t.refs.list;(o.scrollTop===o.scrollHeight-o.clientHeight&&e.wheelDelta<0||0===o.scrollTop&&e.wheelDelta>0)&&e.preventDefault()}.bind(this),t.on("update",function(e){var s=$(".scrollable-content",t.root),i=$(".active",s);e&&e.hasOwnProperty("show")&&(e.show&&l(),i.length&&s.scrollTop(i.index()*i.get(0).getBoundingClientRect().height),$(window)[e.show?"on":"off"]("click",o))}),t.on("mount",l)});
riot.tag2("support-message",'<a class="avatar {message.admin_id || \'\'} " if="{message.msg_type * 1 == 2}"> </a> <a class="avatar app" if="{message.msg_type * 1 == 3}" title="{message.msg_data.app.title}" riot-style="background-image: url({message.msg_data.app.icon})" href="{message.msg_data.app.name}"></a> <div ref="text" if="{type == \'text\'}"> </div> <div class="image" if="{type == \'image\'}" onclick="{showImage}"> <img riot-src="/img/{content.id}_160.{content.extension}" draggable="false" height="{getImageHeight(content)}"> </div> <a class="file" if="{type == \'file\'}" riot-href="{content.url}" target="_blank"> <span> <svg viewbox="0 0 30 30" xmlns="http://www.w3.org/2000/svg"> <g fill="none" fill-rule="evenodd"><path d="M0 0h30v30H0z"></path><path d="M14 21V11c0-.997.496-2 1.5-2s1.5 1.005 1.5 2v10c0 2.002-1.776 3-3 3s-3-1-3-3V11c0-3.005 1.99-5 4.5-5S20 8.002 20 11.002V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path></g> </svg> </span> <span class="text">{content.name}</span> </a>',"",'class="{own: message.msg_type * 1 == 1, new: message.isNew}"',function(e){var t=this;this.message=e.data,this.type=Object.keys(this.message.msg||{text:""})[0],this.content=this.message.msg[this.type],this.showImage=function(){var e=new Image,t="/img/"+this.content.id+"."+this.content.extension,s=this.content.width>this.content.height?"width:"+this.content.width+"px":"height:"+this.content.height+"px";$("body").append('<div class="overlay-support-preview"><img src="/img/'+this.content.id+"_160."+this.content.extension+'" style="'+s+'"/></div>'),$(".overlay-support-preview").on("click",function(e){$(".overlay-support-preview").removeClass("show"),setTimeout(function(){$(e.target).remove()},150)}),setTimeout(function(){$(".overlay-support-preview").addClass("show")},25),e.onload=function(){var e=$(".overlay-support-preview img").get(0);e&&(e.src=t)},e.src=t}.bind(this),this.getImageHeight=function(e){return 160*e.height/e.width}.bind(this),this.on("mount",function(){var e=t.message.msg.text||"";"text"===t.type&&(/```[^`]*```/g.test(e)&&(e=e.replace(/```([^`]*)```/g,"<code><pre>$1</pre></code>")),1*t.message.msg_type!=3||/</g.test(e)||(e=flexbe.lib.htmlspecialchars(e,!0)),t.refs.text.innerHTML=e.replace(/[^>](\n)/g,function(e,t){return e.replace(t,"")+"<br />"}).replace(/(^|[\s\n]|<[A-Za-z]*\/?>)((?:https?|ftp):\/\/[\-A-Z0-9+\u0026\u2019@#\/%?=()~_|!:,.;]*[\-A-Z0-9+\u0026@#\/%=~()_|])/gi,"$1<a target='_blank' href='$2'>$2</a>")),t.message.isNew&&(t.message.isNew=!1,setTimeout(function(){t.update()},10))})}),riot.tag2("smile-panel",'<div class="smiles-wrapper"> <div class="scrollable"> <div each="{type in smiles}"> <span>{type.name}</span> <div class="smiles"> <div each="{smile in type.list}" onclick="{onchoose}">{smile}</div> </div> </div> </div> </div>',"","",function(e){this.onchoose=e.onchoose||function(){},this.smiles=[{name:"Смайлы и люди",list:["😄","😃","😀","😊","😉","😍","😘","😚","😗","😙","😜","😝","😛","😳","😁","😔","😌","😒","😞","😣","😢","😂","😭","😪","😥","😰","😅","😓","😩","😫","😨","😱","😠","😡","😤","😖","😆","😋","😷","😎","😴","😵","😲","😟","😦","😧","👿","😮","😬","😐","😕","😯","😏","😑","👲","👳","👮","👷","💂","👶","👦","👧","👨","👩","👴","👵","👱","👼","👸","😺","😸","😻","😽","😼","🙀","😿","😹","😾","👹","👺","🙈","🙉","🙊","💀","👽","💩","🔥","✨","🌟","💫","💥","💢","💦","💧","💤","💨","👂","👀","👃","👅","👄","👍","👎","👌","👊","✊","👋","✋","👐","👆","👇","👉","👈","🙌","🙏","👏","💪","🚶","🏃","💃","👫","👪","💏","💑","👯","🙆","🙅","💁","🙋","💆","💇","💅","👰","🙎","🙍","🙇","🎩","👑","👒","👟","👞","👡","👠","👢","👕","👔","👚","👗","🎽","👖","👘","👙","💼","👜","👝","👛","👓","🎀","🌂","💄","💛","💙","💜","💚","💔","💗","💓","💕","💖","💞","💘","💌","💋","💍","💎","👤","💬","👣"]},{name:"Животные и природа",list:["🐶","🐺","🐱","🐭","🐹","🐰","🐸","🐯","🐨","🐻","🐷","🐽","🐮","🐗","🐵","🐒","🐴","🐑","🐘","🐼","🐧","🐦","🐤","🐥","🐣","🐔","🐍","🐢","🐛","🐝","🐜","🐞","🐌","🐙","🐚","🐠","🐟","🐬","🐳","🐎","🐲","🐡","🐫","🐩","🐾","💐","🌸","🌷","🍀","🌹","🌻","🌺","🍁","🍃","🍂","🌿","🌾","🍄","🌵","🌴","🌰","🌱","🌼","🌑","🌓","🌔","🌕","🌛","🌙","🌏","🌋","🌌","🌠","⛅","⛄","🌀","🌁","🌈","🌊"]},{name:"Еда и напитки",list:["🍏","🍎","🍐","🍊","🍋","🍌","🍉","🍇","🍓","🍈","🍒","🍑","🍍","🍅","🍆","🌽","🌶","🍠","🌰","🍯","🍞","🧀","🍳","🍤","🍗","🍖","🍕","🌭","🍔","🍟","🌮","🌯","🍝","🍜","🍲","🍥","🍣","🍱","🍛","🍚","🍙","🍘","🍢","🍡","🍧","🍨","🍦","🍰","🎂","🍮","🍭","🍬","🍫","🍿","🍩","🍪","🍼","☕️","🍵","🍶","🍺","🍻","🍷","🍸","🍹","🍾","🍴","🍽"]},{name:"Активность",list:["⚽️","🏀","🏈","⚾️","🎾","🏐","🏉","🎱","🏓","🏸","🏒","🏑","🏏","⛳️","🏹","🎣","⛸","🎿","⛷","🏂","🏋️‍♀️","🏋️","⛹️‍♀️","⛹️","🏌️‍♀️","🏌️","🏄‍♀️","🏄","🏊‍♀️","🏊","🚣‍♀️","🚣","🏇","🚴‍♀️","🚴","🚵‍♀️","🚵","🎽","🏅","🎖","🏆","🏵","🎗","🎫","🎟","🎪","🎭","🎨","🎬","🎤","🎧","🎼","🎹","🎷","🎺","🎸","🎻","🎲","🎯","🎳","🎮","🎰"]},{name:"Путешествия и местности",list:["🏠","🏡","🏫","🏢","🏣","🏥","🏦","🏪","🏩","🏨","💒","⛪","🏬","🌇","🌆","🏯","🏰","⛺","🏭","🗼","🗾","🗻","🌄","🌅","🌃","🗽","🌉","🎠","🎡","⛲","🎢","🚢","⛵","🚤","🚀","💺","🚉","🚄","🚅","🚇","🚃","🚌","🚙","🚗","🚕","🚚","🚨","🚓","🚒","🚑","🚲","💈","🚏","🎫","🚥","🚧","🔰","⛽","🏮","🎰","🗿","🎪","🎭","📍","🚩"]},{name:"Предметы",list:["🎍","💝","🎎","🎒","🎓","🎏","🎆","🎇","🎐","🎑","🎃","👻","🎅","🎄","🎁","🎋","🎉","🎊","🎈","🎌","🔮","🎥","📷","📹","📼","💿","📀","💽","💾","💻","📱","📞","📟","📠","📡","📺","📻","🔊","🔔","📢","📣","⏳","⌛","⏰","⌚","🔓","🔒","🔏","🔐","🔑","🔎","💡","🔦","🔌","🔋","🔍","🛀","🚽","🔧","🔩","🔨","🚪","🚬","💣","🔫","🔪","💊","💉","💰","💴","💵","💳","💸","📲","📧","📥","📤","📩","📨","📫","📪","📮","📦","📝","📄","📃","📑","📊","📈","📉","📜","📋","📅","📆","📇","📁","📂","📌","📎","📏","📐","📕","📗","📘","📙","📓","📔","📒","📚","📖","🔖","📛","📰","🎨","🎬","🎤","🎧","🎼","🎵","🎶","🎹","🎻","🎺","🎷","🎸","👾","🎮","🃏","🎴","🀄","🎲","🎯","🏈","🏀","⚽","⚾","🎾","🎱","🎳","⛳","🏁","🏆","🎿","🏂","🏊","🏄","🎣","🍵","🍶","🍺","🍻","🍸","🍹","🍷","🍴","🍕","🍔","🍟","🍗","🍖","🍝","🍛","🍤","🍱","🍣","🍥","🍙","🍘","🍚","🍜","🍲","🍢","🍡","🍳","🍞","🍩","🍮","🍦","🍨","🍧","🎂","🍰","🍪","🍫","🍬","🍭","🍯","🍎","🍏","🍊","🍒","🍇","🍉","🍓","🍑","🍈","🍌","🍍","🍠","🍆","🍅","🌽"]}]}),riot.tag2("support-chat",'<div class="out-click" onclick="{hideChat}"></div> <div class="chat-wrapper"> <div class="header"> <div> {polyglot.t(\'editor::support::title\')}<br> <span>{polyglot.t(\'editor::support::work_time\')}</span> </div> <div class="close"> <svg viewbox="0 0 12 12" onclick="{hideChat}"> <g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"></path> <g transform="translate(1 1)" stroke="#FFF" stroke-width="2"> <path d="M10 0L0 10M0 0l10 10"></path> </g> </g> </svg> </div> </div> <div class="scrollable" ref="messages" onscroll="{loadOldMessages}"> <div each="{messages in dates}"> <div class="date"> {messages[0].time_day} </div> <support-message each="{message in messages}" data="{message}"></support-message> </div> <div class="loader own" each="{value, loader in loaders}"> <div class="progress-bar"> <svg class="progress-loader-circle" width="60" height="60" viewbox="-3 -3 38 38" style="transform: rotate(-90deg)"> <circle class="progress-loader-bg" cx="16" cy="16" r="19" fill="#6D6D6D"></circle> <circle class="current" cx="16" cy="16" r="16" stroke-dasharray="100" riot-stroke-dashoffset="{100 - value}" stroke-width="2" stroke-linecap="round"></circle> </svg> </div> <div class="cancel" onclick="{cancelUpload}"> <svg viewbox="0 0 14 14" xmlns="http://www.w3.org/2000/svg"> <g transform="translate(1 1)" stroke="#FFF" stroke-width="2" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"><path d="M12 0L0 12M0 0l12 12"></path></g> </svg> </div> </div> <div class="help offline" if="{false && (!isNotWorking && isWaitAnswer && Object.keys(dates).length)}"> {polyglot.t(\'editor::support::not_working\')} </div> <div class="help no-message" if="{!Object.keys(dates).length}"> {polyglot.t(\'editor::support::no_message\')} </div> <div class="help work-off" if="{isNotWorking}"> {polyglot.t(\'editor::support::not_working\')} </div> </div> <div class="chat {input: refs.editor && refs.editor.value.length}"> <textarea placeholder="{polyglot.t(\'editor::support::placeholder\')}" oninput="{textChange}" keydown="{keyPressed}" rows="1" ref="editor"></textarea> <div class="button smile {active: showSmiles}"> <div class="out-click" onclick="{toggleShowSmiles}"></div> <smile-panel onchoose="{insertSmile}"></smile-panel> <span onclick="{toggleShowSmiles}"> <svg viewbox="0 0 30 30" xmlns="http://www.w3.org/2000/svg"> <g fill="none" fill-rule="evenodd"><path d="M0 0h30v30H0z"></path><path d="M15 24a9 9 0 1 1 0-18 9 9 0 0 1 0 18zm0-1a8 8 0 1 0 0-16 8 8 0 0 0 0 16zm-3-9a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm6 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2z" fill="currentColor"></path><path d="M11 17c1.162 1.333 2.495 2 4 2s2.838-.667 4-2" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path></g> </svg> </span> </div> <div class="button file"> <input type="file" name="file"> <svg viewbox="0 0 30 30" xmlns="http://www.w3.org/2000/svg"> <g fill="none" fill-rule="evenodd"><path d="M0 0h30v30H0z"></path><path d="M14 21V11c0-.997.496-2 1.5-2s1.5 1.005 1.5 2v10c0 2.002-1.776 3-3 3s-3-1-3-3V11c0-3.005 1.99-5 4.5-5S20 8.002 20 11.002V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path></g> </svg> </div> <div class="button post" onclick="{sendMessage}"> <svg viewbox="0 0 30 30" xmlns="http://www.w3.org/2000/svg"> <g fill="none" fill-rule="evenodd"><path d="M0 0h30v30H0z"></path><path d="M8.268 16.114c-.14 1.265-.545 2.93-1.218 4.993a1 1 0 0 0 1.338 1.232l14.746-6.21a1 1 0 0 0 0-1.843L8.388 8.077A1 1 0 0 0 7.05 9.31c.673 2.064 1.08 3.73 1.218 4.993l9.054.906-9.054.904z" fill="#0051FF"></path></g> </svg> </div> </div> </div>',"",'class="{show: show}"',function(e){var t,s,i,o=this,n=function(e,t,s){a.socket.instance.send(JSON.stringify({id:s,from:flexbe.socketsig.usermail,event:"support_message",to:"support",msg_type:1,msg:t,socketsig:flexbe.socketsig,url:window.location.href,user_role:flexbe.user_role,msg_data:{sign:e,browser:navigator.userAgent,domain:window.location.hostname,screen:{screen:{width:window.screen.width,height:window.screen.height},window:{width:$(window).width(),height:$(window).height()}}},sign:e}))},a=e.support,l=a.socket.instance;this.dates=[],this.show=e.show,this.connect=l.readyState===l.OPEN,this.isWaitAnswer=!1,this.showSmiles=!1,this.loaders={},this.isNotWorking=!1,this.lastMessage={},this.cash={},this.loadOldMessages=function(e){var t=this;e.target.scrollTop||this.offlineRequest({last_id:i}).done(function(e){if(e.list.reverse(),e.list.forEach(function(e,s){var i=t.cash[e.time_day];i||(i=t.cash[e.time_day]=[],t.dates.unshift(i)),i.unshift(e)}),e.list.length){var s=t.refs.messages,o=s.scrollHeight-s.scrollTop;t.update(),i=e.list[e.list.length-1].id,s.scrollTop=s.scrollHeight-o}})}.bind(this),this.scrollDown=function(){var e=this.refs.messages;e.scrollTop=e.scrollHeight}.bind(this),this.requestHandler=function(e){var t=this;e.list.forEach(function(e){var s=t.cash[e.time_day];s||(s=t.cash[e.time_day]=[],t.dates.push(s)),s.push(e)}),!i&&e.list.length&&(i=e.list[0].id),this.lastMessage=e.list[e.list.length-1]||this.lastMessage||{},this.isWaitAnswer=Boolean(e.is_wait_answer),this.isNotWorking=Boolean(e.is_not_working)}.bind(this),this.offlineRequest=function(e){return void 0===e&&(e={skip_msg_id:this.lastMessage.id,start_time:this.lastMessage.time}),$.ajax({url:"/admin/support/load/",type:"POST",dataType:"json",data:e})}.bind(this),this.offlineLoad=function(){var e=this;return setInterval(function(){e.offlineRequest().done(function(t){t.list.forEach(function(e){return e.isNew=!0}),e.requestHandler(t),e.update(),t.list.length&&(e.opts.support.playNotify(),e.show&&e.opts.support.readAll()),e.scrollDown()})},1e4)}.bind(this),this.cancelUpload=function(e){var s=e.item.loader;t.spacedUpload("cancel",s),delete this.loaders[s]}.bind(this),this.toggleShowSmiles=function(){this.showSmiles=!this.showSmiles,this.showSmiles&&flexbe.stat.event("Support chat - Show smile")}.bind(this),this.insertSmile=function(e){var t=e.item.smile,s=this.refs.editor,i=s.value;s.value=i.substring(0,s.selectionStart)+t+i.substring(s.selectionStart,i.length),this.update({showSmiles:!1}),s.focus(),flexbe.stat.event("Support chat - Insert smile")}.bind(this),this.hideChat=function(){this.show=!1,this.showSmiles=!1}.bind(this),this.textChange=function(e){e.target;this.connect&&(s||a.socket.instance.send(JSON.stringify({event:"support_start_typing",socketsig:flexbe.socketsig})),clearTimeout(s),s=setTimeout(function(){a.socket.instance.send(JSON.stringify({event:"support_stop_typing",socketsig:flexbe.socketsig})),s=void 0},1e3))}.bind(this),this.keyPressed=function(e){var t=this.refs.editor,s=t.value;13!=e.keyCode||e.ctrlKey||(this.sendMessage(),e.preventDefault()),e.ctrlKey&&13==e.keyCode&&(t.value=s.substring(0,t.selectionStart)+"\n"+s.substring(t.selectionStart,s.length)),setTimeout(function(){t.style.height="auto",t.style.height=t.scrollHeight+"px"},30)}.bind(this),this.sendMessage=function(){var e=this,t=this.refs.editor,s=t.value,i=flexbe.socketsig.user_id+"_"+(new Date).getTime();s.trim().length&&($.ajax({url:"/admin/support/send/",type:"POST",dataType:"json",data:{skip_msg_id:this.lastMessage.id,start_time:this.lastMessage.time,msg_data:{url:window.location.href,sign:i},msg:s}}).done(function(t){var o=t.list[0];o&&(e.connect?(e.isWaitAnswer=Boolean(t.is_wait_answer),e.isNotWorking=Boolean(t.is_not_working),n(i,{text:flexbe.lib.htmlspecialchars(s)},o.id)):(o.isNew=!0,e.requestHandler(t),e.update(),e.scrollDown(),a.readAll()),flexbe.stat.event("Support chat - Send message"))}).fail(function(e){console.warn(e)}),t.value="",t.style.height="auto",t.style.height=t.scrollHeight+"px")}.bind(this),this.on("before-mount",function(){o.offlineRequest().done(o.requestHandler).then(function(){o.isMounted&&(o.update(),o.scrollDown())}).fail(function(e){console.warn(e)}),o.connect||(e.support.offlineInterval=o.offlineLoad())}),this.on("mount",function(){var e=this;t=flexbe.files.upload.init({url:"/admin/support/upload/",multi:!0,support:!0,type:"file",$input:$('input[type="file"]',this.root),on_start:function(){t.spacedUpload("setParam",{data:{skip_msg_id:e.lastMessage.id,start_time:e.lastMessage.time,msg_data:{sign:flexbe.socketsig.user_id+"_"+(new Date).getTime(),url:window.location.href}}})},on_select:function(t){e.loaders[t]=0,e.update(),e.scrollDown()},on_progress:function(t,s){e.loaders[t]=s,e.update()},on_complete:function(t,s,i,o){delete e.loaders[i],t&&s?e.connect?s.list.forEach(function(e){var t=flexbe.socketsig.user_id+"_"+(new Date).getTime();n(t,e.msg,e.id)}):e.requestHandler(s):alertify.error(o),e.update(),flexbe.stat.event("Support chat - Upload file")}})}),this.on("mount",this.scrollDown)});
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}riot.tag2("dropdown",'<div class="toggle-helper" onclick="{toggleList}"></div> <div class="balloon"> <div class="arrow"></div> <div class="balloon-content"> <yield></yield> </div> </div>',"",'is-show="{show}"',function(t){var o=this;this.tag=this.parent?this.parent:this,this.main=this.parent?this.parent.main?this.parent.main:this.parent:this,this.editor=this.opts.editor,this.dropdown=this.opts.dropdown,this.show=!1;var i=this.show;this.toggleList=function(t){var o=this;this.update({show:!1===t||!0===t?t:!this.show}),this.editor&&this.editor.$item?this.editor.$item.toggleClass("editor-hover",this.show):($(this.root).parent().toggleClass("focus",this.show),$(this.root).parents(".control-button, .control-group").toggleClass("focus",this.show),$(this.root).parents(".b_block").toggleClass("in-block-edit",this.show)),this.show?($(this.root).spacedClickOut(function(){o.toggleList(!1)}),this.opts.autohide&&$(this.root).off("click.autohide").on("click.autohide","a, li",function(){o.toggleList(!1)})):$(this.root).off("click.autohide")}.bind(this),this.setPosition=function(){var t=!("object"!=("undefined"==typeof flexbe_cli?"undefined":_typeof(flexbe_cli))||!$(this.root).parents(".container-list, .modal-list, .widget-list").length),o=$(".balloon",this.root),i=$(".toggle-helper",this.root),e=$(".arrow",this.root),s=t?$(this.root).closest(".control-button, .control-group, .flexbe-custom-editor-wrap").eq(0):$(this.root).parent(),n=t?flexbe_cli.resize.documentHeight:document.body.offsetHeight,h=t?flexbe_cli.resize.height:window.innerHeight,l=s.innerWidth(),r=s.offset().left,d=(s.offset().left,s.innerWidth(),i.innerWidth()),a=i.offset().left,f=i.offset().left+i.innerWidth(),c={width:o.innerWidth(),height:o.outerHeight(!0)},p=t&&n>h&&c.height+s.offset().top+s.outerHeight()>n,u=0,g=r-a,w=g-(c.width-l),b=d/2-c.width/2;if(w<0&&a+w>10)u=w;else if(a+g+c.width>f&&r+c.width<document.body.offsetWidth-10)u=g;else{var y=a+(u=b)-10,m=a+u+c.width+10;y<0?u-=y:m>document.body.offsetWidth&&(u-=m-document.body.offsetWidth)}c.left=a+u,e.css("left",a-c.left+7+"px"),o.toggleClass("top",!!p),o.css({left:u+"px",right:"auto"})}.bind(this),$(this.root).on("command",function(t){var i=t.detail;i&&i.action&&("open"==i.action?o.toggleList(!0):"close"==i.action&&o.toggleList(!1))}),this.on("open",function(){!1!==o.opts.autoposition&&o.setPosition()}),this.on("updated",function(){if(o.show!=i){i=o.show,o.trigger(o.show?"open":"close");var t=o.opts[o.show?"onopen":"onclose"];"function"==typeof t&&t()}}),this.on("mount",function(){$(o.root).addClass(o.opts.class).attr("data-module-list",o.opts.dataModuleList).attr("data-value",o.opts.dataValue)})});
riot.tag2("raw","","","",function(t){var n=this,o=function(){n.content=n.opts.content,n.root.innerHTML=n.content,n.root.removeAttribute("content")};this.on("update",function(){n.content!==n.opts.content&&o()}),this.on("mount",function(){o()})});
riot.tag2("flexbe-color-input",'<div data-is="flexbe-input" prefix="#" class="flexbe-input context before" placeholder="000000" ref="colorSelect" riot-value="{opts.riotValue.replace(\'#\', \'\')}" readonly="{show}" onclick="{selectColor}" onpaste="{setColorFromEvent}" onkeypress="{preprocessValue}" onchange="{setColorFromEvent}" onblur="{setColorFromEvent}" oninput="{clearColor}"> <span class="color-picker-inner {flexbe.lib.contrastColor(main.opts.riotValue, \'dark\', \'light\')}" riot-style="background-color: {main.opts.riotValue}"> <svg viewbox="0 0 10 10" xmlns="http://www.w3.org/2000/svg"> <g fill="none"><path d="M0 0h10v10H0z"></path><path d="M10 4V0H5L2 3V0H0v4h10zM0 5v2h4v2a1 1 0 0 0 2 0V7h4V5H0z" fill="currentColor" fill-rule="nonzero"></path></g> </svg> </span> </div> <modal-block class="color-picker color-picker-control" if="{show}" onmount="{pickerMount}" onclose="{selectColor}" bind-to="{root}"></modal-block>',"","",function(t){var e=t.update||function(){},o=function(t){if(3===(t=t.replace(/[^A-F0-9]/gi,"")).length)t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2];else if(t.length<6)return!1;return t.slice(0,6)};this.show=!1,this.setColor=function(l,r){var a=r?l:o(l),i=a&&function(t){return!(!(t=o(t))||t.length<3||t.length>6)&&/^#?([\da-f]{3}|[\da-f]{6})$/i.test(t)}(a)?"#"+a:t.riotValue;return e(i),a||(l=l.replace("#","")),l}.bind(this),this.preprocessValue=function(t){t.target.value.length>=6&&t.target.selectionEnd-t.target.selectionStart==0&&(t.preventDefault(),t.target.value=t.target.value.replace(/[^A-Fa-f0-9]/gi,""),t.target.value.length>6&&(t.target.value=t.target.value.slice(0,6)),this.setColor(t.target.value))}.bind(this),this.setColorFromEvent=function(t){this.preprocessValue(t),this.setColor(t.target.value)}.bind(this),this.clearColor=function(t){t.target.value=t.target.value.replace(/[^A-Fa-f0-9]/gi,""),this.opts.applyIfValid&&t.target.value.match(/^(?:[0-9a-f]{3}){1,2}$/i)&&this.setColor(t.target.value,!0)}.bind(this),this.pickerMount=function(o){var l=this,r=o.contentEl;$(r).colorpicker({value:t.riotValue,colorList:t.colorList,opacity:!1,show:!0,outclick:!1,input:!1,append:!1,buttons:!0,position:!1,change:function(t){e(t.value)},on_close:function(){l.update({show:!1}),t.modal&&t.modal.disabled(!1)}})}.bind(this),this.selectColor=function(t){if(t){var e=t.target;if(t.stopPropagation(),"SPAN"!==e.nodeName&&!e.classList.contains("overlay-area"))return}setTimeout(function(){$("body").find(".overlay-area").last().focus()},10),this.update({show:!this.show})}.bind(this)});
riot.tag2("flexbe-copyable",'<label for="" class="flexbe-input copyable-string"> <div data-is="flexbe-input" class="copy-source editor-error {error: opts.error}" type="{opts.type}" checked="{opts.checked}" disabled="{opts.disabled}" riot-value="{opts.riotValue}" name="{opts.name}" required="{opts.required}" placeholder="{opts.placeholder}" readonly="{opts.readonly}" pattern="{opts.pattern}" autofocus="{opts.autofocus}" min="{opts.min}" max="{opts.max}" maxlength="{opts.maxlength}" tabindex="{opts.tabindex}" prefix="{opts.prefix}"></div> <button title="{polyglot.t(\'main::copy\')}" onclick="{copyAnckhor}" class="copy-button flexbe-button style-light icon {done: done}"> <div class="icon base"> <svg> <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/_s/images/land/editor/panel.svg#copy"></use> </svg> </div> <div class="icon done"> <svg> <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/_s/images/land/editor/panel.svg#done"></use> </svg> </div> </button> </label>',"",'class="flexbe-copyable"',function(e){this.done=!1,this.prepend=this.opts.prepend||"",this.append=this.opts.append||"",this.copyAnckhor=function(e){var t=this;flexbe.lib.setToClipboard(this.prepend+this.opts.riotValue+this.append),this.doneIntrval&&clearInterval(this.doneIntrval),this.done=!0,this.doneIntrval=setInterval(function(){t.done=!1,t.update()},2e3)}.bind(this)});
riot.tag2("flexbe-dropdown",'<modal-block class="flexbe-dropdown-content" onclose="{opts.onclose}" position="initial"> <yield></yield> </modal-block>',"","",function(t){this.tag=this.parent?this.parent.tag?this.parent.tag:this.parent:this,this.main=this.parent?this.parent.main?this.parent.main:this.parent:this});
riot.tag2("flexbe-group-button",'<div class="flexbe-button {active: selected == button}" each="{button in buttons}" onclick="{select}"> <div if="{button.icon && !opts.sprite}" class="icon" data-is="raw" content="{button.icon}"></div> <svg if="{button.icon && opts.sprite}"><use riot-xlink:href="{opts.sprite}#{button.icon}"></use></svg> <span if="{button.title}">{button.title}</span> </div>',"","",function(t){var n=this;n.buttons=t.buttons,n.selected=n.buttons[0]||t.riotValue,this.select=function(i){n.selected=i.item.button,(t.onchange||function(){})(i.item.button)}.bind(this)});
riot.tag2("flexbe-input",'<virtual if="{[\'textarea\'].includes(opts.type)}"> <textarea class="flexbe-textarea">{opts.riotValue}</textarea> </virtual> <virtual if="{[\'codemirror\'].includes(opts.type)}"> <codemirror settings="{opts.settings}" riot-value="{opts.riotValue}"></codemirror> </virtual> <virtual if="{![\'textarea\', \'codemirror\'].includes(opts.type)}"> <input class="{error: opts.error}" type="{opts.type || \'text\'}" checked="{opts.checked}" disabled="{opts.disabled}" riot-value="{opts.riotValue}" name="{opts.name}" required="{opts.required}" placeholder="{opts.placeholder}" readonly="{opts.readonly}" pattern="{opts.pattern}" autofocus="{opts.autofocus}" min="{opts.min}" max="{opts.max}" maxlength="{opts.maxlength}" tabindex="{opts.tabindex}"> </virtual> <virtual if="{[\'radio\', \'checkbox\'].includes(opts.type)}"> <span class="flexbe-{opts.type}"></span> </virtual> <yield></yield> <div class="error" if="{opts.error}" style="color: red"></div>',"","",function(t){this.tag=this.parent?this.parent:this,this.main=this.parent?this.parent.main?this.parent.main:this.parent:this});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}riot.tag2("flexbe-link",'<label data-is="flexbe-input" error="{validateLink()}" class="flexbe-input" placeholder="{opts.placeholder}" name="{opts.name}" riot-value="{convertLink(opts.riotValue)}" oninput="{update}" ref="flexbeInput"></label> <span class="show-hide-links {active: show}" onclick="{showHideLinks}"> <svg class="show-hide-links-svg" width="18" height="4" viewbox="0 0 18 4" xmlns="http://www.w3.org/2000/svg"> <path transform="rotate(-90 2 2)" fill="currentcolor" fill-rule="evenodd" d="M4 2a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm0 7a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm-2 9a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"></path> </svg> <div data-is="flexbe-dropdown" class="flexbe-dropdown" if="{show}" onclose="{showHideLinks}"> <ul class="flexbe-dropdown-list"> <li class="flexbe-dropdown-item" each="{item in tag.neededLinks}" onclick="{item.action}"> <div class="icon"> <svg><use riot-xlink:href="{\'/_s/images/land/editor/actions.svg?1#\' + (item.value || \'none\')}"></use></svg> </div> {item.title} </li> </ul> </div> </span>',"","",function(e){this.tag=this,this.main=this.parent?this.parent.main?this.parent.main:this.parent:this,this.show=!1;var t=this.main.opts.editor.entity.siteBlockType,i=[{title:polyglot.t("editor::menu::site_select"),action:function(){var e=this,t=$("<flexbe-pages></flexbe-pages>"),i=flexbe.modal.create({name:"flexbe-page-list",type:"overlay",title:!1,$data:t});riot.mount(t[0],"flexbe-pages",{userRole:flexbe.user_role,modal:i,type:"overlay",onselect:function(t,o){if("object"==_typeof(t)&&"object"==_typeof(o)){var n=o.group_id==flexbe.land.group_id,a=flexbe.page.formatUrl(o.domain,t.uri,n);a=n?a:"http://"+a,i.close(),e.linkChange(a),e.focusOnLastModal()}}}),this.update({show:!this.show})}.bind(this),value:"pages"},{title:polyglot.t("editor::menu::anchor_select"),action:function(){var e=this;this.update({show:!this.show}),this.modalMoveaway();var t=flexbe.view.$document.find("body");t.addClass("select-block"),t.find(".container-list").one("click.select_block",".b_block",function(i){t.removeClass("select-block");var o=$(i.currentTarget).attr("data-id"),n=pageStore.getEntity(o,"block"),a=n&&n.data;void 0===a._anchor&&(a._anchor="b"+o,n.change()),e.linkChange("#b"+o),e.modalGiveback()})}.bind(this),value:"anchor"},{title:polyglot.t("editor::menu::modal_select"),action:function(){var e=this;flexbe.land.modal.control.showList({siteBlockType:t,preview:!0,editor:this.main.opts.editor.modal,onselect:function(i){var o=flexbe.lib.htmlspecialchars("#"+i);/^#/.test(o)&&t&&(o=location.pathname+o),e.update(),e.linkChange(o),e.focusOnLastModal()}})}.bind(this),value:"modal"}];this.neededLinks=i.filter(function(t){return e.links.includes(t.value)}),this.showHideLinks=function(){this.update({show:!this.show}),this.focusOnLastModal()}.bind(this),this.validateLink=function(){return flexbe.land.check.link(e.riotValue)}.bind(this),this.convertLink=function(e){return flexbe.lib.htmlspecialchars(e,!0).replace(new RegExp("(?<!http(?:s)?:)(\\|/)+","g"),"/")}.bind(this),this.modalMoveaway=function(){var e=this,t=this.main.opts.modal.$modal.find(".flexbe_modal");t.addClass("animate move-away"),t.parent().removeClass("on"),$document.on("keydown.editor_menu_anchor",function(t){if(27===t.which)return e.modalGiveback(),t.preventDefault(),t.stopImmediatePropagation(),!1})}.bind(this),this.modalGiveback=function(){var e=flexbe.view.$document.find("body"),t=this.main.opts.modal.$modal.find(".flexbe_modal");e.removeClass("select-block"),t.addClass("animate").removeClass("move-away").parent().addClass("on").one("transitionend",function(){t.removeClass("animate")}),$document.off("keydown.editor_menu_anchor"),this.focusOnLastModal()}.bind(this),this.linkChange=function(e){this.tag.refs.flexbeInput.root.children[0].value=e;var t=new Event("change",{bubbles:!0,cancelable:!0});this.tag.refs.flexbeInput.root.children[0].dispatchEvent(t)}.bind(this),this.focusOnLastModal=function(){setTimeout(function(){$("body").find(".overlay-area").last().focus()},100)}.bind(this)});
riot.tag2("flexbe-select",'<div class="flexbe-selected" onclick="{showList}" riot-style="{current && current.style}"> <virtual if="{!isSelectedYield}">{current.title}</virtual> <virtual if="{isSelectedYield}"><yield from="selected"></yield></virtual> <div class="show-more"> <svg width="12" height="8" viewbox="0 0 12 8"> <path transform="translate(1 1.5)" fill-rule="nonzero" d="M 5 5L 4.29289 5.70711L 5 6.41421L 5.70711 5.70711L 5 5ZM -0.707107 0.707107L 4.29289 5.70711L 5.70711 4.29289L 0.707107 -0.707107L -0.707107 0.707107ZM 5.70711 5.70711L 10.7071 0.707107L 9.29289 -0.707107L 4.29289 4.29289L 5.70711 5.70711Z"></path> </svg> </div> </div> <modal-block class="flexbe-select-content" if="{show}" list="{opts.list}" setposition="{setPosition}" onclose="{showList}"> <ul class="flexbe-select-list scrollable-content" if="{!parent.isOptionsYield}"> <li each="{option in opts.list}" class="flexbe-select-option {active: parent.parent.current.value == option.value}" onclick="{opts.onclose}" riot-style="{option.style}"> <span>{option.title}</span> </li> </ul> <ul class="flexbe-select-list scrollable-content" if="{parent.isOptionsYield}"> <yield from="options"></yield> </ul> </modal-block>',"","",function(t){function e(){if(this.isOptionsYield)return!1;this.current=function(t,e){void 0===e&&(e=[]);for(var i=0;i<e.length;i++)if(e[i].value===t)return e[i];return{title:"Не выбрано",value:null}}(t.riotValue,t.list)}this.tag=this.parent?this.parent.tag?this.parent.tag:this.parent:this,this.main=this.parent?this.parent.main?this.parent.main:this.parent:this,this.isSelectedYield=/yield to="selected"/.test(this.__.innerHTML),this.isOptionsYield=/yield to="options"/.test(this.__.innerHTML),this.show=!1,this.onChange=function(e){if(this.current=e.option,t.onchange){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];t.onchange.apply(t,[e.option].concat(s))}this.update()}.bind(this),this.setPosition=function(t){var e=t.contentEl,i=e.getBoundingClientRect(),s=this.root.getBoundingClientRect(),o=e.querySelector(".scrollable-content"),n=e.querySelector(".active"),l=document.body.offsetHeight,r={width:s.width+"px",left:s.left+"px"},a="";s.top+i.height>l?r.bottom=l-s.bottom+"px":r.top=s.top-5+"px",Object.keys(r).forEach(function(t){return a+=t+": "+r[t]+";"}),e.setAttribute("style",a),n&&(o.scrollTop=Array.prototype.indexOf.call(o.children,n)*n.offsetHeight)}.bind(this),this.showList=function(t){this.show&&t&&t.item?this.onChange(t.item):setTimeout(function(){$("body").find(".overlay-area").last().focus()},10),this.update({show:!this.show})}.bind(this),this.on("before-mount",e),this.on("update",e)});
riot.tag2("flexbe-slider",'<input type="range" autocomplete="{opts.autocomplete}" autofocus="{opts.autofocus}" disabled="{opts.disabled}" max="{opts.max}" min="{opts.min}" step="{opts.step}" riot-value="{value}" name="{opts.name}" oninput="{rangeChange}"> <label data-is="flexbe-input" if="{opts.number}" disabled="{opts.disabled}" class="flexbe-input {size-s: opts.small}" riot-value="{value}" oninput="{inputChange}" onchange="{checkMin}" max="{opts.max || 100}" min="{opts.min || 0}" suffix="{opts.suffix}" type="{\'number\'}"> </label>',"","",function(t){var e=this;e.value=t.riotValue||t.min||0,this.rangeChange=function(t){e.value=t.target.valueAsNumber}.bind(this),this.inputChange=function(a){a.target.value=e.value=Math.max(0,Math.min(t.max||100,a.target.valueAsNumber||0))}.bind(this),this.checkMin=function(a){a.target.value=e.value=Math.max(t.min||0,a.target.valueAsNumber||t.min||0)}.bind(this),e.on("updated",function(){e.value=t.riotValue||t.min||0})});
riot.tag2("ab-block-variant","<div class=\"content-container\"> <span>{polyglot.t('editor::ab_begin::text')}</span> <br> <button class=\"black\" onclick=\"{chooseVariant.bind(this, 'copy')}\">{polyglot.t('editor::ab_begin::copy_text')}</button></br> <a onclick=\"{chooseVariant.bind(this, 'new')}\">{polyglot.t('editor::ab_begin::choose_text')}</a> </div>","","",function(o){this.chooseVariant=function(t){"new"===t?flexbe.land.block.control.addBlockModal({onselect:function(n){o.onselect(t,n)}}):o.onselect(t),o.modal.close()}.bind(this)});
riot.tag2("ab-statistics",'<div if="{result.error}">{polyglot.t(\'editor::ab_stat::error\')}</div> <table cellspacing="0"> <tr class="header"> <td><svg><use riot-xlink:href="{sprite}#statistic-purple"></use></svg></td> <td>{polyglot.t(\'editor::ab_stat::visits\')}</td> <td>{polyglot.t(\'editor::ab_stat::order\')}</td> <td>{polyglot.t(\'editor::ab_stat::conversion\')}</td> <td>{polyglot.t(\'editor::ab_stat::profit\')}</td> </tr> <tr> <td>А</td> <td>{result.view.a.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ⁗ ⁗)}</td> <td>{result.lead.a}</td> <td> {result.conversion.a}</td> <td class="base">{polyglot.t(\'editor::ab_stat::based\')}</td> </tr> <tr> <td>Б</td> <td>{result.view.b.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ⁗ ⁗)}</td> <td>{result.lead.b}</td> <td>{result.conversion.b}</td> <td class="result {plus: result.profit > 0, minus: result.profit < 0}">{flexbe.land.abtest.profitToStr(result.profit)}</td> </tr> </table> <div class="accuracy" show="{false}"> {polyglot.t(\'editor::ab_stat::accuracy\')}:<span> {result.confidence || 0}%</span> <q class="tip tooltipstered" data-width="430">{result.msg}</q> </div> <div class="controls"> <div> {abTest.is_active ? polyglot.t(\'editor::ab_stat::pause\') : polyglot.t(\'editor::ab_stat::play\')} <span class="pause-play" onclick="{toggleActive}"><svg><use riot-xlink:href="{sprite}#{abTest.is_active ? \'pause-circle\' : \'play-circle\'}"></use></svg></span> </div> <div> <span class="stop" onclick="{stopTest}"><svg><use riot-xlink:href="{sprite}#stop"></use></svg></span> {polyglot.t(\'editor::ab_stat::stop\')} <div> </div>',"","",function(t){var s=this;this.abTest={};var e=mobx.autorun(function(){s.update({abTest:pageStore.abtests.getTest(t.id,t.section)})});this.on("unmount",function(){e()}),this.sprite="/_s/images/land/editor/ab_test.svg",this.stats={},this.result={confidence:0,view:{a:"-",b:"-"},lead:{a:"-",b:"-"},conversion:{a:"-",b:"-"},msg:polyglot.t("editor::ab_stat::no_data"),profit:void 0},this.toggleActive=function(){pageStore.abtests.toggleActive(this.abTest.id,this.abTest.a),this.update()}.bind(this),this.stopTest=function(){flexbe.land.abtest.stopTest(this.abTest.id,this.abTest.a),t.modal.close()}.bind(this),this.on("mount",function(){flexbe.land.abtest.getStat(s.abTest.id,s.abTest.a,function(t){var e;t&&(t&&+t.conversion.b&&+t.conversion.a&&(e=parseFloat((100*(t.conversion.b/(1*t.conversion.a+1e-4)-1)).toFixed(1)),e=isNaN(e)?0:e),s.result.profit=e,s.result.confidence=t.confidence,s.result.msg=t.msg,s.result.view=t.view,s.result.lead=t.lead,s.result.conversion.a=t.conversion.a+"%",s.result.conversion.b=t.conversion.b+"%",s.update())}),setTimeout(function(){flexbe.tip.init($(s.root))},200)})});
riot.tag2("ab-stop",'<div class="ab-stop-title"> <p>{polyglot.t(\'editor::ab_stop::stop_text\')}</p> <p>{polyglot.t(\'editor::ab_stop::choose_text\')}</p> </div> <div class="ab-stop-variant"> <button class="test-variant" onclick="{chooseBlock.bind(this, \'a\')}"> <span>{polyglot.t(\'editor::ab_stop::var_a\')}</span> <div class="value base">{polyglot.t(\'editor::ab_stop::var_base\')}</div> </button> <button class="test-variant" onclick="{chooseBlock.bind(this, \'b\')}"> <span>{polyglot.t(\'editor::ab_stop::var_b\')}</span> <div class="value {minus: (profit < 0), plus: (profit > 0)}">{flexbe.land.abtest.profitToStr(profit)}</div> </button> </div>',"","",function(t){var o=this;this.profit=t.profit,this.chooseBlock=function(o){"function"==typeof t.onselect&&t.onselect(o),t.modal.close()}.bind(this),this.on("mount",function(){flexbe.land.abtest.getStat(t.test.id,!1,function(t){var s;t&&+t.conversion.b&&+t.conversion.a&&(s=parseFloat((100*(t.conversion.b/(1*t.conversion.a+1e-4)-1)).toFixed(1)),s=isNaN(s)?0:s),o.update({profit:s})})})});
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}riot.tag2("hidden-input",'<input ref="input" type="text" disabled="{!isEdit}" riot-value="{opts.riotValue}" onclick="{lockEvent}" onfocus="{focusHandler}" oninput="{inputHandler}" onkeyup="{keyupHandler}" onblur="{blur}" onchange="{change}"> <yield></yield>',"","",function(t){var e,n=this;this.tag=this.parent?this.parent.tag?this.parent.tag:this.parent:this,this.main=this.parent?this.parent.main?this.parent.main:this.parent:this,this.isEdit=!1,this.inputValue=t.riotValue,this.inputValid="function"!=typeof t.validate||t.validate(this.inputValue);var o="boolean"!=typeof t.doneonenter||t.doneonenter,i="boolean"!=typeof t.doneonesc||t.doneonesc,u="boolean"!=typeof t.bluronenter||t.bluronenter,s="boolean"!=typeof t.changeonenter||t.changeonenter,a=!!t.autocomplete,r="boolean"!=typeof t.autocompleteStrict||t.autocompleteStrict;this.setEdit=function(e,n){var o=this;if(!e&&(!this.inputValid||a&&r&&!this.autocompleteSuggestion))return!1;if(this.update({isEdit:e}),e)$(this.refs.input).focus(),(t.onfocus||function(){})(),a&&setTimeout(function(){return o.bindAutocomplete()},100);else{a&&this.unbindAutocomplete();var i=this.autocompleteSuggestion||this.refs.input.value;(t.ondone||function(){})(i)}n&&n.stopPropagation()}.bind(this),this.blur=function(e){a&&uiStore.page.body.removeClass("overflow"),(t.onblur||function(){})(e)}.bind(this),this.change=function(e){a&&uiStore.page.body.removeClass("overflow"),(t.onchange||function(){})(e)}.bind(this),this.lockEvent=function(t){t.stopPropagation()}.bind(this),this.inputHandler=function(e){var n,o=this.refs.input.value||"",i=t.pattern;i&&"string"!==!_typeof(i)&&(n=new RegExp(i,"g"),o.match(n)&&(this.refs.input.value=o.replace(n,"")))}.bind(this),this.keyupHandler=function(n){e=n.keyCode,this.inputValue=n.target.value,this.inputValid="function"!=typeof t.validate||t.validate(this.inputValue),13===e?(s&&$(this.refs.input).change(),u&&$(this.refs.input).blur(),o&&this.setEdit(!1)):27===e?i&&this.setEdit(!1):this.autocompleteSuggestion=!1}.bind(this),this.focusHandler=function(){a&&uiStore.page.body.addClass("overflow")}.bind(this),this.bindAutocomplete=function(){var e=this;if(!a)return!1;var n=Object.assign({onSelect:function(n){e.autocompleteSuggestion=n.data,(t.onselectitem||function(){})(e,n.data),e.setEdit(!1)},onSearchComplete:function(t,e){},appendTo:this.root},t.autocomplete);$(this.refs.input).autocomplete(n),$(this.root).off("click.autocomplete").on("click.autocomplete",".autocomplete-suggestions",this.lockEvent)}.bind(this),this.unbindAutocomplete=function(){$(this.refs.input).autocomplete("hide")}.bind(this),this.on("mount",function(){t.autofocus&&n.setEdit(!0)})});
riot.tag2("title-helper",'<div class="arrow"></div> <span class="{nowrap: title.length < 25}">{title}</span>',"",'class="title-helper {show: show}"',function(t){var e,i=this;this.tag=this,this.main=this.parent?this.parent.main?this.parent.main:this.parent:this,this.title="",this.show=!1;var o=$(this.root),s=$(this.main.root),n=function(t){if(clearTimeout(e),!1!==t){var n=t.parent(),a=!!(n=n.add(n.parent()).filter(".control-group, .control-button")).length;if(a&&n.hasClass("focus"))i.update({show:!1});else{i.update({title:t.attr("data-title")});var l=$(".arrow",i.root),r=o.outerWidth(),h=s.get(0).getBoundingClientRect(),u=t.get(0).getBoundingClientRect(),p={top:u.bottom-h.top+(a?7:0),left:u.left-h.left+u.width/2-r/2};p.left<10?p.left=10:p.left+r+10>h.width&&(p.left=h.width-r-10);var c=u.left-h.left+u.width/2-p.left;i.show?(anime({targets:o[0],duration:250,easing:"easeInOutSine",left:p.left+"px",top:p.top+"px"}),anime({targets:l[0],duration:250,easing:"easeInOutSine",left:c+"px"}),e=setTimeout(function(){i.show&&i.update({show:!1})},2e3)):(o.css({left:p.left+"px",top:p.top+"px"}),l.css("left",c+"px"),e=setTimeout(function(){!i.show&&i.update({show:!0}),e=setTimeout(function(){i.show&&i.update({show:!1})},2e3)},1e3))}}else i.update({show:!1})};this.on("mount",function(){$(i.main.root).on("mouseenter.ch mouseleave.ch click.ch","[data-title]",function(t){"mouseenter"===t.type?n($(t.currentTarget)):"mouseleave"===t.type?(clearTimeout(e),e=setTimeout(function(){n(!1)},400)):"click"==t.type&&n(!1)})})});
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}riot.tag2("block-add-window",'<div class="sidebar group-list" if="{options.type == \'block\'}"> <ul class="gubert-list"> <li each="{data, gId in blockGroups}" if="{showList(data)}" data-group="{gId}" class="{gId == current_id ? \'active\':\'\'}" onclick="{selectGroup}"> <span>{polyglot.t(data.name)}</span> <svg viewbox="0 0 18 12" xmlns="http://www.w3.org/2000/svg"><path d="M0 5h14.2l-3.6-3.6L12 0l6 6-6 6-1.4-1.4L14.2 7H0z" fill-rule="evenodd"></path></svg> </li> <li if="{favorites && Object.keys(favorites).length}" data-group="fav" class="{current_id == \'fav\' ? \'active\':\'\'}" onclick="{selectGroup.bind(this, \'fav\')}"> <span>{polyglot.t(\'editor::block_add::favorites\')}</span> <svg viewbox="0 0 18 12" xmlns="http://www.w3.org/2000/svg"><path d="M0 5h14.2l-3.6-3.6L12 0l6 6-6 6-1.4-1.4L14.2 7H0z" fill-rule="evenodd"></path></svg> </li> </ul> </div> <div class="content {demo: isDemo}"> <div class="group-title fixed"> <i riot-style="background-image: url(\'/_s/images/land/theme/{themeId}/groups/blocks/{current_id}.svg\')"></i> <span if="{current_id === \'fav\'}">{polyglot.t(\'editor::block_add::favorites\')}</span> <span if="{current_id !== \'fav\'}">{polyglot.t(blockGroups[current_id].name)}</span> </div> <div class="group-list"> <div each="{data, gId in blockGroups}" if="{showList(data)}" data-group-id="{gId}" class="group-item {gId == current_id ? \'active visible\' : \'\'}"> <div class="group-title"> <i riot-style="background-image: url(\'/_s/images/land/theme/{themeId}/groups/blocks/{gId}.svg\')"></i> <span>{polyglot.t( data.name )}</span> </div> <div class="block-preview-wrap" each="{fullId, index in data.list}" data-b-id="{fullId}" onclick="{selectBlock.bind(this, fullId, options.data)}"> <div class="block-preview {label(fullId)}"> <span class="preview-title"><i></i><i></i><i></i> <div class="title"> {fullId} </div> </span> <img class="loading {data.type}" riot-src="/_s/images/land/theme/{themeId}/blocks/{String(fullId).replace(\':\', \'-\')}.jpg"> </div> </div> </div> <div if="{!isDemo && favorites && Object.keys(favorites).length}" data-group-id="fav" class="group-item {current_id == \'fav\' ? \'active visible\' : \'\'}"> <div class="group-title"> <i riot-style="background-image: url(\'/_s/images/land/theme/{themeId}/groups/blocks/fav.svg\')"></i> <span>{polyglot.t(\'editor::block_add::favorites\')}</span> </div> <div class="block-preview-wrap" each="{data, id in favorites}" if="{data.theme_id == themeId && !data.inRemove}" data-b-id="{data.bId || data.template_id || data.b_id}"> <div class="block-preview {disabled: data.onRemove}" onclick="{selectBlock.bind(this, data.bId || data.template_id || data.b_id, data, \'favorites\')}"> <span class="preview-title"> <i></i><i></i><i></i> <div class="title"> {data.bId || data.template_id || data.b_id}{data.mod_id ? \':\' + data.mod_id : \'\'} </div> <a class="remove" title="{polyglot.t(\'editor::block_add::delete\')}" onclick="{removeFavorite}" if="{!data.onRemove}"> <svg viewbox="0 0 11 12" xmlns="http://www.w3.org/2000/svg"><path d="M8.5 12c.825 0 1.5-.58 1.5-1.286V3H1v7.714C1 11.42 1.675 12 2.5 12h6zm-.667-1C8.475 11 9 10.55 9 10V3H2v7c0 .55.525 1 1.167 1h4.666zM8 0H3v1h5V0zM4 4v6H3V4h1zm2 0v6H5V4h1zm2 0v6H7V4h1zM3 1h1v1H3V1zm4 0h1v1H7V1zM0 2h11v1H0V2z" fill-rule="evenodd"></path></svg> </a> </span> <img if="{!data.img}" riot-src="/_s/images/land/theme/{themeId}/blocks/{data.bId || data.template_id || data.b_id}.jpg"> <img if="{data.img}" riot-src="/img/{data.img.img_id}_800/{data.img.img_name}"> </div> </div> </div> </div> </div>',"","",function(t){var i=this;this.control=this.opts.control,this.options=this.opts.options,this.isDemo=!window.is_editor||this.options.isDemo,this.themeId=this.options.themeId||pageStore.themeId;var e=flexbe.land.themes_json[this.themeId];this.current_id=1,this.blockGroups=e.block,this.preventUpdate=!1,this.cachedGroups={},this.favorites={};var o,a=e.labels||{},s=function(t){var e=$.extend(!0,{},t);if(i.options.type&&"block"!=i.options.type)for(var o in e){var a=e[o],s=configStore.getEntityGroup("block",a.bId||a.template_id||a.b_id),d=configStore.themeJson.block[s];d&&d.type==i.options.type||delete e[o]}return e};this.isDemo||(this.favorites=s(flexbe.land.block&&flexbe.land.block.favorites&&flexbe.land.block.favorites.stored)),this.label=function(t){var i=a[t];if(i&&!(i.hasOwnProperty("timestamp")&&Math.floor((Date.now()-Date.parse(i.timestamp))/864e5)>30))return"type-"+i.type}.bind(this),this.showList=function(t){return!t.hide&&("block"==this.options.type?!!t.list.length:t.list.length&&t.type==this.options.type)}.bind(this),this.selectGroup=function(t){var i=this,e=t&&"object"==_typeof(t)?t.item.gId:t,a=$(".content .group-list",this.root),s=a.find("[data-group-id="+e+"]")[0].offsetTop-a[0].offsetTop;this.current_id=e,this.preventUpdate=!0,a.animate({scrollTop:s},300),clearTimeout(o),o=setTimeout(function(){i.preventUpdate=!1},350),"object"!=_typeof(t)&&"fav"==t?flexbe.stat.event("Editor - Section Add - Favorites"):flexbe.stat.event("Editor - Section Add - Group filter",{group:t.item.data.name})}.bind(this),this.activeGroup=function(){if(!this.preventUpdate){var t=$(".content .group-list",this.root),i=$(".group-item",t),e=t[0].offsetTop+100,o={};if(i.each(function(t,i){var a=$(i).offset().top;a<=e&&(o.offset=a,o.id=$(i).data("groupId")),a<window.innerHeight&&$(i).addClass("visible")}),o.id&&this.current_id!=o.id&&(this.update({current_id:o.id}),window.is_editor&&!this.cachedGroups[o.id])){this.cachedGroups[o.id]=!0;var a=configStore.groups.block&&configStore.groups.block[o.id];a&&pageService.loadEntityData({block:a},0)}}}.bind(this),this.selectBlock=function(i,e,o){if(void 0===e&&(e={}),void 0===o&&(o="new"),!this.isDemo){var a=flexbe.helpers.parseId(i||e.template_id,e.mod_id);e=Object.assign(e,a),t.modal.close(),"function"==typeof this.options.onselect?this.options.onselect(e):flexbe.land.block.create({raw:e,index:this.options.index,loader:!0}),"favorites"===o?flexbe.stat.event("Editor - Section Add - Added from favorites"):flexbe.stat.event("Editor - Section Add - Added",{theme_id:this.themeId,section_id:i})}}.bind(this),this.removeFavorite=function(t){var i=this;if(t.stopPropagation(),!t.item.data.inRemove&&confirm("Удалить секцию из избранного?")){var e=t.item.id;t.item.data.inRemove=!0,this.update(),flexbe.land.block.favorites.remove(e,function(t){i.update({favorites:s(t)})}),flexbe.stat.event("Editor - Section Add - Remove from favorites")}}.bind(this),this.loadImages=function(){$("img",this.root).off("load").on("load",function(t){$(t.target).removeClass("loading")})}.bind(this),this.on("mount",function(){i.activeGroup(),i.loadImages(),i.isDemo||flexbe.land.block.favorites.loadData(function(t){i.update({favorites:s(t)}),i.loadImages()}),$(i.root).find(".group-list").off("scroll.flexbe_block_add").on("scroll.flexbe_block_add",$.throttle(function(t){i.activeGroup()},200))})});
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}riot.tag2("block-controls",'<title-helper></title-helper> <div class="navigation-buttons left" if="{main.isAllow(\'selector\')}" hide="{main.isDisabled(\'selector\')}"> <div class="control-button"> <a class="icon-type" data-command="prev" data-title="{polyglot.t(\'editor::control::prev\')}" onclick="{main.selector.bind(this, \'prev\')}"><svg><use riot-xlink:href="{sprite}#left"></use></svg></a> </div> <div class="control-button"> <a class="icon-type" data-command="next" data-title="{polyglot.t(\'editor::control::next\')}" onclick="{main.selector.bind(this, \'next\')}"><svg><use riot-xlink:href="{sprite}#right"></use></svg></a> </div> </div> <div class="abtest-buttons left" if="{main.isEnabled(\'abtest\')}"> <div class="control-button variant-a {active: (main.state.abVariant == \'a\'), paused: (!main.state.abState)}"> <a class="icon-type" data-command="variant-a" data-title="{polyglot.t(\'editor::control::abtest_var_a\')}" onclick="{main.setABVariant.bind(this, \'a\')}">А</a> </div> <div class="control-button variant-b {active: (main.state.abVariant == \'b\'), paused: (!main.state.abState)}"> <a class="icon-type" data-command="variant-b" data-title="{polyglot.t(\'editor::control::abtest_var_b\')}" onclick="{main.setABVariant.bind(this, \'b\')}">Б</a> </div> <div class="control-button ab-settings"> <a class="icon-type" data-command="ab-settings" data-title="{polyglot.t(\'editor::control::abtest_stat\')}" onclick="{main.abTestStatistic}"> <svg><use xlink:href="/_s/images/land/editor/ab_test.svg#statistic"></use></svg> </a> </div> </div> <div class="multi-buttons left" if="{main.isEnabled(\'multitext\') || main.isEnabled(\'multisection\') || main.isEnabled(\'geolanding\')}"> <div data-is="multitext" if="{main.isEnabled(\'multitext\')}" entity="{main.entity}"></div> <div data-is="multisection" if="{main.isEnabled(\'multisection\')}" entity="{main.entity}"></div> <div data-is="geolanding" if="{main.isEnabled(\'geolanding\')}" entity="{main.entity}"></div> </div> <div class="quiz-buttons left" if="{main.isAllow(\'quiz\')}"> <div class="control-button quiz-wellcome {active: !main.quizStep}"> <a class="text-type" data-command="quiz-wellcome" onclick="{main.quizSelect.bind(this, 0)}"><span>{polyglot.t(\'editor::control::quiz_start\')}</span></a> </div> <div class="control-button quiz-steps {active: main.quizStep && main.quizStep != \'done\'}"> <a class="text-type" data-command="quiz-steps" onclick="{main.quizSelect.bind(this, 1)}"><span>QUIZ</span></a> </div> <div class="control-button quiz-done {active: (main.quizStep == \'done\')}" if="{main.isAllow(\'quizDone\')}"> <a class="text-type" data-command="quiz-done" onclick="{main.quizSelect.bind(this, \'done\')}"><span>{polyglot.t(\'editor::control::quiz_finish\')}</span></a> </div> </div> <div class="control-group right"> <virtual if="{isAllow(\'single\') || isAllow(\'header\')}"> <span class="icon-type" data-command="single" data-title="{main.state.blockType == \'footer\' ? polyglot.t(\'editor::control::site::footer_settings\') : polyglot.t(\'editor::control::site::header_settings\')}"> <svg if="{main.state.blockType != \'footer\'}"><use riot-xlink:href="{sprite}#header"></use></svg> <svg if="{main.state.blockType == \'footer\'}"><use riot-xlink:href="{sprite}#footer"></use></svg> <dropdown class="menu-list" onopen="{updateHeaderInfo}"> <label class="balloon-title" if="{main.state.blockType != \'footer\'}">{polyglot.t(\'editor::control::site::header_settings\')}</label> <label class="balloon-title" if="{main.state.blockType == \'footer\'}">{polyglot.t(\'editor::control::site::footer_settings\')}</label> <hr> <div class="items-container"> <a class="active-item" data-command="replace-header" onclick="{main.replaceBlock.bind(this, \'single\')}"> <svg><use riot-xlink:href="{main.sprite}#header_replace"></use></svg> <span>{polyglot.t(\'editor::control::site::replace\')}</span> </a> <a class="active-item" data-command="header-settings" data-disabled="{main.isDisabled(\'singleSettings\')}" if="{main.isAllow(\'singleSettings\')}" onclick="{main.blockSettings.bind(this, \'single\')}"> <svg><use riot-xlink:href="{main.sprite}#header_settings"></use></svg> <span>{polyglot.t(\'editor::control::site::settings\')}</span> </a> <a class="active-item" data-command="hide-header" class="{active: main.state.headerHide}" data-disabled="{main.isDisabled(\'singleHide\')}" if="{main.isAllow(\'singleHide\')}" onclick="{main.hideBlock.bind(this, \'single\')}"> <svg><use riot-xlink:href="{main.sprite}#{main.state.headerHide ? \'hide-on\' : \'hide\'}"></use></svg> <span if="{!main.state.headerHide}">{polyglot.t(\'editor::control::site::hide\')}</span> <span if="{main.state.headerHide}">{polyglot.t(\'editor::control::site::show\')}</span> </a> </div> </dropdown> </span> </virtual> <virtual if="{isAllow(\'main\')}"> <span class="icon-type" data-command="settings" data-title="{polyglot.t(\'editor::control::settings\')}" if="{main.isAllow(\'settings\')}" onclick="{blockSettings.bind(this, \'main\')}"><svg><use riot-xlink:href="{sprite}#settings"></use></svg></span> <div class="move-holder" if="{main.isAllow(\'move\')}"> <a data-command="move-up" data-title="{polyglot.t(\'editor::control::move_up\')}" onclick="{moveBlock.bind(this, \'up\')}"><svg><use riot-xlink:href="{sprite}#move-up"></use></svg></a> <a data-command="move-down" data-title="{polyglot.t(\'editor::control::move_down\')}" onclick="{moveBlock.bind(this, \'down\')}"><svg><use riot-xlink:href="{sprite}#move-down"></use></svg></a> </div> <span class="icon-type" data-command="more" data-title="{polyglot.t(\'editor::control::options\')}" if="{main.isAllow(\'more\')}"> <svg><use riot-xlink:href="{sprite}#more"></use></svg> <dropdown class="menu-list"> <div class="buttons-bar"> <a data-command="favorites" data-title="{main.state.inFavorites ? polyglot.t(\'editor::control::favorites_update\') : polyglot.t(\'editor::control::favorites_add\')}" if="{main.isAllow(\'favorites\')}" onclick="{main.addToFavorites}" class="{active: main.state.inFavorites}"><svg><use riot-xlink:href="{main.sprite}#favorites"></use></svg></a> <a data-command="copy" data-title="{polyglot.t(\'editor::control::copy\')}" if="{main.isAllow(\'copy\')}" onclick="{main.copyBlock}"><svg><use riot-xlink:href="{main.sprite}#copy"></use></svg></a> <a data-command="replace" data-title="{polyglot.t(\'editor::control::replace\')}" if="{main.isAllow(\'replace\')}" onclick="{main.replaceBlock.bind(this, \'main\')}"><svg><use riot-xlink:href="{main.sprite}#replace"></use></svg></a> <a data-command="hide" data-title="{polyglot.t(\'editor::control::hide\')}" if="{main.isAllow(\'hide\')}" onclick="{main.hideBlock.bind(this, \'main\')}"><svg><use riot-xlink:href="{main.sprite}#{main.state.blockHide ? \'hide-on\' : \'hide\'}"></use></svg></a> <a data-command="remove" data-title="{polyglot.t(\'editor::control::delete\')}" if="{main.isAllow(\'remove\')}" onclick="{main.removeBlock}"><svg><use riot-xlink:href="{main.sprite}#delete"></use></svg></a> </div> <hr> <div class="items-container"> <a class="switch-item" if="{main.isAllow(\'abtest\')}" onclick="{main.toggleABTest}" data-disabled="{main.isDisabled(\'abtest\')}"> <div class="switch {on: main.isEnabled(\'abtest\')}"></div> <span>{polyglot.t(\'editor::control::abtest\')}</span> </a> <a class="switch-item" if="{main.isAllow(\'multisection\')}" onclick="{main.toggleMultisection}" data-disabled="{main.isDisabled(\'multisection\')}"> <div class="switch {on: main.isEnabled(\'multisection\')}"></div> <span>{polyglot.t(\'editor::control::multilanding\')}</span> </a> <a class="switch-item" if="{main.isAllow(\'multitext\')}" onclick="{main.toggleMultitext}" data-disabled="{main.isDisabled(\'multitext\')}"> <div class="switch {on: main.isEnabled(\'multitext\')}"></div> <span>{polyglot.t(\'editor::control::multitext\')}</span> </a> <a class="switch-item" if="{main.isAllow(\'geolanding\')}" onclick="{main.toggleGeolanding}" data-disabled="{main.isDisabled(\'geolanding\')}"> <div class="switch {on: main.isEnabled(\'geolanding\')}"></div> <span>{polyglot.t(\'editor::control::geolanding\')}</span> </a> </div> </dropdown> </span> </virtual> </div>',"","",function(t){var e=this,i=this,a=t.id,n=pageStore.getEntity(a);if(!n)return!1;var o=n.config,s=n.$area;this.tag=this,this.main=i,this.entity=n,i.headerEntity=!1,this.sprite="/_s/images/land/editor/block_controls.svg?6",this.allow={get selector(){return"land"===i.state.mode},get header(){return o&&o.type.includes("allow_head")},get single(){return"site"===i.state.mode},get main(){return"land"===i.state.mode},get singleSettings(){},get singleHide(){return"land"===i.state.mode&&i.headerEntity&&!i.headerEntity.siteBlockType},get hide(){},get copy(){},get replace(){return"a"!==i.state.abVariant},get remove(){},get favorites(){},get more(){return!0},get move(){return!0},get settings(){return!(!o||!o.vars_settings)},get abtest(){},get multitext(){},get multilanding(){},get geolanding(){},get quiz(){return o.type.includes("quiz")&&s.find(".component-quiz").length},get quizDone(){return o.type.includes("quiz")&&s.find('[data-quiz-part="done"]').length}};var l=mobx.autorun(function(){var t=n.siteBlockType,e=!t&&o&&o.type.includes("allow_head"),a=t||e&&"block_header"||"block",s=t?"site":"land",l=n.header;n.utime,l&&l.utime;i.headerEntity=l,i.state={mode:s,blockType:a,blockHide:n.hidden,headerHide:l&&l.hidden,abVariant:n.abtest&&n.abtest.variant||!1,abState:n.abtest&&n.abtest.active,get inFavorites(){return flexbe.land.block.favorites.check(n.id)}},i.update()}),d=function(){var t=new CustomEvent("command",{detail:{action:"close"}});$("dropdown",e.root).each(function(e,i){i.dispatchEvent(t)})};this.isAllow=function(t){return void 0===this.allow[t]||this.allow[t]}.bind(this),this.isEnabled=function(t){return!!this.isAllow(t)&&("abtest"==t?n.abtest&&n.abtest.variant:!!["multisection","multitext","geolanding"].includes(t)&&(n[t]&&n[t].enabled))}.bind(this),this.isDisabled=function(t){return"singleSettings"===t?!i.headerEntity&&"land"===i.state.mode:"singleHide"===t?"site"===i.state.mode||!i.headerEntity||n.hidden:["abtest","multisection","multitext","geolanding"].some(function(e){return e!==t&&("abtest"==e?n.abtest&&n.abtest.variant:n[e]&&n[e].enabled)})}.bind(this),this.quizSelect=function(t){flexbe_cli.events.emit("quiz_command",{command:"step",id:n.id,step:t})}.bind(this),this.toggleMultisection=function(){flexbe.land.block.control.toggleMultisection(n.id)}.bind(this),this.toggleGeolanding=function(){flexbe.land.block.control.toggleGeolanding(n.id)}.bind(this),this.toggleMultitext=function(){flexbe.land.block.control.toggleMultitext(n.id,function(t){t&&i.tags.multitext&&i.tags.multitext.multitextEditor()})}.bind(this),this.toggleABTest=function(){var t=n.abtest&&n.abtest.id||!1,e=n.id;flexbe.land.abtest.toggleTest(t,e)}.bind(this),this.setABVariant=function(t){void 0===t&&(t="a");var e=n.abtest&&n.abtest.id,i=n.id;pageStore.abtests.toggleCurrent(e,i,t)}.bind(this),this.abTestStatistic=function(){var t=n.abtest&&n.abtest.id,e=n.id;flexbe.land.abtest.showStatistic(t,e)}.bind(this),this.selector=function(t){d(),flexbe.land.block.selector(n.id,t),flexbe.stat.event("Editor - Section - Variant change",{direction:t})}.bind(this),this.moveBlock=function(t){d(),flexbe.land.block.move(n.id,t),flexbe.stat.event("Editor - Section - Move",{direction:t})}.bind(this),this.removeBlock=function(t){void 0===t&&(t="main"),d(),flexbe.land.block.remove(n.id),flexbe.stat.event("Editor - Section - Remove")}.bind(this),this.copyBlock=function(){d(),flexbe.land.block.copy({entity:n}),flexbe.stat.event("Editor - Section - Copy")}.bind(this),this.replaceBlock=function(t){void 0===t&&(t="main");var e=i.state.blockType,a="block_header"===e&&"single"===t,o=a?"header":"block_header"===e?"block":e,s=a&&i.headerEntity||n;flexbe.land.block.control.addBlockModal({onselect:function(t){t=Object.assign(t,{hidden:n.hidden}),!a||i.headerEntity?flexbe.land.block.replace({entity:s,raw:t}):flexbe.land.block.create({raw:t,index:n.index,force:!0,loader:!0,scroll:!1})},type:o})}.bind(this),this.addToFavorites=function(){flexbe.land.block.favorites.add(n.id),flexbe.stat.event("Editor - Section - Add to favorites")}.bind(this),this.hideBlock=function(t){void 0===t&&(t="main");var e=i.state.blockType,a="block_header"===e&&"single"===t&&i.headerEntity?i.headerEntity.id:n.id;flexbe.land.block.hide(a),flexbe.stat.event("Editor - Section - Hide",{source:t,mode:e})}.bind(this),this.blockSettings=function(t){void 0===t&&(t="main");var e=i.state.blockType;"block_header"===e&&"single"===t&&i.headerEntity?flexbe.land.editor.bindEditor(i.headerEntity.id,"settings"):flexbe.land.editor.bindEditor(n.id,"settings"),flexbe.stat.event("Editor - Section - Settings",{mode:e,source:t})}.bind(this),this.on("mount",function(){$(".control-group",e.root).on("mouseenter mouseleave",function(t){$(t.currentTarget).hasClass("is-more")||("mouseenter"==t.type?uiStore.page.state.pushState("hover-block-control"):uiStore.page.state.removeState("hover-block-control"))}),flexbe_cli.events.off("quiz_event.controls."+n.id).on("quiz_event.controls."+n.id,function(t,i){"object"==_typeof(i)&&i.quiz.id==n.id&&"to_step"==i.event&&e.update({quizStep:i.quiz.current})})}),this.on("unmount",function(){l(),flexbe_cli.events.off("quiz_event.controls."+n.id)})});
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}riot.tag2("modal-add-window-item",'<div main-action="{!group.user}" class="gubert-card" onmouseenter="{cardHover}" onmouseleave="{cardHover}" onclick="{cardClick}"> <div class="modal-title" if="{group.user}"> <div class="text"> <span class="hash" data-title="{polyglot.t(\'editor::modal_add::hash\')}">#</span> <input class="anchor" type="text" placeholder="{modal.id + (modal.multivar ? (\' (\' + modal.multivar + \')\') : \'\')}" riot-value="{modal.data ? modal.data._anchor : \'\'}" disabled="{main.isPreview}" oninput="{main.setAnchor.bind(main, modal)}" onchange="{main.setAnchor.bind(main, modal)}"> </div> <div class="modal-beidge {used: modal.entries}" data-title="{modal.entries ? polyglot.t(\'editor::modal_add::uses\') : polyglot.t(\'editor::modal_add::unuses\')}"> <span class="entries">{modal.entries || 0}</span> </div> </div> <div main-action class="modal-preview {disabled: (group.user && !modal.entries && !modal.siteBlockType)}"> <div class="preview-image" riot-style="background-image: url(/_s/images/land/theme/{main.themeId}/modals/{modal.fullId}.jpg)"></div> <div class="preview-image" if="{main.getModalPreview(modal, group)}" riot-style="background-image: url({main.getModalPreview(modal, group)})"></div> </div> <div class="modal-data"> <div class="modal-desc" if="{(main.isPreview || !group.user) && tag.descriptions[modal.fullId]}"> <span>{polyglot.t(tag.descriptions[modal.fullId])}</span> </div> <div class="modal-control" if="{group.user}"> <virtual if="{!main.isPreview}"> <a main-action class="gubert-link-button">{polyglot.t(\'editor::modal_add::edit\')}</a> <a class="gubert-link-button" onclick="{main.modalCopy.bind(main, modal)}">{polyglot.t(\'editor::modal_add::copy\')}</a> <a class="gubert-icon-button remove" onclick="{main.modalDelete.bind(main, modal)}" data-title="{polyglot.t(\'editor::modal_add::delete\')}"> <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" riot-xlink:href="{main.spriteCore}#deleteFill"></use></svg> </a> </virtual> <virtual if="{main.isPreview}"> <a main-action if="{tag.isCurrent}" class="gubert-button blue filled {hover: false && inHover}"> <span>{polyglot.t(\'editor::modal_add::selected\')}</span> </a> <a main-action if="{!tag.isCurrent && tag.isRelativeGroup}" class="gubert-button blue fill {hover: false && inHover}"> <span>{polyglot.t(\'editor::modal_add::select\')}</span> </a> <a sub-action class="gubert-button blue fade"> <span>{polyglot.t(\'editor::modal_add::copy\')}</span> </a> </virtual> </div> <div class="modal-control" if="{!group.user}"> <a main-action class="gubert-button blue fill {hover: inHover}"> <span if="{!main.isPreview}">{polyglot.t(\'editor::modal_add::create\')}</span> <span if="{main.isPreview}">{polyglot.t(\'editor::modal_add::select\')}</span> </a> </div> </div> </div>',"",'class="modal-preview-wrap {current: (tag.isCurrent && group.user)}" data-id="{modal.id}" data-m-id="{modal.fullId}"',function(t){this.tag=this,this.main=this.parent?this.parent.main?this.parent.main:this.parent:this;var e=this.main,i=configStore.themeJson;this.inHover=!1,this.modal=t.modal,this.group=t.group,this.descriptions=i&&i.description&&i.description.modal||{},this.isRelativeGroup=e.options.siteBlockType?"user_site"==this.opts.group.gId:"user_land"==this.opts.group.gId,this.isCurrent=e.options.currentId==this.modal.id,this.cardHover=function(t){this.update({inHover:"mouseenter"==t.type})}.bind(this),this.cardClick=function(t){$(t.target).is("[main-action]")||$(t.target).parent().is("[main-action]")?e.modalSelect(this.modal,this.group,"main"):($(t.target).is("[sub-action]")||$(t.target).parent().is("[sub-action]"))&&e.modalSelect(this.modal,this.group,"sub")}.bind(this)}),riot.tag2("modal-add-window-group",'<div class="group-title"> <i riot-style="background-image: url(\'/_s/images/land/theme/{main.themeId}/groups/modals/{opts.group.gId}.svg\')"></i> <span>{polyglot.t(opts.group.name)}</span> </div> <div data-is="modal-add-window-item" each="{modal in opts.group.list}" group="{parent.group}" modal="{modal}"></div>',"","class=\"group-item {(opts.groupId == main.currentGroup.gId) ? 'active visible' : ''}\"",function(t){this.tag=this,this.main=this.parent?this.parent.main?this.parent.main:this.parent:this,this.group=t.group}),riot.tag2("modal-add-window",'<div class="sidebar group-list"> <ul class="gubert-list" if="{list.length}"> <li each="{group, index in list}" class="{active: (group.gId == parent.currentGroup.gId)}" onclick="{selectGroup.bind(this, group.gId)}"> <span>{polyglot.t(group.name)}</span> <svg viewbox="0 0 18 12" xmlns="http://www.w3.org/2000/svg"><path d="M0 5h14.2l-3.6-3.6L12 0l6 6-6 6-1.4-1.4L14.2 7H0z" fill-rule="evenodd"></path></svg> </li> </ul> </div> <div class="content" if="{list.length}"> <div class="group-title fixed" if="{currentGroup && currentGroup.gId}"> <i riot-style="background-image: url(\'/_s/images/land/theme/{themeId}/groups/modals/{currentGroup.gId}.svg\')"></i> <span>{polyglot.t(currentGroup.name)}</span> </div> <div class="group-list" ref="groups"> <div data-is="modal-add-window-group" each="{group, index in list}" group="{group}" group-index="{index}" group-id="{group.gId}"></div> </div> </div>',"","",function(t){var e=this;this.tag=this,this.main=this.parent?this.parent.main?this.parent.main:this.parent:this,this.control=this.opts.control,this.modal=this.opts.modal,this.options=t.options||{},this.isPreview=this.options.preview||!1,this.isPreview?flexbe.stat.event("Editor - Modals - Show list to select"):flexbe.stat.event("Editor - Modals - Show list"),this.spriteCore="/_s/images/land/editor/core.svg",this.themeId=flexbe.land.theme_id,this.currentGroup={},this.list=[],this.shots=this.control.shots||{},this.cachedGroups={},this.init=!1;var i,o,a=function(t,e){return e?"modal_g"+groupStore.groupId+"_"+t:"modal_p"+pageStore.pId+"_"+t},s=function(t){var i=t.id,o=$(e.refs.groups),a=$('[data-id="'+i+'"]',o);if(!i||!a.length)return!1;var s=a[0].offsetTop-70;o.animate({scrollTop:s},450),setTimeout(function(){var t=$('[data-id="'+i+'"]',o);anime({targets:t.find(".modal-preview").get(0),direction:"alternate",opacity:[1,.6],background:["#2C2729","#ffffff"],loop:4,duration:550,delay:50,easing:"easeOutQuad"})},380)},n=function(t){var i=t.gId,o=e.list.find(function(t){return t.gId==i})||{};if(e.update({currentGroup:o}),!e.cachedGroups[i]){e.cachedGroups[i]=!0;var a=configStore.groups.modal&&configStore.groups.modal[i];a&&pageService.loadEntityData({modal:a},0)}};this.updateList=function(){var t=this,i=function(){var t=configStore.themeJson.modal||{},i=pageStore.modals.map(function(e){var i=e.id,o=e.templateId,a=e.modId,s=e.fullId,n=e.data,r=e.multivar,d=e.siteBlockType,l=e.$area,u=configStore.getEntityGroup("modal",s);return{id:i,templateId:o,modId:a,fullId:s,data:n,multivar:r,siteBlockType:d,$area:l,type:!!t[u]&&t[u].type,entries:flexbe.land.modal.check.isRequiredBy(i).length}});if(i=i.filter(function(t){return"pay"!==t.id}),Array.isArray(e.options.exclude)&&(i=i.filter(function(t){return!e.options.exclude.includes(t.id)})),Array.isArray(e.options.excludeGroup)&&(i=i.filter(function(t){return!e.options.excludeGroup.includes(t.type)})),e.isPreview){var o={};i=i.filter(function(t){return!o[t.id]&&(o[t.id]=!0,!0)})}return{land:i.filter(function(t){return!t.siteBlockType}),site:i.filter(function(t){return t.siteBlockType})}}(),o=configStore.themeJson.modal||{},a=Object.keys(o).map(function(t){var e=o[t].type,i=o[t].name,a=o[t].list.map(function(e){var i=flexbe.helpers.parseId(e);return{templateId:i.templateId,modId:i.modId,fullId:i.fullId,type:t,new:1}});return{gId:t,type:e,name:i,list:a}});Array.isArray(this.options.excludeGroup)&&(a=a.filter(function(e){return!t.options.excludeGroup.includes(e.type)})),i.site.length&&(a=[{user:!0,gId:"user_site",name:"editor::modal_add::project_windows",list:i.site}].concat(a)),i.land.length&&(a=[{user:!0,gId:"user_land",name:"editor::modal_add::page_windows",list:i.land}].concat(a)),this.update({init:!0,list:a})}.bind(this),this.setAnchor=function(t,e){var i=flexbe.regex.clean_page_uri(e.target.value,!1,!0);t&&"object"==_typeof(t.data)&&(t.data._anchor=i,"change"===e.type&&(e.target.value=i),flexbe.stat.event("Editor - Modals - Edit anchor"))}.bind(this),this.modalSelect=function(t,e,i){var o=this;void 0===i&&(i="main");var a=!!this.options.siteBlockType&&"modal",n=function(t,e){return void 0===e&&(e="new"),flexbe.stat.event("Editor - Modals - Create "+e,{is_preview:!!o.isPreview}),flexbe.land.modal.create(t)},r=function(t){var e=t.id;flexbe.stat.event("Editor - Modals - Select"),"function"==typeof o.options.onselect&&o.options.onselect(e),o.modal.close()},d=function(t,e){void 0===e&&(e=function(){}),flexbe.stat.event("Editor - Modals - Preview for create",{is_preview:!!o.isPreview}),function(t,e){void 0===t&&(t={}),void 0===e&&(e=function(){});var i="/?is_view=1&service=1&css=1&p_id="+flexbe_cli.p_id+"&b_id=0&w_id=0",o=t.id||"flexbe10000",a=JSON.stringify({modals:[{id:o,m_id:t.templateId,data:t.data||{}}]});e(i+="&m_id="+o+"&p_data="+encodeURIComponent(a))}(t,function(t){var i=flexbe.modal.create({name:"template-preview",type:"overlay",riotTag:"template-preview",riotOpts:{url:t,control:o,createText:o.isPreview?polyglot.t("editor::modal_add::select"):polyglot.t("editor::modal_add::create"),onselect:function(){e(),setTimeout(function(){i.close()},80)}}})})};if(this.isPreview)if(e.user)if("main"==i)r(t);else{var l={templateId:t.fullId,data:t.data,siteBlockType:a};n(l,"copy").then(r)}else d(t,function(){var e={templateId:t.fullId,data:{},siteBlockType:a};n(e,"new").then(r)});else e.user?(flexbe.land.modal.control.open(t.id,this.modal,{multivar:t.multivar}),flexbe.stat.event("Editor - Modals - Edit")):d(t,function(){var e={templateId:t.fullId,data:{},siteBlockType:a};n(e,"new").then(s)})}.bind(this),this.modalDelete=function(t){t.entries&&!confirm(polyglot.t("editor::modal_add::delete_text"))||(flexbe.land.modal.remove(t.id),this.updateList()),flexbe.stat.event("Editor - Modals - Delete")}.bind(this),this.modalCopy=function(t){var e=this,i=void 0===t?{}:t,o=i.id,n=i.siteBlockType;flexbe.land.modal.copy(o).then(function(t){if(!t)return console.warn("Can't copy modal window: not enough data",o,t),!1;var i=a(o,n),r=a(t.id,t.siteBlockType),d=e.shots[i];d&&(e.shots[r]=d,e.update()),s(t),flexbe.stat.event("Editor - Modals - Copy")})}.bind(this),this.getModalPreview=function(t,e){var i=!!e.user&&a(t.id,t.siteBlockType),o=i&&this.shots[i];return o&&"/img/"+o.img_id+".jpg"||!1}.bind(this),this.selectGroup=function(t){var e=this,o=$(this.refs.groups),a=o.find("[group-id="+t+"]");if(!a.length)return!1;clearTimeout(i),this.preventUpdate=!0,i=setTimeout(function(){e.preventUpdate=!1},320);var s=a[0].offsetTop;o.animate({scrollTop:s},300),n({gId:t}),flexbe.stat.event("Editor - Modals - Group filter")}.bind(this),this.activeGroup=function(){if(!this.preventUpdate){var t,e=$(this.refs.groups),i=$(".group-item",e),o=e[0].offsetTop+100;i.each(function(e,i){var a=$(i).offset().top;a<=o&&(a,t=i.getAttribute("group-id")),a<window.innerHeight&&$(i).addClass("visible")}),this.currentGroup.gId!=t&&n({gId:t})}}.bind(this),this.on("mount",function(){if(o=mobx.autorun(e.updateList.bind(e)),e.activeGroup(),e.control.loadScreenshots(function(t,i){!t&&e.isMounted&&e.update({shots:i})}),$(e.refs.groups).off("scroll.flexbe_block_add").on("scroll.flexbe_block_add",$.throttle(function(t){e.activeGroup()},200)),e.options.currentId)s({id:e.options.currentId});else{var t=e.options.siteBlockType?"user_site":"user_land";n({gId:t})}}),this.on("unmount",function(){o&&o()})});
riot.tag2("modal-controls",'<div class="modal-controls right"> <div class="control-button" if="{isAllow(\'settings\')}"> <a class="text-type" data-command="settings" onclick="{modalSettings}"> <svg><use riot-xlink:href="{sprite}#settings"></use></svg> <span>Настроить</span> </a> </div> <div class="control-button" if="{isAllow(\'cancel\')}"> <a class="text-type" data-command="modal-cancel" onclick="{modalCancel}"><span>Назад к списку</span></a> </div> <div class="control-button active"> <a class="text-type" data-command="modal-done" onclick="{modalDone}"> <span>Готово</span> </a> </div> </div>',"","",function(t){this.main=this,this.tag=this,this.$modal=t.$modal,this._object=t._object,this.sprite="/_s/images/land/editor/block_controls.svg?5",this.options=t.options||{},this.isAllow=function(t){return void 0===this.opts.allow[t]||this.opts.allow[t]}.bind(this),this.modalSettings=function(){flexbe.land.editor.bindEditor(this._object.id,"settings"),flexbe.stat.event("Editor - Modals - Edit - Settings")}.bind(this),this.modalCancel=function(){t.control.close(this._object.id),"function"==typeof this.options.cancel&&this.options.cancel(),flexbe.stat.event("Editor - Modals - Edit - Cancel")}.bind(this),this.modalDone=function(){t.control.close(this._object.id),"function"==typeof this.options.done&&this.options.done(),flexbe.stat.event("Editor - Modals - Edit - Done")}.bind(this)});
riot.tag2("element-add-window-item-preview",'<div ref="image" class="image {loading: !imageLoaded}" riot-style="{getStyle()}"> </div>',"",'onclick="{selectItem}" onmouseenter="{preloadItem}"',function(e){this.tag=this,this.main=this.parent?this.parent.main||this.parent:this,this.imageLoaded=!1,this.imageSrc="/_s/images/land/theme/"+pageStore.themeId+"/elements/"+String(e.elementId).replace(":","-")+".jpg",this.selectItem=function(){var t={fullId:e.elementId};e.onselect(t)}.bind(this),this.getStyle=function(){return this.imageLoaded?"background-image: url("+this.imageSrc+")":"opacity: 0"}.bind(this),this.loadImage=function(){var e=this,t=new Image;t.onload=function(){e.update({imageLoaded:!0})},t.src=this.imageSrc}.bind(this),this.preloadItem=function(){pageService.loadEntityData({element:[e.elementId]},50)}.bind(this),this.on("before-mount",this.loadImage)}),riot.tag2("element-add-window",'<div class="group-list" ref="list"> <div class="group-item" if="{main.list.length}" each="{group in main.list}" group-id="{group.id}"> <div class="preview-wrap" each="{elementId in group.list}"> <div class="preview" data-is="element-add-window-item-preview" element-id="{elementId}" onselect="{main.selectElement}"> </div> </div> </div>',"","",function(e){var t=this;this.main=this,this.tag=this,this.themeId=pageStore.themeId,this.list=[],this.loadedImages=[];this.selectElement=function(t){"function"==typeof e.onSelect&&e.onSelect(t),e.modal.close()}.bind(this),this.on("before-mount",function(){var e,i,n;t.list=(e=[],i=configStore.themeJson.element,n=Object.values(i).reduce(function(e,t){return[].concat(e,t&&t.list||[])},[]),e.push({id:"all",name:"All",list:n}),e)})});
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}riot.tag2("geolanding",'<a data-command="geolanding" class="text-type"> <virtual if="{tag.geolanding.selectedVar == \'default\'}"> <svg style="margin-top: 3px"><use riot-xlink:href="{main.sprite}#geolanding"></use></svg> <span>{polyglot.t(\'editor::geolanding::title\')}</span> </virtual> <virtual if="{tag.geolanding.selectedVar != \'default\'}"> <span class="main-var-name">Город</span> <span>{tag.getCity(tag.geolanding.selectedVar)}</span> </virtual> <dropdown class="menu-list"> <div class="label"> {polyglot.t(\'editor::geolanding::cities\')} <q class="tip right"> <p class="tip-content"> <span data-is="raw" content="{polyglot.t(\'editor::geolanding::cities_help\')}"></span> </p> </q> </div> <div class="items-container"> <div class="radio-item default {selected: tag.geolanding.selectedVar == \'default\'}" onclick="{tag.selectVar.bind(tag, \'default\')}"> <span>{polyglot.t(\'editor::multilanding::default\')}</span> </div> <div data-is="hidden-input" each="{variant, id in tag.geolanding.vars}" class="radio-item {selected: (parent.tag.geolanding.selectedVar == id)}" pattern="[^A-zА-я-]" riot-value="{parent.tag.getCity(id)}" autocomplete="{parent.tag.autocomplete}" onclick="{parent.tag.selectVar.bind(parent.tag, id)}"> <div class="buttons"> <button class="delete" onclick="{tag.deleteVar.bind(tag, id)}"><svg><use riot-xlink:href="{tag.sprite}#delete"></use></svg></button> </div> </div> <div if="{tag.add.state}" data-is="hidden-input" class="radio-item new" pattern="[^A-zА-я- ]" autofocus="{true}" ondone="{tag.add.done}" autocomplete="{tag.autocomplete}"> <div class="buttons"> <button class="edit on" if="{inputValue && autocompleteSuggestion}" onclick="{setEdit.bind(this, false)}"><svg><use riot-xlink:href="{tag.sprite}#done"></use></svg></button> <button class="delete" onclick="{tag.add.cancel}"><svg><use riot-xlink:href="{tag.sprite}#delete"></use></svg></button> </div> </div> <button class="add-var" onclick="{tag.add.show}" title="{polyglot.t(\'editor::multilanding::add_var\')}"><i></i></button> </div> </dropdown> </a>',"",'class="control-button"',function(t){var e=this,a=t.entity;this.tag=this,this.main=this.parent?this.parent.main?this.parent.main:this.parent:this,this.url=location.origin+location.pathname,this.sprite="/_s/images/land/editor/multilanding.svg";var n,i=this.tag;this.main;i.autocomplete={minChars:0,autoSelectFirst:!0,triggerSelectOnValidInput:!1,serviceUrl:"/admin/geo/cities",showNoSuggestionNotice:!0,noSuggestionNotice:polyglot.t("editor::geolanding::no_city"),paramName:"term",params:{action:"search"},formatResult:function(t){return t.value+" ("+t.data.country+")"},transformResult:function(t){return{suggestions:(t=JSON.parse(t)).cities.filter(function(e){return e.name.toLowerCase().indexOf(t.term.toLowerCase())>-1}).map(function(t){return{value:t.name,data:t}})}}},i.add={state:!1,show:function(){i.add.state=!0,i.update()},done:function(t){"object"===_typeof(t)&&(a.geolanding.addVar(t.id,{city:t.name}),i.selectVar(t.id)),i.add.state=!1,i.update()},cancel:function(){i.add.state=!1,i.update()}},this.getMultidata=function(){var t=a.geolanding;return{selectedVar:t.selectedVar,enabled:t.enabled,vars:t.vars}}.bind(this),this.getCity=function(t){var e=i.geolanding.vars[t];return e?e.city||e.data&&e.data.geo_city||t||"-":t}.bind(this),this.deleteVar=function(t,e){t==i.geolanding.selectedVar&&this.selectVar("default"),a.geolanding.deleteVar(t),e.stopPropagation()}.bind(this),this.selectVar=function(t,e){a.geolanding.selectVar(t)&&a.render({render:"full"})}.bind(this),this.on("before-mount",function(){e.geolanding=e.getMultidata(),n=mobx.autorun(function(){a.utime,a.geolanding;var t=e.getMultidata();e.update({geolanding:t})})}),this.on("unmount",function(){"function"==typeof n&&n()})});
riot.tag2("multisection",'<a data-command="multisection" class="text-type"> <virtual if="{tag.multisection.selectedVar == \'default\'}"> <svg style="margin-top: 3px"><use riot-xlink:href="{main.sprite}#multilanding"></use></svg> <span>{polyglot.t(\'editor::multilanding::title\')}</span> </virtual> <virtual if="{tag.multisection.selectedVar != \'default\'}"> <span class="main-var-name">{tag.multisection.main_var}</span> <span class="equal">=</span> <span>{tag.multisection.selectedVar}</span> </virtual> <dropdown class="menu-list"> <div class="label"> {polyglot.t(\'editor::multilanding::url_param\')} <q class="tip right"> <p class="tip-content"> <span data-is="raw" content="{polyglot.t(\'editor::multilanding::url_param_help\')}"></span> {tag.url}?<strong>{tag.multisection.main_var}</strong>={tag.multisection.selectedVar} </p> </q> </div> <div data-is="hidden-input" class="main-var" riot-value="{tag.multisection.main_var}" ondone="{tag.changeMainVar}" pattern="[^A-z_0-9]"> <button class="edit {on: isEdit}" onclick="{setEdit.bind(this, !isEdit)}"><svg><use riot-xlink:href="{tag.sprite}#{isEdit ? \'done\' : \'edit\'}"></use></svg></button> </div> <hr> <div class="label"> {polyglot.t(\'editor::multilanding::value\')} <q class="tip right"> <p class="tip-content"> <span data-is="raw" content="{polyglot.t(\'editor::multilanding::value_help\')}"></span> {tag.url}?{tag.multisection.main_var}=<strong>{tag.multisection.selectedVar}</strong> </p> </q> </div> <div class="items-container"> <div class="radio-item default {selected: tag.multisection.selectedVar == \'default\'}" onclick="{tag.selectVar.bind(tag, \'default\')}"> <span>{polyglot.t(\'editor::multilanding::default\')}</span> </div> <div data-is="hidden-input" each="{variant, name in tag.multisection.vars}" class="radio-item {selected: (parent.tag.multisection.selectedVar == name)}" riot-value="{name}" pattern="[^A-z_0-9]" validate="{parent.tag.validateVarname.bind(parent.tag, name)}" onclick="{parent.tag.selectVar.bind(parent.tag, name)}" ondone="{parent.tag.renameVar.bind(parent.tag, name)}"> <div class="buttons"> <button class="edit {on:isEdit}" if="{inputValid}" onclick="{setEdit.bind(this, !isEdit)}"><svg><use riot-xlink:href="{tag.sprite}#{isEdit ? \'done\' : \'edit\'}"></use></svg></button> <button class="delete" onclick="{tag.deleteVar.bind(tag, name)}"><svg><use riot-xlink:href="{tag.sprite}#delete"></use></svg></button> </div> </div> <div if="{tag.add.state}" data-is="hidden-input" class="radio-item new" ondone="{tag.add.done}" autofocus="{true}" pattern="[^A-z_0-9]" validate="{tag.validateVarname.bind(parent.tag, null)}"> <div class="buttons"> <button class="edit on" if="{inputValid}" onclick="{setEdit.bind(this, false)}"><svg><use riot-xlink:href="{tag.sprite}#done"></use></svg></button> <button class="delete" onclick="{tag.add.cancel}"><svg><use riot-xlink:href="{tag.sprite}#delete"></use></svg></button> </div> </div> <button class="add-var" onclick="{tag.add.show}" title="{polyglot.t(\'editor::multilanding::add_var\')}"><i></i></button> </div> </dropdown> </a>',"",'class="control-button"',function(t){var a=this,i=t.entity;this.tag=this,this.main=this.parent?this.parent.main?this.parent.main:this.parent:this,this.url=location.origin+location.pathname,this.sprite="/_s/images/land/editor/multilanding.svg";var e,n=this.tag;this.main;n.add={state:!1,show:function(){n.add.state=!0,n.update()},done:function(t){i.multisection.addVar(t,{}),n.selectVar(t),n.add.state=!1,n.update()},cancel:function(){n.add.state=!1,n.update()}},this.getMultidata=function(){var t=i.multisection;return{selectedVar:t.selectedVar,enabled:t.enabled,main_var:t.main_var,vars:t.vars}}.bind(this),this.validateVarname=function(t,a){var i=n.multisection.vars,e=t&&t===a,s=i[a];return a&&a.length>0&&(!s||e)}.bind(this),this.deleteVar=function(t,a){a.stopPropagation(),t==n.multisection.selectedVar&&this.selectVar("default"),i.multisection.deleteVar(t)}.bind(this),this.selectVar=function(t,a){i.multisection.selectVar(t)&&i.render({render:"full"})}.bind(this),this.renameVar=function(t,a){var e=decodeURIComponent(a);i.multisection.renameVar(t,e)&&n.selectVar(e)}.bind(this),this.changeMainVar=function(t){if(!t)return!1;i.multisection.setField("main_var",t)}.bind(this),this.on("before-mount",function(){a.multisection=a.getMultidata(),e=mobx.autorun(function(){i.utime;var t=a.getMultidata();a.update({multisection:t})})}),this.on("unmount",function(){"function"==typeof e&&e()})});
riot.tag2("multitext",'<a data-command="multitext" class="text-type"> <svg><use riot-xlink:href="{main.sprite}#multilanding"></use></svg> <span>{polyglot.t(\'editor::control::multitext\')}</span> </a>',"",'class="control-button" onclick="{multitextEditor}"',function(t){this.tag=this,this.main=this.parent?this.parent.main?this.parent.main:this.parent:this;this.tag,this.main;var i=t.entity;this.multitextEditor=function(){flexbe.modal.create({name:"block_multitext_editor",width:500,overlay:!1,item:$(".multi-buttons > div",this.root),title:polyglot.t("editor::multitext::title"),riotTag:"multitext-editor",riotOpts:{multitext:i.multitext}})}.bind(this)});
riot.tag2("multitext-editor",'<div> <label class="old-style"> {polyglot.t(\'editor::multitext::url_param\')}<q class="tip tooltipstered" data-width="470"><span data-is="raw" content="{polyglot.t(\'editor::multitext::url_param_help\')}"></span> {url}?<strong>{varData.var_name}</strong>=iPhone 7 Black</q> <input class="old-style" type="text" riot-value="{varData.var_name}" oninput="{updateName}" onfocus="{saveName}" onchange="{checkName}"> </label> <label class="old-style"> {polyglot.t(\'editor::multitext::default_text\')} <input class="old-style" type="text" riot-value="{flexbe.lib.htmlspecialchars(varData.var_default, true)}" oninput="{updateDefault}"> </label> <span>{polyglot.t(\'editor::multitext::default_help\', {var: varData.var_name})}</span> </div> <div> <a onclick="{setToClipboard}" title="Нажмите для копирования в буфер обмена">\\{\\{{varData.var_name}\\}\\}</a> <span class="info" if="{!copy}">{polyglot.t(\'editor::multitext::copy_message\')}</span> <span class="info copy" if="{copy}">{polyglot.t(\'editor::multitext::copied_message\')}</span> </div>','multitext-editor div.flexbe_modal_data[data-name=block_multitext_editor],[data-is="multitext-editor"] div.flexbe_modal_data[data-name=block_multitext_editor]{padding:0} multitext-editor,[data-is="multitext-editor"]{background-color:#fff;min-height:90px} multitext-editor label,[data-is="multitext-editor"] label{padding:0} multitext-editor label:first-child,[data-is="multitext-editor"] label:first-child{padding-bottom:20px} multitext-editor>div:first-child,[data-is="multitext-editor"]>div:first-child{border-bottom:1px solid #e8e9ea} multitext-editor>div:first-child span,[data-is="multitext-editor"]>div:first-child span{color:#989A9D;font-size:12px;padding-top:4px} multitext-editor>div,[data-is="multitext-editor"]>div{padding:20px} multitext-editor .title,[data-is="multitext-editor"] .title{color:#30343b;font:700 13px Arial} multitext-editor a,[data-is="multitext-editor"] a{background-color:#F3F3F3;padding:7px 10px;color:black;text-decoration:none;display:inline-block} multitext-editor a:active,[data-is="multitext-editor"] a:active{background-color:#D8D8D8} multitext-editor .info:before,[data-is="multitext-editor"] .info:before{content:\'\';width:30px;border:1px solid #F2F2F2;display:inline-block;margin:0 10px 5px} multitext-editor .info.copy,[data-is="multitext-editor"] .info.copy{color:#00AD41}',"",function(t){var a=this,i="";t.multitext.vars&&t.multitext.vars.length||(t.multitext.vars=[{var_name:"utm_term",var_default:""}]),a.varData=t.multitext.vars[0],a.url=location.origin+location.pathname,a.copy=!1,this.updateName=function(t){var i=$(t.target),e=i.val();e.match(/[^A-z_0-9]/g)&&i.val(e.replace(/[^A-z_0-9]/g,"")),a.varData.var_name=i.val()}.bind(this),this.saveName=function(t){i=a.varData.var_name}.bind(this),this.checkName=function(t){t.target.value||(a.varData.var_name=i,a.update())}.bind(this),this.updateDefault=function(t){a.varData.var_default=flexbe.lib.htmlspecialchars($(t.target).val())}.bind(this),this.setToClipboard=function(t){var i=t.target.innerText;flexbe.lib.setToClipboard(i),a.update({copy:!0}),setTimeout(function(){a.update({copy:!1})},3e3)}.bind(this),a.on("mount",function(){flexbe.tip.init($(a.root))})});
riot.tag2("action-block",'<div data-is="flexbe-select" class="flexbe-select {![\'cart\', \'quiz\', \'modal\',].includes(value.value) && \'full-width\'}" parentmodal="{opts.modal}" riot-value="{value}" onchange="{selectAction}"> <yield to="selected"> <div class="icon"> <svg><use riot-xlink:href="{\'/_s/images/land/editor/actions.svg?1#\' + (tag.value.value || \'none\')}"></use></svg> </div> <span> {tag.value.title} </span> </yield> <yield to="options"> <li class="flexbe-select-option {active: tag.value.value == option.value}" each="{option in tag.allowActions}" onclick="{opts.onclose}"> <div class="icon"> <svg><use riot-xlink:href="{\'/_s/images/land/editor/actions.svg?1#\' + (option.value || \'none\')}"></use></svg> </div> {option.title} </li> </yield> </div> <div each="{action in allowActions}" if="{value.value == action.value}" data-is="{\'action-block-\' +  action.value}" class="{action-block-item: action.value} {action.value}" data="{opts.data}" options="{opts.options}" onchange="{modalUpdate}"> </div> <div show="{main.data.action == \'modal\' && isOrderModal && main.options.show_form_product_setup}"> <label class="flexbe-form-title product-info-title"> {polyglot.t(\'editor::button::product_title\')} </label> <div class="product-info"> <div class="product-image {loaded: background()} {loading: loading}" riot-style="{background()}"> <label class="upload-input"> <input type="file"> </label> <svg class="cartnoimage" width="16" height="13" viewbox="0 0 16 13" xmlns="http://www.w3.org/2000/svg"> <circle class="loader-path" fill="none" stroke="currentcolor" stroke-width="2" cx="8" cy="7" r="2"></circle> <path fill-rule="evenodd" d="M3.83 1.106A2 2 0 0 1 5.617 0h4.764a2 2 0 0 1 1.79 1.106l.446.894H14a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h1.382l.447-.894zM10.38 2H5.618l-.724 1.447A1 1 0 0 1 4 4H2v7h12V4h-2a1 1 0 0 1-.894-.553L10.382 2z"></path> </svg> <svg if="{loading}" class="loader circular-loader" viewbox="25 25 50 50"><circle class="loader-path" cx="50" cy="50" r="20"></circle></svg> </div> <label data-is="flexbe-input" class="flexbe-input product-title" name="product.title" placeholder="{opts.options.placeholders && opts.options.placeholders.title.trim()}" riot-value="{opts.data.product && opts.data.product.title}"></label> <label data-is="flexbe-input" class="flexbe-input product-price" name="product.price" placeholder="{opts.options.placeholders && opts.options.placeholders.price.trim()}" riot-value="{opts.data.product && opts.data.product.price}" type="{\'number\'}"></label> </div> </div>',"","",function(t){var e=this;this.tag=this,this.main=this.parent?this.parent.main?this.parent.main:this.parent:this;var o=[{value:"none",title:polyglot.t("editor::actions::none")},{value:"quiz",title:polyglot.t("editor::actions::quiz")},{value:"modal",title:polyglot.t("editor::actions::modal")},{value:"cart",title:polyglot.t("editor::actions::cart")},{value:"link",title:polyglot.t("editor::actions::link")},{value:"redirect",title:polyglot.t("editor::actions::redirect")},{value:"pay",title:polyglot.t("editor::actions::pay")},{value:"file",title:polyglot.t("editor::actions::file")},{value:"close",title:polyglot.t("editor::actions::close")},{value:"popup",title:polyglot.t("editor::actions::popup")},{value:"button",title:polyglot.t("editor::actions::button")},{value:"cover",title:polyglot.t("editor::image::sizes_cover")},{value:"contain",title:polyglot.t("editor::image::sizes_contain")},{value:"repeat",title:polyglot.t("editor::image::sizes_repeat")}];function i(t){if(t){var e=configStore.getEntityGroup("modal",t.fullId);return"form"===configStore.themeJson.modal[e].type}return!1}this.allowActions=t.actions&&t.actions.length?o.filter(function(e){return t.actions.includes(e.value)}):o,this.value=this.allowActions.find(function(e){return e.value===t.riotValue}),this.modal=pageStore.getEntity(t.data.modal_id,"modal"),this.isOrderModal=i(this.modal),this.loading=!1,this.modalUpdate=function(t){var e=t.target,o=e.name,a=e.value;if("modal_id"===o){var l=pageStore.getEntity(a,"modal");this.update({modal:l,isOrderModal:i(l)})}}.bind(this),this.background=function(){var e=t.data.product&&t.data.product.img||t.options.placeholders&&t.options.placeholders.img;return e?"background-image: url("+e+"); background-size: cover;":""}.bind(this),this.selectAction=function(e){(t.onchange||function(){})({target:{name:"action",value:e.value}}),this.update({value:e})}.bind(this),this.on("mount",function(){flexbe.files.upload.init({multi:!1,type:"image",$input:$('input[type="file"]',e.root),on_start:function(){e.update({loading:!0})},on_complete:function(t,o){if(t&&o&&o.img_id){var i=new Event("change",{bubbles:!0,cancelable:!0}),a=document.createElement("input");a.name="product.img",a.value="/img/"+o.img_id+"_200/"+o.img_name,a.style.display="none",e.root.appendChild(a),a.dispatchEvent(i),a.remove(),flexbe.stat.event("Editor - Button - Product - Upload",{image_name:o.image_name})}else alertify.error(polyglot.t("editor::button::upload_error")),flexbe.stat.event("Editor - Button - Product - Upload error");e.update({loading:!1})}})})});
riot.tag2("button-style",'<div class="btn-text" if="{!opts.options.disableButtonText}"> <label class="flexbe-form-title">{polyglot.t(\'editor::button_style::submit\')}</label> <label data-is="flexbe-input" class="flexbe-input" placeholder="Введите текст" riot-value="{flexbe.lib.htmlspecialchars(opts.data.submit, true)}" oninput="{setTitle}"></label> </div> <div class="btn-style" if="{!old_style && btnStyles}"> <label class="flexbe-form-title">{polyglot.t(\'editor::button_style::style\')}</label> <div class="style-setup" onclick="{setStyle}"> <div class="styled-button {(opts.data.btn_style || opts.data.style || []).join(\' \')} {isUltraLight ? \'light\' : flexbe.lib.contrastColor(opts.data.color, \'dark\', \'light\')}" riot-style="color: {isUltraLight ? \'#30343b\' : main.opts.data.color}" data-text="{polyglot.t(\'editor::button_style::button\')}"> </div> <div class="style-settings-icon"> <svg width="12" height="12" viewbox="0 0 12 12" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <path fill="#30343B" fill-rule="evenodd" d="M 5 1C 5 0.447754 5.44769 0 6 0C 6.55231 0 7 0.447754 7 1L 7 2.12598C 7.367 2.22046 7.71362 2.36572 8.03192 2.55383L 8.79291 1.79285C 9.18341 1.40234 9.81659 1.40234 10.2071 1.79285C 10.5977 2.18347 10.5977 2.81653 10.2071 3.20715L 9.44617 3.96802C 9.63428 4.28625 9.77948 4.63293 9.87396 5L 11 5C 11.5523 5 12 5.44775 12 6C 12 6.55225 11.5523 7 11 7L 9.87396 7C 9.77948 7.36707 9.63428 7.71375 9.44617 8.03198L 10.2071 8.79285C 10.5977 9.18347 10.5977 9.81653 10.2071 10.2072C 9.81659 10.5977 9.18341 10.5977 8.79291 10.2072L 8.03192 9.44617C 7.71362 9.63428 7.367 9.77954 7 9.87402L 7 11C 7 11.5522 6.55231 12 6 12C 5.44769 12 5 11.5522 5 11L 5 9.87402C 4.633 9.77954 4.28638 9.63428 3.96808 9.44617L 3.20709 10.2072C 2.81659 10.5977 2.18341 10.5977 1.79291 10.2072C 1.40234 9.81653 1.40234 9.18347 1.79291 8.79285L 2.55383 8.03198C 2.36572 7.71375 2.22052 7.36707 2.12604 7L 1 7C 0.447693 7 0 6.55225 0 6C 0 5.44775 0.447693 5 1 5L 2.12604 5C 2.22052 4.63293 2.36572 4.28638 2.55383 3.96802L 1.79297 3.20703C 1.40247 2.81653 1.40253 2.18335 1.79303 1.79285C 2.18359 1.40234 2.81677 1.40234 3.20728 1.79297L 3.96808 2.55383C 4.28638 2.36572 4.633 2.22046 5 2.12598L 5 1ZM 8 6C 8 7.10461 7.10455 8 6 8C 4.89545 8 4 7.10461 4 6C 4 4.89539 4.89545 4 6 4C 7.10455 4 8 4.89539 8 6Z"></path> </svg> </div> </div> </div> <div class="btn-color" if="{opts.options.color}"> <label class="flexbe-form-title">{polyglot.t(\'editor::button_style::button_color\')}</label> <flexbe-color-input if="{!old_style}" class="colorpicker" apply-if-valid="1" riot-value="{opts.data.color}" update="{setColor}" color-list="{opts.options.colors}" modal="{opts.modal}"></flexbe-color-input> <color-list class="color_list" if="{old_style}" active="{opts.data.color || opts.data.submit_color}" colors="{opts.options.colors}" onchange="{setColor}" custom="{opts.options.color_custom}"></color-list> </div> <modal-block if="{isStyleSet}" onclose="{setStyle}" bind-to="{modalTrigger}"> <div class="flexbe-modal-content header"> {polyglot.t(\'editor::button_style::style\')} <div class="flexbe-modal-close" onclick="{opts.onclose}"> <svg width="16" height="16" viewbox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <path fill-rule="evenodd" d="M 9.12128 7.70709L 15.4142 1.41418L 14 0L 7.70709 6.29291L 1.41418 0L 0 1.41418L 6.29291 7.70709L 0 14L 1.41418 15.4142L 7.70709 9.12128L 14 15.4142L 15.4142 14L 9.12128 7.70709Z"></path> </svg> </div> </div> <hr> <div class="flexbe-modal-content"> <div class="button-style-settings"> <div each="{style in main.opts.options.btn_styles}" class="styled-button {style.join(\' \')} {parent.parent.isUltraLight ? \'light\' : flexbe.lib.contrastColor(main.opts.data.color, \'dark\', \'light\')} {active: flexbe.lib.compareArray(main.opts.data.btn_style || main.opts.data.style, style)}" riot-style="color: {parent.parent.isUltraLight ? \'#30343b\' : main.opts.data.color}" data-text="{polyglot.t(\'editor::button_style::button\')}" onclick="{opts.onclose}"></div> </div> </div> </modal-block>',"","",function(t){this.tag=this,this.main=this.parent?this.parent.main?this.parent.main:this.parent:this;var l=t.onchange||function(){};this.isStyleSet=!1,this.modalTrigger=null,this.old_style=+flexbe.land.theme_id<=1,this.old_style&&this.root.classList.add("old-template"),this.btnStyles=this.opts.options.btn_styles,this.isUltraLight=flexbe.lib.contrastColor(this.opts.data.color,1,0,.88),this.setStyle=function(o){this.isStyleSet&&o&&o.item?(t.data[t.data.btn_style?"btn_style":"style"]=o.item.style,l(),t.eventStatGroup&&flexbe.stat.event(t.eventStatGroup+" - Change style",{style:o.item.style})):setTimeout(function(){$("body").find(".overlay-area").last().focus()},10),this.update({isStyleSet:!this.isStyleSet,isUltraLight:flexbe.lib.contrastColor(this.opts.data.color,1,0,.88),modalTrigger:o?$(o.target).parents(".button-style").get(0):null}),t.modal.disabled(this.isStyleSet)}.bind(this),this.setColor=function(o){t.data.color=o,l("full"),this.update({isUltraLight:flexbe.lib.contrastColor(this.opts.data.color,1,0,.88)})}.bind(this),this.setTitle=function(o){t.data.submit=o.target.value,l(),t.eventStatGroup&&flexbe.stat.event(t.eventStatGroup+" - Change text")}.bind(this)});
riot.tag2("goals",'<label class="flexbe-form-title" for="main_goal"> {polyglot.t(\'editor::goals::main\')} <div class="flexbe-tooltip">{polyglot.t(\'editor::goals::main_help\')}</div> <div class="desc">{polyglot.t(\'editor::goals::desc_metric\')}</div> </label> <label data-is="flexbe-input" class="flexbe-input" name="main_goal" riot-value="{opts.mainGoal || \'\'}" readonly="readonly"></label> <label class="flexbe-form-title" for="goal"> {polyglot.t(\'editor::goals::goal\')} <div class="desc">{polyglot.t(\'editor::goals::desc_metric\')}</div> </label> <label data-is="flexbe-input" class="flexbe-input" name="goal" riot-value="{goals.goal}" onchange="{setGoal}"></label> <label class="flexbe-form-title" for="goal_html"> {polyglot.t(\'editor::goals::html\')} <div class="desc">{polyglot.t(\'editor::goals::html_desc\')}</div> </label> <label data-is="flexbe-input" class="flexbe-input" type="codemirror" settings="{htmlOptions}" riot-value="{goals.goal_html}" onchange="{setGoalHtml}"></label>',"",'class="goals"',function(t){var l=this;this.tag=this,this.main=this.parent?this.parent.main?this.parent.main:this.parent:this,this.goals=$.extend({goal:"",goal_html:""},t.goals),this.htmlOptions={options:{value:this.goals.goal_html||"",lineNumbers:!1,indentUnit:4,inputStyle:"contenteditable",mode:"htmlmixed"},url:"mode/htmlmixed/htmlmixed"},this.changed=t.changed||function(){},this.setGoal=function(t){var l="";l="string"==typeof t?t:t.target.value=t.target.value.replace(/[^A-z_0-9]/g,""),this.goals.goal=l,this.changed(this.goals)}.bind(this),this.setGoalHtml=function(t){this.goals.goal_html=t.target.value,this.changed(this.goals)}.bind(this),this.on("mount",function(){$('.goals input[name="goal"]',l.root).autocomplete({minChars:1,autoSelectFirst:!0,lookup:Object.keys(flexbe.page.metrika.goals||{}).filter(function(t){return!/pay_create|pay_done|order_done/.test(t)}),onSelect:function(t){l.setGoal(t.value)}}),flexbe.tip.init(l.parent.root)})});
riot.tag2("media-image",'<div class="image"> <div if="{image.name}" data-is="image-item" item="{image}" image-height="{options.imageHeight}" onupdate="{editorChange}"></div> <div if="{!image.name}" class="no-image"> <svg viewbox="0 0 80 80"> <path d="M29.773 41.727a1.71 1.71 0 0 0 1.704 1.704 1.71 1.71 0 0 0 1.705-1.703c0-3.75 3.067-6.82 6.818-6.82a1.71 1.71 0 0 0 1.705-1.703A1.71 1.71 0 0 0 40 31.5c-5.624 0-10.227 4.603-10.227 10.227zM59 33.25c0 .96.773 1.75 1.714 1.75h8.572c.94 0 1.714-.79 1.714-1.75v-3.5c0-.96-.773-1.75-1.714-1.75h-8.572c-.94 0-1.714.79-1.714 1.75v3.5zM40 55.363c-1.705 0-3.325-.342-4.856-.936l-2.472 2.64c2.214 1.02 4.687 1.705 7.328 1.705 9.375 0 17.045-7.67 17.045-17.045 0-2.983-.768-5.798-2.13-8.265l-2.473 2.64a13.852 13.852 0 0 1 1.194 5.625c0 7.502-6.134 13.636-13.636 13.636zm32.386-34.09h-6.134l-3.24 3.408h9.374a1.71 1.71 0 0 1 1.705 1.706v34.09a1.71 1.71 0 0 1-1.704 1.705H27.9l-3.24 3.41h47.726c2.815 0 5.114-2.3 5.114-5.113v-34.09c0-2.816-2.3-5.115-5.114-5.115zm-3.92-9.802c-.683-.683-1.788-.593-2.388.085l-9.117 9.717h-.683l-3.666-6.05c-.936-1.536-2.555-2.473-4.345-2.473h-16.53c-1.79 0-3.494.936-4.346 2.472l-3.667 6.05H7.613A5.126 5.126 0 0 0 2.5 26.386v34.09c0 2.815 2.3 5.114 5.114 5.114h7.754l-.51.51c-.684.685-.594 1.79.084 2.39.342.34.768.51 1.194.51.427 0 .937-.17 1.28-.51L68.55 13.943c.595-.684.595-1.79-.083-2.473zM7.615 62.18a1.71 1.71 0 0 1-1.705-1.703v-34.09a1.71 1.71 0 0 1 1.704-1.706H24.66c.593 0 1.193-.34 1.446-.85l4.093-6.903c.34-.51.85-.853 1.445-.853h16.62c.595 0 1.194.342 1.447.853l4.093 6.902c.085.167.17.257.342.34l-3.752 4.004C47.502 26.044 43.92 24.68 40 24.68c-9.375 0-17.045 7.672-17.045 17.047a16.88 16.88 0 0 0 4.26 11.247L18.61 62.18H7.613zm40.4-31.45l-18.41 19.777a13.43 13.43 0 0 1-3.24-8.78c0-7.503 6.134-13.637 13.636-13.637 2.983 0 5.798 1.02 8.013 2.64z" fill-opacity=".096" fill="#000"></path> </svg> </div> <a class="upload"> {polyglot.t(\'editor::image::upload\')} <input if="{image.percent === undefined}" type="file" name="file"> </a> </div> <div class="content"> <div class="old-style" if="{options.show_sizes && options.sizes.length > 1}"> <label class="flexbe-form-title"> {polyglot.t(\'editor::actions::sizes\')} </label> <action-block class="action-block" actions="{options.sizes}" data="{image}" options="{options}" riot-value="{image.size || \'cover\'}" onchange="{sizeChanges}" oninput="{sizeChanges}"></action-block> </div> <div class="old-style" if="{options.show_actions && options.actions.length > 1}"> <label class="flexbe-form-title"> {polyglot.t(\'editor::actions::button_title\')} </label> <action-block class="action-block" actions="{options.actions}" data="{image}" options="{options}" riot-value="{image.action}" onchange="{actionChanges}" oninput="{actionChanges}"></action-block> </div> <div class="old-style" if="{options.show_title}"> <label class="flexbe-form-title"> {polyglot.t(\'editor::image::title\')} </label> <input class="old-style" name="title" type="text" riot-value="{image.title}" oninput="{changeText}" placeholder="{polyglot.t(\'editor::image::title_placeholder\')}"> </div> <div class="old-style" if="{options.show_alt}"> <label class="flexbe-form-title"> {polyglot.t(\'editor::image::alt\')} </label> <input class="old-style" name="alt" type="text" riot-value="{image.alt}" oninput="{changeText}" placeholder="{polyglot.t(\'editor::image::alt_placeholder\')}"> </div> <div class="old-style" if="{options.show_desc}"> <label class="flexbe-form-title"> {polyglot.t(\'editor::image::desc\')} </label> <input class="old-style" name="desc" type="text" riot-value="{image.desc}" oninput="{changeText}" placeholder="{polyglot.t(\'editor::image::desc_placeholder\')}"> </div> </div>','media-image,[data-is="media-image"]{display:flex;max-height:calc(100vh - 240px);padding:1px} media-image>.content,[data-is="media-image"]>.content{flex-grow:1} media-image .no-image,[data-is="media-image"] .no-image{width:190px;height:190px;display:flex;justify-content:center;align-items:center;background-color:#EFEFEF} media-image .no-image svg,[data-is="media-image"] .no-image svg{width:80px} media-image div[data-is=image-item],[data-is="media-image"] div[data-is=image-item]{width:100%} media-image .image,[data-is="media-image"] .image{text-align:center;padding-right:20px;width:calc(33.334% + 13px)} media-image div.old-style:not(:first-child),[data-is="media-image"] div.old-style:not(:first-child){margin-top:20px} media-image a,[data-is="media-image"] a{margin-top:15px;font-size:12px;color:#4990E2;display:block;text-decoration:underline;position:relative} media-image a:hover,[data-is="media-image"] a:hover{text-decoration:none} media-image a input,[data-is="media-image"] a input{margin:0;opacity:0;position:absolute;top:0;left:0;cursor:pointer;width:100%;height:100%} media-image input,[data-is="media-image"] input{margin-top:5px} media-image label.old-style,[data-is="media-image"] label.old-style{padding:10px 0} media-image .action-block input,[data-is="media-image"] .action-block input{margin-top:0}',"",function(i){this.tag=this,this.main=this.parent?this.parent.main?this.parent.main:this.parent:this,this.data=i.data,this.editor=i.editor;var e=this,a=i.editor;if(this.editorChange=function(){a.change()}.bind(this),this.actionChanges=function(i){var e=i.target.name.split("."),a=e.splice(e.length-1,1)[0],t="checkbox"===i.target.type?Number(i.target.checked):i.target.value,o=e.reduce(function(i,e){var a=void 0===i[e],t=Array.isArray(i[e])&&!i[e].length;return(a||t)&&(i[e]={}),i[e]||i},this.data);o.image?o.image[a]=t:o[a]=t,this.editorChange()}.bind(this),this.sizeChanges=function(i){e.image.size=i.target.value,a.change(),flexbe.stat.event("Editor - Media - Image - Change size",{size:e.image.size})}.bind(this),this.changeText=function(i){var t=i.target;e.image[t.getAttribute("name")]=t.value,a.change(),flexbe.stat.event("Editor - Media - Image - Input "+t.getAttribute("name"))}.bind(this),e.image=a.options.no_convert?a.data:a.data.image,!e.image.id&&a.data.slider&&a.data.slider.list.length){var t=a.data.slider.list.find(function(i){return i.hasOwnProperty("img")});t&&(e.image=a.data.image=$.extend(!0,{},t.img))}e.options=a.options,e.procent=0,e.options.actions&&e.options.actions.length&&e.options.actions.unshift("none"),e.actionsSprite="/_s/images/land/editor/actions.svg?1",e.on("before-mount",function(){e.image&&(e.image.popup?(e.image.action="popup",delete e.image.popup):e.image.url&&!e.image.action&&(e.image.action="link"))}),e.on("mount",function(){var i=$(".upload",this.root);flexbe.files.upload.init({multi:!1,type:"image",$input:$('input[type="file"]',i),on_select:function(i){e.image.percent=0,e.tags["image-item"].update()},on_progress:function(i,a){e.image.percent=a,e.tags["image-item"].update()},on_complete:function(i,t,o,n){delete e.image.percent,i&&t&&t.img_id&&t.img_name?(e.image.id=t.img_id,e.image.name=t.img_name,e.image.position={x:"50%",y:"50%"},flexbe.stat.event("Editor - Media - Image - Upload")):(alertify.error(polyglot.t("editor::image::upload_error")),flexbe.stat.event("Editor - Media - Image - Upload error")),e.update(),a.change()}})})});
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}riot.tag2("media-slider",'<div class="slider-settings" if="{!options.no_convert}"> <div class="inline-columns"> <label class="old-style">{polyglot.t(\'editor::slider::autoplay\')} ( {slider.autoplay == 0 ? polyglot.t(\'editor::slider::autoplay_off\') : slider.autoplay + polyglot.t(\'editor::slider::autoplay_sec\')} ) <input class="old-style" type="range" step="1" min="0" max="60" oninput="{updateAutoplay}" riot-value="{slider.autoplay}"> </label> <label class="old-style checkbox"> <input class="old-style" type="checkbox" checked="{slider.loop}" onchange="{changeLoop}"> <span>{polyglot.t(\'editor::slider::autoplay_loop\')}</span> </label> </div> <label if="{options.show_sizes && sizes.length > 1}" class="old-style sizes"> {polyglot.t(\'editor::actions::sizes\')} <radio-buttons list="{sizes}" current="{slider.size || \'cover\'}" onselect="{selectSize}" sprite="{actionsSprite}"></radio-buttons> </label> <div class="inline-columns"> <label if="{options.show_pagination && paginations.length > 1}" class="old-style inline"> {polyglot.t(\'editor::slider::bullets\')} <radio-buttons list="{paginations}" current="{slider.pagination || ⁗bullets⁗}" onselect="{selectPagination}" sprite="{actionsSprite}"></radio-buttons> </label> <label class="old-style"> {polyglot.t(\'editor::slider::bullets_color\')} <div if="{options.show_colors}" class="advanced"> <color-list class="color_list" colors="{options.colors}" active="{slider.color}" onchange="{setColor}" custom="{options.custom_color}" inline="true"></color-list> </div> </label> </div> <div class="old-style" if="{options.show_actions && options.actions.length > 1}"> <label class="flexbe-form-title"> {polyglot.t(\'editor::actions::button_title\')} </label> <action-block class="action-block" actions="{options.actions}" data="{slider}" options="{options}" riot-value="{slider.action}" onchange="{actionChanges}" oninput="{actionChanges}"></action-block> </div> </div> <div class="slider-list"> <div class="slider-item" each="{slide, index in list}"> <div if="{slide.img}" data-is="image-item" item="{slide.img}" can-delete="{list.length > 1}" image-height="{parent.opts.editor.options.imageHeight}" ondelete="{parent.deleteItem}" onupdate="{parent.editorChange}"></div> <div if="{slide.video}" data-is="video-item" item="{slide.video}" can-delete="{list.length > 1}" image-height="{parent.opts.editor.options.imageHeight}" ondelete="{parent.deleteItem}"></div> </div> </div> <div class="settings-button" if="{options.allow_slider_settings && !options.no_convert && state != \'settings\'}"> <div> <span onclick="{setState}" state="settings"> <svg viewbox="0 0 16 16"><path d="M12.89 11.477c.4-.56.705-1.192.893-1.872L16 9V7l-2.188-.497c-.186-.72-.5-1.39-.92-1.98l1.472-1.473-1.414-1.414-1.473 1.473c-.52-.37-1.1-.66-1.724-.85L9 0H7l-.753 2.26c-.624.19-1.204.48-1.724.85L3.05 1.635 1.636 3.05 3.11 4.523a5.974 5.974 0 0 0-.907 1.925L0 7v2l2.202.55c.187.7.498 1.35.907 1.927L1.635 12.95l1.414 1.414 1.473-1.473c.53.378 1.125.672 1.764.862L7 16h2l.794-2.273a5.978 5.978 0 0 0 1.683-.836l1.473 1.474 1.414-1.414-1.473-1.473zM8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8z"></path></svg> {polyglot.t(\'editor::slider::settings\')} </span> </div> </div> <div class="upload-bar"> <div class="state-wrapper {add: !state}"> <div if="{onlyImages}" class="button add-button onlyImages"> <svg viewbox="0 0 14 14" xmlns="http://www.w3.org/2000/svg"><path d="M6 6H0v2h6v6h2V8h6V6H8V0H6v6z"></path></svg> <input show="{!uploadCount}" type="file" name="file"> </div> <div if="{!onlyImages}" class="button add-button" onclick="{setState}" state="choose"> <svg viewbox="0 0 14 14" xmlns="http://www.w3.org/2000/svg"><path d="M6 6H0v2h6v6h2V8h6V6H8V0H6v6z"></path></svg> </div> </div> <div class="state-wrapper {choose: state == \'choose\'}"> <div if="{!onlyImages}" class="type-buttons"> <div class="button image {disabled: uploadCount}"> <div class="tooltip"> {polyglot.t(\'editor::slider::add_img\')} </div> <svg viewbox="0 0 14 14" xmlns="http://www.w3.org/2000/svg"><path d="M8 12H0L5 2l3.286 6.57L10 6l4 6H8zm1.5-8a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"></path></svg> <input show="{!uploadCount}" type="file" name="file"> </div> <div class="button {disabled: uploadCount}" onclick="{setState}" state="video"> <div class="tooltip"> {polyglot.t(\'editor::slider::add_video\')} </div> <svg viewbox="0 0 14 14" xmlns="http://www.w3.org/2000/svg"><path d="M0 4c0-1.105.897-2 2.006-2h9.988C13.102 2 14 2.887 14 4v6c0 1.105-.897 2-2.006 2H2.006A1.998 1.998 0 0 1 0 10V4zm5 .99v4.02c0 .54.39.76.87.48l3.26-1.91c.478-.28.49-.744.022-1.03L5.848 4.52C5.376 4.23 5 4.445 5 4.99z"></path></svg> </div> <div class="button close" onclick="{setState}"> <svg viewbox="0 0 14 14" xmlns="http://www.w3.org/2000/svg"><path d="M6 6H0v2h6v6h2V8h6V6H8V0H6v6z"></path></svg> </div> </div> </div> <div class="state-wrapper {video: state == \'video\'}"> <div if="{!onlyImages}" class="upload-video {youtube: videoData && videoData.type == \'youtube\', vimeo: videoData && videoData.type == \'vimeo\'}"> <input type="text" placeholder="{polyglot.t(\'editor::slider::video_placeholder\')}" oninput="{setVideoLink}" riot-value="{videoData && videoData.link}"> <div class="button addVideo" onclick="{addVideo}" if="{videoData && videoData.link}"> <svg viewbox="0 0 14 14" xmlns="http://www.w3.org/2000/svg"> <path stroke="#48A545" stroke-width="2" d="M0 7.775l4.113 4.112L14 2"></path> </svg> </div> <div class="button close" onclick="{setState}" state="choose"> <svg viewbox="0 0 14 14" xmlns="http://www.w3.org/2000/svg"><path d="M6 6H0v2h6v6h2V8h6V6H8V0H6v6z"></path></svg> </div> </div> </div> <div class="state-wrapper {settings: state == \'settings\'}"> <div class="button apply-settings" onclick="{setState}"> <svg viewbox="0 0 14 14" xmlns="http://www.w3.org/2000/svg"> <path d="M4.707 9.79L1.414 6.5 0 7.914 4.707 12.5 14 2.914 12.59 1.5z" fill-rule="nonzero" fill="#FFF"></path> </svg> </div> </div> </div>','media-slider,[data-is="media-slider"]{display:flex;position:relative;flex-direction:column} media-slider [data-is="radio-buttons"],[data-is="media-slider"] [data-is="radio-buttons"],media-slider color-list,[data-is="media-slider"] color-list{margin-top:10px} media-slider [data-is="action-select"] svg,[data-is="media-slider"] [data-is="action-select"] svg{width:15px;height:15px} media-slider.settings .slider-settings,[data-is="media-slider"].settings .slider-settings{opacity:1;left:0;pointer-events:all} media-slider.settings .slider-list,[data-is="media-slider"].settings .slider-list{opacity:0;pointer-events:none;transform:translateX(-15px)} media-slider:not(.settings) .slider-settings,[data-is="media-slider"]:not(.settings) .slider-settings{bottom:120px;overflow:hidden} media-slider div.old-style,[data-is="media-slider"] div.old-style{margin-top:10px} media-slider .settings-button,[data-is="media-slider"] .settings-button{padding:5px 0 20px;text-align:center} media-slider .settings-button div,[data-is="media-slider"] .settings-button div{display:flex;justify-content:center} media-slider .settings-button span,[data-is="media-slider"] .settings-button span{cursor:pointer;color:#A4A4A4;display:flex;align-items:center;font-size:13px;transition:color .2s linear} media-slider .settings-button span:hover,[data-is="media-slider"] .settings-button span:hover{color:#222} media-slider .settings-button span:hover svg,[data-is="media-slider"] .settings-button span:hover svg{transform:rotate(1turn);transition:transform .65s ease-in-out} media-slider .settings-button svg,[data-is="media-slider"] .settings-button svg{width:16px;height:16px;margin-right:5px} media-slider .slider-settings,[data-is="media-slider"] .slider-settings{opacity:0;left:15px;pointer-events:none;position:absolute !important;max-height:calc(100vh - 300px);transition:opacity .3s linear,left .3s linear;will-change:opacity,left;top:0;z-index:2;width:100%} media-slider .slider-settings>label,[data-is="media-slider"] .slider-settings>label,media-slider .slider-settings .inline-columns>label,[data-is="media-slider"] .slider-settings .inline-columns>label{margin-top:10px} media-slider .slider-settings label.checkbox span,[data-is="media-slider"] .slider-settings label.checkbox span{font-weight:normal} media-slider .slider-settings .inline-columns,[data-is="media-slider"] .slider-settings .inline-columns{display:flex;justify-content:space-between;align-items:center} media-slider .slider-settings .inline-columns>label,[data-is="media-slider"] .slider-settings .inline-columns>label{max-width:270px;flex-grow:1} media-slider .slider-settings .sizes [data-is="radio-buttons"] label:not(:last-child),[data-is="media-slider"] .slider-settings .sizes [data-is="radio-buttons"] label:not(:last-child){margin-right:20px} media-slider .slider-list,[data-is="media-slider"] .slider-list{display:flex;align-items:flex-start;justify-content:flex-start;flex-flow:row wrap;width:calc(100% + 10px);margin:-5px -5px 15px;overflow-y:auto;max-height:100%;max-height:calc(100vh - 300px);transition:opacity .3s linear,transform .3s linear} media-slider .slider-list .slider-item,[data-is="media-slider"] .slider-list .slider-item{width:33.334%;padding:5px;flex-shrink:0} media-slider .upload-bar,[data-is="media-slider"] .upload-bar{height:60px;margin:0 -20px -20px;background-color:#fff;border-radius:0 0 3px 3px;box-shadow:0 -1px 2px rgba(0,0,0,0.08);position:relative;z-index:1} media-slider .upload-bar input[type=file],[data-is="media-slider"] .upload-bar input[type=file]{display:block;position:absolute;top:0;bottom:0;left:0;right:0;cursor:pointer;opacity:0;width:30px;height:30px;overflow:hidden} media-slider .upload-bar .button,[data-is="media-slider"] .upload-bar .button{width:30px;height:30px;position:relative;border-radius:17px;border:1px solid #E1E8FE;color:#6B8EFE;display:flex;align-items:center;justify-content:center;transition:transform .2s linear;cursor:pointer;flex-shrink:0} media-slider .upload-bar .button .tooltip,[data-is="media-slider"] .upload-bar .button .tooltip{position:absolute;bottom:calc(100% + 10px);font-size:11px;color:#30343B;background-color:#fff;border:1px solid #ECECEC;padding:7px 10px;white-space:nowrap;border-radius:3px;pointer-events:none;opacity:0;transition:opacity .2s linear} media-slider .upload-bar .button .tooltip:before,[data-is="media-slider"] .upload-bar .button .tooltip:before,media-slider .upload-bar .button .tooltip:after,[data-is="media-slider"] .upload-bar .button .tooltip:after{content:\'\';position:absolute;left:calc(50% - 7px);top:100%;border-style:solid;border-color:#ECECEC transparent;border-width:7px 7px 0} media-slider .upload-bar .button .tooltip:after,[data-is="media-slider"] .upload-bar .button .tooltip:after{top:calc(100% - 1px);border-color:#fff transparent} media-slider .upload-bar .button svg,[data-is="media-slider"] .upload-bar .button svg{width:14px;height:14px} media-slider .upload-bar .button.disabled,[data-is="media-slider"] .upload-bar .button.disabled{filter:grayscale(100%);opacity:.6 !important} media-slider .upload-bar .state-wrapper,[data-is="media-slider"] .upload-bar .state-wrapper{opacity:0;pointer-events:none;transition:opacity .2s linear;position:absolute !important;width:100%;height:100%;display:flex;align-items:center;justify-content:center} media-slider .upload-bar .state-wrapper.add,[data-is="media-slider"] .upload-bar .state-wrapper.add,media-slider .upload-bar .state-wrapper.video,[data-is="media-slider"] .upload-bar .state-wrapper.video,media-slider .upload-bar .state-wrapper.settings,[data-is="media-slider"] .upload-bar .state-wrapper.settings,media-slider .upload-bar .state-wrapper.choose,[data-is="media-slider"] .upload-bar .state-wrapper.choose{opacity:1;pointer-events:all;position:static} media-slider .upload-bar .state-wrapper.settings .apply-settings svg,[data-is="media-slider"] .upload-bar .state-wrapper.settings .apply-settings svg{transform:scaleX(1)} media-slider .upload-bar .state-wrapper.add .add-button svg,[data-is="media-slider"] .upload-bar .state-wrapper.add .add-button svg{transform:rotate(0)} media-slider .upload-bar .state-wrapper.choose .type-buttons>div.disabled,[data-is="media-slider"] .upload-bar .state-wrapper.choose .type-buttons>div.disabled{border-color:#E1E8FE !important} media-slider .upload-bar .state-wrapper.choose .type-buttons>div:not(.close),[data-is="media-slider"] .upload-bar .state-wrapper.choose .type-buttons>div:not(.close){opacity:1} media-slider .upload-bar .state-wrapper.choose .type-buttons>div:first-child,[data-is="media-slider"] .upload-bar .state-wrapper.choose .type-buttons>div:first-child{transform:translateX(0)} media-slider .upload-bar .state-wrapper.choose .type-buttons div[state=video],[data-is="media-slider"] .upload-bar .state-wrapper.choose .type-buttons div[state=video]{transform:translateX(0)} media-slider .upload-bar .state-wrapper.choose .type-buttons .close:hover,[data-is="media-slider"] .upload-bar .state-wrapper.choose .type-buttons .close:hover{border-color:#cecaca !important} media-slider .upload-bar .state-wrapper.choose .type-buttons .close svg,[data-is="media-slider"] .upload-bar .state-wrapper.choose .type-buttons .close svg{transform:rotate(45deg)} media-slider .upload-bar .state-wrapper.video .close svg,[data-is="media-slider"] .upload-bar .state-wrapper.video .close svg{transform:rotate(45deg)} media-slider .upload-bar .close,[data-is="media-slider"] .upload-bar .close{color:#AFAFAF !important;border:1px solid #EAEAEA !important} media-slider .upload-bar .close svg,[data-is="media-slider"] .upload-bar .close svg{transition:transform .2s linear} media-slider .upload-bar .close:hover,[data-is="media-slider"] .upload-bar .close:hover{border-color:#cecaca !important} media-slider .upload-bar .upload-video,[data-is="media-slider"] .upload-bar .upload-video{display:flex;width:100%;padding:0 20px} media-slider .upload-bar .upload-video input,[data-is="media-slider"] .upload-bar .upload-video input{flex-grow:1;border:none} media-slider .upload-bar .upload-video .close,[data-is="media-slider"] .upload-bar .upload-video .close{flex-shrink:0} media-slider .upload-bar .upload-video .addVideo,[data-is="media-slider"] .upload-bar .upload-video .addVideo{color:transparent;border:1px solid #E1F0E1;margin-right:15px} media-slider .upload-bar .upload-video .addVideo:hover,[data-is="media-slider"] .upload-bar .upload-video .addVideo:hover{border-color:#C6E2C5} media-slider .upload-bar .add-button,[data-is="media-slider"] .upload-bar .add-button{background-color:#6B8EFE;border-color:#6B8EFE;cursor:pointer;color:#fff} media-slider .upload-bar .add-button.onlyImages,[data-is="media-slider"] .upload-bar .add-button.onlyImages{position:relative !important} media-slider .upload-bar .add-button svg,[data-is="media-slider"] .upload-bar .add-button svg{transform:rotate(45deg);transition:transform .2s linear} media-slider .upload-bar .apply-settings,[data-is="media-slider"] .upload-bar .apply-settings{background-color:#6B8EFE;border-color:#6B8EFE;cursor:pointer} media-slider .upload-bar .apply-settings svg,[data-is="media-slider"] .upload-bar .apply-settings svg{transform:scaleX(0);transition:transform .2s linear} media-slider .upload-bar .type-buttons,[data-is="media-slider"] .upload-bar .type-buttons{display:flex} media-slider .upload-bar .type-buttons>div,[data-is="media-slider"] .upload-bar .type-buttons>div{position:relative;transition:transform .2s linear,opacity .2s cubic-bezier(.19, 1, .22, 1);cursor:pointer} media-slider .upload-bar .type-buttons>div:not(.close),[data-is="media-slider"] .upload-bar .type-buttons>div:not(.close){opacity:0} media-slider .upload-bar .type-buttons>div:first-child,[data-is="media-slider"] .upload-bar .type-buttons>div:first-child{transform:translateX(45px)} media-slider .upload-bar .type-buttons>div:hover,[data-is="media-slider"] .upload-bar .type-buttons>div:hover{border-color:#B4C6FE !important} media-slider .upload-bar .type-buttons>div:hover .tooltip,[data-is="media-slider"] .upload-bar .type-buttons>div:hover .tooltip{opacity:1} media-slider .upload-bar .type-buttons div[state=video],[data-is="media-slider"] .upload-bar .type-buttons div[state=video]{transform:translateX(-45px);order:1} media-slider .upload-bar .type-buttons .close,[data-is="media-slider"] .upload-bar .type-buttons .close{margin:0 15px}',"class=\"{settings: state == 'settings'}\"",function(t){this.tag=this,this.main=this.parent?this.parent.main?this.parent.main:this.parent:this,this.data=t.data;var e=this,i=t.editor,a=[{name:"cover",value:polyglot.t("editor::image::sizes_cover")},{name:"contain",value:polyglot.t("editor::image::sizes_contain")},{name:"repeat",value:polyglot.t("editor::image::sizes_repeat")}];if(e.options=i.options,e.list=e.options.no_convert?i.data:i.data.slider.list,e.onlyImages=e.options.tabs.every(function(t){return"video"!==t}),e.uploadCount=0,e.slider=i.data.slider,e.actionsSprite="/_s/images/land/editor/actions.svg?1",!e.list.length&&i.data.image.id){var s=$.extend(!0,{},i.data.image);delete s.url,delete s.action,delete s.desc,delete s.title,e.list.push({img:s})}!e.list.length&&i.data.video.id&&e.list.push({video:i.data.video}),this.changeLoop=function(t){e.slider.loop=t.target.checked?1:0,i.change(),flexbe.stat.event("Editor - Media - Slider - Settings - Loop",{loop:e.slider.loop})}.bind(this),this.updateAutoplay=function(t){e.slider.autoplay=t.target.value,i.change(),flexbe.stat.event("Editor - Media - Slider - Settings - Autoplay",{autoplay_speed:e.slider.autoplay})}.bind(this),e.on("updated",function(){"settings"===e.state&&$(".slider-list",e.root).css({minHeight:$(".slider-settings").height()})}),this.actionChanges=function(t){var e=t.target.name.split("."),i=e.splice(e.length-1,1)[0],a="checkbox"===t.target.type?Number(t.target.checked):t.target.value,s=e.reduce(function(t,e){var i=void 0===t[e],a=Array.isArray(t[e])&&!t[e].length;return(i||a)&&(t[e]={}),t[e]||t},this.data);s.slider?s.slider[i]=a:s[i]=a,this.editorChange()}.bind(this),this.selectSize=function(t){"object"===_typeof(t)&&(e.slider.size=t.name,e.update(),i.change(),flexbe.stat.event("Editor - Media - Slider - Settings - Size",{size:e.slider.size}))}.bind(this),this.selectPagination=function(t){"object"===_typeof(t)&&(e.slider.pagination=t.name,e.update(),i.change(),flexbe.stat.event("Editor - Media - Slider - Settings - Pagination",{pagination:e.slider.pagination}))}.bind(this),this.setColor=function(t){e.slider.color=t,i.change(),flexbe.stat.event("Editor - Media - Slider - Settings - Color")}.bind(this),this.setState=function(t){e.uploadCount||(e.state=t.currentTarget.getAttribute("state"),"video"===e.state&&(e.videoData=null),"settings"!==e.state&&$(".slider-list",e.root).css("minHeight",""))}.bind(this),this.setVideoLink=function(i){e.videoData=t.parseVideoLink(i.target.value),flexbe.stat.event("Editor - Media - Slider - Video set link")}.bind(this),this.addVideo=function(){e.list.push({video:e.videoData}),e.state=null,i.change(),flexbe.stat.event("Editor - Media - Slider - Video add")}.bind(this),this.editorChange=function(){i.change()}.bind(this),this.deleteItem=function(t,a){e.list[t]===a&&(e.list.splice(t,1),e.update(),i.change(),flexbe.stat.event("Editor - Media - Slider - Item delete"))}.bind(this),e.options.actions&&e.options.actions.length&&(e.options.actions.unshift("none"),e.options.actions.splice(e.options.actions.indexOf("link"),1)),e.sizes=a.filter(function(t){return e.options.sizes&&!!~e.options.sizes.indexOf(t.name)}),e.paginations=[{name:"none"},{name:"bullets"},{name:"fraction"}].filter(function(t){return e.options.paginations&&(!!~e.options.paginations.indexOf(t.name)||"none"===t.name)}),e.on("mount",function(){var t=$(".button.image, .onlyImages",this.root),a=e.list;flexbe.files.upload.init({multi:!0,type:"image",$input:$('input[type="file"]',t),on_select:function(t){e.uploadCount++;var i=a.find(function(t){return t.hasOwnProperty("img")})||{img:{position:{x:"50%",y:"50%"}}},s=$.extend(!0,{},i,{img:{id:t,percent:0}});a.push(s),e.update()},on_progress:function(t,i){a.forEach(function(a){!a.video&&a.img&&a.img.id&&a.img.id==t&&(a.img.percent=i,e.update())})},on_complete:function(t,s,o,d){e.uploadCount--,t&&s&&s.img_id&&s.img_name?(a.forEach(function(t){!t.video&&t.img&&t.img.id&&t.img.id==d&&(delete t.img.percent,t.img.id=s.img_id,t.img.name=s.img_name)}),flexbe.stat.event("Editor - Media - Slider - Image upload")):(alertify.error(polyglot.t("editor::image::upload_error")),a.forEach(function(t,e){!t.video&&t.img&&t.img.id&&t.img.id==d&&a.splice(e,1)}),flexbe.stat.event("Editor - Media - Slider - Image upload error")),e.update(),e.uploadCount||i.change()}}),e.sortable=new Sortable($(".slider-list",this.root)[0],{scroll:!1,draggable:".slider-item",animation:300,delay:0,forceFallback:!0,setData:function(t,e){t.setData("text/html",e.innerHTML)},onEnd:function(t){var a=e.list.splice(t.oldIndex,1)[0];e.list.splice(t.newIndex,0,a),e.update(),i.change(),flexbe.stat.event("Editor - Media - Slider - Change order")}})})});
riot.tag2("media-video",'<label class="old-style"> {polyglot.t(\'editor::video::link\')} <input class="old-style" name="title" type="text" oninput="{changeText}" riot-value="{video.link}" placeholder="www.youtube.com/watch?v=j5CnnwwdSNk"> </label> <div class="links"> <a href="http://www.youtube.com/" data-type="youtube" target="_blank"></a> <a href="http://vimeo.com/" data-type="vimeo" target="_blank"></a> </div> <label class="old-style" if="{options.show_video_size}"> {polyglot.t(\'editor::video::sizes\')}</br> <div class="size-item {active: value == video.size}" each="{value, index in sizes}" onclick="{setSize}">{index + 1}x</div> </label>','media-video .size-item,[data-is="media-video"] .size-item{display:inline-block;padding:5px 12px;border:1px solid #C8C8C8;border-radius:2px;color:#C8C8C8;margin:10px 10px 0 0;cursor:pointer} media-video .size-item.active,[data-is="media-video"] .size-item.active{color:#fff;background-color:#000;border-color:#000;cursor:default}',"",function(e){this.tag=this,this.main=this.parent?this.parent.main?this.parent.main:this.parent:this;var i=this,t=e.editor;if(!t.data.video||!t.data.video.id){var a=t.data.slider&&t.data.slider.list.length&&t.data.slider.list.find(function(e){return e.hasOwnProperty("video")});a&&a.video?t.data.video=a.video:t.data.video={id:189995539,link:"vimeo.com/189995539",type:"vimeo"}}i.sizes=["small","medium","big"],i.options=t.options,i.video=t.data.video,this.setSize=function(e){i.video.size=e.item.value,t.change(),flexbe.stat.event("Editor - Media - Video - Size",{size:i.video.size})}.bind(this),this.changeText=function(a){var o=e.parseVideoLink(a.target.value);i.video=$.extend(i.video,o),t.change(),flexbe.stat.event("Editor - Media - Video - Change link")}.bind(this)});
riot.tag2("old-button-style",'<div class="submit-setup"> <div class="submit-text" if="{!opts.isQuiz}"> <label class="old-style" if="{!opts.isQuiz}">{polyglot.t(\'editor::button_style::submit\')}</label> <label class="old-style" if="{opts.isQuiz}">{polyglot.t(\'editor::button_style::submit_quiz\')}</label> <input class="old-style" type="text" placeholder="Введите текст" riot-value="{flexbe.lib.htmlspecialchars(data.submit, true)}" oninput="{setSubmit}"> </div> <div class="submit-color" if="{options.color}"> <label class="old-style" if="{!opts.isQuiz}">{options.is_link ? polyglot.t(\'editor::button_style::link_color\') : polyglot.t(\'editor::button_style::button_color\')}</label> <label class="old-style" if="{opts.isQuiz}">{polyglot.t(\'editor::button_style::elements_color\')}</label> <color-list class="color_list" active="{data.color || data.submit_color}" colors="{options.colors}" onchange="{setColor}" custom="{options.color_custom}"></color-list> </div> </div> <div class="style-setup theme-{theme}" if="{styles && !options.is_link}"> <label class="old-style" if="{!opts.isQuiz}">{polyglot.t(\'editor::button_style::style\')}</label> <label class="old-style" if="{opts.isQuiz}">{polyglot.t(\'editor::button_style::style_quiz\')}</label> <div class="style-list"> <div class="style {active: flexbe.lib.compareArray(data.btn_style || data.style, style)}" each="{style in styles}" onclick="{setStyle}"> <div class="button {style.join(\' \')} {flexbe.lib.contrastColor(data.color, \'dark\', \'light\')}" riot-style="color: {data.color}" data-text="{polyglot.t(\'editor::button_style::half_title\')}"></div> </div> </div> </div>','old-button-style,[data-is="old-button-style"]{ padding: 0; background: #fafafa; overflow: visible; font-size: 13px; } old-button-style .style-setup,[data-is="old-button-style"] .style-setup{ margin-top: 12px; } old-button-style .style-list,[data-is="old-button-style"] .style-list{ display: flex; flex-flow: row wrap; } old-button-style .style,[data-is="old-button-style"] .style{ position: relative; width: 46px; padding: 2px 1px; margin-right: 20px; } old-button-style .button,[data-is="old-button-style"] .button{ height: 30px; line-height: 28px; text-align: right; color: #3d51b0; border: 1px solid currentColor; border-right: 0; box-shadow: -1px 0 50px rgba(0,0,0,.07); cursor: pointer; opacity: .8; transform: translateZ(0); transition: all .2s; } old-button-style .filled,[data-is="old-button-style"] .filled{ background: currentColor; } old-button-style .rounded,[data-is="old-button-style"] .rounded{ border-radius: 17px 0 0 17px; } old-button-style .squared,[data-is="old-button-style"] .squared{ border-radius: 5px 0 0 5px; } old-button-style .button:before,[data-is="old-button-style"] .button:before{ content: "Офор"; font-size: 11px; font-weight: 500; color: #232323; } old-button-style .button:after,[data-is="old-button-style"] .button:after{ content: ""; display: block; width: 1px; height: 34px; position: absolute; top: -3px; right: -1px; background: currentColor; } old-button-style .light:before,[data-is="old-button-style"] .light:before{ color: #fff; } old-button-style .dark:before,[data-is="old-button-style"] .dark:before{ color: #232323; } old-button-style .button:not(.filled):before,[data-is="old-button-style"] .button:not(.filled):before{ color: #232323; } old-button-style .style:after,[data-is="old-button-style"] .style:after{ content: ""; display: block; width: 16px; height: 16px; border-radius: 50%; background: #fff; background-image: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDggNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMy4zMzggNi4xMzRhLjQ0OC40NDggMCAwIDEtLjYzMiAwYy0uMDA3LS4wMDctLjAwNC0uMDE4LS4wMS0uMDI1TC44NyA0LjI4N2EuNDg2LjQ4NiAwIDAgMSAuNjg3LS42ODZMMy4wOCA1LjEyOCA3LjQzNS43NzRhLjQ0Ny40NDcgMCAwIDEgLjYzMi42MzJMMy4zMzggNi4xMzR6IiBmaWxsPSIjM0Q1MUIwIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=); background-size: 10px 8px; background-position: 50%; background-repeat: no-repeat; box-shadow: -1px 0 3px rgba(0,0,0,.15); position: absolute; top: 50%; left: 0; margin: -8px 0 0 -6px; pointer-events: none; opacity: 0; transform: scale(.6); transition: opacity .2s,transform .3s ease-out; } old-button-style .style-list .active:after,[data-is="old-button-style"] .style-list .active:after{ opacity: 1; transform: scale(1); }',"",function(t){var o=t.editor;this.data=t.data,this.options=t.options,this.theme=flexbe.land.theme_id,this.styles=this.options.btn_styles,this.buttonStyleProperty=this.data.hasOwnProperty("btn_style")?"btn_style":"style",this.setSubmit=function(l){this.data.submit=flexbe.lib.htmlspecialchars(l.target.value),o.change(),t.eventStatGroup&&flexbe.stat.event(t.eventStatGroup+" - Change text")}.bind(this),this.setColor=function(l){this.data.color=l,1===flexbe_cli.theme_id&&(this.data.submit_color=l),this.update(),o.change("full"),t.eventStatGroup&&flexbe.stat.event(t.eventStatGroup+" - Change color")}.bind(this),this.setStyle=function(l){l.item&&l.item.style&&(this.data[this.buttonStyleProperty]=l.item.style,this.update(),o.change(),t.eventStatGroup&&flexbe.stat.event(t.eventStatGroup+" - Change style",{style:l.item.style}))}.bind(this)});
riot.tag2("action-select",'<div class="select {error: current.error}" onclick="{toggleActionSelect}"> <svg if="{sprite}"><use riot-xlink:href="{sprite}#{current.icon || current.name || \'none\'}"></use></svg> <span class="main-val">{current.label || current.lang || current.value}</span> <span class="sub-val" if="{current.desc}">{current.desc}</span> <div class="show-more-button {active: selectIsOpen}" if="{actions.length > 1}"></div> </div> <ul class="{show: selectIsOpen}"> <li class="{active: parent.opts.riotValue == action.value}" each="{action in actions}" onclick="{selectAction}"> <svg if="{sprite}"><use riot-xlink:href="{sprite}#{action.value || \'none\'}"></use></svg> <span>{action.title || action.value}</span> </li> </ul>',"",'class="action-select"',function(t){var e=this;this.sprite=t.sprite,this.actions=t.actions;var n=t.onselect||function(){},o=function(t){e.value=t||e.actions[0].value;var n=e.actions.filter(function(t){return t.value===e.value});e.current=n&&n[0]||{}};o(t.riotValue),this.selectAction=function(t){o(t.item.action.value),this.toggleActionSelect(!1),n(t)}.bind(this),this.selectIsOpen=!1,this.toggleActionSelect=function(e){var n=this,o=$("ul",this.root);"boolean"!=typeof e&&(e=!this.selectIsOpen),this.update({selectIsOpen:e}),e?(this.root.style.zIndex=999,o.css("top",""),setTimeout(function(){var e=t.overflowElement?$(n.root).closest(t.overflowElement):$("body"),i=Math.min(e.outerHeight()-30,o.outerHeight()),s=o.offset().top,c=e.get(0).getBoundingClientRect();i+s+15>c.bottom&&o.css("top",c.bottom-(i+s+15)+"px")},50),setTimeout(function(){$("body").off("click.toggleBtnSelect").on("click.toggleBtnSelect",function(t){$(t.target).closest(".action-list").length||n.toggleActionSelect(!1)})},300)):($("body").off("click.toggleBtnSelect"),this.root.style.zIndex="auto")}.bind(this)});
riot.tag2("codemirror",'<textarea class="codemirror-textarea" ref="textarea">{opts.riotValue}</textarea>','codemirror .codemirror-textarea,[data-is="codemirror"] .codemirror-textarea{ border: none; background: inherit; resize: none; outline: none; width: 100%; height: 100%; }',"",function(e){var r=this,t=e.settings||{};$("head #coremirror_css").length<1&&$("head").append('<link id="coremirror_css" href="/_s/lib/codemirror/5.28/lib/codemirror.css" rel="stylesheet" type="text/css" media="all">'),this.dispatchEvent=function(e){if(!e)return!1;r.instance&&(r.refs.textarea.value=r.instance.getValue());var t=new Event(e,{bubbles:!0,cancelable:!0});r.refs.textarea.dispatchEvent(t)}.bind(this),require({baseUrl:"/_s/lib/codemirror/5.28/"},["lib/codemirror"].concat([t.url]),function(e){r.instance=e(r.root,t.options),$(".codemirror-textarea").css("display","none"),r.instance.on("focus",function(){r.root.className="focused",r.dispatchEvent("focus")}),r.instance.on("blur",function(){r.root.className="",r.dispatchEvent("change")}),r.instance.on("change",function(){r.dispatchEvent("input")}),$(r.root).find(".CodeMirror textarea").on("change",function(e){return e.stopPropagation(),!1})})});
function _typeof(o){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o})(o)}riot.tag2("color-list",'<div class="title" if="{opts.title}">{opts.title}</div> <div class="color-wrap"> <div class="main-bar {inline: opts.inline}"> <div class="color" if="{showCustomColor}" ref="customColor"> <a title="{selected}" onclick="{selectCustomColor}" class="color-custom" riot-style="color: {selected}"> <svg viewbox="0 0 16 16"><path d="M1.478 13.34a2.09 2.09 0 0 1 .473-2.246L8.776 4.27 8 3.496l.584-.583A.817.817 0 0 1 9.75 2.91l.267.266L12.61.584a1.982 1.982 0 0 1 2.81 0 1.987 1.987 0 0 1 0 2.807l-2.593 2.592.27.27c.32.32.31.85-.003 1.164L12.51 8l-.778-.777-6.826 6.826c-.61.608-1.495.768-2.247.473a1.333 1.333 0 1 1-1.18-1.18zm8.255-8.007l.934.935-6.872 6.876a.665.665 0 0 1-.93-.002.653.653 0 0 1-.004-.933l6.873-6.877z" fill="currentColor" fill-rule="evenodd"></path></svg> </a> </div> <div class="color" if="{showColors}" each="{color, index in colors.slice(0, barLength)}" no-reorder> <a title="{color}" data-color="{color}" class="{selected: cleanColor(color) === selected}" onclick="{selectColor}" riot-style="background-color: {cleanColor(color)}"></a> </div> <div class="show-more-button {active: more}" if="{showMoreBar}" onclick="{toggleMoreBar}"></div> </div> <div class="more-bar {show: more}" if="{showMoreBar}"> <div class="color" each="{color,index in colors.slice(barLength, colors.length)}" no-reorder> <a title="{color}" data-color="{color}" class="{selected: cleanColor(color) === selected}" onclick="{selectColor}" riot-style="background-color: {cleanColor(color)}"></a> </div> </div> </div>',"","",function(o){var t=this;this.old_style=+flexbe.land.theme_id<=1,this.onchange=o.onchange||function(){},this.colors=[],this.more=!1,this.toggleMoreBar=function(){this.update({more:!this.more})}.bind(this),this.cleanColor=function(o){var t=String(o).split(":")[0];return this.normalizeColor(t)}.bind(this),this.normalizeColor=function(o){var t=o.replace(/^#/,"");return this.old_style?o:String(6===t.length?o:"#"+t[0]+t[0]+t[1]+t[1]+t[2]+t[2]).toUpperCase()}.bind(this),this.selectColor=function(o,t){void 0===t&&(t=!0);var e="object"==_typeof(o)?o.item.color:o;this.selected=this.cleanColor(e),this.onchange(e),t&&this.saveColor(e)}.bind(this),this.selectCustomColor=function(o){var t=this;$.fn.colorpicker({element:this.refs.customColor,value:this.selected,opacity:!1,colors:!this.old_style,buttons:!0,show:!0,change:function(o){t.selectColor("#"+o.hex,!1),t.update()},on_done:function(o){t.saveColor("#"+o.hex),t.setColors()}})}.bind(this),this.setColors=function(t){if(void 0===t&&(t=!0),this.colors=o.colors||(this.old_style?["blue","green","orange","purple","rose","red","yellow"]:["#000000","#222222","#FFFFFF","#4D69BE","#3D52B0","#2BB0D4","#95DAF8","#794C90","#E05BA5","#FC2F58","#DD4B39","#F06D28","#38A817","#1AC687","#8CC832","#AE7E4B","#F6B91F","#FFF55A"]),this.showCustomColor=!!o.custom,this.showColors=this.old_style&&!this.showCustomColor||!this.old_style,this.showCustomColor){var e=this.loadColors();Array.isArray(e)&&(this.colors=e.concat(this.colors))}this.colors=this.colors.map(this.normalizeColor),this.colors=flexbe.lib.arrayUnique(this.colors),this.selected=this.cleanColor(o.active||this.colors[0]),this.barLength=o.inline?this.colors.length:(o.length||6)-(this.showCustomColor?1:0),this.showMoreBar=this.showColors&&this.colors.length>this.barLength,t&&this.update()}.bind(this),this.loadColors=function(){var o=localStorage.getItem("colorset");try{o=JSON.parse(o)}catch(t){o=[]}return o||[]}.bind(this),this.saveColor=function(o){if(o&&!this.old_style){var t=this.loadColors()||[];t.unshift(o),t.splice(5,t.length-1),localStorage.setItem("colorset",JSON.stringify(t))}}.bind(this),this.on("update",function(o){"object"==_typeof(o)&&void 0!==o.more&&o.more&&setTimeout(function(){$("body").off("click.toggleMoreBar").on("click.toggleMoreBar",function(o){$(o.target).closest(".more-bar").length||$(o.target).is(".show-more-button")||(t.update({more:!1}),$("body").off("click.toggleMoreBar"))})},300)}),this.on("mount",function(){t.setColors()})});
riot.tag2("flexbe-field-list","<yield></yield>","","",function(e){var a=this;this.tag=this.parent?this.parent:this,this.main=this.parent?this.parent.main?this.parent.main:this.parent:this;var t=e.sortend||e.sortEnd||function(){},l=e.itemSelector||".field-item",s=e.handleSelector||!1,i="field-list__sortable-item",n="field-list__sortable-ghost",o="field-list__sortable-drag",r="field-list__sortable-chosen",d="field-list__sortable-placeholder",c="field-list--sortable";this.on("mount",function(){var h,f;h=e.listSelector?a.root.querySelector(e.listSelector):a.root,f=$(h),new Sortable(h,{delay:0,scroll:!0,animation:{duration:300,easing:"ease"},ghostAnimation:{duration:180,easing:"ease"},fallbackOpacity:1,fallbackScale:1,fallbackTolerance:1,forceFallback:!0,disableLayerCheck:!0,draggable:l,handle:s,ghostClass:n,dragClass:o,chosenClass:r,placeholderClass:d,onStart:function(e){var a=f.find(l);f.addClass(c),a.addClass(i)},onUnchoose:function(e){var a=f.find(l);f.removeClass(c),a.removeClass(i)},onEnd:function(e){var a=e.oldIndex,l=e.newIndex;a!==l&&t(a,l)}})})});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}riot.tag2("image-item",'<div class="image {move: inMove}" if="{image && image.percent === undefined}" data-size="{image.size || \'cover\'}" riot-style="padding-bottom: {opts.imageHeight || 100}%; background-image: url(/img/{image.id}{postfixHeight}/{image.name}); background-position: {(image.position && image.position.x) || \'50%\'} {(image.position && image.position.y) || \'50%\'};"> <img if="{image && image.percent === undefined}" class="original-image" riot-src="/img/{image.id}{postfixHeight}/{image.name}" draggable="false"> <div class="action"> <span title="{polyglot.t(\'editor::img_item::position\')}" if="{!inMove && !~[\'contain\', \'repeat\'].indexOf(image.size)}" class="aim" onclick="{setMove}"> <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/_s/images/land/editor/block_controls.svg?2#aim"></use></svg> </span> <span title="{polyglot.t(\'editor::img_item::editor\')}" if="{!inMove}" class="pencil" onclick="{getPhotoEditor}"> <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/_s/images/land/editor/block_controls.svg?3#pencil"></use></svg> </span> <span if="{inMove}" title="{polyglot.t(\'editor::img_item::apply\')}" class="done" onclick="{applyMove}" onmousedown="{blockEvent}"> <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/_s/images/land/editor/block_controls.svg?2#done"></use></svg> </span> <span if="{canDelete && !inMove}" title="{polyglot.t(\'editor::img_item::delete\')}" class="delete" onclick="{deleteImage}"> <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/_s/images/land/editor/block_controls.svg?2#delete"></use></svg> </span> </div> <div class="move-helper"></div> </div> <div if="{image.percent !== undefined}" class="image uploading" riot-style="padding-bottom: {opts.imageHeight || 100}%;"> <div class="percent"><span riot-style="width: {image.percent}%"></span></div> <div class="action" if="{canDelete}"> <span title="{polyglot.t(\'editor::img_item::cancel\')}" class="delete" onclick="{deleteImage}"> <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/_s/images/land/editor/block_controls.svg?2#delete"></use></svg> </span> </div> </div>',"",'class="image-item"',function(e){var i=this,t=e.onupdate||function(){},o=e.ondelete||function(){},n=function(){if(i.image&&void 0===i.image.percent){var e=$(".image",i.root),t=e[0].offsetWidth,o=e[0].offsetHeight,n=o/t*100,a=e.find("img")[0].naturalWidth,s=e.find("img")[0].naturalHeight,l=s/a*100,m=n!==l&&(n>l?"w":"h"),d="h"==m?t:a/(s/o),g="w"==m?o:s/(a/t);i.settings={direction:m,ww:d-t,hh:g-o},e.attr("direction",m)}},a=function(){var t=e.item;!t||i.image===t&&void 0===i.image||(i.image=t,i.postfixHeight=/.svg$/.test(t.name)?"":"_500",i.canDelete=e.canDelete)},s=function(o){var n=$(".image",i.root),a=i.settings,s=a.direction,l=a.ww,m=a.hh,d=o.clientX,g=o.clientY,r=e.item;n.addClass("in"),"object"!=_typeof(r.position)&&(r.position={x:"50%",y:"50%"});var c=Object.assign({x:"50%",y:"50%"},r.position);function p(){n.css("background-position",r.position.x+" "+r.position.y)}return c.x=parseFloat(c.x),c.y=parseFloat(c.y),$document.on("mousemove",function(e){var i="w"==s?(e.clientX-d)/l*100:0,t="h"==s?(e.clientY-g)/m*100:0;r.position.x="w"==s?Math.min(100,Math.max(0,c.x-i))+"%":"50%",r.position.y="h"==s?Math.min(100,Math.max(0,c.y-t))+"%":"50%",requestAnimationFrame(p)}),$document.on("mouseup",function(e){n.removeClass("in"),$document.off("mouseup mousemove"),t()}),o.stopPropagation(),o.preventDefault(),flexbe.stat.event("Editor - Media - Image position - Move"),!1};this.blockEvent=function(e){e.stopPropagation()}.bind(this),this.setMove=function(){i.inMove=!0,!i.settings&&i.settings.direction||($(".image",i.root).on("mousedown",s),$(i.root).on("pointerdown",i.blockEvent))}.bind(this),this.applyMove=function(){return i.inMove=!1,$(".image",i.root).off("mousedown"),$(i.root).off("pointerdown"),flexbe.stat.event("Editor - Media - Image position - Apply"),!1}.bind(this),this.getPhotoEditor=function(){var o=document.location.host,n=e.item;flexbe.view&&flexbe.view.document.domain&&(o=flexbe.view.document.domain);var a=document.location.protocol+"//"+o+"/img/"+n.id+"_1920/"+n.name;flexbe.land.image.aviary.run({image:$("img",i.root).get(0),url:a,img_name:n.name,save:function(e){n.id=e.id,n.name=e.name,t(),i.update(),flexbe.stat.event("Editor - Media - Aviary - Save")}}),flexbe.stat.event("Editor - Media - Aviary - Open")}.bind(this),this.deleteImage=function(e){var i=e.item;o(i.index,i.slide),flexbe.stat.event("Editor - Media - Slider - Delete image")}.bind(this),i.on("before-mount",a),i.on("update",a),i.on("mount",$.debounce(n,100)),i.on("updated",$.debounce(n,100))});
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}riot.tag2("radio-buttons",'<div each="{item in list}" class="radio-buttons-label {active: (tag.opts.current == item.name)}" onclick="{tag.onselect.bind(this, item)}" data-value="{item.name}"> <svg if="{tag.sprite}"><use riot-xlink:href="{tag.sprite}#{(typeof item == \'object\') ? item.name : item}"></use></svg> <span if="{item.value}">{item.value}</span> </div>',"","",function(t){this.tag=this,this.main=this.parent?this.parent.main?this.parent.main:this.parent:this,this.sprite=t.sprite,this.list=(t.list||[]).map(function(t){return"object"===_typeof(t)?t:{name:t}}),this.onselect=t.onselect||function(){}});
riot.tag2("video-item",'<iframe if="{source}" riot-src="{source}" frameborder="0" allowfullscreen></iframe> <div class="action"> <span if="{opts.canDelete}" title="{polyglot.t(\'editor::video_item::delete\')}" class="delete" onclick="{deleteVideo}"> <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/_s/images/land/editor/block_controls.svg?2#delete"></use></svg> </span> </div>','video-item,[data-is="video-item"]{position:relative;overflow:hidden} video-item:after,[data-is="video-item"]:after{content:\'\';background:url(data:image/svg+xml,%3Csvg%20viewBox%3D%220%200%2022%2022%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%3E%0A%20%20%20%20%3Cdefs%3E%3Cpath%20d%3D%22M450%2020c0-5.523%204.476-10%2010-10%205.523%200%2010%204.476%2010%2010%200%205.523-4.476%2010-10%2010-5.523%200-10-4.476-10-10zm7-4.005v8.01c0%20.54.383.757.856.463l6.288-3.91c.47-.29.48-.767.015-1.06l-6.32-3.97c-.454-.286-.84-.082-.84.467z%22%20id%3D%22aa%22/%3E%0A%20%20%20%20%20%20%20%20%3Cmask%20id%3D%22ab%22%20x%3D%22-1%22%20y%3D%22-1%22%20width%3D%2222%22%20height%3D%2222%22%3E%3Cpath%20fill%3D%22%23fff%22%20d%3D%22M449%209h22v22h-22z%22/%3E%3Cuse%20xlink%3Ahref%3D%22%23aa%22/%3E%3C/mask%3E%0A%20%20%20%20%3C/defs%3E%0A%20%20%20%20%3Cg%20transform%3D%22translate%28-449%20-9%29%22%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%20opacity%3D%22.704%22%3E%3Cuse%20fill%3D%22%23FFF%22%20xlink%3Ahref%3D%22%23aa%22/%3E%3Cuse%20stroke-opacity%3D%22.05%22%20stroke%3D%22%23000%22%20mask%3D%22url%28%23ab%29%22%20stroke-width%3D%222%22%20xlink%3Ahref%3D%22%23aa%22/%3E%3C/g%3E%0A%3C/svg%3E);width:20px;height:20px;display:block;position:absolute;margin:10px} video-item iframe,[data-is="video-item"] iframe{position:absolute;width:100%;height:100%;pointer-events:none}','class="video-item" riot-style="padding-bottom: {opts.imageHeight || 100}%;"',function(e){var i=e.item,t=e.ondelete||function(){};if(this.deleteVideo=function(e){var i=e.item;t(i.index,i.slide)}.bind(this),i)switch(i.type){case"youtube":this.source="//www.youtube.com/embed/"+i.id+"?vq=hd1080&rel=0&controls=1&modestbranding=1&showinfo=0&autohide=1&color=white";break;case"vimeo":this.source="//player.vimeo.com/video/"+i.id+"?badge=0&byline=0&title=0&portrait=0&color=white"}});
riot.tag2("action-block-cart",'<div class="cart-open"> <div class="flexbe-button style-blue filled" ref="button" onclick="{openCart}"> <span>{polyglot.t(\'editor::action_block::open\')}</span> </div> </div> <virtual if="{main.options.show_cart_product_setup}"> <label class="flexbe-form-title"> {polyglot.t(\'editor::button::product_title\')} </label> <div class="product-info"> <div class="product-image {loaded: background()} {loading: loading}" riot-style="{background()}"> <label class="upload-input"> <input type="file" oninput="{blockEvent}" onchange="{blockEvent}"> </label> <svg class="cartnoimage" width="16" height="13" viewbox="0 0 16 13" xmlns="http://www.w3.org/2000/svg"> <circle class="loader-path" fill="none" stroke="currentcolor" stroke-width="2" cx="8" cy="7" r="2"></circle> <path fill-rule="evenodd" d="M3.83 1.106A2 2 0 0 1 5.617 0h4.764a2 2 0 0 1 1.79 1.106l.446.894H14a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h1.382l.447-.894zM10.38 2H5.618l-.724 1.447A1 1 0 0 1 4 4H2v7h12V4h-2a1 1 0 0 1-.894-.553L10.382 2z"></path> </svg> <svg if="{loading}" class="loader circular-loader" viewbox="25 25 50 50"><circle class="loader-path" cx="50" cy="50" r="20"></circle></svg> </div> <label data-is="flexbe-input" class="flexbe-input product-title" name="product.title" placeholder="{opts.options.placeholders.title.trim()}" riot-value="{opts.data.product.title}" onchange="{trimTitle}"></label> <label data-is="flexbe-input" class="flexbe-input product-price" name="product.price" placeholder="{opts.options.placeholders.price.trim()}" riot-value="{opts.data.product.price}" type="{\'number\'}"></label> </div> </virtual>',"","",function(t){var e=this;this.tag=this,this.main=this.parent?this.parent.main?this.parent.main:this.parent:this,this.loading=!1,this.blockEvent=function(t){t.stopPropagation()}.bind(this),this.background=function(){var e=t.data.product.img||t.options.placeholders.img;return e?"background-image: url("+e+"); background-size: cover;":""}.bind(this),this.trimTitle=function(t){t.target.value=t.target.value.trim()}.bind(this),this.openCart=function(t){t.stopPropagation(),flexbe_cli.events.emit("cart_command",{command:"toggle"}),flexbe.view.$document.find(".widget-list").css("zIndex",99),this.opts.options.editor.modal&&this.opts.options.editor.modal.close()}.bind(this),this.on("mount",function(){flexbe.files.upload.init({multi:!1,type:"image",$input:$('input[type="file"]',e.root),on_start:function(){e.update({loading:!0})},on_complete:function(t,i){if(t&&i&&i.img_id){var o=new Event("change",{bubbles:!0,cancelable:!0}),a=document.createElement("input");a.name="product.img",a.value="/img/"+i.img_id+"_200/"+i.img_name,a.style.display="none",e.root.appendChild(a),a.dispatchEvent(o),a.remove(),flexbe.stat.event("Editor - Button - Product - Upload",{image_name:i.image_name})}else alertify.error(polyglot.t("editor::button::upload_error")),flexbe.stat.event("Editor - Button - Product - Upload error");e.update({loading:!1})}})})});
riot.tag2("action-block-file",'<div class="upload-info"> <label data-is="flexbe-input" class="flexbe-input" placeholder="{polyglot.t(\'editor::button::file_placeholder\')}" riot-value="{(opts.data.action_file || \'\').replace(/\\/files\\//, \'\')}" readonly="readonly"></label> <div class="flexbe-button style-blue filled upload-btn"> <label class="upload-input"> <input type="file" oninput="{blockEvent}" onchange="{blockEvent}"> </label> <span>{polyglot.t(\'editor::button::file_load\')}</span> <div class="progress-block"> <div class="progress-loader"> <svg class="progress-loader-circle" width="30" height="30" viewbox="-3 -3 38 38" style="transform: rotate(-90deg)"> <circle class="current" cx="16" cy="16" r="16" stroke-dasharray="100" stroke-dashoffset="{100 - progress}" stroke-width="4"></circle> <circle class="progress-loader-bg" cx="16" cy="16" r="16" stroke-width="4"></circle> </svg> </div> <span class="percents">{progress}%</span> </div> <div class="done done-icon"> <svg class="done done-icon"> <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/_s/images/land/editor/panel.svg#done"></use> </svg> </div> </div> </div> <div class="force_load"> <label data-is="flexbe-input" checked="{opts.data.force_download}" onchange="{toggleForceDownLoad}" class="flexbe-input toggle field-required" type="checkbox"> <span>{polyglot.t(\'editor::button::file_force\')}</span> </label> <div class="flexbe-tooltip">{polyglot.t(\'editor::button::file_help\')}</div> </div>',"","",function(e){var t=this;this.data=e.data,this.progress=0,this.blockEvent=function(e){e.stopPropagation()}.bind(this),this.toggleForceDownLoad=function(e){this.data.force_download=Number(e.target.checked)}.bind(this),this.on("mount",function(){flexbe.files.upload.init({multi:!1,type:"file",$input:$('input[type="file"]',t.root),on_select:function(){$(".upload-btn").addClass("active"),t.update({progress:1})},on_progress:function(e,o){o<100&&t.update({progress:o})},on_complete:function(e,o){if(e&&o&&o.f_id){var l=$(".upload-btn",t.root);l.removeClass("active"),l.addClass("success"),setTimeout(function(){l.removeClass("success")},2e3);var s=new Event("change",{bubbles:!0,cancelable:!0}),a=document.createElement("input");a.name="action_file",a.value="/files/"+o.f_name,a.style.display="none",t.root.appendChild(a),a.dispatchEvent(s),a.remove(),flexbe.stat.event("Editor - Button - File - Upload",{file_name:o.f_name})}else alertify.error(polyglot.t("editor::button::upload_error")),flexbe.stat.event("Editor - Button - File - Upload error")}}),flexbe.tip.init(t.parent.root)})});
riot.tag2("action-block-link",'<flexbe-link class="flexbe-link" name="{linkName}" riot-value="{opts.data[linkName]}" placeholder="{polyglot.t(\'editor::button::link_placeholder\')}" links="{[\'pages\', \'anchor\']}"></flexbe-link> <label disabled="{!(opts.data[linkName] && !checkOnAnchor())}" data-is="flexbe-input" checked="{opts.data[linkBlankName]}" name="{linkBlankName}" class="flexbe-input toggle" type="checkbox"> <span>{polyglot.t(\'editor::button::link_blank\')}</span> </label>',"","",function(n){this.tag=this,this.main=this.parent?this.parent.main?this.parent.main:this.parent:this;var t=this.main.editor instanceof flexbe.land.editor.modules.media;this.linkName=t?"url":"action_link",this.linkBlankName=t?"link_blank":"action_link_blank",this.checkOnAnchor=function(){return/^(\.\/#|#)/.test(this.opts.data[this.linkName])}.bind(this)});
riot.tag2("action-block-modal",'<div class="load"> <div class="flexbe-button {modal ? \'style-gray filling\' : \'style-blue filled\'}" ref="modal" onclick="{selectModal}"> <span>{polyglot.t(\'editor::action_block::modal_select\')}</span> </div> </div> <div class="edit" if="{modal}"> <label data-is="flexbe-input" class="flexbe-input" riot-value="{\'#\' + (tag.modal.data._anchor ? tag.modal.data._anchor : tag.modal.id)}" readonly="readonly"></label> <div class="flexbe-button style-blue filled upload-btn" onclick="{editModal}"> <span>{polyglot.t(\'editor::action_block::edit_modal\')}</span> </div> </div>',"","",function(t){this.tag=this,this.main=this.parent?this.parent.main?this.parent.main:this.parent:this,this.modal=pageStore.getEntity(t.data.modal_id,"modal");var a=this.main.opts.editor.entity.siteBlockType;this.selectModal=function(){var l=this,e=t.options,o=t.data;flexbe.land.modal.control.showList({preview:!0,siteBlockType:a,exclude:e.exclude,excludeGroup:e.excludeGroup,editor:e.editor.modal,currentId:o.modal_id,onselect:function(t){var a=new Event("change",{bubbles:!0,cancelable:!0}),e=l.refs.modal;e.name="modal_id",e.value=t,e.dispatchEvent(a),l.update({modal:pageStore.getEntity(t,"modal")})}})}.bind(this),this.editModal=function(){var a=t.options,l=t.data;flexbe.land.modal.control.open(l.modal_id,a.editor.modal)}.bind(this)});
riot.tag2("action-block-pay",'<div if="{flexbe.land.pays_active != 1}"> {polyglot.t(\'editor::form::pay_warn_integration\')} <a target="_blank" href="/admin/settings/pay/">{polyglot.t(\'editor::form::integration_link\')}</a> </div> <div class="pay-info" if="{flexbe.land.pays_active == 1 && !opts.options.price_select}"> {polyglot.t(\'editor::form::pay_warn_price\')} </div> <virtual if="{flexbe.land.pays_active == 1 && opts.options.price_select}"> <div class="product-info"> <div class="product-image {loaded: background()} {loading: loading}" riot-style="{background()}"> <label class="upload-input"> <input type="file" oninput="{blockEvent}" onchange="{blockEvent}"> </label> <svg class="cartnoimage" width="16" height="13" viewbox="0 0 16 13" xmlns="http://www.w3.org/2000/svg"> <circle class="loader-path" fill="none" stroke="currentcolor" stroke-width="2" cx="8" cy="7" r="2"></circle> <path fill-rule="evenodd" d="M3.83 1.106A2 2 0 0 1 5.617 0h4.764a2 2 0 0 1 1.79 1.106l.446.894H14a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h1.382l.447-.894zM10.38 2H5.618l-.724 1.447A1 1 0 0 1 4 4H2v7h12V4h-2a1 1 0 0 1-.894-.553L10.382 2z"></path> </svg> <svg if="{loading}" class="loader circular-loader" viewbox="25 25 50 50"><circle class="loader-path" cx="50" cy="50" r="20"></circle></svg> </div> <label data-is="flexbe-input" class="flexbe-input product-title" name="pay.title" placeholder="{polyglot.t(\'editor::actions::product_title\')}" riot-value="{opts.data.pay.title}" onchange="{trimTitle}"></label> <label data-is="flexbe-input" class="flexbe-input product-price" name="pay.price" placeholder="0 ₽" riot-value="{opts.data.pay.price}" type="{\'number\'}"></label> </div> </virtual>',"","",function(t){var e=this,a=this;a.loading=!1,this.blockEvent=function(t){t.stopPropagation()}.bind(this),this.background=function(){var e=t.data.pay.img;return e?"background-image: url("+e+"); background-size: cover;":""}.bind(this),this.trimTitle=function(t){t.target.value=t.target.value.trim()}.bind(this),a.on("mount",function(){flexbe.files.upload.init({multi:!1,type:"image",$input:$('input[type="file"]',a.root),on_start:function(){a.update({loading:!0})},on_complete:function(t,i){if(t&&i&&i.img_id){var l=new Event("change",{bubbles:!0,cancelable:!0}),o=document.createElement("input");o.name="pay.img",o.value="/img/"+i.img_id+"_200/"+i.img_name,o.style.display="none",a.root.appendChild(o),o.dispatchEvent(l),o.remove(),flexbe.stat.event("Editor - Form - Pay - Upload",{image_name:i.img_name})}else alertify.error(polyglot.t("editor::button::upload_error")),flexbe.stat.event("Editor - Form - Pay - Upload error");e.update({loading:!1})}})})});
riot.tag2("action-block-quiz",'<div class="flexbe-button style-blue filled" ref="button" onclick="{openQuiz}"> <span>{polyglot.t(\'editor::action_block::open\')}</span> </div>',"","",function(i){this.tag=this,this.main=this.parent?this.parent.main?this.parent.main:this.parent:this,this.openQuiz=function(){flexbe_cli.events.emit("quiz_command",{command:"start",id:this.main.editor.block.id}),this.main.editor.modal&&this.main.editor.modal.close()}.bind(this)});
riot.tag2("action-block-redirect",'<flexbe-link class="flexbe-link" name="action_redirect" riot-value="{opts.data.action_redirect}" placeholder="{polyglot.t(\'editor::form::redirect_placeholder\')}" links="{[\'pages\']}"></flexbe-link>',"","",function(t){this.tag=this,this.main=this.parent?this.parent.main?this.parent.main:this.parent:this});
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}riot.tag2("dropdown-module-choise",'<div class="module-title"> {title} </div> <ul class="preset-{s.options.preset}"> <li each="{state in s.options.states}" onclick="{selectValue}" class="{active: state.value == data}"> {state.title} </li> </ul> <div class="module-caption"> {caption} </div>',"","",function(t){var e=this;this.index=this.opts.editorIndex,this.s=this.parent.dropdown[this.index],this.varname=this.s.var,this.title=polyglot.t("editor::dropdown_choice::var_choice"),this.caption="",this.selectValue=function(t){var e=this,o=this.parent.editor,i=t.item.state.value;"object"==_typeof(o.data)?o.data[this.varname]=i:o.data=i,setTimeout(function(){o.change(e.s.options.render)},200)}.bind(this),this.on("update",function(){var t=e.parent.editor;e.data="object"!==_typeof(t.data)?t.data:t.data[e.varname]}),this.on("mount",function(){e.s.options=$.extend({},{preset:"custom",states:[],render:["template"]},e.s.options),"seo"==e.s.options.preset&&(e.title=polyglot.t("editor::dropdown_choice::seo_title"),e.s.options.states=[{value:"h1",title:"H1"},{value:"h2",title:"H2"},{value:"h3",title:"H3"},{value:"div",title:"DIV"}],e.caption=polyglot.t("editor::dropdown_choice::seo_caption"))})});
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}riot.tag2("editor-anchors",'<div class="sections-list"> <label class="old-style title">{polyglot.t(\'editor::anchor::choose_title\')}</label> <ul> <li each="{block in blockList}"> <input class="old-style" type="checkbox" id="item-{block.id}" checked="{!!getBlockInfo(block.id).enabled}" onchange="{setBulletState}"> <label for="item-{block.id}" class="old-style group-name">{polyglot.t(blockGroups[block.group].name) + (block.abtest ? \' (\' + block.abtest.toUpperCase() + \')\' : \'\')}</label> <span class="anchor-name" onclick="{selectAnchor.bind(this, block)}" title="{polyglot.t(\'editor::anchor::anchor_title\')}">{block.anchor ? \'#\' + block.anchor : polyglot.t(\'editor::anchor::no_anchor\')}</span> <input type="text" class="old-style bullet-title" placeholder="{polyglot.t(\'editor::anchor::placeholder\')}" riot-value="{getBlockInfo(block.id).title}" oninput="{setBulletText}"> </li> </ul> </div> <div class="style-list" data-theme="{flexbe_cli.theme_id}"> <label class="old-style title">{polyglot.t(\'editor::anchor::bullet_title\')}</label> <ul> <li each="{style in options.styles}" data-style="{style}" class="{active: style == data.style}" onclick="{setBulletStyle}"> <div if="{data.show_title}" class="bullet-title">{polyglot.t(\'editor::anchor::catalog\')}</div> <div class="bullets-container"><i></i><i></i><i></i></div> <span> <svg viewbox="0 0 11 8" xmlns="http://www.w3.org/2000/svg"><path d="M4.15 8.03a.575.575 0 0 1-.813 0c-.01-.01-.006-.024-.013-.033-.005-.005-.013-.003-.018-.008L.973 5.656a.625.625 0 0 1 .884-.884l1.96 1.962 5.598-5.598a.575.575 0 0 1 .813.813l-6.08 6.08z"></path></svg> </span> </li> </ul> <label class="old-style show-title"> <input class="old-style" type="checkbox" checked="{data.show_title}" onchange="{toggleShowTitle}"> <span>{polyglot.t(\'editor::anchor::show_title\')}</span> </label> </div>',"","",function(t){this.data=this.opts.data,this.editor=this.opts.editor,this.options=this.opts.options,this.blockList=this.opts.blockList,this.blockGroups=configStore.themeJson.block,this.getBlockInfo=function(t){var e={};return this.data.list.some(function(l){l.id==t&&(e.title=l.title,e.enabled=l.enabled)}),e}.bind(this),this.setBlockInfo=function(t,e){t&&e&&"object"==_typeof(e)&&(this.data.list=this.data.list.map(function(l){if(l.id==t)for(var o in e)e.hasOwnProperty(o)&&(l[o]=e[o]);return l}),this.editor.change())}.bind(this),this.setBulletState=function(t){this.setBlockInfo(t.item.block.id,{enabled:t.target.checked?1:0})}.bind(this),this.setBulletText=function(t){this.setBlockInfo(t.item.block.id,{title:t.target.value})}.bind(this),this.setBulletStyle=function(t){this.data.style=t.item.style,this.editor.change()}.bind(this),this.toggleShowTitle=function(t){this.data.show_title=t.target.checked?1:0,this.editor.change()}.bind(this),this.selectAnchor=function(t){var e=pageStore.$blocks.filter('[data-id="'+t.id+'"]'),l=e.offset().top-(flexbe_cli.resize.height-e[0].offsetHeight)/2;flexbe.view.$document.find("body, html").animate({scrollTop:l})}.bind(this)});
riot.tag2("editor-bgposition",'<div class="contain image"> <div class="image-holder-outer"> <div class="image-holder data_img" onmousedown="{showPreview}"> <img class="img" riot-src="{image}"> <div class="percent"> <span riot-style="width: {loaded}%"></span> </div> </div> <div class="bgpreview {show: pressed}"> <div class="view-laptop"> <svg class="laptop-svg"> <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/_s/images/land/editor/editor_background.svg#laptop"></use> </svg> <div class="img-viewport" riot-style="background: url({image}) center / cover no-repeat; background-position: {pos.x} {pos.y};"></div> </div> <div class="view-mobile"> <div class="mobile-outer"> <div class="mobile-device"> <div class="mobile-viewport" riot-style="background: url({image}) center / cover no-repeat; background-position: {pos.x} {pos.y};"></div> </div> </div> </div> </div> <div class="label {hide: pressed}">{polyglot.t(\'editor::bg_setting::pick_a_visible_area\')}</div> </div> <div class="image-action row"> <div class="col col-12"> <button onclick="{apply}" class="bg_option flexbe-button block style-blue filled size-m icon"> <span> {polyglot.t(\'editor::bg_setting::save_bgposition\')} </span> </button> </div> </div> </div>',"","",function(i){var s=this;this.bg=this.opts.bg,this.options=this.opts.options,this.params=this.opts.params,this.loaded=100,this.pickerVisible=!1,this.pressed=!1,this.pos=this.bg.position,this.image="image"===this.bg.type?this.bg.image:this.bg.video_image;var o=this.opts,t=o.change,e=o.editor;this.showPreview=function(){s.pressed=!0},$(window).mouseup(function(){s.pressed=!1,s.update()}),this.apply=function(){s.bg.position=s.pos,t(),s.opts.modal.close()},this.on("mount",function(){$(".data_img",s.root).dragBg({block:e.$area,bg_el_selector:".component-bg .image",pos:{x:s.bg.position.x||50,y:s.bg.position.y||50}},function(i){s.pos=i,s.update()})})});
riot.tag2("editor-button",'<div class="flexbe-modal-content"> <div data-is="flexbe-group-button" class="flexbe-group-button dark" buttons="{tabs}" onchange="{selectTab}"></div> </div> <div if="{state == \'button\'}"> <div class="flexbe-modal-content"> <button-style class="button-style" options="{opts.options}" data="{data}" onchange="{editorUpdate}" modal="{opts.modal}" event-stat-group="Editor - Button"></button-style> </div> <hr> <div class="flexbe-modal-content"> <label class="flexbe-form-title"> {polyglot.t(\'editor::actions::button_title\')} </label> <action-block class="action-block" data="{main.data}" editor="{main.editor}" modal="{main.opts.modal}" options="{main.options}" actions="{main.options.actions}" riot-value="{main.data.action}" onchange="{actionChanges}" oninput="{actionChanges}"></action-block> </div> </div> <div if="{state == \'goals\'}"> <hr> <div class="flexbe-modal-content"> <div data-is="goals" main-goal="{flexbe_cli.stat.getGoal(main.data.action, (main.data.action == \'modal\' && main.data.modal_id))}" goals="{main.data.goals}" action="{main.data.action}" changed="{goalsUpdate}"></div> </div> </div>',"","",function(t){this.tag=this,this.main=this,this.tabs=[{value:"button",title:polyglot.t("editor::button_style::button")},{value:"goals",title:polyglot.t("editor::modal::tab_goals")}],this.state=this.tabs[0].value,this.options=t.options,this.data=t.data,this.editor=t.editor,this.selectTab=function(t){this.update({state:t.value})}.bind(this),this.actionChanges=function(t){var a=t.target.name.split("."),i=a.splice(a.length-1,1)[0],o="checkbox"===t.target.type?Number(t.target.checked):t.target.value;a.reduce(function(t,a){var i=void 0===t[a],o=Array.isArray(t[a])&&!t[a].length;return(i||o)&&(t[a]={}),t[a]||t},this.data)[i]=o,this.editorUpdate()}.bind(this),this.goalsUpdate=function(a){t.data.goals=a,this.update(),this.editorUpdate(),flexbe.stat.event("Editor - Button - Goals - Update")}.bind(this),this.editorUpdate=function(a){"string"!=typeof a&&(a=null),t.onchange(a)}.bind(this)});
riot.tag2("editor-form-field-add",'<div class="field-type-list"> <div class="field-type" data-type="{type}" onclick="{fieldSelect}" each="{list}"> <svg><use riot-xlink:href="/_s/images/land/editor/field_types.svg#{type}"></use></svg> <span>{name}</span> </div> </div>',"","",function(t){var e=this;this.list=t.templates||t.list||[],t.allowed&&t.allowed.length&&(this.list=t.allowed.map(function(t){return e.list.find(function(e){return e.type===t})})),this.fieldSelect=function(e){"function"==typeof t.onchange&&t.onchange(e)}.bind(this)});
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}riot.tag2("editor-form-field-edit",'<label class="flexbe-form-title">{polyglot.t(\'editor::form::field_name\')}</label> <label data-is="flexbe-input" class="flexbe-input" data-field="name" riot-value="{opts.field.name}" oninput="{changeField}"></label> <label if="{main.options.allow_desc && opts.field.type !== \'checkbox\'}" class="flexbe-form-title">{polyglot.t(\'editor::form::field_desc\')}</label> <label if="{main.options.allow_desc && opts.field.type !== \'checkbox\'}" data-is="flexbe-input" class="flexbe-input" data-field="desc" riot-value="{opts.field.desc}" oninput="{changeField}"></label> <div if="{/select|radio/.test( opts.field.type)}"> <label class="flexbe-form-title">{polyglot.t(\'editor::form::field_vars\')}</label> <textarea class="flexbe-textarea" oninput="{changeTextareaField}">{opts.field.vars.join(\'\\n\')}</textarea> </div> <label if="{/text|textarea|file|phone|email|name|checkbox/.test( opts.field.type )}" data-is="flexbe-input" type="checkbox" class="flexbe-input toggle field-required" data-name="is_required" checked="{serializeRequired( opts.field.is_required )}" onchange="{changeChecked}"><span>{polyglot.t(\'editor::form::field_required\')}</span></label> <label if="{opts.field.type == \'checkbox\'}" data-is="flexbe-input" type="checkbox" class="flexbe-input toggle field-required" data-name="is_checked" checked="{serializeRequired( opts.field.is_checked )}" onchange="{changeChecked}"><span>{polyglot.t(\'editor::form::field_default\')}</span></label>',"","",function(e){this.tag=this,this.main=this.parent?this.parent.main?this.parent.main:this.parent:this;var t=e.onupdate||function(){},i=this;i.tag=i.parent?i.parent:i,i.main=i.parent?i.parent.main?i.parent.main:i.parent:i,this.serializeRequired=function(e){switch(_typeof(e)){case"number":return Boolean(e);case"string":return"true"==e}return!1}.bind(this),this.changeChecked=function(i){var l=$(i.target).parents(".flexbe-input").attr("data-name");e.field[l]=Number(i.target.checked),t(),flexbe.stat.event("Editor - Form - Fields - Edit")}.bind(this),this.changeField=function(i){var l=$(i.target).parents(".flexbe-input").data("field");e.field[l]=i.target.value,t(),flexbe.stat.event("Editor - Form - Fields - Edit")}.bind(this),this.changeTextareaField=function(i){e.field.vars=i.target.value.split("\n"),t(),flexbe.stat.event("Editor - Form - Fields - Edit")}.bind(this)}),riot.tag2("editor-form",'<div class="flexbe-modal-content"> <div data-is="flexbe-group-button" class="flexbe-group-button dark" buttons="{tabs}" onchange="{selectTab}"></div> </div> <div if="{state == \'form\'}"> <div class="flexbe-modal-content-title"> {polyglot.t(\'editor::form::fields_title\')} </div> <div class="flexbe-modal-content"> <div data-is="flexbe-field-list" if="{!destroyList}" class="field-list {no-remove: data.list.length === options.min}" handle-selector=".draggable" item-selector=".form-field" sortend="{sortField}"> <div class="form-field" each="{field in main.data.list}" key="{field.id}" data-id="{field.id}"> <div class="draggable"> <svg viewbox="0 0 6 14"><path fill="#30343B" d="M0 0h2v2H0V0zm0 4h2v2H0V4zm0 4h2v2H0V8zm0 4h2v2H0v-2zm4 0h2v2H4v-2zM4 0h2v2H4V0zm0 4h2v2H4V4zm0 4h2v2H4"></path></svg> </div> <div class="field-type-icon"> <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/_s/images/land/editor/field_types.svg#{field.type}"></use></svg> </div> <div class="field-name"> <label data-is="flexbe-input" class="flexbe-input" placeholder="{polyglot.t(\'editor::form::name\')}" riot-value="{field.name}" oninput="{main.changeName}"></label> </div> <div class="field-settings-button" onclick="{main.editField}"> {polyglot.t(\'editor::form::field_settings\')} </div> <div class="field-remove" onclick="{main.deleteField}" title="{polyglot.t(\'editor::form::field_delete\')}"> <svg width="14" height="14" viewbox="0 0 14 14" xmlns="http://www.w3.org/2000/svg" id="icon"> <g fill="none" fill-rule="evenodd"><path d="M0 0h14v14H0z"></path><path d="M6 1L5 2H3a1 1 0 0 0-1 1v1h10V3a1 1 0 0 0-1-1H9L8 1H6zM3 5v7a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V5H3z" fill="#30343B" fill-rule="nonzero"></path></g> </svg> </div> </div> </div> <div class="field-limit-message" if="{data.list.length >= options.max}"> <img class="info-icon" src="/_s/images/land/editor/info.png" srcset="/_s/images/land/editor/info.retina.png 2x" alt=""> {polyglot.t(\'editor::form::fields_limit\', {min: options.min, max: options.max})} </div> <div class="flexbe-button style-blue add-field" onclick="{addField}" if="{options.max != data.list.length}" ref="addField"> <div class="icon plus"> <svg viewbox="0 0 10 10" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <path fill="#4773FF" fill-rule="evenodd" d="M6 0H4v4H0v2h4v4h2V6h4V4H6V0z"></path> </svg> </div> <span class="add-button">{polyglot.t(\'editor::form::field_add\')}</span> </div> <modal-block class="field-settings" if="{main.selected}" bind-to="{main.modalTrigger}" onclose="{main.editField}"> <div class="flexbe-modal-content"> <div class="form-field"> <div class="field-type-icon"> <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/_s/images/land/editor/field_types.svg#{main.selected.field.type}"></use></svg> </div> <div class="field-name"> {main.getTypeName(main.selected.field.type)} </div> <div class="flexbe-modal-close" onclick="{opts.onclose}"> <svg width="16" height="16" viewbox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <path fill-rule="evenodd" d="M 9.12128 7.70709L 15.4142 1.41418L 14 0L 7.70709 6.29291L 1.41418 0L 0 1.41418L 6.29291 7.70709L 0 14L 1.41418 15.4142L 7.70709 9.12128L 14 15.4142L 15.4142 14L 9.12128 7.70709Z"></path> </svg> </div> </div> </div> <hr> <div class="flexbe-modal-content"> <div data-is="editor-form-field-edit" class="field-editor" field="{main.selected.field}" onupdate="{main.editorUpdate}"></div> <div class="flexbe-button style-blue filled" onclick="{opts.onclose}"> <span>{polyglot.t(\'editor::form::field_done\')}</span> </div> </div> </modal-block> <modal-block if="{main.isAddField}" onclose="{addField}" bind-to="{main.modalTrigger}" position="center"> <div class="flexbe-modal-content header"> {polyglot.t(\'editor::form::field_add_title\')} <div class="flexbe-modal-close" onclick="{opts.onclose}"> <svg width="16" height="16" viewbox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <path fill-rule="evenodd" d="M 9.12128 7.70709L 15.4142 1.41418L 14 0L 7.70709 6.29291L 1.41418 0L 0 1.41418L 6.29291 7.70709L 0 14L 1.41418 15.4142L 7.70709 9.12128L 14 15.4142L 15.4142 14L 9.12128 7.70709Z"></path> </svg> </div> </div> <hr> <div class="flexbe-modal-content"> <div data-is="editor-form-field-add" class="field-add" list="{main.options.types}" allowed="{main.options.allowed}" onchange="{opts.onclose}"></div> </div> </modal-block> </div> <hr if="{options.styles}"> <div class="flexbe-modal-content" if="{options.styles}"> <label class="flexbe-form-title">{polyglot.t(\'editor::form::field_style\')}</label> <div class="field-style theme-{flexbe.land.theme_id}"> <div class="style {style} {active: ( (main.data.style || []).join(\' \') == style )}" each="{style in options.styles}" onclick="{setStyle}"> <img class="text-style-icon" src="/_s/images/land/editor/text_style_icon.png" srcset="/_s/images/land/editor/text_style_icon.retina.png 2x" alt=""> </div> </div> </div> <div class="flexbe-modal-content-title"> {polyglot.t(\'editor::form::button_style_title\')} </div> <div class="flexbe-modal-content"> <button-style class="button-style" options="{opts.options}" modal="{opts.modal}" data="{data}" onchange="{editorUpdate}" event-stat-group="Editor - Form - Action"></button-style> </div> <hr> <div class="flexbe-modal-content"> <label class="flexbe-form-title"> {polyglot.t(\'editor::actions::form_title\')} </label> <action-block class="action-block" data="{data}" options="{options}" actions="{options.actions}" riot-value="{data.action}" onchange="{actionChanges}" oninput="{actionChanges}"></action-block> </div> </div> <div if="{state == \'goals\'}"> <hr> <div class="flexbe-modal-content"> <label class="flexbe-form-title"> {polyglot.t(\'editor::form::name\')} <div class="flexbe-tooltip">{polyglot.t(\'editor::form::name_help\')}</div> </label> <label data-is="flexbe-input" class="flexbe-input form-name" name="name" riot-value="{data.name}" oninput="{setFormName}"></label> </div> <hr> <div class="flexbe-modal-content"> <div data-is="goals" main-goal="{\'order_done\'}" goals="{data.goals}" action="{data.action}" changed="{goalsUpdate}"></div> </div> </div>',"","",function(e){this.tag=this,this.main=this,this.selected=null,this.isAddField=!1,this.tabs=[{value:"form",title:polyglot.t("editor::modal::tab_form")},{value:"goals",title:polyglot.t("editor::modal::tab_goals")}],this.state=this.tabs[0].value,this.options=e.options,this.data=e.data,this.modalTrigger=null,this.actionChanges=function(e){var t=e.target.name.split("."),i=t.splice(t.length-1,1)[0],l="checkbox"===e.target.type?Number(e.target.checked):e.target.value;t.reduce(function(e,t){var i=void 0===e[t],l=Array.isArray(e[t])&&!e[t].length;return(i||l)&&(e[t]={}),e[t]||e},this.data)[i]=l,this.editorUpdate()}.bind(this),this.selectTab=function(e){this.update({state:e.value})}.bind(this),this.setStyle=function(e){this.data.style=e.item.style.split(" "),this.editorUpdate(),flexbe.stat.event("Editor - Form - Fields - Change style",{style:this.data.style})}.bind(this),this.getTypeName=function(e){return e?this.options.types.find(function(t){return t.type===e}).name:""}.bind(this),this.sortField=function(e,t){this.data.list.splice(t,0,this.data.list.splice(e,1)[0]),this.update({destroyList:!0}),this.update({destroyList:!1}),this.editorUpdate(),flexbe.stat.event("Editor - Form - Fields - Sorted")}.bind(this),this.addField=function(t){this.isAddField&&t&&t.item&&(this.data.list.push($.extend(!0,{id:flexbe.helpers.getRandId()},t.item)),this.editorUpdate(),flexbe.stat.event("Editor - Form - Fields - Add")),this.update({isAddField:!this.isAddField,modalTrigger:this.refs.addField}),t||this.focusOnLastModal(),e.modal.disabled(this.isAddField)}.bind(this),this.sortend=function(){this.editorUpdate()}.bind(this),this.editField=function(t){this.update({selected:this.selected?null:{field:t.item.field},modalTrigger:t?$(t.target).parents(".form-field").get(0):null}),this.focusOnLastModal(),e.modal.disabled(this.selected)}.bind(this),this.changeName=function(e){e.item?e.item.field.name=e.target.value:this.main.selected.field.name=e.target.value,this.editorUpdate()}.bind(this),this.deleteField=function(e){var t=e.item.field,i=this.data.list;i.splice(i.indexOf(t),1),this.editorUpdate(),flexbe.stat.event("Editor - Form - Fields - Delete")}.bind(this),this.changeRequired=function(){this.selected.field.is_required=+!this.selected.field.is_required,this.editorUpdate()}.bind(this),this.editorUpdate=function(t){e.onchange(t),this.update()}.bind(this),this.goalsUpdate=function(t){e.data.goals=t,this.update(),flexbe.stat.event("Editor - Form - Goals - Update")}.bind(this),this.setFormName=function(e){this.data.name=e.target.value,this.editorUpdate(),flexbe.stat.event("Editor - Form - Goals - Set form name")}.bind(this),this.focusOnLastModal=function(){setTimeout(function(){$("body").find(".overlay-area").last().focus()},10)}.bind(this)});
riot.tag2("editor-gallery",'<div class="image-list"> <div class="image-list-unsplash"> <div class="tags-list scrollable-content"> <div class="tag {active: search == ex.search}" each="{ex in explode}" onclick="{selectUnsplashTag.bind(this, ex.search)}"> {ex.name} </div> </div> <div class="columns scrollable-content"> <div class="column" each="{column,cindex in Array(columns)}"> <div class="page show" each="{page, pindex in list}" data-page="{pindex + 1}"> <div class="item" each="{img in page.slice(cindex * perColumn, cindex * perColumn + perColumn)}"> <div class="image {loading: inSelect == img.id}" riot-style="background-color: {img.color}; padding-bottom: {img.height/img.width * 100}%"> <img riot-src="{img.urls.thumb}" onclick="{selectUnsplashImage.bind(this, img)}" style="opacity: 1"> <svg if="{inSelect == img.id}" class="loader circular-loader" viewbox="25 25 50 50"><circle class="loader-path" cx="50" cy="50" r="20"></circle></svg> <div class="overlay"> <a target="_blank" href="https://unsplash.com/@{img.user.username}?utm_source=flexbe&utm_medium=referral&utm_campaign=api-credit"> {img.user.name} </a> / <a target="_blank" href="https://unsplash.com/?utm_source=flexbe&utm_medium=referral&utm_campaign=api-credit">Unsplash</a> </div> </div> </div> </div> </div> </div> </div> </div>',"","",function(e){var o=this,t=this.opts.editor,a={};this.perColumn=10,this.columns=3,this.preloadCount=this.columns*this.perColumn,this.search=":latest",this.list=[],this.explode=[{name:polyglot.t("editor::background::latest"),search:":latest"},{name:polyglot.t("editor::background::popular"),search:":popular"},{name:polyglot.t("editor::background::nature"),search:"NATURE"},{name:polyglot.t("editor::background::landscape"),search:"LANDSCAPE"},{name:polyglot.t("editor::background::mountains"),search:"MOUNTAINS"},{name:polyglot.t("editor::background::sky"),search:"SKY"},{name:polyglot.t("editor::background::city"),search:"city"},{name:polyglot.t("editor::background::road"),search:"ROAD"},{name:polyglot.t("editor::background::people"),search:"PEOPLE"},{name:polyglot.t("editor::background::girl"),search:"GIRL"},{name:polyglot.t("editor::background::woman"),search:"woman"},{name:polyglot.t("editor::background::man"),search:"MAN"},{name:polyglot.t("editor::background::friends"),search:"FRIENDS"},{name:polyglot.t("editor::background::family"),search:"FAMILY"},{name:polyglot.t("editor::background::love"),search:"LOVE"},{name:polyglot.t("editor::background::happy"),search:"HAPPY"},{name:polyglot.t("editor::background::wedding"),search:"WEDDING"},{name:polyglot.t("editor::background::flower"),search:"Flower"},{name:polyglot.t("editor::background::animal"),search:"animal"},{name:polyglot.t("editor::background::coffee"),search:"COFFEE"},{name:polyglot.t("editor::background::food"),search:"FOOD"},{name:polyglot.t("editor::background::restaurant"),search:"RESTAURANT"},{name:polyglot.t("editor::background::home"),search:"home"},{name:polyglot.t("editor::background::work"),search:"WORK"},{name:polyglot.t("editor::background::construction"),search:"construction"},{name:polyglot.t("editor::background::business"),search:"BUSINESS"},{name:polyglot.t("editor::background::office"),search:"OFFICE"},{name:polyglot.t("editor::background::desk"),search:"DESK"},{name:polyglot.t("editor::background::computer"),search:"COMPUTER"},{name:polyglot.t("editor::background::clock"),search:"CLOCK"},{name:"Apple",search:"apple"},{name:polyglot.t("editor::background::music"),search:"MUSIC"},{name:polyglot.t("editor::background::sport"),search:"sport"},{name:polyglot.t("editor::background::bike"),search:"bike"},{name:polyglot.t("editor::background::motorcycle"),search:"motorcycle"},{name:polyglot.t("editor::background::car"),search:"car"},{name:polyglot.t("editor::background::summer"),search:"SUMMER"},{name:polyglot.t("editor::background::winter"),search:"Winter"},{name:polyglot.t("editor::background::spring"),search:"spring"},{name:polyglot.t("editor::background::autumn"),search:"AUTUMN"},{name:polyglot.t("editor::background::rain"),search:"RAIN"}],this.selectUnsplashTag=function(e){var o=this;this.search!=e&&(a[this.search]=$.extend([],this.list),this.search=e,this.list=[],$(this.root).parent(".flexbe_modal_data").scrollTop(0),setTimeout(function(){o.list=$.extend(!0,[],a[o.search]),o.list.length?o.update():(o.inLoad=!1,o.loadFromUnsplash())},50))}.bind(this),this.selectUnsplashImage=function(e){var o=this;if(!this.inSelect){this.inSelect=e.id;var a=e.urls.full;t.setImageByUrl(a,function(){setTimeout(function(){o.inSelect=!1,o.update()},1e3)})}}.bind(this),this.loadFromUnsplash=function(e){var o=this;if(!this.inLoad){this.inLoad=!0;var a=this.search,r=this.list.length;t.unsplashService(r+1,this.preloadCount,this.search,function(t){o.inLoad=!1,"function"==typeof e&&e(t),t&&Array.isArray(t)&&a==o.search&&(o.list[r]=t,o.update())})}}.bind(this),this.on("mount",function(){o.loadFromUnsplash();var e=$(o.root).find(".columns"),t=e.find(".column");e.on("scroll",function(e){var a=e.currentTarget.scrollTop+e.currentTarget.offsetHeight,r=1/0;t.each(function(e,o){var t=o.offsetHeight;r>t&&(r=t)}),a+600>r&&o.loadFromUnsplash()})})});
riot.tag2("html-file-item",'<div class="ico img" if="{item.type === \'img\'}" riot-style="background-image: url( \'/img/{item.id}_50/{item.name}\' )"></div> <div class="ico {item.type}" if="{item.type !== \'img\'}"></div> <div class="path-types"> {this[type]} <div class="button-set"> <div class="button {type} {active: parent.type === type}" each="{type in types}" if="{!(item.type !== \'img\' && type ===\'css\')}" onclick="{setType}"></div> </div> </div> <a class="button download" target="_blank" riot-href="{path}"></a> <yield></yield>',"","",function(t){var e=this;switch(e.item=t.data,e.types=["css","html","path"],e.type="path",e.item.type){case"img":e.path="/img/"+e.item.id+"/"+e.item.name,e.html='<img src="'+e.path+'">',e.css='background-image: url("'+e.path+'");';break;case"js":e.path="/files/"+e.item.name,e.html='<script src="'+e.path+'"><\/script>';break;case"css":e.path="/files/"+e.item.name,e.html='<link href="'+e.path+'" rel="stylesheet" type="text/css">';break;default:e.path="/files/"+e.item.name,e.html='<a href="'+e.path+'" target="_blank">Файл</a>'}this.setType=function(t){e.type=t.item.type}.bind(this)}),riot.tag2("editor-html",'<div class="tabs"> <div class="group"> <div class="tab {active: tab === \'html\'}" data-name="html" onclick="{selectTab}">HTML</div> <div class="tab {active: tab === \'css\'}" data-name="css" onclick="{selectTab}">CSS</div> </div> <div class="tab {active: tab === \'files\'}" data-name="files" onclick="{selectTab}">{polyglot.t(\'editor::html::tab_file\')}</div> </div> <div class="content-wrapper {tab} {error: error}"> <div class="html-content"> <codemirror settings="{settings.html}" ref="html"></codemirror> <div class="error" if="{error}">{error}</div> <div class="desc">{polyglot.t(\'editor::html::html_desc\')}<a href="/admin/settings/counters/" target="_blank">{polyglot.t(\'editor::html::html_desc_link\')}</a>.</div> </div> <div class="css-content"> <codemirror settings="{settings.css}" ref="css"></codemirror> <div class="error" if="{error}">{error}</div> <div class="desc">{polyglot.t(\'editor::html::css_desc\')} <a href="http://www.lesscss.org/" target="_blank">LESS</a>. {polyglot.t(\'editor::html::css_desc_warn\')}</div> </div> <div class="files-content"> <div class="files"> <div class="upload-block"> <div class="desc"> {polyglot.t(\'editor::html::file_desc\')} </div> <div> <div class="upload-button"> <input type="file" name="file" ref="uploader">{polyglot.t(\'editor::html::file_upload\')} </div> </div> </div> <div class="list"> <div class="no-files" if="{!files.length && !Object.keys(progress).length && polyglot.currentLocale == ⁗ru⁗}"></div> <html-file-item each="{file in files}" data="{file}"> <div class="button remove" onclick="{parent.removeFile}"></div> </html-file-item> <div class="progress" each="{item in progress}"> <div class="bar" riot-style="width: {item}%"></div> </div> </div> </div> <div class="error" if="{error}">{error}</div> <div class="desc">{polyglot.t(\'editor::html::file_upload_desc\')}</div> </div> </div> <div class="button-set"> <div class="button done" onclick="{done}">{polyglot.t(\'editor::html::done\')}</div> <div class="button update" onclick="{apply}">{polyglot.t(\'editor::html::apply\')}</div> </div>',"","",function(t){var e=this,i=t.editor,s=i.opt.data,l=function(){var t=e.refs.css.instance.getValue(),l=$("<div>"+e.refs.html.instance.getValue()+"</div>")[0].innerHTML,r="."+i.opt.block.is.substr(0,1)+"_"+i.opt.block.id,o=(configStore.getStyle("mixin")||"")+" "+r;return o+="block"===i.opt.block.is?" .container-fluid {\n"+t+"}\n":" .modal-data {\n"+t+"}\n",e.error="",less.render(o,{compress:!0}).then(function(e){return s.less=t,s.css=e.css,!0},function(t){return e.update({error:polyglot.t("editor::html::less_error")+": "+t.extract.join("\n")}),!1}).then(function(t){if(!t)return!1;var r=(l.match(/<script[^]*?src=['|"](.*?)['|"]/gm)||[]).map(function(t){return t.replace(/<script[^]*?src=/gm,"").replace(/"|'/gm,"")}),o=/101widgets|jquery?(|\-latest|-([0-9]){1}\.([0-9]){1}\.([0-9]){1}).(|min\.|pack\.)js/.exec(r.join(""));return o?(/jquery/.test(o[0])?e.update({error:polyglot.t("editor::html::jquery_error")+" "+r.find(function(t){return/jquery/.test(t)})}):e.update({error:polyglot.t("editor::html::101widgets_error")+" "+r.find(function(t){return/101widgets/.test(t)})}),!1):(s.html=l,i.change("full"),!0)})};e.tab="html",e.files=s.files,e.progress={},e.settings={html:{options:{value:s.html||"",lineNumbers:!1,indentUnit:4,inputStyle:"contenteditable",mode:"htmlmixed"},url:"mode/htmlmixed/htmlmixed"},css:{options:{value:s.less||"",lineNumbers:!1,indentUnit:4,inputStyle:"contenteditable",mode:"text/x-less"},url:"mode/css/css"}},this.done=function(){l().then(function(t){t&&i.modal.close()})}.bind(this),this.apply=function(){l()}.bind(this),this.selectTab=function(t){e.tab=t.target.getAttribute("data-name")}.bind(this),this.removeFile=function(t){var i=e.files.indexOf(t.item.file);confirm(polyglot.t("editor::html::file_delete"))&&(e.files.splice(i,1),e.update())}.bind(this),e.on("mount",function(){flexbe.files.upload.init({multi:!0,type:"auto",$input:$(e.refs.uploader),on_select:function(t){e.progress[t]=0,e.update()},on_progress:function(t,i){e.progress[t]=i,e.update()},on_complete:function(t,i,s,l){if(delete e.progress[l],!t)return alertify.error("Не удалось загрузить файл"),void e.update();if(i.hasOwnProperty("img_id"))e.files.push({id:i.img_id,type:"img",name:i.img_name});else if(i.hasOwnProperty("f_id")){var r="file";/js|css/.test(i.f_name_info.ext)&&(r=i.f_name_info.ext),e.files.push({id:i.f_id,type:r,name:i.f_name})}else alertify.error("Не удалось загрузить файл");e.update()}})})});
riot.tag2("editor-ico",'<div class="tabs" if="{opts.ico_sets.length > 1}"> <ul class="editor-tabs"> <li each="{tab, index in opts.ico_sets}" class="{tab: 1, active: selectedTab === tab}" onclick="{selectTab}"> {parent.sets[tab.name] || tab.title || polyglot.t(\'editor::ico::custom\')} </li> </ul> </div> <div if="{colors && colors.length > 1}" class="advanced"> <color-list class="color_list" active="{opts.data.color}" colors="{colors}" onchange="{setColor}" custom="{opts.options.custom_color}" inline="true"></color-list> </div> <div class="container"> <div class="ico-list" onscroll="{scrollMoreIcons}"> <div class="wrapper"> <a class="icon empty" riot-style="{\'background-image:url(/_s/images/empty.png)\'}" onclick="{setIcon.bind(this, \'/_s/images/empty.png\')}"><span>{polyglot.t(\'editor::ico::no_icon\')}</span></a> <a class="icon" each="{iconsList}" riot-style="{\'background-image:url(\' + parent.selectedTab.data.path + name + \');\'}" onclick="{setIcon.bind(this, parent.selectedTab.data.path + name)}"></a> <span if="{!iconsList.length && !loading}" class="empty-result"> {polyglot.t(\'editor::ico::empty\')} </span> <a if="{iconsList.length < getIconsList().length}" class="more_button" onclick="{moreIcons}">{polyglot.t(\'editor::ico::load_more\')}</a> </div> </div> </div>',"","",function(t){var i=0,o=192,e=this,s=t.editor,n="";function a(t){var n,a,l=function(){e.selectedTab.data=s.cache[t.name]||{},e.update({iconsList:c().slice(0,o),loading:!1})};i=0,e.selectedTab=t,e.iconsList=[],s.cache.hasOwnProperty(t.name)?l():(e.loading=!0,n=t.name,void 0===(a=l)&&(a=function(){}),$.getJSON(s.iconpath+n+".json?v"+flexbe.land.version_id).done(function(t){s.cache[n]=t,a()}).fail(function(t,i,o){var e=i+", "+o;console.error("Request Failed: "+e)}))}function c(){var t=e.selectedTab.data&&e.selectedTab.data.list||[];return n?t.filter(function(t){return-1!==t.tags.join(" ").search(n)}):t}function l(i,o){if(o&&o.img_id){var e="/img/"+o.img_id+"/"+o.img_name;t.data.url=e,t.data.svg=0,s.change()}else alertify.error(polyglot.t("editor::ico::upload_error"))}e.colors=t.options.colors,e.scrollMoreIcons=$.throttle(function(t){$(t.target).scrollTop()+750>$(".wrapper",t.target).height()&&e.moreIcons()},500),e.getIconsList=c,e.sets={budicon:polyglot.t("editor::ico::budicon"),line:polyglot.t("editor::ico::line"),solid:polyglot.t("editor::ico::solid"),thick:polyglot.t("editor::ico::thick"),handy:polyglot.t("editor::ico::handy"),numbers:polyglot.t("editor::ico::numbers")},this.moreIcons=function(){i+=1,e.update({iconsList:e.iconsList.concat(c().slice(i*o,(i+1)*o))})}.bind(this),this.setColor=function(i){this.currentColor=i,t.data.color=i,s.change()}.bind(this),this.selectTab=function(t){a(t.item.tab)}.bind(this),this.setIcon=function(i){t.data.url=i,t.data.svg=Number(/.svg$/.test(i)),s.change()}.bind(this),a(t.ico_sets[0]),e.on("mount",function(){var a=s.modal.$modal.find(".flexbe_modal_title .title");t.options.deny_download||(a.append('<div class="file_select"><input type="file" name="file" accept="image/jpeg,image/png,image/gif,image/svg"><a><span>'+polyglot.t("editor::ico::upload")+"</span></a></div>"),flexbe.files.upload.init({$input:a.find(".file_select input"),type:"image_svg",on_complete:l})),a.parent().append('<div class="search_bar"><input type="text"><span class="clean"></span></div>');var r=a.parent().find(".search_bar");r.find("input").on("input",$.debounce(function(){i=0,n=$(this).val(),e.update({iconsList:c().slice(0,o)}),r.find(".clean")[n?"addClass":"removeClass"]("focus")},150)),r.find(".clean").on("click",function(){$(this).siblings("input").val("").trigger("input")})})});
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}riot.tag2("editor-logo",'<ul if="{options.tabs.length > 1}" class="editor-tabs"> <li each="{tab in options.tabs}" class="{active: tab == data.type}" onclick="{selectType.bind(this, tab)}"> <svg><use riot-xlink:href="{sprite}#type-{tab}"></use></svg> <span>{tabs[tab]}</span> </li> </ul> <div class="type-wrap"> <div class="type-img {show: data.type == \'img\'}"> <div class="image-wrap"> <div class="image-preview"> <div class="img" riot-style="{getImageStyle()}"></div> </div> <div class="image-actions"> <div class="image-action-item image-upload"> <input type="file" ref="upload_image" onchange="{uploadImage}"> <svg width="28" height="22"><use riot-xlink:href="{sprite}#upload"></use></svg> <span>{polyglot.t(\'editor::logo::upload\')}</span> </div> <div class="image-action-item image-lm" onclick="{openConstructor}"> <svg width="28" height="28"><use riot-xlink:href="{sprite}#constructor"></use></svg> <span>{polyglot.t(\'editor::logo::creator\')}</span> </div> </div> </div> </div> <div class="type-text {show: data.type == \'text\'}" if="{!!~options.tabs.indexOf(\'text\')}"> <div class="flexbe-field"> <span class="flexbe-field-title">{polyglot.t(\'editor::logo::text\')}</span> <div class="flexbe-field-input"> <input class="old-style" type="text" oninput="{setTextName}" riot-value="{flexbe.lib.htmlspecialchars(data.text.name, true)}" placeholder="{polyglot.t(\'editor::logo::text_title\')}"> </div> </div> <div class="flexbe-field"> <span class="flexbe-field-title">{polyglot.t(\'editor::logo::text_font\')}</span> <div class="flexbe-field-input"> <div data-is="flexbe-select" class="flexbe-select" list="{options.fonts}" riot-value="{data.text.font}" onchange="{setTextFont}" onchange="{setTextFont}"></div> <div class="old-flexbe-button compact {active: data.text.bold}" onclick="{setTextStyle.bind(this, \'bold\')}"> <svg width="9" height="12"><use riot-xlink:href="{sprite}#bold"></use></svg> </div> <div class="old-flexbe-button compact {active: data.text.italic}" onclick="{setTextStyle.bind(this, \'italic\')}"> <svg width="6" height="12"><use riot-xlink:href="{sprite}#italic"></use></svg> </div> </div> </div> <div class="flexbe-field"> <span class="flexbe-field-title">{polyglot.t(\'editor::logo::color\')}</span> <color-list class="flexbe-field-color" inline="{true}" onchange="{setColor}" active="{data.text.color}" colors="{options.colors}" custom="{options.color_custom}"></color-list> </div> </div> <div class="type-both"> <div class="flexbe-field"> <span class="flexbe-field-title">{polyglot.t(\'editor::logo::size\')}</span> <div class="flexbe-field-input"> <input class="old-style" type="range" min="{options.size[data.type][0]}" max="{options.size[data.type][1]}" riot-value="{data[data.type].size}" oninput="{setSize}"> </div> </div> <div class="flexbe-field"> <label class="old-style light flexbe-field-checkbox"> <input class="old-style" type="checkbox" onchange="{setLink}" checked="{typeof data.link !== \'undefined\' && data.link !== false}"> <span>{polyglot.t(\'editor::logo::make_link\')}</span> </label> </div> <virtual if="{typeof data.link !== \'undefined\' && data.link !== false}"> <div class="flexbe-field"> <span class="flexbe-field-title">{polyglot.t(\'editor::logo::link\')}</span> <div class="flexbe-field-input"> <input class="old-style" type="text" oninput="{setLink}" riot-value="{data.link}" placeholder="{location.protocol}//{location.host}"> </div> </div> <div class="flexbe-field"> <label class="old-style light flexbe-field-checkbox"> <input class="old-style" type="checkbox" onchange="{toggleLinkBlank}" checked="{data.link_blank}"> <span>{polyglot.t(\'editor::logo::link_blank\')}</span> </label> </div> </virtual> </div> </div>',"","",function(t){var e,i=t.editor;this.tag=this,this.main=this,this.data=t.data,this.options=t.options,this.sprite="/_s/images/land/editor/editor_logo.svg?1",this.coreSprite="/_s/images/land/editor/core.svg?1",this.tabs={img:polyglot.t("editor::logo::img"),text:polyglot.t("editor::logo::name")},this.uploadImage=function(t){var e=this,a=$('<input type="file">').spacedUpload({url:"/admin/files/upload?type=image"}),l=t.target.files;l&&l.length&&(a.spacedUpload("addItem",{file:l[0],onComplete:function(t,a,l){t||console.warn("Failed to upload. Error code: "+l);try{a=JSON.parse(a)}catch(t){console.warn("Failed to upload. Server return wrong object ",a)}e.data.img.id=a.img_id,e.data.img.name=a.img_name,e.data.img.ext=a.img_ext,e.update(),i.change()}}),a.spacedUpload("startUpload"))}.bind(this),this.openConstructor=function(){i.LM()}.bind(this),this.getImageStyle=function(){var t=parseInt(2.5*this.data.img.size,10),e=parseInt(1.4*this.data.img.size,10);return"background-image: url("+("/img/"+this.data.img.id+(/.(svg|gif)$/.test(this.data.img.name)?"":"_500")+"/"+this.data.img.name)+"); width: "+t+"px; height: "+e+"px"}.bind(this),this.selectType=function(t){this.data.type=t,this.update(),i.change()}.bind(this),this.setLink=function(t){var e;e="change"==t.type?!!t.target.checked&&"/":t.target.value,this.data.link=e,i.change()}.bind(this),this.toggleLinkBlank=function(t){this.data.link_blank=Number(t.target.checked),this.update(),i.change()}.bind(this),this.setSize=function(t){var a=this.data.type,l="object"==_typeof(t)?t.target.value:t;this.data[a].size=l,clearTimeout(e),e=setTimeout(function(){i.change()},100)}.bind(this),this.setTextName=function(t){this.data.text.name=flexbe.lib.htmlspecialchars(t.target.value),i.change()}.bind(this),this.setTextStyle=function(t){this.data.text[t]=Number(!this.data.text[t]),i.change()}.bind(this),this.setTextFont=function(t){t&&(this.data.text.font=t,i.change())}.bind(this),this.setColor=function(t){this.data.text.color=t,i.change()}.bind(this),i.on("update",this.update.bind(this))});
riot.tag2("editor-map-place-item",'<div class="place-title"> <span class="draggable"> <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" riot-xlink:href="{sprite}#drag"></use></svg> </span> <div class="place-name"> <input class="old-style" type="text" placeholder="{polyglot.t(\'editor::map::mark_placeholder\')} #{index + 1}" riot-value="{place.name}" onfocus="{setCenter}" oninput="{setName}"> </div> <div class="place-remove" onclick="{main.removePlace}" if="{main.places.length > 1}"> <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" riot-xlink:href="{sprite}#delete"></use></svg> </div> </div> <div class="place-address"> <input class="old-style" type="text" class="mark-addr" placeholder="{polyglot.t(\'editor::map::address_placeholder\')}" riot-value="{place.address}" onfocus="{setCenter}" oninput="{setAddr}"> </div> <color-list class="place-color" inline="{true}" onfocus="{setCenter}" onchange="{setColor}" active="{place.color}" colors="{main.options.colors}" custom="{main.options.color_custom}"></color-list>',"","",function(t){var e=this;this.tag=this,this.main=this.parent?this.parent.main?this.parent.main:this.parent:this,this.sprite="/_s/images/land/editor/editor_map.svg?1",this.old_style=+flexbe.land.theme_id<=1,this.editor=this.main.editor,this.mark=!1;var a,s,i=function(){e.mark&&(e.mark.properties.set("balloonContentHeader",e.place.name),e.mark.properties.set("balloonContent",e.place.address),e.old_style?(e.mark.options.set("iconLayout","default#image"),e.mark.options.set("iconImageHref","/_app/block/10/mark_"+e.place.color+".png"),e.mark.options.set("iconImageSize",[50,50]),e.mark.options.set("iconImageOffset",[-25,-50])):(e.mark.properties.set("color",e.place.color),e.mark.options.set("balloonOffset",[0,-48]),e.mark.options.set("iconLayout","custom#placemark"),e.mark.options.set("iconShape",{type:"Rectangle",coordinates:[[-16,-48],[16,0]]})),e.editor.change())},o=function(){var t='<svg width="32" height="48" viewBox="0 0 24 32" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.36 0 0 5.36 0 12c0 8 12 20 12 20s12-12 12-20c0-6.64-5.36-12-12-12zm0 8a4 4 0 0 1 4 4c0 2.22-1.78 4-4 4a4 4 0 0 1-4-4c0-2.2 1.8-4 4-4z" fill="'+(e.place.color||"#222")+'" fill-rule="evenodd"/></svg>',a='<div style="margin-bottom: 3px;"><strong>'+(e.place.name||"")+"</strong></div>"+(e.place.address||"");e.mark&&e.mark.setIcon({url:"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent(t)}),e.info&&e.info.setContent(a),e.editor.change()};this.createMark=function(){this.removeMark(),"yandex"==this.main.type?this.createYandexMark():"google"==this.main.type&&this.createGoogleMark()}.bind(this),this.createYandexMark=function(){var t=this;this.mark=new ymaps.Placemark(this.place.coords,{balloonContentHeader:this.place.name||!1,balloonContent:this.place.address},{draggable:!0,hideIconOnBalloonOpen:!1}),this.main.map.geoObjects.add(this.mark),i(),this.mark.events.add("click",function(){t.main.trigger("markSelect",t.index)}),this.mark.events.add("dragend",function(){t.place.coords=t.mark.geometry.getCoordinates(),t.geocode(t.place.coords,!1,function(e){if(e){var a=t.place.address;t.setAddr(e,!1),t.showBalloon(),t.update(),t.main.showAddressBar(a,e,function(e){t.setAddr(e,!1),t.update()})}})})}.bind(this),this.createGoogleMark=function(){var t=this;this.mark=new google.maps.Marker({position:{lat:this.place.coords[0],lng:this.place.coords[1]},map:this.main.map,visible:!0,draggable:!0}),this.info=new google.maps.InfoWindow,o(),this.mark.addListener("click",function(){t.showBalloon(),t.main.trigger("markSelect",t.index)}),this.mark.addListener("dragend",function(e){var a=t.mark.getPosition().toJSON();t.place.coords=[a.lat,a.lng],t.geocode(t.place.coords,!1,function(e){if(e){var a=t.place.address;t.setAddr(e,!1),t.showBalloon(),t.update(),t.main.showAddressBar(a,e,function(e){t.setAddr(e,!1),t.update()})}})})}.bind(this),this.removeMark=function(){this.mark&&this.main.map&&(this.main.map.geoObjects?this.main.map.geoObjects.remove(this.mark):this.mark.setMap&&(this.mark.setMap(null),this.info&&this.info.close()),this.mark=!1,this.info=!1)}.bind(this),this.showBalloon=function(){this.mark&&(this.main.trigger("closeBaloon"),"yandex"==this.main.type?this.mark.balloon.open():this.info&&this.info.open(this.main.map,this.mark))}.bind(this),this.closeBaloon=function(){this.mark&&("yandex"==this.main.type?this.mark&&this.mark.balloon.close():this.info&&this.info.close())}.bind(this),this.setCenter=function(){this.main.map&&this.mark&&("yandex"==this.main.type?this.main.map.setCenter(this.mark.geometry.getCoordinates()):"google"==this.main.type&&this.main.map.panTo(this.mark.getPosition()),this.showBalloon())}.bind(this),this.setColor=function(t){this.place.color=t,"yandex"==this.main.type?i():"google"==this.main.type&&o()}.bind(this),this.setName=function(t){var e=t.target.value;this.place.name=e,"yandex"==this.main.type?i():"google"==this.main.type&&o()}.bind(this),this.setAddr=function(t,e){var a=this;void 0===e&&(e=!0);var s="string"==typeof t?t:t.target.value;this.place.address=s,"yandex"==this.main.type?i():"google"==this.main.type&&o(),e&&this.geocode(s,!0,function(t){!1!==t&&(a.place.coords=t,a.mark&&("yandex"==a.main.type&&a.mark.geometry?a.mark.geometry.setCoordinates(t):"google"==a.main.type&&a.mark.setPosition&&a.mark.setPosition({lat:t[0],lng:t[1]}),a.setCenter()))})}.bind(this),this.geocode=function(t,e,s){var i=this;clearTimeout(a),a=setTimeout(function(){if("yandex"==i.main.type){if(!ymaps)return;e?ymaps.geocode(t,{results:1}).then(function(t){var e=t.geoObjects.get(0).geometry.getCoordinates();s(e)},function(t){s(!1),console.log(t.message)}):ymaps.geocode(t,{results:1}).then(function(t){if(t&&t.geoObjects){var e=t.geoObjects.get(0);s(e.getAddressLine())}else s(!1)},function(t){s(!1),console.log(t.message)})}else{var a=i.main.geocoder;if(!a)return;if(e)a.geocode({address:t},function(t){if(t&&t.length){var e=t[0].geometry.location.toJSON();e=[e.lat,e.lng],s(e)}else s(!1)});else{if(!Array.isArray(t))return;a.geocode({location:{lat:t[0],lng:t[1]}},function(t){if(t&&t.length){var e=t[0].address_components,a=[e[3].short_name.length>4?e[3].short_name:e[3].long_name,e[1].short_name,e[0].short_name];s(a.join(", "))}else s(!1)})}}},400)}.bind(this),this.on("update",function(t){!e.main.map||e.mark&&s==e.main.type||(e.createMark(),s=e.main.type)}),this.on("mount",function(){e.main.on("closeBaloon",function(){e.closeBaloon()})}),this.on("unmount",function(){e.removeMark()})}),riot.tag2("editor-map",'<ul class="map-type editor-tabs" if="{options.providers.length > 1}"> <li each="{provider in options.providers}" class="{active: type == provider}" onclick="{selectType.bind(this, provider)}"> {provider == \'google\' ? polyglot.t(\'editor::map::google\') : polyglot.t(\'editor::map::yandex\')} </li> </ul> <div class="map-content"> <div class="place-container"> <div data-is="flexbe-field-list" class="place-list" handle-selector=".draggable" item-selector=".place-item" sortend="{sortPlaces}"> <div data-is="editor-map-place-item" class="place-item" each="{place, index in main.places}"></div> </div> <a class="add-place" onclick="{addPlace}"> <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" riot-xlink:href="{sprite}#add"></use></svg> <span>{polyglot.t(\'editor::map::add_mark\')}</span> </a> </div> <div class="map-container"> <div class="map-wrap"> <div class="address-bar"></div> <div class="map"></div> </div> <div class="map-style" if="{type == \'google\'}"> <div each="{style in options.styles}" class="style-item" onclick="{selectStyle.bind(this, style)}"> <div class="preview {active: data.style == style}" riot-style="background-image: url(/_s/lib/google/maps/styles/preview/{style}.png)"> <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" riot-xlink:href="{sprite}#selected"></use></svg> </div> </div> </div> </div> </div>',"","",function(t){var e=this;this.main=this,this.tag=this,this.data=t.data,this.options=t.options,this.editor=t.editor,this.map=!1,this.places=this.data.places,this.mapMarkers=[],this.type=this.data.type,this.sprite="/_s/images/land/editor/editor_map.svg?1",this.removePlace=function(t){this.places.splice(t.item.index,1),this.resizeMap(),this.editor.change(),this.update()}.bind(this),this.addPlace=function(){var t=this.places.length&&$.extend(!0,{},this.places[this.places.length-1])||{name:polyglot.t("editor::map::default_name"),address:polyglot.t("editor::map::default_address"),coords:[55.75824,37.613575],color:"#222"};this.places.push(t);var e=$(".place-list",this.root);e.animate({scrollTop:e[0].scrollHeight}),this.resizeMap(),this.editor.change()}.bind(this),this.sortPlaces=function(t,e){this.places.splice(e,0,this.places.splice(t,1)[0]),this.update(),this.editor.change()}.bind(this),this.selectType=function(t){t!=this.type&&(this.data.type=t,this.type=t,this.createMap(),this.editor.change())}.bind(this),this.selectStyle=function(t){t!=this.data.style&&(this.data.style=t,this.applyStyle(),this.editor.change())}.bind(this),this.createMap=function(){var t=this,e=$(".map",this.root);this.map&&("function"==typeof this.map.destroy&&this.map.destroy(),this.map=!1,e.empty()),"google"==this.type?require(["//maps.googleapis.com/maps/api/js?key=AIzaSyAuc1CX3_a9QASrIlndml62145Zb65ea0M"],function(){t.createGoogle(e)}):require(["//api-maps.yandex.ru/2.1/?lang=ru_RU"],function(){ymaps.ready(function(){t.createYandex(e)})})}.bind(this);var a,s=function(){if(e.map){if("yandex"==e.type)e.data.center=e.map.getCenter();else{var t=e.map.getCenter().toJSON();e.data.center=[t.lat,t.lng]}e.data.zoom=e.map.getZoom(),e.editor.change()}};this.createYandex=function(t){this.map=new ymaps.Map(t[0],{center:this.data.center,zoom:this.data.zoom,controls:["zoomControl"],behaviors:["default","scrollZoom"],type:"yandex#map"});var e=ymaps.templateLayoutFactory.createClass('<svg title="$[properties.balloonContent]" class="placemark" width="32" height="48" viewBox="0 0 24 32" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.36 0 0 5.36 0 12c0 8 12 20 12 20s12-12 12-20c0-6.64-5.36-12-12-12zm0 8a4 4 0 0 1 4 4c0 2.22-1.78 4-4 4a4 4 0 0 1-4-4c0-2.2 1.8-4 4-4z" fill="$[properties.color]" fill-rule="evenodd"/></svg>');ymaps.layout.storage.add("custom#placemark",e),this.map.events.add("boundschange",s),this.update({mapCreated:!0})}.bind(this),this.createGoogle=function(t){this.map=new google.maps.Map(t[0],{center:{lat:this.data.center[0],lng:this.data.center[1]},zoom:this.data.zoom,panControl:!0,zoomControl:!0,mapTypeControl:!1,streetViewControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP}),this.geocoder=new google.maps.Geocoder,this.applyStyle(),this.map.addListener("bounds_changed",s),this.update({mapCreated:!0})}.bind(this),this.applyStyle=function(){var t=this;if("google"==this.type&&this.map&&"function"==typeof this.map.setOptions)if("default"!=this.data.style&&this.data.style){var e="/_s/lib/google/maps/styles/"+this.data.style+".json";$.getJSON(e,function(e){e&&Array.isArray(e)&&t.map.setOptions({styles:e})})}else this.map.setOptions({styles:[]})}.bind(this),this.resizeMap=function(){var t=this;this.map&&setTimeout(function(){"yandex"==t.type&&t.map.container&&t.map.container.fitToViewport(),"google"==t.type&&google&&google.maps&&google.maps.event.trigger(t.map,"resize")},350)}.bind(this),this.showAddressBar=function(t,e,s){clearTimeout(a),"function"==typeof s&&(a=setTimeout(function(){i.removeClass("show"),s(e)},1e4));var i=$(".address-bar",this.root),o=$("<div></div>");o.append('<a class="times close"></a>'),o.append('<div class="new-address"><strong>'+polyglot.t("editor::map::address_changed")+": "+e+"</strong></div>"),o.append('<div class="action-bar"><a data-command="oldAddr">'+polyglot.t("editor::map::undo_address")+"</a><span> ("+t+")</span></div>"),o.on("click","a",function(a){i.removeClass("show");var o=$(a.currentTarget).data("command");"function"==typeof s&&s("oldAddr"==o?t:e)}),i.on("mouseenter",function(){clearTimeout(a)}),i.empty().append(o),i.addClass("show")}.bind(this),this.on("markSelect",function(t){var a=$(".place-list",e.root),s=$(".place-item",a).eq(t);s.removeClass("blink");var i=a.scrollTop()+s.position().top-20;a.animate({scrollTop:Math.max(i,0)},400,"swing",function(){s.addClass("blink")})}),this.on("mount",function(){e.createMap()})});
riot.tag2("editor-media",'<ul if="{options.tabs.length > 1}" class="editor-tabs"> <li each="{name in options.tabs}" class="{active: data.type == name}" onclick="{selectType}"> <svg><use riot-xlink:href="/_s/images/land/editor/editor_media.svg#{name}"></use></svg>{types[name]} </li> </ul> <div each="{name in options.tabs}" class="tab-container {name}" show="{data.type == name || options.no_convert}"></div>','editor-media,[data-is="editor-media"]{user-select:none} editor-media label>input,[data-is="editor-media"] label>input,editor-media div[data-is=action-select],[data-is="editor-media"] div[data-is=action-select]{margin-top:10px;width:100%;max-width:100%}',"",function(e){var t=this;this.tag=this,this.main=this,this.editor=e.editor;var i=e.editor,a={},o=function(e){var t=e=$.trim(e),i="";if(0===(e=e.replace(/http:\/\/|https:\/\/|:\/\/|www./g,"")).search(/(\s*)?youtube.com\//i)||0===e.search(new RegExp("(s*)?youtu.be/","i"))){if(/youtube\.com\/(.*?)v=([^&\s+]+)/i.test(e)?i=e.match(/youtube.com\/(.*?)v=([^&\s+]+)/i)[2].replace(/(\s*)/,""):/youtube\.com\/user\/(.*?)\#/i.test(e)?i=e.match(/\/([^\/.*]+)$/i)[1].replace(/(\s*)/,""):/youtu\.be\/([^&\s+]+)/i.test(e)&&(i=e.match(/youtu\.be\/([^&\s+]+)/i)[1].replace(/(\s*)/,"")),i.length>0)return{link:e,id:i,type:"youtube"}}else if(0===e.search(/^vimeo\.com\//i)||0===e.search(/^player\.vimeo\.com\//i)){if(/^vimeo\.com\/channels\/([^\/]*)\/([0-9]*)/i.test(e)?i=e.match(/^vimeo\.com\/channels\/([^\/]*)\/([0-9]*)/i)[2].replace(/(\s*)/,""):/^vimeo\.com\/([0-9]*)/i.test(e)?i=e.match(/^vimeo\.com\/([0-9]*)/i)[1].replace(/(\s*)/,""):/player\.vimeo\.com\/video\/([0-9]*)/i.test(e)&&(i=e.match(/player\.vimeo\.com\/video\/([0-9]*)/i)[1].replace(/(\s*)/,"")),i.length>0)return{link:e,id:i,type:"vimeo"}}else if(0===t.search(/^\<iframe/i)||0===t.search(/^\<object/i))return{link:t,id:t,type:"html"};return{link:"",id:"",type:""}};switch(this.options=i.options,this.data=i.data,this.types={image:polyglot.t("editor::media::image"),slider:polyglot.t("editor::media::slider"),video:polyglot.t("editor::media::video")},this.on("mount",function(){t.options.tabs.forEach(function(e){a[e]=riot.mount($(".tab-container."+e,t.root).get(0),"media-"+e,{editor:i,parseVideoLink:o,modal:t.main.opts.modal,data:t.data})[0]})}),this.data.type){case"image":flexbe.stat.event("Editor - Media - Image");break;case"slider":flexbe.stat.event("Editor - Media - Slider");break;case"video":flexbe.stat.event("Editor - Media - Video");break;default:flexbe.stat.event("Editor - Media - Unknown")}this.selectType=function(e){var t=e.item.name;switch(a[t].update({state:null}),this.data.type!=t&&(this.data.type=t,i.change()),t){case"image":flexbe.stat.event("Editor - Media - Image");break;case"slider":flexbe.stat.event("Editor - Media - Slider");break;case"video":flexbe.stat.event("Editor - Media - Video");break;default:flexbe.stat.event("Editor - Media - Unknown")}}.bind(this)});
riot.tag2("editor-menu",'<div class="hover-color" if="{options.color}"> <label class="old-style title">{polyglot.t(\'editor::menu::active_link_color\')}</label> <color-list class="color-list" inline="true" active="{data.color || data.active_color}" colors="{options.colors}" onchange="{setColor}" custom="{options.color_custom}"></color-list> </div> <label class="old-style title">{polyglot.t(\'editor::menu::current_menu_item\')}</label> <div class="scrollable-content"> <div data-is="flexbe-field-list" class="field-list" handle-selector=".draggable" item-selector=".field-item" sortend="{sortItems}"> <div each="{field, index in main.data.list}" class="field-item"> <span class="draggable"> <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" riot-xlink:href="{parent.parent.sprite}#drag"></use></svg> </span> <label class="old-style field-name"> <div class="text-field {error: !field.text}"> <input class="old-style" type="text" data-type="name" riot-value="{flexbe.lib.htmlspecialchars(field.text, true)}" oninput="{parent.parent.setName.bind(this, index)}" placeholder="{polyglot.t(\'editor::menu::menu_item_placeholder\')}"> </div> </label> <div class="field-uri"> <div class="text-field {error: flexbe.land.check.link(field.url)}"> <input class="old-style" type="text" data-type="url" riot-value="{flexbe.lib.htmlspecialchars(field.url, true)}" oninput="{parent.parent.setUrl.bind(this, index)}" placeholder="{polyglot.t(\'editor::menu::link_placeholder\')}"> <label class="old-style target-blank" data-disabled="{!field.url || /^#.*/.test(field.url) || RegExp(\'^\' + location.pathname + \'#\').test(field.url)}"> <input class="old-style" type="checkbox" checked="{!!field.target_blank}" onchange="{parent.parent.targetBlank.bind(this, field)}"><span>{polyglot.t(\'editor::menu::link_blank\')}</span> </label> </div> <div class="select select-page" if="{parent.parent.options.show_pages}" onclick="{parent.parent.selectPage}" data-title="{polyglot.t(\'editor::menu::site_select\')}"> <svg width="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" riot-xlink:href="{parent.parent.spriteActions}#pages"></use></svg> </div> <div class="select select-anchor" if="{parent.parent.options.show_anchors}" onclick="{parent.parent.selectAnchor}" data-title="{polyglot.t(\'editor::menu::anchor_select\')}"> <svg width="15"><use xmlns:xlink="http://www.w3.org/1999/xlink" riot-xlink:href="{parent.parent.spriteActions}#anchor"></use></svg> </div> <div class="select select-modal" if="{parent.parent.options.show_anchors}" onclick="{parent.parent.selectModal}" data-title="{polyglot.t(\'editor::menu::modal_select\')}"> <svg width="12"><use xmlns:xlink="http://www.w3.org/1999/xlink" riot-xlink:href="{parent.parent.spriteActions}#modals"></use></svg> </div> </div> <div class="field-remove" onclick="{parent.parent.removeItem}" if="{(main.data.list.length > parent.parent.options.min)}"> <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" riot-xlink:href="{parent.parent.spriteCore}#delete"></use></svg> </div> </div> </div> <div class="add-field" hide="{data.list.length >= options.max}"> <div class="add-holder {show: inAdd}"> <input class="old-style" type="text" placeholder="{polyglot.t(\'editor::menu::enter_placeholder\')}" onkeyup="{addField}" required> <div class="action cancel" onclick="{toggleAddField.bind(this, false)}"> <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" riot-xlink:href="{sprite}#x"></use></svg> </div> <div class="action done" onclick="{addField}"> <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" riot-xlink:href="{sprite}#arrr"></use></svg> </div> </div> <a class="add-button {show: !inAdd}" onclick="{toggleAddField.bind(this, true)}"> <svg viewbox="0 0 15 17" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <path d="M15,12.001 L14,12.001 L14,11 L14.5,11 C14.776,11 15,10.777 15,10.501 L15,1.501 C15,1.225 14.776,1.001 14.5,1.001 L5.5,1.001 C5.224,1.001 5,1.225 5,1.501 L5,2 L4,2 L4,1.001 C4,0.448 4.447,0 5,0 L15,0 C15.552,0 16,0.448 16,1.001 L16,11 C16,11.553 15.552,12.001 15,12.001 Z" fill-rule="nonzero"></path> <path d="M13,4.001 L13,15.001 C13,15.554 12.552,16.001 12,16.001 L1,16.001 C0.447,16.001 0,15.554 0,15.001 L0,4.001 C0,3.448 0.447,3.001 1,3.001 L12,3.001 C12.552,3.001 13,3.448 13,4.001 Z" id="bg"></path> <polygon id="plus" points="7 12.001 6 12.001 6 10 4 10 4 9 6 9 6 7.001 7 7.001 7 9 9 9 9 10 7 10"></polygon> </svg> <span>{polyglot.t(\'editor::menu::add_item\')}</span> </a> </div> </div>',"","",function(t){var e=this;this.tag=this,this.main=this,this.data=t.data,this.editor=t.editor,this.options=t.options,this.sprite="/_s/images/land/editor/editor_menu.svg?1",this.spriteActions="/_s/images/land/editor/actions.svg",this.spriteCore="/_s/images/land/editor/core.svg";var i=this.main.opts.editor.entity.siteBlockType;this.removeItem=function(t){Array.isArray(this.data.list)&&this.data.list.length&&this.data.list.splice(t.item.index,1),this.update(),this.editor.change()}.bind(this),this.sortItems=function(t,e){this.data.list.splice(e,0,this.data.list.splice(t,1)[0]),this.update(),this.editor.change()}.bind(this),this.toggleAddField=function(t){var e=this;this.inAdd=t,this.$addInput.val(""),t&&setTimeout(function(){e.$addInput.focus()},100)}.bind(this),this.addField=function(t){if("click"==t.type||13==t.which){var e=this.$addInput.val();if(this.toggleAddField(!1),!e)return;var i=Object.assign({},this.editor.types.link);i.text=e,this.data.list.push(i),this.editor.change()}}.bind(this),this.selectPage=function(t){var e=this,i=t.item.index;this.editor.selectPage(function(s){e.data.list[i].url=s,e.update(),e.editor.change(),setTimeout(function(){$(t.target).siblings(".text-field").find('input[type="text"]').focus()},150)})}.bind(this),this.selectAnchor=function(t){var e=this,i=t.item.index;this.editor.selectAnchor(function(s){e.setUrl(i,s),e.update(),setTimeout(function(){$(t.target).siblings(".text-field").find('input[type="text"]').focus()},150)})}.bind(this),this.selectModal=function(t){var e=this,s=t.item.index;this.options.isSiteBlock;flexbe.land.modal.control.showList({siteBlockType:i,preview:!0,editor:this.editor.modal,onselect:function(i){e.setUrl(s,"#"+i),e.update(),setTimeout(function(){$(t.target).siblings(".text-field").find('input[type="text"]').focus()},150)}})}.bind(this),this.targetBlank=function(t,e){e.item.index;$(e.target).closest(".text-field").find('input[type="text"]').focus(),t.target_blank=t.target_blank?0:1,this.editor.change()}.bind(this),this.setName=function(t,e){var i="string"==typeof e?e:e.target.value;this.data.list[t].text=flexbe.lib.htmlspecialchars(i),this.editor.change()}.bind(this),this.setUrl=function(t,e){var i="string"==typeof e?e:e.target.value,s=flexbe.lib.htmlspecialchars(i);/^#/.test(s)&&this.options.isSiteBlock&&(s=location.pathname+s),this.data.list[t].url=s,this.editor.change()}.bind(this),this.setColor=function(t){this.data.color=this.data.active_color=t,this.update(),this.editor.change()}.bind(this),this.on("mount",function(){var t;e.$addInput=$(e.root).find(".add-holder input"),$(e.root).on("input","[contenteditable]",$.debounce(function(t){var i=t.currentTarget.dataset.index;e.data.list[i].text=t.currentTarget.innerText,e.editor.change()},150)).on("focusin focusout",'.text-field input[type="text"]',function(e){clearTimeout(t);var i=$(e.currentTarget).closest(".field-item"),s=$(e.currentTarget).attr("data-type");"focusin"==e.type?(i.siblings(".active").removeClass("active").find(".target-blank").removeClass("show"),i.addClass("active"),i.find(".target-blank").toggleClass("show","url"==s)):t=setTimeout(function(){i.removeClass("active"),i.find(".target-blank").removeClass("show")},200)})})});
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}riot.tag2("editor-quiz-variants-list",'<div class="field-title"> <label class="old-style title">{polyglot.t(\'editor::quiz::fields_list\')}</label> <label class="old-style field-text checkbox" show="{field.type == \'image\'}"> <input class="old-style" type="checkbox" checked="{field.show_text}" onchange="{main.setFieldParams.bind(main, field, \'show_text\')}"> <span>{polyglot.t(\'editor::quiz::show_text\')}</span> </label> </div> <ul data-is="flexbe-field-list" class="variant-list" handle-selector=".draggable" item-selector="li" sortend="{sortVariant}"> <li class="variant-item" each="{item, index in tag.vars}"> <span class="draggable"> <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" riot-xlink:href="{main.sprite}#drag"></use></svg> </span> <div class="variant-item__image" show="{tag.field.type == \'image\'}"> <div class="overlay"> <svg><use riot-xlink:href="{main.sprite}#upload_file"></use></svg> </div> <div class="img-holder"> <div class="img" if="{item.img_id && item.img_name}" riot-style="background-image: url(\'/img/{item.img_id}_200/{item.img_name}\')"></div> <div class="img" if="{!item.img_id || !item.img_name}"></div> <input class="old-style" type="file" name="file" onchange="{tag.uploadVariantImage.bind(this, item)}" accept="image/jpeg,image/png,image/gif,image/svg+xml"> </div> </div> <div class="variant-item__name"> <input class="old-style" type="text" placeholder="{polyglot.t(\'editor::quiz::item_name_placeholder\')}" riot-value="{flexbe.lib.htmlspecialchars(item.title, true)}" onkeyup="{tag.variantTitleEnter.bind(this, index)}" oninput="{tag.setVariantTitle.bind(this, item)}"> </div> <div title="{polyglot.t(\'editor::quiz::default_select\')}" class="variant-item__checked {active: item.checked}" onclick="{tag.setChecked.bind(this, tag.field, item)}" show="{[\'checkbox\', \'image\', \'radio\'].indexOf(tag.field.type) > -1}"> <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" riot-xlink:href="{main.sprite}#checked"></use></svg> </div> <div title="{polyglot.t(\'editor::quiz::delete_item\')}" class="variant-item__remove" onclick="{tag.removeVariant.bind(this, index)}" if="{tag.vars.length > 1}"> <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" riot-xlink:href="{main.sprite}#remove"></use></svg> </div> </li> </ul> <a class="add-variant" onclick="{addVariant}">{polyglot.t(\'editor::quiz::add_item\')}</a>',"","",function(t){this.main=this.parent?this.parent.main?this.parent.main:this.parent:this,this.tag=this,this.field=t.field,this.vars=this.field.vars,this.addVariant=function(t){"number"!=typeof t&&(t=this.vars.length),t===this.vars.length&&this.vars.push({title:""}),setTimeout(function(){$(".field-list-item-name").eq(t).find("input").focus()},100),flexbe.stat.event("Editor - Quiz - Step - Add variant")}.bind(this),this.removeVariant=function(t){this.vars.length>1&&(this.vars.splice(t,1),this.update(),this.main.change()),flexbe.stat.event("Editor - Quiz - Step - Delete variant")}.bind(this),this.sortVariant=function(t,e){this.vars.splice(e,0,this.vars.splice(t,1)[0]),this.update(),this.main.change(),flexbe.stat.event("Editor - Quiz - Step - Sorting variants")}.bind(this),this.setVariantTitle=function(t,e){if("object"===_typeof(t)){var i=flexbe.lib.htmlspecialchars(e.target.value);t.title!=i&&(t.title=i,this.main.change()),flexbe.stat.event("Editor - Quiz - Step - Set variant title")}}.bind(this),this.variantTitleEnter=function(t,e){13===e.which&&(flexbe.stat.event("Editor - Quiz - Step - Add variant by enter"),this.addVariant(t+1))}.bind(this),this.setChecked=function(t,e,i){if("object"===_typeof(e)){var s=!1;"radio"!=t.type&&"radio"!=t.input||(s=!0,this.main.resetRadio(t)),e.checked=e.checked&&!s?0:1,this.main.change(),flexbe.stat.event("Editor - Quiz - Step - Select variant by default")}}.bind(this);var e=$('<input type="file">').spacedUpload({url:"/admin/files/upload?type=image"});this.uploadVariantImage=function(t,i){var s=this,a=i.target.files;a&&a.length&&(e.spacedUpload("addItem",{file:a[0],onComplete:function(e,i,a){e||console.warn(polyglot.t("editor::quiz::upload_error")+": "+a);try{i=JSON.parse(i)}catch(t){console.warn(polyglot.t("editor::quiz::object_error")+" ",i)}t.img_id=i.img_id,t.img_name=i.img_name,s.update(),s.main.change(),flexbe.stat.event("Editor - Quiz - Step - Upload variant image")}}),e.spacedUpload("startUpload"))}.bind(this)}),riot.tag2("editor-quiz",'<ul if="{options.tabs.length > 1}" class="editor-tabs"> <li each="{tab in options.tabs}" class="{active: currentTab == tab}" onclick="{selectTab.bind(this, tab)}"> <svg><use riot-xlink:href="{sprite}#{tab}"></use></svg> {tabs[tab]} </li> </ul> <div class="content-wrapper steps-tab" show="{currentTab == \'steps\'}"> <div class="steps-container"> <div class="steps-list"> <label class="old-style title">{polyglot.t(\'editor::quiz::steps_list\')}</label> <ul data-is="flexbe-field-list" handle-selector=".draggable" item-selector="li" sortend="{sortStep}"> <li class="draggable" each="{step, index in main.data.steps}"> <div class="field-item {active: main.currentStep == index}" onclick="{main.selectStep.bind(this, index, false)}"> <svg class="step-icon"> <use riot-xlink:href="{main.fieldsSprite}#field-{step.list[0].type}"></use> </svg> <div class="step-preview">{flexbe.lib.htmlspecialchars(step.list[0].name, true) || main.types[step.list[0].type]}</div> <a class="remove-step" if="{main.data.steps.length > 1}" onclick="{main.removeStep.bind(this, index)}"> <svg><use riot-xlink:href="{main.sprite}#remove"></use></svg> </a> </div> </li> </ul> <a class="add-step" onclick="{addStep}">{polyglot.t(\'editor::quiz::add_step\')}</a> <modal-block if="{isAddStep}" onclose="{addStep}"> <div class="flexbe-modal-content header"> {polyglot.t(\'editor::quiz::step_add_title\')} <div class="flexbe-modal-close" onclick="{opts.onclose}"> <svg width="16" height="16" viewbox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <path fill-rule="evenodd" d="M 9.12128 7.70709L 15.4142 1.41418L 14 0L 7.70709 6.29291L 1.41418 0L 0 1.41418L 6.29291 7.70709L 0 14L 1.41418 15.4142L 7.70709 9.12128L 14 15.4142L 15.4142 14L 9.12128 7.70709Z"></path> </svg> </div> </div> <hr> <div class="flexbe-modal-content"> <div data-is="editor-form-field-add" class="field-add" list="{tag.opts.editor.templates}" allowed="{tag.opts.options.allowed}" onchange="{opts.onclose}"></div> </div> </modal-block> </div> <div class="step-settings"> <div class="field-item" each="{field, index in getCurrentStep().list}"> <div class="field" if="{index == 0}"> <label class="old-style title">{polyglot.t(\'editor::quiz::step_title\')}</label> <input class="old-style" type="text" placeholder="{polyglot.t(\'editor::quiz::step_title_placeholder\')}" riot-value="{flexbe.lib.htmlspecialchars(data.steps[currentStep].title, true)}" oninput="{setStepTitle.bind(this, data.steps[currentStep])}"> </div> <div class="field"> <div class="field-title"> <label class="old-style title"> {polyglot.t(\'editor::quiz::field_form_title\')} <q class="tip">{polyglot.t(\'editor::quiz::field_form_help\')}</q> </label> <label class="field-required checkbox" if="{true || /text|textarea|file|phone|email|name|checkbox|image/.test( field.type )}"> <input class="old-style" type="checkbox" checked="{field.is_required}" onchange="{setFieldParams.bind(this, field, \'is_required\')}"> <span>{polyglot.t(\'editor::form::field_required\')}</span> </label> </div> <input class="old-style" type="text" placeholder="{polyglot.t(\'editor::quiz::field_name_placeholder\')}" riot-value="{flexbe.lib.htmlspecialchars(field.name, true)}" oninput="{setFieldName.bind(this, field)}"> </div> <div data-is="editor-quiz-variants-list" class="field field-list" if="{/select|checkbox|radio|image/.test( field.type )}" field="{field}"></div> <div class="field field__image-params" if="{field.type == \'image\'}"> <label class="old-style field__image-params-multiple"> {polyglot.t(\'editor::quiz::field_multiple\')} <div data-is="radio-buttons" list="{multipleList}" current="{field.input || \'radio\'}" onselect="{setMultiple.bind(this, field)}"></div> </label> <label class="old-style field__image-params-form"> {polyglot.t(\'editor::quiz::field_img_format\')} <div data-is="radio-buttons" list="{imageForms}" current="{field.image_form || \'quad\'}" onselect="{setFieldImageForm.bind(this, field)}" sprite="{sprite}"></div> </label> </div> </div> </div> </div> <div class="step-actions"> <div class="action-setup"> <label class="flexbe-form-title">{polyglot.t(\'editor::quiz::step_action\')}</label> <action-block class="action-block" options="{opts.options}" data="{data}" editor="{opts.editor}" actions="{options.actions}" riot-value="{data.action}" onchange="{actionChanges}" oninput="{actionChanges}" event-stat-group="Editor - Quiz - Action"></action-block> </div> </div> </div> <div class="content-wrapper style-tab" show="{currentTab == \'style\'}"> <div data-is="old-button-style" options="{options}" data="{data}" editor="{opts.editor}" render="{opts.render}" is-quiz="{true}" event-stat-group="Editor - Quiz - Style - Button"></div> <label class="old-style text-loader-style"> {polyglot.t(\'editor::quiz::loader_title\')} <radio-buttons list="{options.text_loader_styles}" current="{data.text_loader || \'none\'}" onselect="{setTextLoader}" sprite="{sprite}"></radio-buttons> </label> <label class="old-style progress-loader-style"> {polyglot.t(\'editor::quiz::loader_type\')} <radio-buttons list="{options.progress_loader_styles}" current="{data.progress_loader || \'none\'}" onselect="{setProgressLoader}" sprite="{sprite}"></radio-buttons> </label> </div> <div class="content-wrapper goals-tab" show="{currentTab == \'goals\'}"> <div class="order"> <label class="old-style light flex" for="name">{polyglot.t(\'editor::form::name\')} <q class="tip tooltipstered">{polyglot.t(\'editor::quiz::form_name_help\')}</q> </label> <input class="old-style" type="text" name="name" riot-value="{flexbe.lib.htmlspecialchars(data.name, true)}" oninput="{setName}"> </div> <div data-is="goals" is-quiz="{true}" goals="{data.goals}" main-goal="order_done" changed="{goalsUpdate}"></div> </div>',"","",function(t){var e=t.editor;this.tag=this,this.main=this,flexbe.stat.event("Editor - Quiz"),this.options=t.options,this.data=t.data,this.sprite="/_s/images/land/editor/editor_quiz.svg?4",this.fieldsSprite="/_s/images/land/editor/fields.svg?2",this.types={name:polyglot.t("editor::form::type_name"),email:polyglot.t("editor::form::type_email"),phone:polyglot.t("editor::form::type_phone"),text:polyglot.t("editor::form::type_text"),textarea:polyglot.t("editor::form::type_textarea"),select:polyglot.t("editor::form::type_select"),checkbox:polyglot.t("editor::form::type_checkbox"),radio:polyglot.t("editor::form::type_radio"),image:polyglot.t("editor::form::type_image"),file:polyglot.t("editor::form::type_file")},this.imageForms=["horizontal","quad","vertical"],this.multipleList=[{name:"radio",value:polyglot.t("editor::quiz::multiple_list_one")},{name:"checkbox",value:polyglot.t("editor::quiz::multiple_list_multi")}],this.currentTab="steps",this.tabs={steps:polyglot.t("editor::quiz::tab_steps"),style:polyglot.t("editor::quiz::tab_style"),goals:polyglot.t("editor::quiz::tab_goals")},this.currentStep=t.currentStep||0,this.inputDebounce=500,this.isAddStep=!1,this.getCurrentStep=function(){return this.data.steps[this.currentStep]||{}}.bind(this),this.selectStep=function(t,i){void 0===i&&(i=!0),"done"==t&&(t=0),t=Math.min(Math.max(0,t),this.data.steps.length-1),this.currentStep!=t&&flexbe_cli.events.emit("quiz_command",{id:e.id,command:"step",step:t+1}),this.update({currentStep:t}),flexbe.tip.init($(".steps-tab",this.root)),flexbe.stat.event("Editor - Quiz - Step - View")}.bind(this),this.actionChanges=function(t){var e=t.target.name.split("."),i=e[e.length-1];e.reduce(function(t,e){return"object"===_typeof(t[e])?t[e]:t},this.data)[i]=t.target.value,this.change()}.bind(this),this.addStep=function(t){var e=this;this.isAddStep&&t&&t.item&&(this.data.steps.push({title:t.item.name||polyglot.t("editor::quiz::step_new_field"),list:[$.extend(!0,{id:flexbe.lib.rand(1e4,99999)},t.item)]}),this.change(),setTimeout(function(){e.selectStep(e.data.steps.length-1)},300)),this.update({isAddStep:!this.isAddStep}),this.opts.editor.modal.disabled(this.isAddStep),flexbe.stat.event("Editor - Quiz - Step - Added"),setTimeout(function(){$("body").find(".overlay-area").last().focus()},10)}.bind(this),this.removeStep=function(t){this.data.steps.length>1&&(this.selectStep(Math.max(t-1,0)),this.data.steps.splice(t,1),this.update(),this.change()),flexbe.stat.event("Editor - Quiz - Step - Delete")}.bind(this),this.sortStep=function(t,e){var i=this;this.data.steps.splice(e,0,this.data.steps.splice(t,1)[0]),this.change(),setTimeout(function(){i.selectStep(e)},30),flexbe.stat.event("Editor - Quiz - Step - Sorting")}.bind(this),this.setStepTitle=function(t,e){if("object"==_typeof(t)){var i=flexbe.lib.htmlspecialchars(e.target.value);t.title!=i&&(t.title=i,this.change(null,this.inputDebounce)),flexbe.stat.event("Editor - Quiz - Step - Set title")}}.bind(this),this.setFieldName=function(t,e){if("object"==_typeof(t)){var i=flexbe.lib.htmlspecialchars(e.target.value);t.name!=i&&(t.name=i,this.change(null,this.inputDebounce)),flexbe.stat.event("Editor - Quiz - Step - Set field name")}}.bind(this),this.setFieldParams=function(t,e,i){switch(t[e]=t[e]?0:1,this.change(),e){case"is_required":flexbe.stat.event("Editor - Quiz - Step - Required field",{is_required:t[e]});break;case"show_text":flexbe.stat.event("Editor - Quiz - Step - Show image titles",{show_text:t[e]});break;default:console.log("setFieldParams",e)}}.bind(this),this.setMultiple=function(t,e){if("object"===_typeof(e))switch(t.input=e.name,"radio"!=t.type&&"radio"!=t.input||(this.resetRadio(t),t.vars[0]&&(t.vars[0].checked=1)),this.update(),this.change(),e.name){case"radio":flexbe.stat.event("Editor - Quiz - Step - Disallow multiple value");break;case"checkbox":flexbe.stat.event("Editor - Quiz - Step - Allow multiple value")}}.bind(this),this.resetRadio=function(t){"object"===_typeof(t)&&Array.isArray(t.vars)&&("radio"!==t.type&&"radio"!==t.input||t.vars.forEach(function(t){return delete t.checked}))}.bind(this),this.setFieldImageForm=function(t,e){"object"===_typeof(e)&&(t.image_form=e.name,this.change(),flexbe.stat.event("Editor - Quiz - Step - Set image size"))}.bind(this),this.setTextLoader=function(t){"object"===_typeof(t)&&(this.data.text_loader=t.name,this.change(),flexbe.stat.event("Editor - Quiz - Style - Select text loader",{type:this.data.text_loader}))}.bind(this),this.setProgressLoader=function(t){"object"===_typeof(t)&&(this.data.progress_loader=t.name,this.change(),flexbe.stat.event("Editor - Quiz - Style - Select progress loader",{type:this.data.progress_loader}))}.bind(this),this.setLink=function(t){this.data.action_redirect=t.target.value,this.change(null,this.inputDebounce),this.update(),flexbe.stat.event("Editor - Quiz - Action - Link - Edit")}.bind(this),this.setPay=function(t){this.data.pay.price=flexbe.lib.htmlspecialchars(t.target.value),this.change(null,this.inputDebounce),this.update(),flexbe.stat.event("Editor - Quiz - Action - Pay - Edit price")}.bind(this),this.goalsUpdate=function(e){t.data.goals=e,this.update(),flexbe.stat.event("Editor - Quiz - Goals - Update")}.bind(this),this.setName=function(t){this.data.name=flexbe.lib.htmlspecialchars(t.target.value),this.update(),this.change(null,this.inputDebounce),flexbe.stat.event("Editor - Quiz - Goals - Set form name")}.bind(this),this.selectTab=function(t){switch(this.currentTab=t,t){case"steps":flexbe.stat.event("Editor - Quiz - Steps tab");break;case"style":flexbe.stat.event("Editor - Quiz - Style tab");break;case"goals":flexbe.stat.event("Editor - Quiz - Goals tab")}}.bind(this),this.change=function(t,i){e.change(t,i)}.bind(this)});
riot.tag2("social-list",'<div each="{item, name in list}" data-type="{name}" title="{item.title}" onclick="{addItem}"> <svg><use xlink:href="/_s/images/land/socials.svg#{name}"></use></svg> </div>',"",'class="field-list"',function(t){this.list=t.socials,this.addItem=function(e){t.update($.extend({},e.item.item)),t.modal.close()}}),riot.tag2("editor-socials",'<div class="fields"> <span class="description">{polyglot.t(\'editor::socials::desc\')}</span> <div class="fields-holder"> <div each="{opts.data.list}" class="item" data-item="{name}"> <span class="icon social-{name}"> <svg><use xlink:href="/_s/images/land/socials.svg#{name}"></use></svg> </span> <input type="text" riot-value="{url}" onkeyup="{inputUpdate}" oninput="{inputUpdate}"> <a class="remove" onclick="{removeSocial}"><i></i></a> </div> </div> <div class="field-add"><a onclick="{addSocial}" if="{opts.data.list.length < opts.options.max}">{polyglot.t(\'editor::socials::add_social\')}</a><span if="{opts.data.list.length >= opts.options.max}">{polyglot.t(\'editor::socials::limit_warn\')}</span></div> </div> <div class="style"> <div class="style-holder"> <span class="title">{polyglot.t(\'editor::socials::style_select\')}</span> <virtual each="{style, name in opts.options.styles}"> <input type="radio" onchange="{selectStyle}" checked="{name == selectedStyle.type}" name="socials-style" id="{name}"> <label for="{name}"> <svg><use xlink:href="/_s/images/land/socials.svg#vk"></use></svg> </label> </virtual> </div> <div class="color-holder" if="{hasColors.length > 1}"> <color-list class="color_list" title="Цвет иконок" colors="{hasColors}" onchange="{selectColor}" active="{selectedStyle.color}"></color-list> </div> </div>',"","",function(t){var e,s=this,l=t.editor;s.selectedStyle=t.data.style,t.options.styles[s.selectedStyle.type].color=s.selectedStyle.color,s.hasColors=t.options.styles[s.selectedStyle.type].colors,s.on("mount",function(){var l=$(".fields-holder",s.root)[0];$(l).sortable({start:function(t,s){e=$(this).children().index(s.item[0])},stop:function(l,i){var a=i.item[0],o=$(this).children().index(a),c=t.data.list[e||0];e!==o&&(t.data.list.splice(e,1),t.data.list.splice(o,0,c),s.update())}})}),s.on("update",function(){s.isMounted&&l.change()}),s.inputUpdate=$.debounce(function(t){t.item.url=$(t.target).val().replace(new RegExp("^(http|https)://"),""),s.update()},150),s.addSocial=function(e){if(!$('[data-name="editor_socials_add"]').length){var l=$(e.target),i=$.extend({},t.editor._socials);t.data.list.forEach(function(t){delete i[t.name]});flexbe.modal.create({name:"editor_socials_add",context:l,context_align:"left",item:l,title:polyglot.t("editor::socials::add_social_title"),overlay:!1,width:360,riotTag:"social-list",riotOpts:{socials:i,update:function(e){t.data.list.push(e),s.update()}}})}},s.removeSocial=function(e){var l=t.data.list;l.splice(l.indexOf(e.item),1),s.update()},s.selectStyle=function(e){var l=t.options.styles[e.item.name];s.selectedStyle.type=t.data.style.type=e.item.name,s.selectedStyle.color=l.color||l.colors[0]||"",s.update({hasColors:t.options.styles[s.selectedStyle.type].colors})},s.selectColor=function(e){var l=t.options.styles[s.selectedStyle.type];s.selectedStyle.color=l.color=e,s.update()}});
riot.tag2("font-setup",'<div class="font-group"> <div class="controls"> <div class="button prev-button"> <svg viewbox="0 0 12 22"><path d="M10.645 0L12 1.4 2.71 11 12 20.6 10.645 22 0 11z" fill="currentColor" fill-rule="evenodd"></path></svg> </div> <div class="counter"> {polyglot.t(\'editor::fonts::var_title\')} {main.id} {polyglot.t(\'editor::fonts::of\')} {main.variants.length} </div> <div class="button next-button"> <svg viewbox="0 0 12 22"><path d="M1.355 0L0 1.4 9.29 11 0 20.6 1.355 22 12 11z" fill="currentColor" fill-rule="evenodd"></path></svg> </div> </div> <div class="select-variants"> <ul class="slide-items"> <li each="{variant in main.variants}" class="slide variant-{variant.id} {active: (variant.id == main.id)}"> <div each="{data, name in variant.set}" class="field {name}" onclick="{selectCustom.bind(this, name)}"> <div class="name"> <span>{formatFontFamily(getCurrent(name).family)}</span> <svg viewbox="0 0 10 7"><path d="M1.4 0L5 3.6 8.6 0 10 1.4l-5 5-5-5z" fill="currentColor" fill-rule="evenodd"></path></svg> <a class="reset" if="{getCurrent(name).family != data.family}" onclick="{main.resetFont}"> {polyglot.t(\'editor::fonts::reset\')} </a> </div> <div class="preview" riot-style="font-family: {getCurrent(name).family}"> <span class="text" if="{name == \'title-main\'}"> {polyglot.t(\'editor::fonts::main_title\')} </span> <span class="text" if="{name == \'title\'}"> {polyglot.t(\'editor::fonts::block_title\')} </span> <span class="text" if="{name == \'subtitle\'}"> {polyglot.t(\'editor::fonts::subtitle\')} </span> <span class="text" if="{name == \'content\'}"> {polyglot.t(\'editor::fonts::content\')} </span> <span class="text" if="{name == \'quote\'}"> {polyglot.t(\'editor::fonts::quote\')} </span> </div> </div> </li> </ul> </div> </div> <div class="font-select"> <div class="main-title"> <span>{titles[selectedType]}</span> <a class="cancel-custom" onclick="{selectCustom.bind(this, false)}">{polyglot.t(\'editor::fonts::done\')}</a> </div> <ul class="font-list" if="{selectedType}"> <li each="{font in scope.list}" class="{active: font.family == (fonts[selectedType] || {}).family}" onclick="{selectFont}"> <span riot-style="font-family: {font.family}">{formatFontFamily(font.family)}</span> </li> </ul> </div>',"",'class="{custom-select: selectedType}"',function(t){var e=this,i=function(){return pageStore.fonts.id},n=function(){return pageStore.fonts.set};this.tag=this,this.main=this,this.scope=flexbe.land.fonts,this.id=i(),this.fonts=n(),this.variants=configStore.themeJson.fonts,this.titles={"title-main":polyglot.t("editor::fonts::style_main_title"),title:polyglot.t("editor::fonts::style_block_title"),subtitle:polyglot.t("editor::fonts::style_subtitle"),content:polyglot.t("editor::fonts::style_content"),quote:polyglot.t("editor::fonts::style_quote")},this.selectedType=!1;var s=mobx.autorun(function(){e.update({id:i(),fonts:n()})});this.on("unmount",function(){s()}),this.formatFontFamily=function(t){return void 0===t&&(t=""),String(t).split(",")[0].replace(new RegExp("[\"']","g"),"")||"-"}.bind(this),this.getCurrent=function(t){return this.fonts[t]||{}}.bind(this),this.selectCustom=function(t){var e=this;if(!1===t)return this.selectedType=t,!1;this.selectedType=t,flexbe.stat.event("Editor - Fonts - Custom"),setTimeout(function(){e.scrollToActive()},150)}.bind(this),this.selectVariant=function(t){pageStore.fonts.setVariant(t),flexbe.stat.event("Editor - Fonts - Change combinations")}.bind(this),this.selectFont=function(t){var e=this.selectedType,i=t&&t.item&&t.item.font;if(!i)return!1;pageStore.fonts.setFont(e,i),flexbe.stat.event("Editor - Fonts - Select custom",{group:e,font:i.family})}.bind(this),this.resetFont=function(t){var e=t.item.name;pageStore.fonts.resetFont(e),flexbe.stat.event("Editor - Fonts - Reset to default",{group:e,font:t.item.font.family}),t.stopPropagation()}.bind(this),this.scrollToActive=function(){var t=$("ul.font-list",this.root),e=t.find("li.active");e.length&&t.animate({scrollTop:e[0].offsetTop-t[0].offsetHeight/2-80+"px"},300)}.bind(this),this.on("mount",function(){e.scope.loadFontsOnPage(function(){e.update()}),require(["/_s/lib/swiper/swiper.js"],function(){var t=$(e.root).find(".select-variants"),i=$(e.root).find(".button"),n=t.find(".active").index()||0;new Swiper(t[0],{wrapperClass:"slide-items",slideClass:"slide",slideActiveClass:"active",prevButton:i[0],nextButton:i[1],initialSlide:n,simulateTouch:!1,slideToClickedSlide:!1,spaceBetween:0,autoHeight:!1,onInit:function(t){e.is_init=!0},onSlideChangeStart:function(t){e.selectVariant(t.activeIndex+1)}})}),$(window).off("keyup.font_select").on("keyup.font_select",function(t){if(e.selectedType&&-1!=[38,40].indexOf(t.which)){t.preventDefault(),t.stopPropagation();var i=$("ul.font-list",e.root).find("li.active"),n=38==t.which?i.prev():i.next();try{n.trigger("click")}catch(t){}return!1}})})});
riot.tag2("modal-block","<yield></yield>","","",function(t){var n=this,i=this.parent?this.parent.tag?this.parent.tag:this.parent:this,o=this.parent?this.parent.main?this.parent.main:this.parent:this,e=Object.assign({onmount:function(){},onclose:function(){},setposition:function(){return!0},bindTo:o.root,position:"center",appendToBody:!0,class:""},this.opts),s=document.createElement("div"),a=this.root,p=e.bindTo;this.tag=i,this.main=o,this.params=e,this.overlayEl=s,this.contentEl=a,this.parentEl=p;var r=function(){var t,n;e.appendToBody&&(s.tabIndex=0,s.classList="overlay-area on",a.classList="modal-block "+e.class,s.contains(a)||s.appendChild(a),document.body.appendChild(s),$(s).on("mousedown",function(n){t=n.target===s}),$(s).on("mouseup",function(t){n=t.target===s}),$(s).on("click",function(i){if(t&&n)return e.onclose(i),i.preventDefault(),!1;t=!1,n=!1}),$(s).on("keydown",function(t){return 27!==t.which||(t.preventDefault(),t.stopImmediatePropagation(),e.onclose(t),!1)}).focus())};this.on("mount",function(){e.onmount(n),"center"==e.position&&r(),e.setposition(n)&&function(){if("center"==e.position){var t=p.getBoundingClientRect(),n=a.getBoundingClientRect();a.setAttribute("style","\n                    position: absolute;\n                    top: "+(t.top+(t.height-n.height)/2)+"px;\n                    left: "+(t.left+(t.width-n.width)/2)+"px;\n                ")}else if("initial"==e.position){var i=a.getBoundingClientRect();a.setAttribute("style","\n                    position: absolute;\n                    top: "+i.top+"px;\n                    left: "+i.left+"px;\n                    width: "+i.width+"px;\n                    height: "+i.height+"px;\n                ")}}(),"initial"==e.position&&r()}),this.on("unmount",function(){s&&s.remove()})});
riot.tag2("section-anchor",'<div class="field group-start"> <label data-is="flexbe-input" riot-value="{anchorActive}" checked="{anchorActive}" onchange="{toggleAnchor}" class="flexbe-input toggle" type="checkbox"><span>{polyglot.t(\'editor::settings::anchor\')}</span></label> </div> <div if="{anchorActive}" class="field"> <div data-is="flexbe-copyable" oninput="{updateAnchor}" riot-value="{opts.data._anchor}" prefix="#" prepend="{prepend}" type="text"></div> </div>',"",'data-type="anchor" class="anchor-editor"',function(t){var a=this.opts;a.change,a.editor;this.prepend=location.origin+location.pathname+"#",this.anchorString="",this.anchorActive=!!this.opts.data._anchor,this.updateAnchor=function(t){this.opts.data._anchor=t.target.value}.bind(this),this.toggleAnchor=function(){this.anchorActive?(this.opts.data.savedAnchor=this.opts.data._anchor,delete this.opts.data._anchor,this.anchorActive=!1):(this.anchorActive=!0,this.opts.data._anchor=this.opts.data.savedAnchor?this.opts.data.savedAnchor:""),this.update()}.bind(this)});
riot.tag2("editor-background",'<div class="type-select" if="{options.type.length > 1}"> <div class="flexbe-group-button dark"> <div each="{name, i in options.type}" class="flexbe-button {active: name == bg.type}" onclick="{setType}">{parent.types[name]}</div> </div> </div> <div class="contain {bg.type}"> <div class="image-page" if="{!!~options.type.indexOf(\'image\')}"> <div class="image-holder-outer"> <div class="image-holder data_img {loading: loaded < 100}" riot-style="background-image: url({bg.image}); background-position: {bg.position.x} {bg.position.y};"> <div class="image-preloader"> <svg class="loader circular-loader" viewbox="25 25 50 50"><circle class="loader-path" cx="50" cy="50" r="20"></circle></svg> </div> </div> <div class="controlls {hide: loaded < 100}"> <button if="{typeof bg.image === \'string\'}" class="flexbe-button style-dark filled size-s icon" onclick="{showPositionModule}"> <span>{polyglot.t(\'editor::bg_setting::bgposition\')}</span> </button> </div> </div> <div class="image-action row"> <div class="col col-6"> <label class="file_select bg_option flexbe-button block style-blue filled size-m icon"> <input type="file" name="file" accept="image/jpeg,image/png,image/gif"> <div class="ico" style="text-align:center; width: 14px; line-height: 14px; display: inline-block; height: 14px;"> <svg> <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/_s/images/land/editor/editor_background.svg#upload"></use> </svg> </div> <span> {polyglot.t(\'editor::settings::upload\')} </span> </label> </div> <div class="col col-6" onclick="{openGallery}"> <button class="flexbe-button bg_option block style-dark size-m icon"> <div class="ico" style="text-align:center; width: 18px; line-height: 14px; display: inline-block; height: 14px;"> <svg> <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/_s/images/land/editor/editor_background.svg#photo"></use> </svg> </div> <span>{polyglot.t(\'editor::bg_settings::gallery\')}</span> </button> </div> </div> </div> <div class="video-page" if="{!!~options.type.indexOf(\'video\')}"> <div class="image-holder-outer"> <div class="controlls"> <label class="upload-preview bg_option flexbe-button style-dark filled size-s"> <input type="file" name="file" accept="image/jpeg,image/png,image/gif"> <span>{polyglot.t(\'editor::bg_settings::upload\')}</span> </label> <button if="{bg.originalVideoPreview && bg.video_image !== bg.originalVideoPreview}" class="flexbe-button style-dark filled size-s" onclick="{setOriginalPreview}"> <div class="ico" style="text-align:center; width: 14px; line-height: 14px; display: inline-block; height: 14px;"> <svg> <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/_s/images/land/editor/editor_background.svg#trash"></use> </svg> </div> </button> <button if="{bg.video_image}" class="flexbe-button style-dark filled size-s icon" onclick="{showPositionModule}"> <span>{polyglot.t(\'editor::bg_setting::bgposition\')}</span> </button> </div> <div class="image-holder video-image data_img {loading: loaded < 100}" riot-style="background-image: url({bg.video_image}); background-position: {bg.position.x} {bg.position.y};"> <div class="image-preloader"> <svg class="loader circular-loader" viewbox="25 25 50 50"><circle class="loader-path" cx="50" cy="50" r="20"></circle></svg> </div> </div> </div> <div class="video-settings"> <div class="flexbe-form-title">{polyglot.t(\'editor::bg_settings::video_link\')}</div> <label class="flexbe-input block"> <input type="text" placeholder="youtube.com/watch?v=DSLgAsrcpGQ" riot-value="{bg.video && bg.video.url}" oninput="{setupVideo}"> </label> </div> </div> <div class="color-page {bg.type != \'color\' ? \'second\':\'\'}" if="{!!~options.type.indexOf(\'color\')}"> <div if="{bg.type === \'color\' && options.type.length > 1}" class="color-preview" riot-style="background-color: {bg.color}" onclick="{showPicker}"> <div class="ico {flexbe.lib.contrastColor(bg.color, \'dark\', \'light\')}"> <svg> <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/_s/images/land/editor/editor_background.svg#bucked"></use> </svg> </div> </div> <div class="color-page-inner"> <div class="row"> <div class="col col-6"> <span class="flexbe-form-title"> {(options.type.length == 1 && options.title) ? options.title : (bg.type == \'color\') && polyglot.t(\'editor::bg_settings::bg_color\') || polyglot.t(\'editor::bg_settings::bg_shadow\')} </span> <label for="" class="flexbe-input context before"> <flexbe-color-input class="colorpicker" riot-value="{bg.color}" color-list="{options.colors}" apply-if-valid="1" update="{setColor}"></flexbe-color-input> </label> </div> <div class="col col-6" if="{bg.type !== \'color\'}"> <span class="flexbe-form-title"> {polyglot.t(\'editor::bg_settings::opacity\')} </span> <flexbe-slider class="flexbe-slider percent" suffix="%" oninput="{changeOpacity}" max="{100}" riot-value="{bg.opacity || 0}" number="true"> </flexbe-slider> </div> </div> </div> <div class="color-page-inner" if="{bg.type !== \'color\'}"> <div class="row"> <div class="col col-6"> <label data-is="flexbe-input" riot-value="{bg.gradientOn}" checked="{bg.gradientOn}" onchange="{switchGradient}" class="flexbe-input toggle" type="checkbox" style="margin-right: 15px"><span>{polyglot.t(\'editor::bg_settings::gradient\')}</span></label> </div> <div if="{bg.gradientOn}" class="col col-6"> <flexbe-slider class="flexbe-slider" oninput="{changeGradient}" max="{200}" disabled="{!bg.gradientOn}" min="{1}" riot-value="{bg.gradientOn ? bg.gradient : bg.gradientCommit}"> </flexbe-slider> </div> </div> </div> <div if="{bg.type === \'image\' && options.parallax}" class="color-page-inner"> <span class="flexbe-form-title">{polyglot.t(\'editor::bg_settings::effects\')}</span> <flexbe-select class="flexbe-select block" list="{effects}" onchange="{changeEffects}" riot-value="{bg.parallax}"></flexbe-select> </div> <div if="{bg.type === \'video\'}" class="color-page-inner"> <label data-is="flexbe-input" checked="{bg.parallax}" onchange="{toggleParallax}" class="flexbe-input toggle" type="checkbox" style="margin-right: 15px"><span>{polyglot.t(\'editor::bg_settings::parallax\')}</span></label> </div> </div> </div>',"","",function(i){var e=this;this.bg=this.opts.bg,this.options=this.opts.options,this.loaded=100;var t,o=this.opts,s=o.change,l=o.editor;this.effects=[{title:polyglot.t("editor::bg_settings::effect::no_effects"),value:0},{title:polyglot.t("editor::bg_settings::effect::parallax"),value:1},{title:polyglot.t("editor::bg_settings::effect::parallax_fade"),value:2},{title:polyglot.t("editor::bg_settings::effect::zoom"),value:3},{title:polyglot.t("editor::bg_settings::effect::zoom_return"),value:4}],this.types={color:polyglot.t("editor::bg_settings::tab_color"),image:polyglot.t("editor::bg_settings::tab_image"),video:polyglot.t("editor::bg_settings::tab_video")},this.init=function(){this.bg.gradientOn=this.bg.gradientOn?this.bg.gradientOn:!!this.bg.gradient,this.bg.gradientCommit=this.bg.gradientCommit?this.bg.gradientCommit:1,this.update()}.bind(this),this.showPicker=function(i){var e=this.root.querySelector(".color-picker-inner");e&&e.click()}.bind(this),this.selectColor=function(i){if(i){var e=i.target;if(i.stopPropagation(),"SPAN"!==e.nodeName&&!e.classList.contains("overlay-area"))return}}.bind(this),this.setType=function(i){this.bg.type=i.item.name,"color"!=this.bg.type||this.options.color_gradient?"image"==this.bg.type?(this.bg.image||(this.bg.image={}),(this.bg.opacity>80||this.bg.opacity<20)&&(this.bg.opacity=65)):"video"==this.bg.type&&(this.bg.video||(this.bg.video={}),this.bg.video.url&&setTimeout(l._object.clientMsg("video_bg_update",this.bg.video),100)):this.bg.gradient=0,s(this.bg,"full")}.bind(this),this.setColor=function(i){var e=this,t=i.split(":"),o=/^#/.test(t[0]);void 0===t[1]&&(t[1]=this.bg.opacity),o&&!this.bg.gradient&&100==t[1]&&(t[1]=95);var a=this.bg.color;if(this.bg.color=t[0],this.bg.opacity=+t[1],!1!==this.options.animate&&!this.bg.gradient&&o&&l.$area&&l.$area.width()>=l.$area.height()){var g=l.$area.find(".component-bg").find(".overlay").removeClass("animate").addClass("preload");g[0]&&(g[0].style.borderColor=a,g[0].style.background=t[0],g[0].style.opacity=t[1]/100,setTimeout(function(){g.addClass("animate")},50),g.one("transitionend",function(){g.removeClass("animate preload").removeAttr("style"),s(e.bg,"css")}))}s(this.bg),this.update()}.bind(this),this.changeOpacity=function(i){var e=i.target.valueAsNumber;this.bg.opacity=e,this.update(),s(this.bg,"css")}.bind(this),this.changeGradient=function(i){this.bg.gradient=parseInt(i.target.value,10),this.update()}.bind(this),this.switchGradient=function(){this.bg.gradientOn=!this.bg.gradientOn,this.bg.gradientOn?this.bg.gradient=this.bg.gradientCommit:(this.bg.gradientCommit=this.bg.gradient,this.bg.gradient=0),this.update()}.bind(this),this.changeEffects=function(i){this.bg.parallax=i.value,this.update(),s(this.bg,"full")}.bind(this),this.toggleParallax=function(){this.bg.parallax=this.bg.parallax?0:1,s(this.bg,"full")}.bind(this),this.openGallery=function(){var i=this;new flexbe.land.editor.modules.gallery(l.$area,{is_background:!0,on_change:function(e){i.bg["video"==i.bg.type?"video_image":"image"]="/img/"+e.img_id+"_2560/"+e.img_name,i.update(),s(i.bg,"full")}})}.bind(this),this.showPositionModule=function(){var i=this;new flexbe.land.editor.modules.bgposition(l.$area,{bg:this.bg,on_change:function(e){i.update(),s(i.bg,"full")}})}.bind(this),this.setOriginalPreview=function(){this.bg.video_image&&this.bg.originalVideoPreview&&(this.bg.video_image=this.bg.originalVideoPreview,this.update())}.bind(this),this.setupVideo=function(i){var e=this;clearTimeout(t),t=setTimeout(function(i){var t=$.trim(i.target.value);t=(t=(t=(t=t.replace("http://","")).replace("https://","")).replace("://","")).replace("www.","");var o="";if(/youtube\.com\/(.*?)v=([^&\s+]+)/i.test(t)?o=t.match(/youtube.com\/(.*?)v=([^&\s+]+)/i)[2].replace(/(\s*)/,""):/youtube\.com\/user\/(.*?)\#/i.test(t)?o=t.match(/\/([^\/.*]+)$/i)[1].replace(/(\s*)/,""):/youtu\.be\/([^&\s+]+)/i.test(t)&&(o=t.match(/youtu\.be\/([^&\s+]+)/i)[1].replace(/(\s*)/,"")),!o.length)return e.bg.video={},void l._object.clientMsg("video_bg_destroy");e.bg.video={type:"youtube",id:o,url:t},l._object.clientMsg("video_bg_update",e.bg.video);var a=$(".video-image img",e.root);if(!a.hasClass("check_load")){var g=["maxresdefault.jpg","hqdefault.jpg","mqdefault.jpg","default.jpg"],n=0;e.bg.video_image="https://img.youtube.com/vi/"+o+"/"+g[n],a.attr("src",e.bg.video_image+"?"+(new Date).getTime()),a.addClass("check_load").off("load.check_img error.check_img").on("load.check_img error.check_img",function(i){120==i.currentTarget.naturalWidth&&90==i.currentTarget.naturalHeight?(n++,e.bg.video_image="https://img.youtube.com/vi/"+o+"/"+g[n],e.bg.originalVideoPreview=e.bg.video_image,a.attr("src",e.bg.video_image+"?"+(new Date).getTime())):(a.removeClass("check_load").off("load.check_img error.check_img").attr("src",e.bg.video_image),e.bg.originalVideoPreview=e.bg.video_image,e.update())})}e.update(),s(e.bg,"full")},200,i)}.bind(this),this.on("mount",function(){e.init(),flexbe.files.upload.init({$input:$('input[type="file"]',e.root),type:"image",on_progress:function(i,t){e.update({loaded:t})},on_complete:function(i,t){t&&t.img_id?(e.loaded=100,e.bg["video"==e.bg.type?"video_image":"image"]="/img/"+t.img_id+"_2560/"+t.img_name,e.update(),s(e.bg,"full")):alertify.error(polyglot.t("editor::bg_settings::upload_error"))}}),e.options.position&&(~e.options.type.indexOf("image")||~e.options.type.indexOf("video"))&&(e.bg.position||(e.bg.position={}))}),this.on("updated",function(){s(e.bg)})});
riot.tag2("flexbe-page-add-item",'<div class="gubert-card" onmouseenter="{cardHover}" onmouseleave="{cardHover}" onclick="{cardClick}"> <div sub-action class="template-preview"> <div class="preview-image" riot-style="background-image: url({opts.template.img})"></div> </div> <div class="template-data"> <div class="template-desc"> <span>{opts.template.title}</span> <span class="tiny-label" if="{opts.template.label}" riot-style="{color: opts.template.label.color}">{opts.template.label.text}</span> </div> <div main-action class="gubert-button blue fill select {loading: main.inCreate == opts.template.id} {hover: inHover}"> <span>{polyglot.t(\'admin::pages::page_add::select\')}</span> </div> <div sub-action class="gubert-button blue fade select"> <span>{polyglot.t(\'admin::pages::page_add::show\')}</span> </div> </div> </div>',"",'class="template-preview-wrap"',function(e){this.tag=this,this.main=this.parent?this.parent.main?this.parent.main:this.parent:this,this.inHover=!1,this.cardHover=function(e){}.bind(this),this.cardClick=function(e){$(e.target).is("[main-action]")||$(e.target).closest("[main-action]").length?this.main.createPage(this.opts.template.id):($(e.target).is("[sub-action]")||$(e.target).closest("[sub-action]").length)&&this.main.showPreview(this.opts.template,!1)}.bind(this)}),riot.tag2("flexbe-page-add",'<header> <div class="title-wrap"> <div class="title" if="{!isFirstPage}"> {polyglot.t(\'admin::pages::page_add::create\')} <span class="type-select"> {p_type == 0 ? polyglot.t(\'admin::pages::page_add::create_lp\') : polyglot.t(\'admin::pages::page_add::create_site\')} <svg class="arrow-down" viewbox="0 0 9 6"><path d="M4.5 6L0 1.454 1.444 0 4.5 3.09 7.556 0 9 1.454z"></path></svg> <dropdown autoposition="{false}" autohide="{true}"> <ul> <li class="{active: parent.p_type == 0}" onclick="{parent.togglePageType.bind(parent, 0); this.show = false;}"> <span>{polyglot.t(\'admin::pages::page_add::lp_item\')}</span> </li> <li class="{active: parent.p_type == 1}" onclick="{parent.togglePageType.bind(parent, 1); this.show = false;}"> <span>{polyglot.t(\'admin::pages::page_add::site_item\')}</span> </li> </ul> </dropdown> </span> </div> <div class="title" if="{isFirstPage}"> {polyglot.t(\'admin::pages::page_add::first_page\')} </div> <a class="close" if="{isModal}"></a> </div> </header> <div class="page-content"> <div class="page-params" hide="{isFirstPage}"> <div class="gubert-text-field page-title"> <div class="field-title">{polyglot.t(\'admin::pages::page_add::title\')}</div> <input type="text" riot-value="{p_title}" required="" oninput="{setPageTitle}" maxlength="250"> <label>{polyglot.t(\'admin::pages::page_add::enter_title\')}</label> </div> <div class="gubert-text-field page-uri {loading: uriInUse == 1, error: uriInUse == 2}"> <div class="field-title">{polyglot.t(\'admin::pages::page_add::uri\')}</div> <input type="text" riot-value="{isNewGroup ? \'\' : p_uri}" oninput="{setPageUri}" onchange="{checkPageUri.bind(this, 0, false)}" maxlenght="250" disabled="{isNewGroup}" required=""> <label>{isNewGroup ? polyglot.t(\'admin::pages::page_add::main\') : \'/example/\'}</label> <div class="err"><span>{polyglot.t(\'admin::pages::page_add::uri_error\')}</span></div> <svg class="loader circular-loader" viewbox="25 25 50 50"> <circle class="loader-path" cx="50" cy="50" r="20"></circle> </svg> <svg class="done done-loader" viewbox="0 0 25 19" xmlns="http://www.w3.org/2000/svg"><path d="M1 9l8 7L23 1"></path></svg> </div> </div> <div class="page-type" if="{isFirstPage && allowSelectType}"> <div class="gubert-white-area {active: p_type == 1}"> <img src="/_s/images/land/emoji/mountains.png"> <div class="card-content"> <label>{polyglot.t(\'admin::pages::page_add::site\')}</label> <div class="text-content"> {polyglot.t(\'admin::pages::page_add::site_desc\')} </div> <div class="gubert-button blue fill {active: p_type == 1, success: p_type == 1}" onclick="{togglePageType.bind(this, 1, false)}"> <span>{polyglot.t(\'admin::pages::page_add::select\')}</span> <i class="check"></i> </div> </div> </div> <div class="gubert-white-area {active: p_type != 1}"> <img src="/_s/images/land/emoji/rocket.png"> <div class="card-content"> <label>{polyglot.t(\'admin::pages::page_add::lp\')}</label> <div class="text-content"> {polyglot.t(\'admin::pages::page_add::lp_desc\')} </div> <div class="gubert-button blue fill {active: p_type != 1, success: p_type != 1}" onclick="{togglePageType.bind(this, 0, false)}"> <span>{polyglot.t(\'admin::pages::page_add::select\')}</span> <i class="check"></i> </div> </div> </div> </div> <div class="page-template"> <div class="theme-item {compact: isFirstPage}" each="{theme in themes}"> <div class="title-wrap theme-title" if="{!isFirstPage}"> <div class="name"> <span>{polyglot.t(\'admin::pages::page_add::template\')} {theme.name}</span> <em if="{theme.count}" onclick="{showBlocks.bind(this, theme)}">{polyglot.t(\'admin::pages::page_add::sections\', theme.count)}</em> </div> <div class="gubert-button blue fill select {loading: inCreate == theme.empty}" onclick="{createPage.bind(this, theme.empty)}"> <span>{polyglot.t(\'admin::pages::page_add::empty\')}</span> </div> </div> <div class="templates-wrap"> <div data-is="flexbe-page-add-item" each="{template in theme.pages}" template="{template}"></div> </div> </div> </div> </div>',"","",function(e){var t=this;this.main=this,this.sprite="/_s/images/land/admin/pages.svg",this.isFirstPage=!!this.opts.isFirstPage,this.allowSelectType=!!parseInt(this.opts.allowSelectType,10),this.isModal=!this.isFirstPage,this.groups=flexbe.page.group_list,this.groupId=this.opts.groupId||flexbe.land.group_id,this.isNewGroup="new"==this.groupId,this.p_type=parseInt(localStorage.getItem("p_type"),10)||parseInt(this.opts.pageType,10)||0,this.p_title=this.isNewGroup||this.isFirstPage?polyglot.t("admin::pages::page_add::main"):"",this.p_uri=this.isNewGroup||this.isFirstPage?"/":(this.groupId,"/page_"+flexbe.lib.rand(1e4,99999)+"/"),this.uriInUse=0,this.inGroupSelect=!1,this.currentTemplateView=!1,this.themes=[{name:polyglot.t("admin::pages::page_add::london"),id:3,empty:200569,pages:[{id:294181,title:polyglot.t("admin::pages::page_add::quiz_london"),img:"/_s/images/land/theme/add/quiz_london.jpg",url:"https://themes.flexbe.ru/quiz_london/",label:{text:"QUIZ",color:"#56B157"}},{id:239424,title:polyglot.t("admin::pages::page_add::coffee"),img:"/_s/images/land/theme/add/coffee.jpg",url:"https://themes.flexbe.ru/coffee/"},{id:200160,title:polyglot.t("admin::pages::page_add::english"),img:"/_s/images/land/theme/add/english.jpg",url:"https://themes.flexbe.ru/english/"},{id:200152,title:polyglot.t("admin::pages::page_add::portfolio"),img:"/_s/images/land/theme/add/portfolio.jpg",url:"https://themes.flexbe.ru/portfolio/"},{id:200159,title:polyglot.t("admin::pages::page_add::bicycle_shop"),img:"/_s/images/land/theme/add/bicycle-shop.jpg",url:"https://themes.flexbe.ru/bicycle-shop/"},{id:200156,title:polyglot.t("admin::pages::page_add::kids"),img:"/_s/images/land/theme/add/kids.jpg",url:"https://themes.flexbe.ru/kids-shop/"},{id:200158,title:polyglot.t("admin::pages::page_add::film_festival"),img:"/_s/images/land/theme/add/film-festival.jpg",url:"https://themes.flexbe.ru/film-festival/"},{id:200155,title:polyglot.t("admin::pages::page_add::kontora"),img:"/_s/images/land/theme/add/kontora.jpg",url:"https://themes.flexbe.ru/kontora/"},{id:243400,title:polyglot.t("admin::pages::page_add::video"),img:"/_s/images/land/theme/add/video.jpg",url:"https://themes.flexbe.ru/video/",label:{text:polyglot.t("admin::pages::page_add::bullet_label"),color:"#56B157"}}]},{name:polyglot.t("admin::pages::page_add::paris"),id:2,empty:200572,pages:[{id:294174,title:polyglot.t("admin::pages::page_add::quiz_paris"),img:"/_s/images/land/theme/add/quiz_paris.jpg",url:"https://themes.flexbe.ru/quiz_paris/",label:{text:"QUIZ",color:"#56B157"}},{id:227607,title:polyglot.t("admin::pages::page_add::restaurant"),img:"/_s/images/land/theme/add/restaurant.jpg",url:"https://themes.flexbe.ru/restaurant/"},{id:200161,title:polyglot.t("admin::pages::page_add::auto"),img:"/_s/images/land/theme/add/auto.jpg",url:"https://themes.flexbe.ru/auto/"},{id:200164,title:polyglot.t("admin::pages::page_add::steel"),img:"/_s/images/land/theme/add/steel.jpg",url:"https://themes.flexbe.ru/steel/"},{id:200166,title:polyglot.t("admin::pages::page_add::essential"),img:"/_s/images/land/theme/add/essential.jpg",url:"https://themes.flexbe.ru/essential/"},{id:200162,title:polyglot.t("admin::pages::page_add::flat"),img:"/_s/images/land/theme/add/flat.jpg",url:"https://themes.flexbe.ru/flat/"},{id:200165,title:polyglot.t("admin::pages::page_add::window"),img:"/_s/images/land/theme/add/window.jpg",url:"https://themes.flexbe.ru/window/"},{id:200163,title:polyglot.t("admin::pages::page_add::interior"),img:"/_s/images/land/theme/add/interior.jpg",url:"https://themes.flexbe.ru/interior/"}]}],this.togglePageType=function(e,t){var i=this;if(void 0===t&&(t=!1),(e=parseInt(e,10))!=this.p_type&&(this.update({p_type:e}),localStorage.setItem("p_type",this.p_type),t)){var a=$(".page-type",this.root).outerHeight(!0);setTimeout(function(){$(".page-content",i.root).animate({scrollTop:a})},500)}}.bind(this);var i,a=!1;this.setPageTitle=function(e){e.target&&(this.p_title=e.target.value,a||(this.p_uri=flexbe.regex.clean_page_uri(this.p_title,!0,!0),this.update({uriInUse:1}),this.checkPageUri()))}.bind(this),this.setPageUri=function(e){e.target&&(this.p_uri=e.target.value,a=!0,this.update({uriInUse:1}),this.checkPageUri())}.bind(this),this.checkPageUri=function(e){var t=this;void 0===e&&(e=1e3),this.isNewGroup||this.isFirstPage?this.update({uriInUse:0}):(clearTimeout(i),i=setTimeout(function(){t.p_uri=flexbe.regex.clean_page_uri(t.p_uri,!!t.p_uri)||"/",flexbe.page.checkUri(t.p_uri,t.groupId,function(e){t.update({uriInUse:e.status?2:0})})},e))}.bind(this),this.domainSelect=function(e){e&&(this.groupId=e,this.group=flexbe.page.find_domain_by_id(this.groupId),this.inGroupSelect=!1,this.isNewGroup="new"==this.groupId,this.checkPageUri(0),this.update())}.bind(this),this.showPreview=function(e){var t=this,i=$("<template-preview></template-preview>"),a=flexbe.modal.create({name:"template-preview",type:"overlay",$data:i});riot.mount(i[0],"template-preview",{control:this,modal:a,url:e.url,onselect:function(){t.createPage(e.id)},onclose:function(){}})}.bind(this),this.showBlocks=function(e){flexbe.modal.create({name:"flexbe-block-add",type:"overlay",title:polyglot.t("admin::pages::page_add::section_list")+e.name,riotTag:"block-add-window",riotOpts:{control:this,options:{type:"block",isDemo:!0,themeId:e.id}}})}.bind(this),this.inCreate=!1,this.createPage=function(e){var t=this;if(!this.inCreate){if(this.uriInUse)return this.update({currentTemplateView:!1}),$(".page-content",this.root).animate({scrollTop:0},200),void anime({targets:$(".page-uri",this.root)[0],easing:"linear",loop:3,delay:200,translateX:[{value:5,duration:50,delay:0,elasticity:1e3},{value:-5,duration:100,delay:0,elasticity:1e3},{value:0,duration:50,delay:0,elasticity:1e3}]});this.update({inCreate:e});var i={title:this.p_title,group_id:this.groupId,type:this.p_type,uri:"new"==this.groupId?"/":this.p_uri,is_first_page:this.isFirstPage?1:0,src_p_id:e};flexbe.page.create_request(i,function(e){e.domain&&e.uri?document.location=document.location.protocol+"//"+e.domain+e.uri:(t.update({inCreate:!1}),e.error||($(t.root).find("header .close").trigger("click"),flexbe.page.updateList()))})}}.bind(this);var s,l=function(e){return $(e).toArray().map(function(e){return e.offsetTop})},p=1;this.on("update",function(e){e&&void 0!==e.uriInUse&&($(".page-uri",t.root).removeClass("done"),e.uriInUse||p?p=0:(clearTimeout(s),setTimeout(function(){return $(".page-uri",t.root).addClass("done")},30),s=setTimeout(function(){return $(".page-uri",t.root).removeClass("done")},1500)))}),this.on("mount",function(){t.domainSelect(t.opts.groupId||flexbe.land.group_id);var e=$(".page-content",t.root),i=$(".theme-item",t.root),a=l(i),s=-1;$(window).off("resize.flexbe_page_add").on("resize.flexbe_page_add",$.throttle(function(e){a=l(i)})),e.off("scroll.flexbe_page_add").on("scroll.flexbe_page_add",function(l){var p=function(e,t){if(!Array.isArray(t))return-1;var i=-1;return t.forEach(function(t,a){e>t&&(i=a)}),i}(e[0].scrollTop,a);s!=p&&(s=p,i.removeClass("active"),p>=0&&i.eq(p).addClass("active")),t.inScroll=!0,clearTimeout(void 0),setTimeout(function(){t.inScroll=!1},150)}),t.themes.forEach(function(e){var t=0,i=flexbe.land.themes_json[e.id].block;for(var a in i)t+=i[a].list.length;e.count=t}),t.update()})});
riot.tag2("land-group-select",'<div class="group-overlay" onclick="{onClose}"> <a class="close"></a> </div> <div class="group-list"> <div class="title"> {titleText} </div> <div class="select-content"> <ul class="gubert-list scrollable-content"> <li each="{group in list}" class="{active: group.group_id == id}" onclick="{setCurrent.bind(this, group.group_id)}"> <span>{group.domain}</span> </li> <li if="{opts.inNewDomain}" class="{active: id == \'new\'}" onclick="{setCurrent.bind(this, \'new\')}"> <span>{polyglot.t(\'admin::pages::add_domen\')}</span> </li> </ul> <div class="gubert-button filled blue {loading: busy}" onclick="{onSelect}" if="{!fastMode}"> <span>{buttonText}</span> </div> </div> </div>',"",'class="{show: show}"',function(t){var e,i=this;this.fastMode=t.fast,this.setCurrent=function(t){this.id=t,this.fastMode&&this.onSelect()}.bind(this),this.onSelect=function(){var i=this;this.busy||(this.busy=!0,"function"==typeof t.onselect&&(clearTimeout(e),e=setTimeout(function(){t.onselect(i.id,function(){i.update({busy:!1})})},50)))}.bind(this),this.onClose=function(){this.busy||"function"!=typeof t.onclose||t.onclose()}.bind(this),this.on("update",function(e){i.titleText=t.name||polyglot.t("admin::pages::select_domen"),i.buttonText=t.button||polyglot.t("admin::pages::done"),i.id=i.id||t.current||flexbe.land.group_id,i.show=t.show,i.list=flexbe.page.group_list,i.show?(1!=i.list.length||t.inNewDomain||(i.busy=!1,i.show=!1,i.onSelect()),t.closeOnEsc&&$document.off("keydown.land_gr_sel").on("keydown.land_gr_sel",function(t){if(i.show&&27===t.which)return i.update({show:!1}),t.preventDefault(),t.stopImmediatePropagation(),!1})):i.busy=!1})}),riot.tag2("flexbe-pages-item",'<div class="gubert-card {controled: (flexbe.user_role != \'manager\' && !main.isPreview)} {hover: inHover}" onmouseenter="{cardHover}" onmouseleave="{cardHover}" onclick="{cardClick}"> <a class="page-preview" href="http://{flexbe.page.formatUrl(main.group.domain, page.uri)}" onclick="{main.selectPage.bind(this, opts.page)}"> <div if="{opts.page.img_id}" class="preview-image" riot-style="background-image: url(//{main.group.domain}/img/{opts.page.img_id}/page.jpg)"></div> <div if="{!opts.page.img_id}" class="preview-image"></div> </a> <div class="page-title {no-title: !opts.page.title || opts.page.title == \'Название компании\'}"> <raw content="{flexbe.lib.htmlspecialchars(opts.page.title || polyglot.t(\'admin::pages::no_title\'), true)}"></raw> </div> <div class="page-uri" href="http://{flexbe.page.formatUrl(main.group.domain, opts.page.uri)}" onclick="{main.selectPage.bind(this, opts.page)}"> <raw content="{flexbe.page.formatUrl(main.group.domain, opts.page.uri, false, true)}"></raw> </div> <div class="page-data" if="{!main.isPreview}"> <div class="page-stat" if="{main.stat[opts.page.id]}"> <div class="stat-info gubert-icon-label"> <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" riot-xlink:href="{main.sprite}#lead"></use></svg> <span>{main.stat[opts.page.id].leads || 0}</span> </div> <div class="stat-info gubert-icon-label"> <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" riot-xlink:href="{main.sprite}#visit"></use></svg> <span>{main.stat[opts.page.id].visits || 0}</span> </div> </div> <div class="page-control" if="{flexbe.user_role != \'manager\' && !main.isPreview}"> <a class="gubert-link-button" onclick="{main.pageSettings.bind(this, opts.page.id)}">{polyglot.t(\'admin::pages::settings\')}</a> <a class="gubert-link-button" onclick="{main.toggleDomainSelectOld.bind(this, \'copy\', [opts.page.id, main.group.group_id])}">{polyglot.t(\'admin::pages::copy\')}</a> <a class="remove gubert-icon-button" onclick="{main.pageDelete.bind(this, opts.page)}" if="{opts.page.uri !== \'/\'}"> <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" riot-xlink:href="{main.sprite}#delete"></use></svg> </a> </div> </div> </div>',"",'class="page-item"',function(t){this.tag=this,this.main=this.parent?this.parent.main?this.parent.main:this.parent:this,this.inHover=!1,this.cardHover=function(t){this.update({inHover:"mouseenter"==t.type})}.bind(this),this.cardClick=function(t){$(t.target).is("[main-action]")||$(t.target).closest("[main-action]").length?this.main.createPage(this.opts.template.id):($(t.target).is("[sub-action]")||$(t.target).closest("[sub-action]").length)&&this.main.showPreview(this.opts.template,!1)}.bind(this)}),riot.tag2("flexbe-pages",'<land-group-select name="{domainSelectTitle}" in-new-domain="true" close-on-esc="true" show="{showGroupSelect}" onselect="{domainSelect}" onclose="{toggleDomainSelectOld.bind(this, false)}"></land-group-select> <header> <div class="page-add" if="{!isPreview}"> <div class="gubert-button filled blue" onclick="{pageAdd}"> <span>{polyglot.t(\'admin::pages::add\')}</span> </div> </div> <div class="title" if="{isPreview}"> {polyglot.t(\'admin::pages::select\')} </div> <a class="flexbe_modal_close" if="{isPreview}"></a> </header> <div class="container"> <div class="content"> <div class="group-list scrollable-content"> <div class="group-item"> <div class="page-list"> <div data-is="flexbe-pages-item" each="{page in flexbe.page.list}" page="{page}"></div> </div> </div> </div> </div> </div>',"","",function(t){var e=this;this.main=this,this.type=t.type||"page",this.sprite="/_s/images/land/admin/pages.svg?1",this.group=flexbe.page.group_list.filter(function(t){return t.group_id==flexbe.land.group_id})[0],this.isPreview="overlay"==this.type,this.stat=flexbe.page.stat,this.positionCopyDropdown=function(t){var e=$(".group-list",this.root),i=$("dropdown",this.root),s=$(t.target),o=e.scrollTop()+s.offset().top-e.offset().top,a=s.offset().left;i.css({top:o,left:a})}.bind(this),this.toggleDomainSelectOld=function(t,e){"copy"==t&&Array.isArray(e)&&(this.copyId=e[0]),this.update({showGroupSelect:void 0===t?!this.showGroupSelect:t})}.bind(this),this.toggleDomainSelect=function(t,e){$("dropdown",this.root).attr("is-show")||(this.copyId=t,$("dropdown .toggle-helper",this.root)[0].click())}.bind(this),this.itemHover=function(t){$(t.target).toggleClass("hover","mouseenter"==t.type)}.bind(this),this.domainSelect=function(t,e){var i=this;t&&this.copyId&&(this.update({inCopy:!0}),flexbe.page.create(t,this.copyId,function(t){i.update({inCopy:!1}),"function"==typeof e&&e()}))}.bind(this),this.selectPage=function(e,i){return!this.isPreview||("function"==typeof t.onselect?(t.onselect(e,this.group),i.preventDefault(),!1):void 0)}.bind(this),this.pageAdd=function(){flexbe.page.create(flexbe.land.group_id)}.bind(this),this.pageSettings=function(t){flexbe.page.settings(t)}.bind(this),this.pageDelete=function(t){var e=this;"/"==t.uri?alert(polyglot.t("admin::pages::main_error")):confirm(polyglot.t("admin::pages::delete"))&&flexbe.page.remove(t.id,function(){e.update()})}.bind(this),$(window).on("update_page_list",function(){e.update()}),this.on("update",function(){e.domainSelectTitle="copy"==e.showGroupSelect?polyglot.t("admin::pages::copy_place"):polyglot.t("admin::pages::select_domen")}),this.on("mount",function(){e.isPreview?flexbe.page.updateList():flexbe.page.updateStat(function(t,i){!t&&i&&e.update({stat:i})})})});
function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}riot.tag2("page-settings",'<header> <div class="title">{polyglot.t(\'admin::pages::page_settings::title\')} <span>{flexbe.page.formatUrl(data.domain, originalUri)}</span></div> <a class="flexbe_modal_close"></a> </header> <div class="container"> <div class="sidebar"> <ul class="gubert-list"> <li each="{group in groups}" class="{active: group.id == current, hidden: group.hidden}" onclick="{selectGroup.bind(this, group.id, 300)}"> <span>{group.title}</span> <svg viewbox="0 0 18 12" xmlns="http://www.w3.org/2000/svg"><path d="M0 5h14.2l-3.6-3.6L12 0l6 6-6 6-1.4-1.4L14.2 7H0z" fill-rule="evenodd"></path></svg> </li> </ul> </div> <div class="content"> <div class="group-title fixed"> <span class="title"> <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" riot-xlink:href="{sprite}#settings_{current}"></use></svg> {getCurrent().title} </span> </div> <div class="group-list scrollable-content"> <div class="group-item {active: group.id == current, hidden: group.hidden}" each="{group in groups}" data-group-id="{group.id}"> <div class="group-title"> <span class="title"> <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" riot-xlink:href="{sprite}#settings_{group.id}"></use></svg> {group.title} </span> </div> <div class="page-settings {group.id}" if="{group.id == \'base\'}"> <div class="set-item convert-theme" if="{data.theme_id == 1}"> <div class="gubert-text-field"> <div class="field-title">{polyglot.t(\'admin::pages::page_settings::update_title\')}</div> <div class="gubert-button filled blue {loading: inConvert}" onclick="{convertTheme.bind(this, 3)}"><span>{polyglot.t(\'admin::pages::page_settings::update\')}</span></div> </div> <div class="gubert-help runned"> <div class="ico i w"> <i></i><i></i><i></i> </div> <span>{polyglot.t(\'admin::pages::page_settings::update_help\')}</span> </div> </div> <div class="set-item restore-theme" if="{data.theme_id == 3 && restore_version}"> <div class="gubert-text-field"> <div class="field-title">{polyglot.t(\'admin::pages::page_settings::update_design\')}</div> <div class="btn-holder"> <div class="gubert-button filled blue {loading: inConvert}" onclick="{convertTheme.bind(this, 1)}"><span>{polyglot.t(\'admin::pages::page_settings::cancel_update\')}</span></div> <div class="caption"> <span data-is="raw" content="{polyglot.t(\'admin::pages::page_settings::restore_update\', { ver: restore_version })}"></span> </div> </div> </div> <div class="gubert-help runned"> <div class="ico i w"> <i></i><i></i><i></i> </div> <span data-is="raw" content="{polyglot.t(\'admin::pages::page_settings::restore_help\')}"></span> </div> </div> <div class="set-item {has-error: fields.p_title.error}"> <div class="gubert-text-field"> <div class="field-title">{polyglot.t(\'admin::pages::page_settings::page_title\')}</div> <input type="text" riot-value="{flexbe.lib.htmlspecialchars(data.p_data.title, true)}" oninput="{setTitle}" maxlength="250" required> <label>{polyglot.t(\'admin::pages::page_settings::enter_title\')}</label> </div> <div class="gubert-help"> <div class="ico {fields.p_title.icon}"> <i></i><i></i><i></i> </div> <span>{fields.p_title.text}</span> </div> </div> <div class="set-item uri {has-error: fields.p_uri.error}"> <div class="gubert-text-field"> <div class="field-title">{polyglot.t(\'admin::pages::page_settings::page_address\')}</div> <input type="text" riot-value="{data.p_uri || \'/\'}" oninput="{setUri}" onchange="{checkUri.bind(this, 0)}" required disabled="{isMain}" maxlength="250"> <label if="{!isMain}">/about/</label> <a class="gubert-sub-feature no-border {hide: data.p_uri == \'/\'}" onclick="{setUri.bind(this, \'/\')}"> <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" riot-xlink:href="{sprite}#home"></use></svg> <span>{polyglot.t(\'admin::pages::page_settings::make_main\')}</span> </a> </div> <div class="gubert-help"> <div class="ico {fields.p_uri.icon}"> <i></i><i></i><i></i> </div> <span>{fields.p_uri.text}</span> </div> </div> <div class="set-item type" show="{data.theme_id != 1}"> <div class="gubert-checkbox-field"> <label> <input type="checkbox" checked="{data.p_type == 1}" onchange="{togglePageType}"> <span>{polyglot.t(\'admin::pages::page_settings::make_site\')}</span> </label> </div> <div class="gubert-help"> <div class="ico i"> <i></i><i></i><i></i> </div> <span>{polyglot.t(\'admin::pages::page_settings::make_site_help\')}</span> </div> </div> </div> <div class="page-settings {group.id}" if="{group.id == \'seo\'}"> <div class="set-item {has-error: fields.meta_desc.error}"> <div class="gubert-text-field"> <div class="field-title">{polyglot.t(\'admin::pages::page_settings::seo_title\')} <span>(meta-description)</span></div> <textarea rows="4" cols="80" oninput="{setMetaDesc}">{data.p_data.meta_desc}</textarea> </div> <div class="gubert-help"> <div class="ico {fields.meta_desc.icon}"> <i></i><i></i><i></i> </div> <span>{fields.meta_desc.text}</span> </div> </div> <div class="set-item {has-error: fields.meta_keywords.error}"> <div class="gubert-text-field"> <div class="field-title">{polyglot.t(\'admin::pages::page_settings::seo_keys\')} <span>(meta-keywords)</span></div> <input type="text" riot-value="{data.p_data.meta_keywords}" oninput="{setMetaKeywords}"> </div> <div class="gubert-help"> <div class="ico {fields.meta_keywords.icon}"> <i></i><i></i><i></i> </div> <span>{fields.meta_keywords.text}</span> </div> </div> </div> <div class="page-settings {group.id}" if="{group.id == \'socials\'}"> <div class="set-item"> <div class="gubert-text-field"> <div class="field-title">{polyglot.t(\'admin::pages::page_settings::soc_title\')}</div> <input type="text" riot-value="{flexbe.lib.htmlspecialchars(data.p_data.og_title, true)}" oninput="{setOgTitle}"> </div> <div class="gubert-help"> <div class="ico i"> <i></i><i></i><i></i> </div> <span>{polyglot.t(\'admin::pages::page_settings::soc_help\')}</span> </div> </div> <div class="set-item"> <div class="gubert-text-field"> <div class="field-title">{polyglot.t(\'admin::pages::page_settings::soc_desc\')}</div> <textarea rows="4" cols="80" oninput="{setOgDesc}">{flexbe.lib.htmlspecialchars(data.p_data.og_desc, true)}</textarea> </div> <div class="gubert-help"> <div class="ico i"> <i></i><i></i><i></i> </div> <span>{polyglot.t(\'admin::pages::page_settings::soc_desc_help\')}</span> </div> </div> <div class="set-item image-upload"> <div class="social-preview"> <label class="upload-button"> <input type="file"> <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" riot-xlink:href="{sprite}#plus"></use></svg> <span>{polyglot.t(\'admin::pages::page_settings::soc_upload\')}</span> <div class="card-item"> <div class="image-preview" riot-style="{data.p_data.meta_img && \'background-image: url(\' + data.p_data.meta_img + \')\'}"></div> <div class="title-preview">{flexbe.lib.htmlspecialchars(data.p_data.og_title || data.p_data.title || \'\', true)}</div> <div class="desc-preview">{flexbe.lib.htmlspecialchars(data.p_data.og_desc || meta_desc || \'\', true)}</div> <div class="domain-preview">{data.domain}</div> </div> </label> </div> <div class="gubert-help"> <div class="ico i"> <i></i><i></i><i></i> </div> <span data-is="raw" content="{socialImageUploadHelpText}"></span> </div> </div> </div> <div class="page-settings {group.id}" if="{group.id == \'code\'}"> <div class="set-item {has-error: fields.code_head.error}"> <div class="gubert-text-field"> <div class="field-title">{polyglot.t(\'admin::pages::page_settings::head_title\')}</div> <textarea rows="4" cols="80" oninput="{setCodeHead}">{data.p_data.code_head}</textarea> </div> <div class="gubert-help"> <div class="ico {fields.code_head.icon}"> <i></i><i></i><i></i> </div> <span>{fields.code_head.text}</span> </div> </div> <div class="set-item {has-error: fields.code_body.error}"> <div class="gubert-text-field"> <div class="field-title">{polyglot.t(\'admin::pages::page_settings::body_title\')}</div> <textarea rows="4" cols="80" oninput="{setCodeBody}">{data.p_data.code_body}</textarea> </div> <div class="gubert-help"> <div class="ico {fields.code_body.icon}"> <i></i><i></i><i></i> </div> <span>{fields.code_body.text}</span> </div> </div> </div> </div> </div> </div> </div> <footer> <div class="gubert-button filled blue save {loading: inSave}" onclick="{savePage}"><span>{polyglot.t(\'admin::pages::page_settings::save\')}</span></div> <div class="gubert-button blue close">{polyglot.t(\'admin::pages::page_settings::cancel\' )}</div> </footer>',"","",function(t){var i,e,s=this;this.scope=t.scope,this.data=t.data,this.sprite="/_s/images/land/admin/pages.svg?4",this.groups=[{id:"base",title:polyglot.t("admin::pages::page_settings::mains")},{id:"seo",title:"SEO"},{id:"socials",title:polyglot.t("admin::pages::page_settings::soc")},{id:"code",title:polyglot.t("admin::pages::page_settings::code"),hidden:99!=flexbe.land.theme_id&&"#advanced"!=location.hash}],this.current=this.groups[0].id,this.fields={},this.uriInUse=0,this.originalUri=this.data.p_uri,this.isMain="/"==this.originalUri,this.socialImageUploadHelpText=polyglot.t("admin::pages::page_settings::soc_upload_help",{uri:"https://developers.facebook.com/tools/debug/sharing/?q="+(this.data.domain+this.data.p_uri)}),this.getCurrent=function(){var t=this;return this.groups.filter(function(i){return i.id==t.current&&!i.hidden})[0]||{}}.bind(this),this.setTitle=function(t){if(t.target){var i=flexbe.lib.htmlspecialchars(t.target.value);this.data.p_title=i,this.data.p_data.title=i}}.bind(this),this.setUri=function(t){("object"!=_typeof(t)||t.target)&&(this.data.p_uri="string"==typeof t?t:t.target.value,this.data.p_uri?(this.uriInUse=1,this.checkUri()):(this.data.p_uri="/",$(".uri input",this.root).val("/")))}.bind(this),this.checkUri=function(t){var i=this;void 0===t&&(t=1e3),clearTimeout(e),this.originalUri!=this.data.p_uri&&"/"!=this.data.p_uri?e=setTimeout(function(){i.data.p_uri=flexbe.regex.clean_page_uri(i.data.p_uri,!!i.data.p_uri),flexbe.page.checkUri(i.data.p_uri,i.data.group_id,function(t){i.update({uriInUse:t.status?2:0})})},t):this.update({uriInUse:0})}.bind(this),this.togglePageType=function(t){t.target&&(this.data.p_type=t.target.checked?1:0,this.typeChanged=!0)}.bind(this),this.setMetaDesc=function(t){t.target&&(this.data.p_data.meta_desc=t.target.value)}.bind(this),this.setMetaKeywords=function(t){t.target&&(this.data.p_data.meta_keywords=t.target.value)}.bind(this),this.setCodeHead=function(t){t.target&&(this.data.p_data.code_head=t.target.value)}.bind(this),this.setCodeBody=function(t){t.target&&(this.data.p_data.code_body=t.target.value)}.bind(this),this.setOgTitle=function(t){t.target&&(this.data.p_data.og_title=flexbe.lib.htmlspecialchars(t.target.value))}.bind(this),this.setOgDesc=function(t){t.target&&(this.data.p_data.og_desc=flexbe.lib.htmlspecialchars(t.target.value))}.bind(this);var a,d,o=function(){this.fields.p_title={error:!this.data.p_data.title,icon:this.data.p_data.title?"i":"e",text:this.data.p_data.title?polyglot.t("admin::pages::page_settings::title_error"):polyglot.t("admin::pages::page_settings::title_info")},this.fields.p_uri={error:!1,icon:"i",text:polyglot.t("admin::pages::page_settings::uri_info")},this.data.p_uri?1==this.uriInUse?(this.fields.p_uri.error=!1,this.fields.p_uri.icon="i",this.fields.p_uri.text=polyglot.t("admin::pages::page_settings::uri_process")):2==this.uriInUse?(this.fields.p_uri.error=!0,this.fields.p_uri.icon="e",this.fields.p_uri.text=polyglot.t("admin::pages::page_settings::uri_use_error")):this.isMain||"/"!=this.data.p_uri||(this.fields.p_uri.icon="i w",this.fields.p_uri.text=polyglot.t("admin::pages::page_settings::uri_change",{domain:this.data.domain,page:flexbe.page.list[0].id})):(this.fields.p_uri.error=!0,this.fields.p_uri.icon="e",this.fields.p_uri.text=polyglot.t("admin::pages::page_settings::uri_error")),this.fields.meta_desc={error:/[<>]/.test(this.data.p_data.meta_desc),icon:/[<>]/.test(this.data.p_data.meta_desc)?"e":"i",text:/[<>]/.test(this.data.p_data.meta_desc)?polyglot.t("admin::pages::page_settings::desc_error"):polyglot.t("admin::pages::page_settings::desc_info")},this.fields.meta_keywords={error:/[<>]/.test(this.data.p_data.meta_keywords),icon:/[<>]/.test(this.data.p_data.meta_keywords)?"e":"i",text:/[<>]/.test(this.data.p_data.meta_keywords)?polyglot.t("admin::pages::page_settings::keywords_error"):polyglot.t("admin::pages::page_settings::keywords_info")},this.fields.code_head={error:"",icon:"i",text:polyglot.t("admin::pages::page_settings::head_info")},this.fields.code_body={error:"",icon:"i",text:polyglot.t("admin::pages::page_settings::code_body")}};this.savePage=function(){var t=this,i=$(this.root).find(".has-error"),e=i.eq(0).closest(".group-item");if(!this.inSave){if(i[0])return this.selectGroup(e.data("groupId")),$("footer",this.root).removeClass("animate"),setTimeout(function(){$("footer",t.root).addClass("animate")},50),!1;this.inSave=!0,"undefined"==typeof pageStore||pageStore.saved||void 0===flexbe.land.save?s.call(this):flexbe.land.save(function(){s.call(t)})}function s(){var t=this;$.ajax({url:"/admin/pages/settings_save",type:"POST",dataType:"json",data:{p_id:this.data.p_id,data:JSON.stringify(this.data)}}).done(function(i){if(1==i.status){if(flexbe.page.updateList(),window.is_editor){var e=t.data.p_data.title;$("head title").text(e),flexbe.panel.$menu.find(".page-settings span").html(e),flexbe.panel.$menu.find(".page-settings").removeClass("warning"),i.is_uri_change&&history.replaceState("","",i.data.p_uri),t.typeChanged&&location.reload()}t.update({inSave:!1}),t.opts.modal.close()}else alertify.error(i.error)})}}.bind(this),this.convertTheme=function(t){var i=this;void 0===t&&(t=3),this.inConvert||(this.inConvert=!0,"undefined"!=typeof pageStore&&(pageStore.saved=!0),3==t?this.scope.update_theme(this.data.p_id,3,function(t){window.is_editor?location.reload():(i.update({inConvert:!1}),flexbe.page.updateList(),i.opts.modal.close())}):this.scope.restore(this.data.p_data.v_id_convert,this.data.p_id,function(t){window.is_editor?location.reload():flexbe.page.updateList()}))}.bind(this),this.selectGroup=function(t,e){if(void 0===e&&(e=300),i.find("[data-group-id="+t+"]")[0]){var s=i.find("[data-group-id="+t+"]")[0].offsetTop-i[0].offsetTop;this.update({current:t}),i.animate({scrollTop:s},e),d=!0,clearTimeout(a),a=setTimeout(function(){d=!1},350)}}.bind(this),this.checkActive=function(){if(!d){var t=i[0].offsetTop+80,e={};$(".group-item",i).not(".hidden").each(function(i,s){$(s).offset().top<=t&&(e.id=s.dataset.groupId)}),e.id&&this.current!=e.id&&this.update({current:e.id})}}.bind(this),this.pageVersionsInit=function(){var t=this,i=this.data.p_data.v_id_convert;i&&3==this.data.theme_id?flexbe.page.getVersion(i,function(i){var e=1e3*i.v_time;i.v_date&&e+2592e6>(new Date).getTime()&&t.update({restore_version:i.v_date})}):this.update({restore_version:!1})}.bind(this),this.gubertInit=function(){var t=this,i=$(this.root);i.on("focusin focusout",".gubert-text-field input, .gubert-text-field textarea",function(t){if($(t.currentTarget).parent().toggleClass("focus","focusin"==t.type),"focusin"==t.type){var i=$(t.currentTarget).closest(".set-item").find(".gubert-help"),e=i.find("i");i.removeClass("run"),e.hide(),setTimeout(function(){i.addClass("run"),e.show()},50)}}),flexbe.files.upload.init({multi:!1,type:"image",$input:i.find(".image-upload input[type='file']"),on_complete:function(i,e){i&&e&&e.img_id&&e.img_name?(t.data.p_data.meta_img="/img/"+e.img_id+"_1200/"+String(e.img_name).replace(/.*\.(jpg|png|gif|jpeg)$/,"og.$1"),t.data.p_data.meta_img_w=Math.floor(e.img_width>1200?1200:e.img_width),t.data.p_data.meta_img_h=Math.floor(t.data.p_data.meta_img_w*e.img_height/e.img_width),t.update()):alertify.error(polyglot.t("admin::pages::page_settings::upload_error"))}})}.bind(this),this.on("update",o),this.on("before-mount",o),this.on("mount",function(){s.pageVersionsInit(),s.gubertInit(),flexbe.page.list.length||flexbe.page.updateList(),i=$(".content .group-list",s.root),s.checkActive(),i.off("scroll.flexbe_page_list").on("scroll.flexbe_page_list",$.throttle(function(t){s.checkActive()},200))})});
riot.tag2("template-preview",'<header> <div class="template-view"> <div class="select-pc {active: view == \'pc\'}" onclick="{setView.bind(this, \'pc\')}"> <svg><use xmlns:xlink="https://www.w3.org/1999/xlink" riot-xlink:href="{sprite}#select-pc"></use></svg> </div> <div class="select-mobile {active: view == \'mobile\'}" onclick="{setView.bind(this, \'mobile\')}"> <svg><use xmlns:xlink="https://www.w3.org/1999/xlink" riot-xlink:href="{sprite}#select-mobile"></use></svg> </div> </div> <div class="template-actions"> <div class="gubert-button blue select" onclick="{cancelSelect}"> <span>{opts.cancelText || polyglot.t(\'editor::template_preview::back\')}</span> </div> <div class="gubert-button filled blue select {loading: inDone}" onclick="{doneSelect}"> <span>{opts.createText || polyglot.t(\'editor::template_preview::choose\')}</span> </div> </div> </header> <div class="preview-wrap"> <div class="preview {view} {loaded: loaded}"> <svg class="loader circular-loader" viewbox="25 25 50 50"><circle class="loader-path" cx="50" cy="50" r="20"></circle></svg> <iframe width="100%" height="100%" frameborder="0" riot-src="{opts.url}" onload="{iframeLoaded}"></iframe> </div> </div>',"","",function(e){this.sprite="/_s/images/land/admin/pages.svg?1",this.view="pc",this.url=e.url,this.loaded=!1,this.inDone=!1;var i=e.modal;this.setView=function(e){this.view=e}.bind(this),this.cancelSelect=function(){i.close(),"function"==typeof e.onclose&&e.onclose()}.bind(this),this.iframeLoaded=function(){var e=this;setTimeout(function(){e.update({loaded:!0})},120)}.bind(this),this.doneSelect=function(){this.inDone=!0,"function"==typeof e.onselect&&e.onselect()}.bind(this)});