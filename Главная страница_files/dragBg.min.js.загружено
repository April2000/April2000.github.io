$(function(){$.fn.dragBg=function(a,b){return this.each(function(){var c=100,d=200,f=$('<div class="dragpoint"></div>');f.css({left:a.pos.x,top:a.pos.y});var g=$(this);g.append(f),g.on('mousedown.drag',function(h){function i(k,l){var m=k-g.offset().left,n=l-g.offset().top;m>d&&(m=d),0>m&&(m=0),n>c&&(n=c),0>n&&(n=0);var o={x:(100*(m/d)).toFixed(2)+'%',y:(100*(n/c)).toFixed(2)+'%'};f.css({left:o.x,top:o.y}),j&&j.css({'background-position':o.x+' '+o.y}),b(o)}/^(relative|absolute)$/.test(g.css('position'))||g.css('position','relative');var j;a.block&&a.bg_el_selector&&(j=a.block.find(a.bg_el_selector)),c=g.height(),d=g.width(),$document.on('mousemove.drag',function(k){i(k.pageX,k.pageY),k.preventDefault()}).one('mouseup.drag',function(){$document.off('mousemove.drag')}),i(h.pageX,h.pageY),h.preventDefault()})})}});