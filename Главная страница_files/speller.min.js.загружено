!function(e){e.extend(e.FroalaEditor.POPUP_TEMPLATES,{"speller.popup":"[_TITLE_][_BUTTONS_]"}),e.FE.RegisterCommand("wordChoose",{callback:function(e,l){this.speller.applyWord(l)},plugin:"speller"}),e.FE.PLUGINS.speller=function(l){var t=!1;return{checkText:function(){var r=function(){alertify.error(l.language.translate("editor::text::speller_error")),l.$tb.find('.fr-command[data-cmd="speller"]').removeClass("loading"),t=!1},o=function(){e("speller",l.$el).each(function(){e(this).replaceWith(this.childNodes)}),e(".speller-shutdown",l.$wp).remove(),l.$tb.removeClass("hide"),l.$el.attr("spellcheck",l.opts.spellcheck),l.$doc.off("keydown.speller"+l.sid)},s=-1,n=setTimeout(function(){t&&r()},1e4),a=l.html.get();if(/<speller/.test(a))o();else if(!t){l.$el.attr("spellcheck",!1),t=!0;try{e.ajax({url:"//speller.yandex.net/services/spellservice.json/checkText",data:{text:a,format:"html"}}).done(function(r){if(t=!1,!r.length)return clearTimeout(n),void alertify.success(l.language.translate("editor::text::speller_no_errors"));l.events.on("window.mouseup",function(t){var o=t.target,n=(l.$tb.find('.fr-command[data-cmd="speller"]'),l.popups.get("speller.popup"));if("SPELLER"===o.tagName&&e(t.target).closest(l.$el).length){var a=o.getAttribute("index");a!==s&&(n&&n.remove(),n=function(e,t){var r='<ul class="speller-wordlist">';e.s.forEach(function(e){r+='<li><a class="fr-command fr-title speller-word" tabIndex="-1" data-cmd="wordChoose" data-param1="'+e+'">'+e+"</a></li>"}),r+="</ul>";var o={title:'<div class="speller-title">'+l.language.translate("editor::text::speller_options")+"</div>",buttons:r};return l.lastError={error:e,el:t},l.popups.create("speller.popup",o)}(r[s=a],o)),l.popups.setContainer("speller.popup",l.$sc);var p=e(o).offset().left+e(o).outerWidth()/2,i=e(o).offset().top+e(o).outerHeight();l.popups.show("speller.popup",p,i,e(o).outerHeight())}}),l.$box.on("froalaEditor.commands.before",function(e,l,t){/speller|wordChoose/.test(t)||o()}),l.$box.on("froalaEditor.froalaEditor.blur",function(){var e=l.popups.get("speller.popup");e&&e.remove(),o()}),l.$doc.on("keydown.speller"+l.sid,function(e){27===e.keyCode&&o()}),l.$wp.append('<div class="speller-shutdown"><svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"/><path d="M4.5 10l-.65.76.78.667.646-.796L4.5 10zM.35 7.76l3.5 3 1.3-1.52-3.5-3-1.3 1.52zm4.926 2.87l6.5-8-1.552-1.26-6.5 8 1.552 1.26z" fill="currentColor" fill-rule="nonzero"/></g></svg></div>'),e(".speller-shutdown",l.$wp).on("click",function(e){o(),l.$box.off("froalaEditor.commands.before")});var p=r.map(function(e){return e.word});a=a.replace(new RegExp(p.join("|"),"g"),function(e,l){var t,o=r.find(function(e,r){return t=r,e.pos==l});return o&&o.s.length?"<speller index="+t+">"+e+"</speller>":e}),l.html.set(a),l.$tb.addClass("hide"),clearTimeout(n)})}catch(e){clearTimeout(n),r()}}},applyWord:function(t){var r=l.popups.get("speller.popup");e(l.lastError.el).replaceWith(t),r&&r.remove()},setButtonState:function(e){var r="";e.removeClass("loading fr-active"),t&&(r="loading"),/<speller/.test(l.html.get())&&(r="fr-active"),e.addClass(r)}}},e.FE.DefineIcon("speller",{PATH:'<svg viewBox="0 0 28 28"><path d="M8.12 9h7.76l.12 2.5h-.28c-.018-.235-.066-.338-.143-.5-.023-.05-.05-.104-.077-.17a1.49 1.49 0 0 0-.61-.63l-.047-.022c-.275-.13-.375-.178-.953-.178H12.5v7.27c0 .386.024.794.2 1.15.153.31.604.31.95.31H14V19h-4v-.27h.348c.358 0 .794 0 .992-.39.14-.338.16-.692.16-1.07V10h-1.24c-.26 0-.674.017-1 .1a1.36 1.36 0 0 0-.66.54l-.04.066c-.174.282-.27.44-.28.794H8L8.12 9zm8.734 9.354l3-3-.707-.708-2.647 2.647-1.146-1.147-.708.708 1.5 1.5.354.353.354-.353z" /></svg>',template:"flexbeSVG"}),e.FE.RegisterCommand("speller",{title:"editor::text::speller",icon:"speller",callback:function(){this.speller.checkText()},refresh:function(e){this.speller.setButtonState(e)},plugin:"speller"})}(jQuery);