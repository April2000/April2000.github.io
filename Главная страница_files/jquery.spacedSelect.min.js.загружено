(function(a){a.fn.spacedSelect=function(b){a(this).each(function(){function c(){var f=d.find('option'),g=f.filter(':selected'),h=f.filter(':first').text();g.length&&(h=g.text());var i=a('<ul></ul>');f.each(function(w,x){var y='',z=a(x);z.is(':selected')&&(y=' class="selected sel"'),z.is(':disabled')&&(y=' class="disabled"'),z.attr('value')&&(y+=' data-value="'+z.attr('value')+'"'),z.attr('data-id')&&(y+=' data-id="'+z.attr('data-id')+'"');var A=a('<li'+y+'>'+z.text()+'</li>');if(z.parent().is('optgroup')){var B=z.parent().attr('label'),C=i.find('li[data-group="'+B+'"] ul').eq(0);if(1>C.length){var D=a('<li data-group="'+B+'"><span>'+B+'</span></li>');C=a('<ul></ul>'),D.append(C),i.append(D)}C.append(A)}else i.append(A)});var j=a('<span class="spacedSelect" style="display:inline-block;position:relative"><div class="select" style="float:left;position:relative;z-index:10000"><div class="text">'+h+'</div><b class="trigger"><i class="arrow"></i></b></div><div class="dropdown" style="position:absolute;z-index:9999;list-style:none"></div></span>');d.before(j).css({position:'absolute',top:-9999,left:-1e3}),j.find('.dropdown').html(i);var k=j.find('div.select'),l=j.find('div.text'),m=j.find('div.dropdown'),p=m.find('li'),q=j.outerHeight(),r=b&&b.left?b.left:0;'auto'==m.css('left')&&m.css({left:r}),'auto'==m.css('top')&&m.css({top:q});var s=p.outerHeight(),t=m.css('top');if(t=parseInt(t)+1,b&&b.top&&(t=b.top),b&&b.bottom){var u=!0;t=b.bottom}m.hide(),k.click(function(){var w=j.offset().top,x=a(window).height()-q-(w-a(window).scrollTop());return(m.height('auto').css({top:'auto',bottom:t}),m.outerHeight()>w-a(window).scrollTop()-20&&m.height(Math.floor((w-a(window).scrollTop()-20)/s)*s)),a('span.spacedSelect').css({zIndex:1}).removeClass('focused'),j.css({zIndex:2}),m.is(':hidden')?(a('div.dropdown:visible').hide(),m.show()):m.hide(),!1}),p.off('mouseenter').on('mouseenter',function(){a(this).siblings().removeClass('selected')}),b&&b.hover&&i.on('mouseenter.spacedSelect mouseleave.spacedSelect','li:not([data-group])',b.hover);var v=p.filter('.selected').text();p.filter('.selected').is('[data-title]')&&(v=p.filter('.selected').attr('data-title')),p.filter(':not(.disabled,[data-group])').click(function(){var w=a(this).attr('data-value');d.val(w);var x=d.find('option[value="'+w+'"]'),y=a(this).text();x.is('[data-title]')&&(y=x.attr('data-title')),v!=y&&(a(this).closest('.dropdown').find('li').removeClass('selected sel'),a(this).addClass('selected sel'),v=y,l.text(y),d.change()),m.hide()}),m.mouseout(function(){m.find('li.sel').addClass('selected')}),d.focus(function(){a('span.spacedSelect').removeClass('focused'),j.addClass('focused')}).keyup(function(){l.text(f.filter(':selected').text()),p.removeClass('selected sel').eq(f.filter(':selected').index()).addClass('selected sel')}),a(document).on('click',function(w){a(w.target).parents().hasClass('spacedSelect')||(m.hide().find('li.sel').addClass('selected'),j.removeClass('focused'))})}var d=a(this);d.prev('span.spacedSelect').length&&d.prev('span.spacedSelect').remove(),c(),d.on('refresh',function(){d.prev().remove(),c()})})}})(jQuery);